<!DOCTYPE html>
<html lang="ko">
<head>
<style>
:root {
  --purple: #8b5cf6;
  --purple-dark: #7c3aed;
  --purple-darker: #6d28d9;
  --purple-light: #ede9fe;
  --purple-pale: #f5f3ff;
  --green: #10b981;
  --green-light: #d1fae5;
  --yellow: #f59e0b;
  --yellow-light: #fef3c7;
  --red: #ef4444;
  --red-light: #fee2e2;
  --blue: #3b82f6;
  --blue-light: #dbeafe;
  --gray-50: #f9fafb;
  --gray-100: #f3f4f6;
  --gray-200: #e5e7eb;
  --gray-300: #d1d5db;
  --gray-500: #6b7280;
  --gray-700: #374151;
  --gray-900: #111827;
  --text: #0f172a;
  --border: #e5e7eb;
  --surface: #f8fafc;
  --font: 'Inter', 'Noto Sans KR', sans-serif;
}
</style>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ë¼ì´ë¸ŒëŸ¬ë¦¬ â€” TimeLink</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&family=Noto+Sans+KR:wght@400;500;700;900&display=swap" rel="stylesheet">
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: var(--font); background: #f8fafc; color: #0f172a; line-height: 1.5; }

/* ë„¤ë¹„ê²Œì´ì…˜ */
.navbar {
  background: white;
  border-bottom: 1px solid #e2e8f0;
  padding: 0 24px;
  height: 64px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  position: sticky;
  top: 0;
  z-index: 100;
  gap: 16px;
}
.logo {
  display: flex;
  align-items: center;
  gap: 10px;
  font-size: 20px;
  font-weight: 800;
  color: #0f172a;
  text-decoration: none;
  flex-shrink: 0;
}
.logo-icon {
  width: 32px;
  height: 32px;
  background: #8b5cf6;
  border-radius: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-size: 16px;
}
.logo span { color: #8b5cf6; }
.nav-right { display: flex; align-items: center; gap: 12px; flex-shrink: 0; }
.btn {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 10px 20px;
  border-radius: 999px;
  font-weight: 600;
  font-size: 14px;
  cursor: pointer;
  transition: all 0.2s;
  border: none;
  text-decoration: none;
}
.btn-primary { background: #8b5cf6; color: white; }
.btn-primary:hover { background: #7c3aed; }
.btn-outline { background: white; color: #1f2937; border: 1px solid #e5e7eb; }
.btn-sm { padding: 6px 14px; font-size: 13px; }

.balance {
  background: #f3f4f6;
  border-radius: 999px;
  padding: 6px 16px;
  display: flex;
  align-items: center;
  gap: 16px;
}
.balance-item { display: flex; align-items: center; gap: 6px; font-size: 14px; }
.balance-label { color: #6b7280; font-weight: 500; }
.balance-value { font-weight: 700; color: #8b5cf6; }

.avatar {
  width: 36px;
  height: 36px;
  background: #8b5cf6;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-weight: 700;
  cursor: pointer;
  position: relative;
}
.dropdown {
  position: absolute;
  top: 100%;
  right: 0;
  margin-top: 8px;
  background: white;
  border: 1px solid #e5e7eb;
  border-radius: 12px;
  box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1);
  width: 200px;
  display: none;
  z-index: 1000;
}
.dropdown.show { display: block; }
.dropdown-item {
  padding: 12px 16px;
  cursor: pointer;
  font-size: 14px;
  color: #1f2937;
  text-decoration: none;
  display: block;
}
.dropdown-item:hover { background: #f3f4f6; }
.dropdown-item.danger { color: #ef4444; }

/* íƒ­ */
.tabs {
  background: white;
  border-bottom: 1px solid #e5e7eb;
  padding: 0 24px;
  display: flex;
  justify-content: center;
  gap: 4px;
  position: sticky;
  top: 64px;
  z-index: 90;
  overflow-x: auto;
}
.tab {
  padding: 12px 20px;
  font-size: 14px;
  font-weight: 600;
  color: #6b7280;
  text-decoration: none;
  border-bottom: 2px solid transparent;
  transition: all 0.2s;
  white-space: nowrap;
}
.tab:hover { color: #8b5cf6; }
.tab.active { color: #8b5cf6; border-bottom-color: #8b5cf6; }

/* ì»¨í…Œì´ë„ˆ */
.container {
  max-width: 1100px;
  margin: 0 auto;
  padding: 32px 24px;
}

/* í˜ì´ì§€ íƒ­ */
.page-tabs {
  display: flex;
  gap: 8px;
  margin-bottom: 28px;
  background: white;
  padding: 6px;
  border-radius: 16px;
  width: fit-content;
  box-shadow: 0 1px 3px rgba(0,0,0,0.08);
}
.page-tab {
  padding: 9px 20px;
  border-radius: 12px;
  font-weight: 700;
  font-size: 14px;
  cursor: pointer;
  border: none;
  background: transparent;
  color: #6b7280;
  transition: all .2s;
}
.page-tab.active { background: #8b5cf6; color: white; }

/* ì¹´ë“œ */
.card {
  background: white;
  border-radius: 20px;
  padding: 24px;
  box-shadow: 0 1px 3px rgba(0,0,0,0.08);
  margin-bottom: 20px;
}

/* í†µê³„ */
.stats-row {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 16px;
  margin-bottom: 24px;
}
.stat-card {
  background: white;
  border-radius: 16px;
  padding: 18px 20px;
  box-shadow: 0 1px 3px rgba(0,0,0,0.08);
  border-left: 4px solid #8b5cf6;
}
.stat-label { font-size: 12px; color: #6b7280; font-weight: 600; margin-bottom: 4px; }
.stat-value { font-size: 24px; font-weight: 800; color: #8b5cf6; }

/* íŒŒì¼ ëª©ë¡ */
.file-list { display: flex; flex-direction: column; gap: 10px; }
.file-item {
  background: white;
  border-radius: 14px;
  padding: 14px 18px;
  display: flex;
  align-items: center;
  gap: 14px;
  box-shadow: 0 1px 3px rgba(0,0,0,0.06);
  transition: all .2s;
}
.file-item:hover { box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
.file-icon {
  width: 48px;
  height: 48px;
  border-radius: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 22px;
  flex-shrink: 0;
  overflow: hidden;
  background: #f3f4f6;
}
.file-icon img { width: 100%; height: 100%; object-fit: cover; }
.file-info { flex: 1; min-width: 0; }
.file-title { font-weight: 700; font-size: 15px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.file-meta { font-size: 12px; color: #6b7280; margin-top: 2px; }
.file-status {
  padding: 4px 12px;
  border-radius: 999px;
  font-size: 12px;
  font-weight: 700;
  flex-shrink: 0;
}
.status-pending { background: #ede9fe; color: #7c3aed; }
.status-verified { background: #ede9fe; color: #7c3aed; }
.status-rejected { background: #fee2e2; color: #dc2626; }
.file-actions { display: flex; gap: 8px; flex-shrink: 0; }
.action-btn {
  padding: 6px 14px;
  border-radius: 999px;
  font-size: 12px;
  font-weight: 700;
  cursor: pointer;
  border: none;
  transition: all .2s;
}
.action-btn-primary { background: #8b5cf6; color: white; }
.action-btn-primary:hover { background: #7c3aed; }
.action-btn-outline { background: white; color: #6b7280; border: 1px solid #e5e7eb; }
.action-btn-outline:hover { background: #f3f4f6; }
.action-btn-green { background: #8b5cf6; color: white; }
.action-btn-green:hover { background: #7c3aed; }

/* ì¸ì¦ ëª¨ë‹¬ */
.modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.5);
  z-index: 500;
  display: none;
  align-items: center;
  justify-content: center;
  padding: 20px;
}
.modal-overlay.show { display: flex; }
.modal {
  background: white;
  border-radius: 24px;
  padding: 32px;
  width: 100%;
  max-width: 600px;
  max-height: 90vh;
  overflow-y: auto;
}
.modal-title { font-size: 22px; font-weight: 800; margin-bottom: 6px; }
.modal-sub { color: #6b7280; font-size: 14px; margin-bottom: 24px; }

.auth-method-tabs {
  display: flex;
  gap: 8px;
  margin-bottom: 24px;
}
.auth-method-tab {
  flex: 1;
  padding: 12px;
  border: 2px solid #e5e7eb;
  border-radius: 14px;
  text-align: center;
  cursor: pointer;
  font-weight: 700;
  font-size: 14px;
  transition: all .2s;
  color: #6b7280;
  background: white;
}
.auth-method-tab.active { border-color: #8b5cf6; color: #8b5cf6; background: #f5f3ff; }

/* Spotify ê²€ìƒ‰ */
.spotify-search-row {
  display: flex;
  gap: 8px;
  margin-bottom: 16px;
}
.spotify-search-row input {
  flex: 1;
  padding: 11px 16px;
  border: 2px solid #e5e7eb;
  border-radius: 12px;
  font-size: 14px;
  outline: none;
  transition: all .2s;
}
.spotify-search-row input:focus { border-color: #1db954; }
.spotify-search-btn {
  padding: 11px 20px;
  background: #1db954;
  color: white;
  border: none;
  border-radius: 12px;
  font-weight: 700;
  cursor: pointer;
}

.spotify-results {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 10px;
  margin-bottom: 16px;
}
.spotify-album-card {
  border: 2px solid #e5e7eb;
  border-radius: 12px;
  overflow: hidden;
  cursor: pointer;
  transition: all .2s;
}
.spotify-album-card:hover { border-color: #1db954; transform: translateY(-2px); }
.spotify-album-card.selected { border-color: #1db954; background: #f0fdf4; }
.spotify-album-card img { width: 100%; aspect-ratio: 1; object-fit: cover; }
.spotify-album-info { padding: 8px; }
.spotify-album-title { font-weight: 700; font-size: 12px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.spotify-album-artist { font-size: 11px; color: #6b7280; }

/* ì¦ë¹™ ì—…ë¡œë“œ */
.proof-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 12px;
  margin-bottom: 16px;
}
.proof-zone {
  border: 2px dashed #e5e7eb;
  border-radius: 14px;
  padding: 16px;
  text-align: center;
  cursor: pointer;
  transition: all .2s;
  min-height: 110px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 6px;
  position: relative;
}
.proof-zone:hover { border-color: #8b5cf6; background: #f5f3ff; }
.proof-zone.filled { border-color: #8b5cf6; background: #f0fdf4; }
.proof-zone.over { border-color: #8b5cf6; background: #f5f3ff; }
.proof-zone-icon { font-size: 24px; }
.proof-zone-label { font-size: 11px; font-weight: 700; color: #6b7280; }
.proof-zone-hint { font-size: 10px; color: #9ca3af; }
.proof-preview { max-width: 100%; max-height: 60px; border-radius: 6px; object-fit: cover; }
.proof-check { font-size: 11px; font-weight: 700; color: #8b5cf6; margin-top: 4px; }
.proof-clear {
  position: absolute;
  top: -6px;
  right: -6px;
  width: 18px;
  height: 18px;
  border-radius: 50%;
  background: #ef4444;
  color: white;
  border: none;
  font-size: 10px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
}

/* ë¹„ìš© ì•ˆë‚´ */
.cost-box {
  background: #fefce8;
  border: 1px solid #fde047;
  border-radius: 12px;
  padding: 14px 16px;
  margin-bottom: 20px;
  display: flex;
  align-items: center;
  justify-content: space-between;
}
.cost-box-label { font-size: 14px; color: #78716c; }
.cost-box-value { font-size: 18px; font-weight: 800; color: #ca8a04; }

/* ë¹ˆ ìƒíƒœ */
.empty-state {
  text-align: center;
  padding: 60px 20px;
  color: #6b7280;
}
.empty-state-icon { font-size: 48px; margin-bottom: 12px; }
.empty-state-title { font-size: 18px; font-weight: 700; margin-bottom: 8px; }
.empty-state-desc { font-size: 14px; margin-bottom: 20px; }

/* í† ìŠ¤íŠ¸ */
.toast {
  position: fixed;
  bottom: 24px;
  left: 50%;
  transform: translateX(-50%) translateY(100px);
  background: #1f2937;
  color: white;
  padding: 12px 24px;
  border-radius: 999px;
  font-weight: 600;
  font-size: 14px;
  z-index: 9999;
  transition: transform .3s;
}
.toast.show { transform: translateX(-50%) translateY(0); }

.hidden { display: none !important; }

@media (max-width: 768px) {
  .stats-row { grid-template-columns: repeat(2, 1fr); }
  .spotify-results { grid-template-columns: repeat(2, 1fr); }
  .proof-grid { grid-template-columns: repeat(2, 1fr); }
}
.page-footer {
  background: #f9fafb;
  border-top: 1px solid #e5e7eb;
  padding: 48px 24px 24px;
  margin-top: 60px;
}
.footer-grid {
  max-width: 1100px;
  margin: 0 auto;
  display: grid;
  grid-template-columns: 1.5fr 1fr 1fr 1fr;
  gap: 40px;
  margin-bottom: 40px;
}
.footer-logo {
  font-size: 18px;
  font-weight: 800;
  margin-bottom: 10px;
  color: #0f172a;
}
.footer-tagline {
  font-size: 13px;
  color: #9ca3af;
  line-height: 1.6;
}
.footer-col-title {
  font-size: 12px;
  font-weight: 700;
  color: #9ca3af;
  text-transform: uppercase;
  letter-spacing: 0.8px;
  margin-bottom: 14px;
}
.footer-col a {
  display: block;
  font-size: 14px;
  color: #6b7280;
  text-decoration: none;
  margin-bottom: 8px;
  transition: color 0.2s;
}
.footer-col a:hover { color: #8b5cf6; }
.footer-bottom {
  max-width: 1100px;
  margin: 0 auto;
  padding-top: 24px;
  border-top: 1px solid #e5e7eb;
  font-size: 12px;
  color: #9ca3af;
  text-align: center;
}
@media (max-width: 768px) {
  .footer-grid { grid-template-columns: 1fr 1fr; gap: 28px; }
}
@media (max-width: 480px) {
  .footer-grid { grid-template-columns: 1fr; }
}
</style>
<style>
/* ê¸€ë¡œë²Œ ì»¨íŠ¸ë¡¤ - ë¼ì´íŠ¸ í…Œë§ˆ ì˜¤ë²„ë¼ì´ë“œ */
.navbar #global-controls button,
nav #global-controls button {
  background: rgba(139,92,246,0.08) !important;
  border: 1px solid rgba(139,92,246,0.2) !important;
  color: #374151 !important;
}
.navbar #global-controls button:hover,
nav #global-controls button:hover {
  background: rgba(139,92,246,0.15) !important;
}

/* Google Translate ì»¤ìŠ¤í…€ ìŠ¤íƒ€ì¼ */
#google_translate_element { display: inline-flex; align-items: center; }
#google_translate_element .goog-te-gadget-simple {
  background: rgba(139,92,246,0.08) !important;
  border: 1px solid rgba(139,92,246,0.2) !important;
  border-radius: 8px !important;
  padding: 4px 10px !important;
  font-size: 13px !important;
  font-family: 'Inter', 'Noto Sans KR', sans-serif !important;
  color: #374151 !important;
  cursor: pointer !important;
}
#google_translate_element .goog-te-gadget-simple:hover {
  background: rgba(139,92,246,0.15) !important;
}
#google_translate_element .goog-te-gadget-simple span { color: #374151 !important; }
#google_translate_element .goog-te-gadget-simple .goog-te-menu-value span:first-child { color: #374151 !important; }
.goog-te-banner-frame { display: none !important; }
body { top: 0 !important; }
.goog-logo-link { display: none !important; }
.goog-te-gadget { font-size: 0 !important; }
</style>
  <meta property="og:title" content="ë¼ì´ë¸ŒëŸ¬ë¦¬ - TimeLink">
  <meta property="og:description" content="TimeLink ìŒì•… ë¼ì´ë¸ŒëŸ¬ë¦¬. ì „ ì„¸ê³„ ì°½ì‘ìì˜ ìŒì•…ì„ íƒìƒ‰í•˜ì„¸ìš”.">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://taolee-crypto.github.io/timelink-frontend/public/library.html">
  <meta property="og:image" content="https://taolee-crypto.github.io/timelink-frontend/public/og-image.png">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="ë¼ì´ë¸ŒëŸ¬ë¦¬ - TimeLink">
  <meta name="twitter:description" content="TimeLink ìŒì•… ë¼ì´ë¸ŒëŸ¬ë¦¬. ì „ ì„¸ê³„ ì°½ì‘ìì˜ ìŒì•…ì„ íƒìƒ‰í•˜ì„¸ìš”.">
  <meta name="description" content="TimeLink ìŒì•… ë¼ì´ë¸ŒëŸ¬ë¦¬. ì „ ì„¸ê³„ ì°½ì‘ìì˜ ìŒì•…ì„ íƒìƒ‰í•˜ì„¸ìš”.">
  <link rel="canonical" href="https://taolee-crypto.github.io/timelink-frontend/public/library.html">
<!-- Google Translate -->
<script type="text/javascript">
function googleTranslateElementInit() {
  new google.translate.TranslateElement({
    pageLanguage: 'ko',
    includedLanguages: 'en,ja,zh-CN,es,pt,fr,de,ar,hi,id,th,vi',
    layout: google.translate.TranslateElement.InlineLayout.SIMPLE,
    autoDisplay: false
  }, 'google_translate_element');
}
</script>

</head>
<body>

<nav class="navbar">
  <a href="shareplace.html" class="logo">
    <div class="logo-icon">âš¡</div>
    <div>Time<span>Link</span></div>
  </a>
  <div id="global-controls" style="display:flex;align-items:center;gap:6px;margin-left:auto;margin-right:12px;"><div id="currency-selector"></div></div>
  <div class="nav-right" id="nav-guest">
    <a href="login.html" class="btn btn-outline btn-sm" data-i18n="nav_login">ë¡œê·¸ì¸</a>
    <a href="signup.html" class="btn btn-primary btn-sm" data-i18n="nav_start">ì‹œì‘í•˜ê¸°</a>
  </div>
  <div class="nav-right hidden" id="nav-auth">
    <div class="balance">
      <div class="balance-item"><span class="balance-label">TL</span><span class="balance-value" id="balance-tl">0</span></div>
      <div class="balance-item"><span class="balance-label">TLC</span><span class="balance-value" id="balance-tlc">0.0000</span></div>
    </div>
    <div class="avatar" onclick="toggleDropdown()">
      <span id="avatar-letter">U</span>
      <div class="dropdown" id="dropdown">
        <a href="create.html" class="dropdown-item" data-i18n="tab_upload">ğŸ“¤ ì—…ë¡œë“œ</a>
        <a href="shareplace.html" class="dropdown-item" data-i18n="footer_shareplace">ğŸ›ï¸ SharePlace</a>
        <a href="player.html" class="dropdown-item">ğŸ¬ í”Œë ˆì´ì–´</a>
        <a href="index.html" class="dropdown-item" data-i18n="tab_dashboard">ğŸ“Š ëŒ€ì‹œë³´ë“œ</a>
        <a href="charge.html" class="dropdown-item charge">ğŸ’³ TL ì¶©ì „</a>
        <div class="dropdown-divider"></div>
        <div class="dropdown-item danger" onclick="logout()">ğŸšª ë¡œê·¸ì•„ì›ƒ</div>
      </div>
    </div>
  </div>
</nav>

<div class="tabs">
  <a href="index.html" class="tab" data-i18n="tab_home">ğŸ  í™ˆ</a>
  <a href="shareplace.html" class="tab" data-i18n="tab_shareplace">ğŸ›ï¸ SharePlace</a>
  <a href="library.html" class="tab active" data-i18n="tab_library">ğŸ” ë¼ì´ë¸ŒëŸ¬ë¦¬</a>
  <a href="create.html" class="tab" data-i18n="tab_upload">ğŸ“¤ ì—…ë¡œë“œ</a>
  <a href="radio.html" class="tab" data-i18n="tab_radio">â˜• ì¹´í˜ë°©ì†¡</a>
  <a href="car.html" class="tab" data-i18n="tab_car">ğŸ§ Moving Radio</a>
  <a href="ads.html" class="tab" data-i18n="tab_ads">ğŸ“£ ê´‘ê³ </a>
  <a href="wallet.html" class="tab" data-i18n="tab_wallet">ğŸ‘› ì§€ê°‘</a>
  <a href="chart.html" class="tab" data-i18n="tab_chart">ğŸ“Š ì°¨íŠ¸</a>
  <a href="dashboard.html" class="tab" data-i18n="tab_dashboard">ğŸ“Š ëŒ€ì‹œë³´ë“œ</a>
</div>

<div class="container">

  <!-- í˜ì´ì§€ íƒ­ -->
  <div class="page-tabs">
    <button class="page-tab active" onclick="switchPageTab('my', this)">ğŸ“ ë‚´ íŒŒì¼</button>
    <button class="page-tab" onclick="switchPageTab('pending', this)">â³ ì¸ì¦ ëŒ€ê¸°</button>
    <button class="page-tab" onclick="switchPageTab('verified', this)">âœ… ì¸ì¦ ì™„ë£Œ</button>
  </div>

  <!-- í†µê³„ -->
  <div class="stats-row">
    <div class="stat-card">
      <div class="stat-label" data-i18n="lib_all">ì „ì²´ íŒŒì¼</div>
      <div class="stat-value" id="stat-total">0</div>
    </div>
    <div class="stat-card" style="border-left-color:#8b5cf6">
      <div class="stat-label" data-i18n="lib_pending">ì¸ì¦ ëŒ€ê¸°</div>
      <div class="stat-value" style="color:#8b5cf6" id="stat-pending">0</div>
    </div>
    <div class="stat-card" style="border-left-color:#8b5cf6">
      <div class="stat-label" data-i18n="lib_certified">ì¸ì¦ ì™„ë£Œ</div>
      <div class="stat-value" style="color:#8b5cf6" id="stat-verified">0</div>
    </div>
    <div class="stat-card" style="border-left-color:#1db954">
      <div class="stat-label">SharePlace ë“±ë¡</div>
      <div class="stat-value" style="color:#1db954" id="stat-shared">0</div>
    </div>
    <div class="stat-card" style="border-left-color:#8b5cf6;margin-top:0;">
      <div class="stat-label">ğŸ† ê¸°ì—¬ë„ ì ìˆ˜</div>
      <div class="stat-value" style="color:#8b5cf6" id="stat-contrib">0</div>
    </div>
  </div>

  <!-- ë‚´ íŒŒì¼ íƒ­ -->
  <div id="tab-my">
    <div class="card" style="background:linear-gradient(135deg,#ede9fe,#dbeafe);border:none;">
      <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:12px;">
        <div>
          <div style="font-size:18px;font-weight:800;margin-bottom:4px;">ğŸ“ ë‚´ íŒŒì¼ ë¼ì´ë¸ŒëŸ¬ë¦¬</div>
          <div style="font-size:14px;color:#4b5563;">ì—…ë¡œë“œí•œ íŒŒì¼ì„ ì¸ì¦ í›„ SharePlaceì— ë“±ë¡í•˜ì„¸ìš”</div>
        </div>
        <a href="create.html" class="btn btn-primary">+ íŒŒì¼ ì—…ë¡œë“œ</a>
      </div>
    </div>

    <div class="file-list" id="file-list-all">
      <!-- JS ë Œë”ë§ -->
    </div>

    <div class="empty-state" id="empty-all" style="display:none;">
      <div class="empty-state-icon">ğŸ“­</div>
      <div class="empty-state-title" data-i18n="lib_empty">ì•„ì§ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤</div>
      <div class="empty-state-desc">MP3, MP4 íŒŒì¼ì„ ì—…ë¡œë“œí•´ì„œ TL3ë¡œ ë³€í™˜í•˜ì„¸ìš”</div>
      <a href="create.html" class="btn btn-primary">ğŸ“¤ íŒŒì¼ ì—…ë¡œë“œí•˜ê¸°</a>
    </div>
  </div>

  <!-- ì¸ì¦ ëŒ€ê¸° íƒ­ -->
  <div id="tab-pending" style="display:none;">
    <div class="card" style="background:linear-gradient(135deg,#ede9fe,#fff);border:none;">
      <div style="font-size:18px;font-weight:800;margin-bottom:4px;">â³ ì¸ì¦ ëŒ€ê¸° ì¤‘ì¸ íŒŒì¼</div>
      <div style="font-size:14px;color:#4b5563;">ì¸ì¦ ì™„ë£Œ í›„ SharePlaceì— ìë™ ë“±ë¡ë©ë‹ˆë‹¤</div>
    </div>
    <div class="file-list" id="file-list-pending"></div>
    <div class="empty-state" id="empty-pending" style="display:none;">
      <div class="empty-state-icon">âœ¨</div>
      <div class="empty-state-title">ì¸ì¦ ëŒ€ê¸° íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤</div>
    </div>
  </div>

  <!-- ì¸ì¦ ì™„ë£Œ íƒ­ -->
  <div id="tab-verified" style="display:none;">
    <div class="card" style="background:linear-gradient(135deg,#ede9fe,#fff);border:none;">
      <div style="font-size:18px;font-weight:800;margin-bottom:4px;">âœ… ì¸ì¦ ì™„ë£Œ íŒŒì¼</div>
      <div style="font-size:14px;color:#4b5563;">SharePlaceì—ì„œ íŒë§¤ ì¤‘ì¸ íŒŒì¼ì…ë‹ˆë‹¤</div>
    </div>
    <div class="file-list" id="file-list-verified"></div>
    <div class="empty-state" id="empty-verified" style="display:none;">
      <div class="empty-state-icon">ğŸ¯</div>
      <div class="empty-state-title">ì¸ì¦ ì™„ë£Œ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤</div>
      <div class="empty-state-desc">íŒŒì¼ì„ ì¸ì¦í•˜ë©´ SharePlaceì— ë“±ë¡ë©ë‹ˆë‹¤</div>
    </div>
  </div>

</div>

<!-- ì¸ì¦ ëª¨ë‹¬ -->
<div class="modal-overlay" id="auth-modal">
  <div class="modal">
    <div class="modal-title">ğŸ” íŒŒì¼ ì¸ì¦</div>
    <div class="modal-sub" id="auth-modal-filename">íŒŒì¼ëª…</div>

    <div class="auth-method-tabs">
      <button class="auth-method-tab active" onclick="switchAuthMethod('spotify', this)">
        ğŸµ Spotify ì¸ì¦
      </button>
      <button class="auth-method-tab" onclick="switchAuthMethod('proof', this)">
        ğŸ“¸ ì¦ë¹™ ìë£Œ ì œì¶œ
      </button>
    </div>

    <!-- Spotify ì¸ì¦ -->
    <div id="auth-spotify">
      <div style="background:#f0fdf4;border:1px solid #86efac;border-radius:12px;padding:12px 16px;margin-bottom:16px;font-size:13px;color:#15803d;">
        âœ… Spotifyì— ì¶œì‹œëœ ìŒì›ì€ ì•„í‹°ìŠ¤íŠ¸ IDë¡œ ìë™ ì¸ì¦ë©ë‹ˆë‹¤. ì¸ì¦ ë¹„ìš©: <strong>5,000 TL</strong>
      </div>
      <div class="spotify-search-row">
        <input type="text" id="sp-query" placeholder="ì•„í‹°ìŠ¤íŠ¸ëª… ë˜ëŠ” ì•¨ë²”ëª… ê²€ìƒ‰..." onkeydown="if(event.key==='Enter') searchSpotify()">
        <button class="spotify-search-btn" onclick="searchSpotify()">ğŸ” ê²€ìƒ‰</button>
      </div>
      <div id="sp-loading" style="display:none;text-align:center;padding:20px;color:#6b7280;">â³ ê²€ìƒ‰ ì¤‘...</div>
      <div class="spotify-results" id="sp-results" style="display:none;"></div>
      <div id="sp-selected" style="display:none;margin-bottom:16px;">
        <div style="display:flex;gap:12px;align-items:center;background:#f0fdf4;border-radius:12px;padding:12px;">
          <img id="sp-cover" style="width:64px;height:64px;border-radius:8px;object-fit:cover;" src="">
          <div>
            <div id="sp-name" style="font-weight:800;font-size:16px;"></div>
            <div id="sp-artist" style="color:#6b7280;font-size:13px;"></div>
            <div style="margin-top:6px;display:inline-block;background:#ede9fe;color:#7c3aed;padding:2px 8px;border-radius:999px;font-size:11px;font-weight:700;">âœ“ ê³µì‹ Spotify ìŒì›</div>
          </div>
        </div>
      </div>
      <div class="cost-box" id="sp-cost" style="display:none;">
        <span class="cost-box-label">ğŸ’° ì¸ì¦ ë¹„ìš©</span>
        <span class="cost-box-value">5,000 TL</span>
      </div>
    </div>

    <!-- ì¦ë¹™ ìë£Œ ì œì¶œ -->
    <div id="auth-proof" style="display:none;">
      <div style="background:#eff6ff;border:1px solid #93c5fd;border-radius:12px;padding:12px 16px;margin-bottom:16px;font-size:13px;color:#1d4ed8;">
        ğŸ“¸ 3ê°€ì§€ ì¦ë¹™ ìë£Œë¥¼ ì œì¶œí•˜ì„¸ìš”. Ctrl+V ë¶™ì—¬ë„£ê¸°ë„ ê°€ëŠ¥í•©ë‹ˆë‹¤. ì¸ì¦ ë¹„ìš©: <strong>5,000 TL</strong>
      </div>
      <div class="proof-grid">
        <!-- ì¦ë¹™ 1: ê²°ì œ ì˜ìˆ˜ì¦ -->
        <div class="proof-zone" id="pz-1"
          ondragover="event.preventDefault();this.classList.add('over')"
          ondragleave="this.classList.remove('over')"
          ondrop="handleDrop(event,'1')"
          onclick="document.getElementById('pf-1').click()">
          <input type="file" id="pf-1" accept="image/*" style="display:none" onchange="handleFile(this,'1')">
          <div id="pz-1-preview" style="display:none;width:100%;text-align:center;position:relative;">
            <img id="pz-1-img" class="proof-preview">
            <button class="proof-clear" onclick="event.stopPropagation();clearProof('1')">âœ•</button>
          </div>
          <div id="pz-1-ph">
            <div class="proof-zone-icon">ğŸ§¾</div>
            <div class="proof-zone-label">ê²°ì œ ì˜ìˆ˜ì¦</div>
            <div class="proof-zone-hint">ì´ë¯¸ì§€ ë˜ëŠ” Ctrl+V</div>
          </div>
          <div class="proof-check" id="pz-1-check"></div>
        </div>
        <!-- ì¦ë¹™ 2: ì œì‘ í™”ë©´ -->
        <div class="proof-zone" id="pz-2"
          ondragover="event.preventDefault();this.classList.add('over')"
          ondragleave="this.classList.remove('over')"
          ondrop="handleDrop(event,'2')"
          onclick="document.getElementById('pf-2').click()">
          <input type="file" id="pf-2" accept="image/*" style="display:none" onchange="handleFile(this,'2')">
          <div id="pz-2-preview" style="display:none;width:100%;text-align:center;position:relative;">
            <img id="pz-2-img" class="proof-preview">
            <button class="proof-clear" onclick="event.stopPropagation();clearProof('2')">âœ•</button>
          </div>
          <div id="pz-2-ph">
            <div class="proof-zone-icon">ğŸ–¥ï¸</div>
            <div class="proof-zone-label">ì œì‘/ìƒì„± í™”ë©´</div>
            <div class="proof-zone-hint">íƒ€ì„ìŠ¤íƒ¬í”„ í¬í•¨</div>
          </div>
          <div class="proof-check" id="pz-2-check"></div>
        </div>
        <!-- ì¦ë¹™ 3: ê¸°íƒ€ -->
        <div class="proof-zone" id="pz-3"
          ondragover="event.preventDefault();this.classList.add('over')"
          ondragleave="this.classList.remove('over')"
          ondrop="handleDrop(event,'3')"
          onclick="document.getElementById('pf-3').click()">
          <input type="file" id="pf-3" accept="image/*" style="display:none" onchange="handleFile(this,'3')">
          <div id="pz-3-preview" style="display:none;width:100%;text-align:center;position:relative;">
            <img id="pz-3-img" class="proof-preview">
            <button class="proof-clear" onclick="event.stopPropagation();clearProof('3')">âœ•</button>
          </div>
          <div id="pz-3-ph">
            <div class="proof-zone-icon">ğŸ“</div>
            <div class="proof-zone-label">ê¸°íƒ€ ì¦ë¹™</div>
            <div class="proof-zone-hint">ì¶”ê°€ ìë£Œ</div>
          </div>
          <div class="proof-check" id="pz-3-check"></div>
        </div>
      </div>
      <div class="cost-box">
        <span class="cost-box-label">ğŸ’° ì¸ì¦ ë¹„ìš©</span>
        <span class="cost-box-value">5,000 TL</span>
      </div>
    </div>

    <div style="display:flex;gap:10px;">
      <button onclick="closeAuthModal()" class="btn btn-outline" style="flex:1;">ì·¨ì†Œ</button>
      <button onclick="submitAuth()" class="btn btn-primary" style="flex:2;" id="auth-submit-btn">âœ… ì¸ì¦ ì‹ ì²­ (5,000 TL)</button>
    </div>
  </div>
</div>



<!-- ê°€ê²© ì„¤ì • ëª¨ë‹¬ -->
<div class="modal-overlay" id="price-modal">
  <div class="modal" style="max-width:420px;">
    <div class="modal-title">âš™ï¸ ì¬ìƒ ê°€ê²© ì„¤ì •</div>
    <div class="modal-sub" id="price-modal-filename">íŒŒì¼ëª…</div>

    <div style="background:#f5f3ff;border-radius:14px;padding:18px;margin-bottom:20px;">
      <div style="font-size:13px;color:#6b7280;margin-bottom:16px;line-height:1.6;">
        ì´ˆë‹¹ ì¬ìƒ ê°€ê²©ì„ ì„¤ì •í•˜ì„¸ìš”.<br>
        ìµœì¢… ê°€ê²© = <strong>ì´ˆë‹¹ê°€ê²© Ã— ì¬ìƒì‹œê°„(ì´ˆ) Ã— Pulse ê°€ì¤‘ì¹˜</strong>
      </div>

      <div style="margin-bottom:16px;">
        <label style="font-size:13px;font-weight:700;color:#374151;display:block;margin-bottom:8px;">ì´ˆë‹¹ ê°€ê²© (TL/ì´ˆ)</label>
        <div style="display:flex;align-items:center;gap:10px;">
          <input type="number" id="price-input" min="1" max="100" step="1" value="1"
            style="flex:1;padding:12px 16px;border:2px solid #e5e7eb;border-radius:12px;font-size:16px;font-weight:700;outline:none;"
            oninput="updatePricePreview()">
          <span style="font-weight:700;color:#8b5cf6;">TL/ì´ˆ</span>
        </div>
        <div style="display:flex;gap:8px;margin-top:8px;flex-wrap:wrap;">
          <button onclick="setPrice(1)" style="padding:4px 10px;border:1px solid #8b5cf6;border-radius:999px;font-size:11px;font-weight:700;cursor:pointer;background:#f5f3ff;color:#8b5cf6;">1 (ê¸°ë³¸)</button>
          <button onclick="setPrice(2)" style="padding:4px 10px;border:1px solid #e5e7eb;border-radius:999px;font-size:11px;font-weight:700;cursor:pointer;background:white;">2</button>
          <button onclick="setPrice(5)" style="padding:4px 10px;border:1px solid #e5e7eb;border-radius:999px;font-size:11px;font-weight:700;cursor:pointer;background:white;">5</button>
          <button onclick="setPrice(10)" style="padding:4px 10px;border:1px solid #e5e7eb;border-radius:999px;font-size:11px;font-weight:700;cursor:pointer;background:white;">10</button>
          <button onclick="setPrice(50)" style="padding:4px 10px;border:1px solid #e5e7eb;border-radius:999px;font-size:11px;font-weight:700;cursor:pointer;background:white;">50</button>
        </div>
      </div>

      <div style="background:white;border-radius:10px;padding:14px;">
        <div style="font-size:12px;font-weight:700;color:#6b7280;margin-bottom:10px;">ì˜ˆìƒ ì¬ìƒ ë¹„ìš©</div>
        <div style="display:flex;justify-content:space-between;font-size:13px;margin-bottom:6px;">
          <span style="color:#6b7280;">30ì´ˆ ë¯¸ë¦¬ë“£ê¸°</span>
          <span id="preview-30" style="font-weight:700;color:#8b5cf6;">0.3 TL</span>
        </div>
        <div style="display:flex;justify-content:space-between;font-size:13px;margin-bottom:6px;">
          <span style="color:#6b7280;">3ë¶„ ê³¡ ì „ì²´</span>
          <span id="preview-180" style="font-weight:700;color:#8b5cf6;">1.8 TL</span>
        </div>
        <div style="display:flex;justify-content:space-between;font-size:13px;margin-bottom:6px;">
          <span style="color:#6b7280;">10ë¶„ ì˜ìƒ</span>
          <span id="preview-600" style="font-weight:700;color:#8b5cf6;">6.0 TL</span>
        </div>
        <div style="border-top:1px solid #f3f4f6;margin-top:8px;padding-top:8px;font-size:11px;color:#9ca3af;">
          âœ¦ Pulse ê°€ì¤‘ì¹˜ ì ìš© ì‹œ ìµœëŒ€ 10ë°°ê¹Œì§€ ìë™ ìƒìŠ¹
        </div>
      </div>
    </div>

    <div style="background:#ede9fe;border-radius:10px;padding:12px 14px;margin-bottom:20px;font-size:12px;color:#92400e;">
      ğŸ’¡ ìµœì†Œ 1 TL/ì´ˆ Â· Pulse ê°€ì¤‘ì¹˜: 0~100 Ã—1 Â· 101~500 Ã—2 Â· 501~2000 Ã—3 Â· 2001~5000 Ã—5 Â· 5001+ Ã—10
    </div>

    <div style="display:flex;gap:10px;">
      <button onclick="closePriceModal()" class="btn btn-outline" style="flex:1;">ì·¨ì†Œ</button>
      <button onclick="savePriceSettings()" class="btn btn-primary" style="flex:2;">âœ… ì €ì¥</button>
    </div>
  </div>
</div>

<!-- í”Œë ˆì´ì–´ íŒ¨ë„ (í•˜ë‹¨ ìŠ¬ë¼ì´ë“œì—…) -->
<div id="player-panel" style="
  position:fixed;bottom:-100%;left:0;right:0;
  background:white;border-radius:24px 24px 0 0;
  box-shadow:0 -8px 40px rgba(0,0,0,0.15);
  z-index:600;transition:bottom .35s cubic-bezier(.4,0,.2,1);
  padding:0;max-height:90vh;overflow-y:auto;
">
  <!-- ë“œë˜ê·¸ í•¸ë“¤ -->
  <div style="text-align:center;padding:12px 0 0;" onclick="closePlayerPanel()">
    <div style="width:40px;height:4px;background:#e5e7eb;border-radius:999px;display:inline-block;cursor:pointer;"></div>
  </div>

  <div style="padding:20px 24px 32px;display:grid;grid-template-columns:1fr 280px;gap:24px;">

    <!-- ì™¼ìª½: í”Œë ˆì´ì–´ -->
    <div>
      <!-- ì•¨ë²”ì•„íŠ¸ + ê³¡ ì •ë³´ -->
      <div style="display:flex;gap:20px;align-items:flex-start;margin-bottom:24px;">
        <div id="player-artwork" style="width:100px;height:100px;border-radius:16px;background:linear-gradient(135deg,#ede9fe,#dbeafe);display:flex;align-items:center;justify-content:center;font-size:40px;flex-shrink:0;overflow:hidden;"></div>
        <div style="flex:1;min-width:0;">
          <div id="player-title" style="font-size:22px;font-weight:800;margin-bottom:4px;"></div>
          <div id="player-artist" style="color:#6b7280;font-size:15px;margin-bottom:8px;"></div>
          <div style="display:flex;gap:8px;flex-wrap:wrap;">
            <span id="player-genre-tag" style="background:#f3f4f6;padding:3px 10px;border-radius:999px;font-size:12px;font-weight:700;color:#374151;"></span>
            <span id="player-tl3-tag" style="background:#f5f3ff;color:#8b5cf6;padding:3px 10px;border-radius:999px;font-size:12px;font-weight:700;">TL3</span>
            <span id="player-verified-tag" style="background:#ede9fe;color:#7c3aed;padding:3px 10px;border-radius:999px;font-size:12px;font-weight:700;display:none;">âœ… ì¸ì¦</span>
          </div>
        </div>
      </div>

      <!-- ì˜¤ë””ì˜¤/ë¹„ë””ì˜¤ ì—˜ë¦¬ë¨¼íŠ¸ -->
      <div id="player-video-wrap" style="display:none;margin-bottom:16px;">
        <video id="player-video" controls style="width:100%;border-radius:12px;background:#000;max-height:200px;"></video>
      </div>
      <div id="player-audio-wrap" style="margin-bottom:16px;">
        <audio id="player-audio" controls style="width:100%;"></audio>
      </div>

      <!-- ì§„í–‰ ë°” + TL ë¯¸í„° -->
      <div style="background:#f8fafc;border-radius:14px;padding:16px;margin-bottom:16px;">
        <div style="display:flex;justify-content:space-between;font-size:12px;color:#6b7280;margin-bottom:8px;">
          <span>ì¬ìƒ ì‹œê°„</span>
          <span id="player-time">0:00 / 0:00</span>
        </div>
        <div style="height:6px;background:#e5e7eb;border-radius:999px;margin-bottom:12px;">
          <div id="player-progress" style="height:100%;background:#8b5cf6;border-radius:999px;width:0%;transition:width .5s;"></div>
        </div>
        <div style="display:flex;justify-content:space-between;align-items:center;">
          <span style="font-size:13px;color:#6b7280;">TL ì‚¬ìš©</span>
          <span id="player-tl-used" style="font-weight:800;color:#ef4444;font-size:16px;">0 TL</span>
        </div>
      </div>

      <!-- ì»¨íŠ¸ë¡¤ -->
      <div style="display:flex;gap:10px;align-items:center;justify-content:center;">
        <button onclick="seekBack()" style="padding:10px 18px;background:#f3f4f6;border:none;border-radius:999px;font-size:18px;cursor:pointer;">â®</button>
        <button id="play-pause-btn" onclick="togglePlayPause()" style="padding:12px 28px;background:#8b5cf6;color:white;border:none;border-radius:999px;font-size:20px;cursor:pointer;font-weight:700;">â–¶</button>
        <button onclick="seekForward()" style="padding:10px 18px;background:#f3f4f6;border:none;border-radius:999px;font-size:18px;cursor:pointer;">â­</button>
      </div>
    </div>

    <!-- ì˜¤ë¥¸ìª½: ì°½ì‘ì ì •ë³´ -->
    <div style="background:#f8fafc;border-radius:20px;padding:20px;">
      <div style="font-size:13px;font-weight:700;color:#6b7280;text-transform:uppercase;letter-spacing:.5px;margin-bottom:16px;">ì°½ì‘ì ì •ë³´</div>

      <div style="display:flex;align-items:center;gap:12px;margin-bottom:16px;">
        <div id="creator-avatar" style="width:48px;height:48px;border-radius:50%;background:#8b5cf6;display:flex;align-items:center;justify-content:center;color:white;font-size:20px;font-weight:800;flex-shrink:0;"></div>
        <div>
          <div id="creator-name" style="font-weight:800;font-size:16px;"></div>
          <div id="creator-since" style="font-size:12px;color:#6b7280;"></div>
        </div>
      </div>

      <div style="display:flex;flex-direction:column;gap:8px;margin-bottom:16px;">
        <div style="display:flex;justify-content:space-between;font-size:13px;">
          <span style="color:#6b7280;">ì¥ë¥´</span>
          <span id="creator-genre" style="font-weight:700;"></span>
        </div>
        <div style="display:flex;justify-content:space-between;font-size:13px;">
          <span style="color:#6b7280;">íŒŒì¼ í˜•ì‹</span>
          <span style="font-weight:700;color:#8b5cf6;">TL3</span>
        </div>
        <div style="display:flex;justify-content:space-between;font-size:13px;">
          <span style="color:#6b7280;">ì¸ì¦ ë°©ì‹</span>
          <span id="creator-auth" style="font-weight:700;"></span>
        </div>
        <div style="display:flex;justify-content:space-between;font-size:13px;">
          <span style="color:#6b7280;">ğŸ”¥ Pulse</span>
          <span id="creator-pulse" style="font-weight:700;color:#8b5cf6;"></span>
        </div>
        <div style="display:flex;justify-content:space-between;font-size:13px;">
          <span style="color:#6b7280;">ì´ˆë‹¹ ê°€ê²©</span>
          <span id="creator-price" style="font-weight:700;color:#8b5cf6;"></span>
        </div>
      </div>

      <div style="border-top:1px solid #e5e7eb;padding-top:14px;">
        <div style="font-size:12px;color:#6b7280;margin-bottom:8px;">í˜„ì¬ ì¬ìƒ ë¹„ìš©</div>
        <div style="display:flex;justify-content:space-between;margin-bottom:4px;font-size:13px;">
          <span style="color:#6b7280;">ë‚´ TL ì”ê³ </span>
          <span id="creator-balance" style="font-weight:700;"></span>
        </div>
        <div style="display:flex;justify-content:space-between;font-size:13px;">
          <span style="color:#6b7280;">TL/ì´ˆ</span>
          <span id="creator-per-sec" style="font-weight:800;color:#ef4444;"></span>
        </div>
      </div>

      <div id="creator-spotify" style="display:none;margin-top:14px;background:#f0fdf4;border-radius:10px;padding:10px 12px;">
        <div style="font-size:11px;font-weight:700;color:#15803d;">ğŸµ Spotify ê³µì‹ ìŒì›</div>
        <div id="creator-spotify-album" style="font-size:12px;color:#166534;margin-top:2px;"></div>
      </div>
    </div>
  </div>
</div>

<!-- ì¬ìƒ í™•ì¸ ëª¨ë‹¬ (ê°„ì†Œí™”) -->
<div class="modal-overlay" id="play-modal">
  <div class="modal" style="max-width:400px;">
    <div style="text-align:center;margin-bottom:16px;">
      <div id="play-modal-icon" style="font-size:48px;margin-bottom:8px;">ğŸµ</div>
      <div id="play-modal-title" style="font-size:18px;font-weight:800;margin-bottom:2px;"></div>
      <div id="play-modal-artist" style="color:#6b7280;font-size:13px;"></div>
    </div>
    <div style="background:#f8fafc;border-radius:12px;padding:14px;margin-bottom:16px;">
      <div style="display:flex;justify-content:space-between;font-size:13px;margin-bottom:8px;">
        <span style="color:#6b7280;">ë‚´ TL ì”ê³ </span>
        <span style="font-weight:700;" id="play-modal-balance">0 TL</span>
      </div>
      <div style="display:flex;justify-content:space-between;font-size:13px;margin-bottom:8px;">
        <span style="color:#6b7280;">ì´ˆë‹¹ ê°€ê²©</span>
        <span id="play-modal-cost" style="font-weight:800;color:#8b5cf6;">1 TL/ì´ˆ</span>
      </div>
      <div style="display:flex;justify-content:space-between;font-size:13px;">
        <span style="color:#6b7280;">Pulse <span id="play-modal-pulse" style="color:#8b5cf6;"></span></span>
        <span id="play-modal-weight" style="font-weight:700;color:#8b5cf6;"></span>
      </div>
    </div>
    <div style="background:#ede9fe;border-radius:10px;padding:10px;margin-bottom:16px;font-size:12px;color:#92400e;text-align:center;">
      ì¬ìƒí•˜ëŠ” ë™ì•ˆ TLì´ ì´ˆë‹¹ ì°¨ê°ë©ë‹ˆë‹¤
    </div>
    <div style="display:flex;gap:10px;">
      <button onclick="closePlayModal()" class="btn btn-outline" style="flex:1;">ì·¨ì†Œ</button>
      <button onclick="confirmPlay()" class="btn btn-primary" style="flex:2;" id="play-modal-submit">â–¶ ì¬ìƒ ì‹œì‘</button>
    </div>
  </div>
</div>


<!-- ìˆ˜ì • ëª¨ë‹¬ -->
<div class="modal-overlay" id="edit-modal">
  <div class="modal" style="max-width:520px;">
    <div class="modal-title">âœï¸ íŒŒì¼ ì •ë³´ ìˆ˜ì •</div>
    <div class="modal-sub" id="edit-modal-filename"></div>

    <div style="margin-bottom:20px;">
      <label style="font-size:13px;font-weight:700;color:#374151;display:block;margin-bottom:8px;">ì•¨ë²” ì´ë¯¸ì§€</label>
      <div style="display:flex;gap:16px;align-items:flex-start;">
        <div id="edit-cover-preview" style="width:80px;height:80px;border-radius:12px;background:#f3f4f6;display:flex;align-items:center;justify-content:center;font-size:32px;overflow:hidden;flex-shrink:0;">ğŸµ</div>
        <div style="flex:1;">
          <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:8px;">
            <button onclick="document.getElementById('edit-cover-file').click()" style="padding:8px 14px;background:#f3f4f6;border:none;border-radius:8px;font-weight:700;font-size:13px;cursor:pointer;">ğŸ“ íŒŒì¼</button>
            <button onclick="openSpotifyCoverSearch()" style="padding:8px 14px;background:#ede9fe;color:#7c3aed;border:none;border-radius:8px;font-weight:700;font-size:13px;cursor:pointer;">ğŸµ Spotify</button>
          </div>
          <input type="file" id="edit-cover-file" accept="image/*" style="display:none" onchange="handleEditCover(this)">
          <div style="font-size:11px;color:#9ca3af;">Ctrl+Vë¡œ ì´ë¯¸ì§€ ë¶™ì—¬ë„£ê¸° ê°€ëŠ¥</div>
        </div>
      </div>
    </div>

    <div id="edit-spotify-search" style="display:none;background:#f0fdf4;border-radius:14px;padding:16px;margin-bottom:16px;">
      <div style="font-size:13px;font-weight:700;color:#15803d;margin-bottom:10px;">ğŸµ Spotifyì—ì„œ ì•¨ë²” ì´ë¯¸ì§€ ê°€ì ¸ì˜¤ê¸°</div>
      <div style="display:flex;gap:8px;margin-bottom:10px;">
        <input type="text" id="edit-sp-query" placeholder="ì•„í‹°ìŠ¤íŠ¸ ë˜ëŠ” ì•¨ë²”ëª…..." style="flex:1;padding:10px;border:1px solid #86efac;border-radius:8px;font-size:13px;outline:none;" onkeydown="if(event.key==='Enter') searchEditSpotify()">
        <button onclick="searchEditSpotify()" style="padding:10px 16px;background:#1db954;color:white;border:none;border-radius:8px;font-weight:700;cursor:pointer;">ê²€ìƒ‰</button>
      </div>
      <div id="edit-sp-results" style="display:grid;grid-template-columns:repeat(4,1fr);gap:8px;"></div>
    </div>

    <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:16px;">
      <div>
        <label style="font-size:12px;font-weight:700;color:#6b7280;display:block;margin-bottom:6px;">ê³¡ ì œëª©</label>
        <input type="text" id="edit-title" style="width:100%;padding:10px 12px;border:2px solid #e5e7eb;border-radius:10px;font-size:14px;outline:none;">
      </div>
      <div>
        <label style="font-size:12px;font-weight:700;color:#6b7280;display:block;margin-bottom:6px;">ì•„í‹°ìŠ¤íŠ¸</label>
        <input type="text" id="edit-artist" style="width:100%;padding:10px 12px;border:2px solid #e5e7eb;border-radius:10px;font-size:14px;outline:none;">
      </div>
    </div>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:20px;">
      <div>
        <label style="font-size:12px;font-weight:700;color:#6b7280;display:block;margin-bottom:6px;">ì¥ë¥´</label>
        <select id="edit-genre" style="width:100%;padding:10px 12px;border:2px solid #e5e7eb;border-radius:10px;font-size:14px;background:white;">
          <option value="pop">Pop</option><option value="kpop">K-Pop</option><option value="hiphop">Hip-Hop</option>
          <option value="rnb">R&amp;B</option><option value="rock">Rock</option><option value="indie">Indie</option>
          <option value="edm">EDM</option><option value="jazz">Jazz</option><option value="classical">í´ë˜ì‹</option>
          <option value="chill">Chill</option><option value="mv">ë®¤ì§ë¹„ë””ì˜¤</option><option value="lecture-code">ê°•ì˜</option><option value="etc">ê¸°íƒ€</option>
        </select>
      </div>
      <div>
        <label style="font-size:12px;font-weight:700;color:#6b7280;display:block;margin-bottom:6px;">ì´ˆë‹¹ ê°€ê²© (ìµœì†Œ 1 TL)</label>
        <input type="number" id="edit-price" min="1" step="1" style="width:100%;padding:10px 12px;border:2px solid #e5e7eb;border-radius:10px;font-size:14px;outline:none;">
      </div>
    </div>

    <!-- ì˜¤ë””ì˜¤ íŒŒì¼ ì„¹ì…˜ -->
    <div style="margin-bottom:20px;background:#f8fafc;border-radius:12px;padding:14px;">
      <div style="font-size:13px;font-weight:700;color:#374151;margin-bottom:10px;">ğŸµ ì˜¤ë””ì˜¤ íŒŒì¼</div>
      <div id="edit-audio-status" style="font-size:12px;color:#6b7280;margin-bottom:8px;">ë¡œë”© ì¤‘...</div>
      <div style="display:flex;gap:8px;flex-wrap:wrap;">
        <button onclick="document.getElementById('edit-audio-file').click()" style="padding:8px 14px;background:#ede9fe;color:#7c3aed;border:none;border-radius:8px;font-weight:700;font-size:13px;cursor:pointer;">ğŸ“‚ íŒŒì¼ ì—…ë¡œë“œ (IndexedDB)</button>
      </div>
      <input type="file" id="edit-audio-file" accept="audio/*,video/*" style="display:none" onchange="handleEditAudio(this)">
      <div style="margin-top:10px;">
        <label style="font-size:12px;font-weight:700;color:#6b7280;display:block;margin-bottom:4px;">ğŸ”— ì™¸ë¶€ ìŠ¤íŠ¸ë¦¬ë° URL (SharePlace ì¬ìƒìš©)</label>
        <input type="text" id="edit-stream-url" placeholder="https://example.com/audio.mp3" style="width:100%;padding:8px 12px;border:1px solid #e5e7eb;border-radius:8px;font-size:12px;outline:none;">
        <div style="font-size:11px;color:#9ca3af;margin-top:4px;">SharePlaceì—ì„œ ë‹¤ë¥¸ ìœ ì €ê°€ ì¬ìƒí•  ìˆ˜ ìˆëŠ” ê³µê°œ URL</div>
      </div>
    </div>

    <div style="display:flex;gap:10px;">
      <button onclick="closeEditModal()" class="btn btn-outline" style="flex:1;">ì·¨ì†Œ</button>
      <button onclick="saveEdit()" class="btn btn-primary" style="flex:2;">âœ… ì €ì¥ + D1 ë™ê¸°í™”</button>
    </div>
  </div>
</div>

<!-- ê³µìœ  ëª¨ë‹¬ -->
<div class="modal-overlay" id="share-modal">
  <div class="modal" style="max-width:480px;">
    <div class="modal-title">ğŸ”— íŒŒì¼ ê³µìœ </div>
    <div class="modal-sub">TL3 ë§í¬ë¥¼ ê³µìœ í•˜ì„¸ìš”. ë°›ëŠ” ì‚¬ëŒì€ TimeLink ê°€ì… í›„ ì—´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div>

    <div style="background:#f0fdf4;border:1px solid #86efac;border-radius:12px;padding:14px;margin-bottom:20px;">
      <div style="font-weight:700;color:#15803d;margin-bottom:6px;">ğŸ† ê¸°ì—¬ë„ ì ë¦½ ë°©ì‹</div>
      <div style="font-size:13px;color:#166534;line-height:1.6;">
        ë§í¬ë¥¼ í†µí•´ ìƒˆ íšŒì›ì´ ê°€ì…í•˜ë©´ <strong>ê¸°ì—¬ë„ ì ìˆ˜ +10</strong>ì´ ì ë¦½ë©ë‹ˆë‹¤.<br>
        ê¸°ì—¬ë„ ì ìˆ˜ëŠ” TLC ë§ˆì´ë‹ ì†ë„ì™€ ìˆ˜ìµ ë¶„ë°°ìœ¨ì— ë°˜ì˜ë©ë‹ˆë‹¤.
      </div>
    </div>

    <div style="background:#f8fafc;border-radius:12px;padding:14px;margin-bottom:16px;">
      <div style="font-size:12px;color:#6b7280;margin-bottom:8px;font-weight:600;">ê³µìœ  ë§í¬</div>
      <div style="display:flex;gap:8px;align-items:center;">
        <div id="share-link-text" style="flex:1;font-size:13px;color:#374151;word-break:break-all;background:white;padding:10px;border-radius:8px;border:1px solid #e5e7eb;"></div>
        <button onclick="copyShareLink()" style="padding:10px 16px;background:#8b5cf6;color:white;border:none;border-radius:8px;font-weight:700;cursor:pointer;white-space:nowrap;">ë³µì‚¬</button>
      </div>
    </div>

    <div style="margin-bottom:20px;">
      <div style="font-size:13px;font-weight:700;margin-bottom:10px;">ê³µìœ  ë°©ë²•</div>
      <div style="display:flex;gap:8px;flex-wrap:wrap;">
        <button onclick="shareKakao()" style="padding:8px 16px;background:#FEE500;color:#000;border:none;border-radius:8px;font-weight:700;cursor:pointer;font-size:13px;">ì¹´ì¹´ì˜¤í†¡</button>
        <button onclick="shareTwitter()" style="padding:8px 16px;background:#1DA1F2;color:white;border:none;border-radius:8px;font-weight:700;cursor:pointer;font-size:13px;">Twitter/X</button>
        <button onclick="copyShareLink()" style="padding:8px 16px;background:#f3f4f6;color:#374151;border:none;border-radius:8px;font-weight:700;cursor:pointer;font-size:13px;">ë§í¬ ë³µì‚¬</button>
      </div>
    </div>

    <div style="background:#ede9fe;border-radius:10px;padding:12px;margin-bottom:20px;font-size:12px;color:#92400e;">
      ğŸ“Œ ë°›ëŠ” ì‚¬ëŒì´ ë§í¬ë¥¼ ì—´ë©´ "ì´ íŒŒì¼ì€ TL3 í˜•ì‹ì…ë‹ˆë‹¤. TimeLinkì— ê°€ì…í•˜ë©´ ì—´ ìˆ˜ ìˆìŠµë‹ˆë‹¤" ë©”ì‹œì§€ê°€ í‘œì‹œë©ë‹ˆë‹¤.
    </div>

    <button onclick="closeShareModal()" class="btn btn-outline" style="width:100%;">ë‹«ê¸°</button>
  </div>
</div>

<!-- í† ìŠ¤íŠ¸ -->
<div class="toast" id="toast"></div>

<script>
// ===== ìƒíƒœ =====
var currentFile = null;
var authMethod = 'spotify';
var proofFiles = {1: null, 2: null, 3: null};
var spotifySelected = null;
var _spotifyAlbums = [];

// ===== ìœ í‹¸ =====
function $(id) { return document.getElementById(id); }
function showToast(msg, type) {
  var t = $('toast');
  t.textContent = msg;
  t.style.background = type === 'success' ? '#8b5cf6' : type === 'error' ? '#ef4444' : '#1f2937';
  t.classList.add('show');
  setTimeout(function() { t.classList.remove('show'); }, 2500);
}

// ===== íŒŒì¼ ë°ì´í„° =====
function getFiles() {
  return JSON.parse(localStorage.getItem('tl_myfiles') || '[]');
}
function saveFiles(files) {
  localStorage.setItem('tl_myfiles', JSON.stringify(files));
}

// ===== ë Œë”ë§ =====
function renderFileItem(f) {
  var statusClass = f.authStatus === 'verified' ? 'status-verified' : f.authStatus === 'rejected' ? 'status-rejected' : 'status-pending';
  var statusLabel = f.authStatus === 'verified' ? 'âœ… ì¸ì¦ ì™„ë£Œ' : f.authStatus === 'rejected' ? 'âŒ ê±°ì ˆ' : 'â³ ëŒ€ê¸° ì¤‘';
  var icon = f.coverImage ? '<img src="' + f.coverImage + '">' : (f.type === 'video' ? 'ğŸ¬' : 'ğŸµ');
  var iconHtml = f.coverImage ? '<img src="' + f.coverImage + '" style="width:100%;height:100%;object-fit:cover;border-radius:10px;">' : '<span style="font-size:22px">' + (f.type === 'video' ? 'ğŸ¬' : 'ğŸµ') + '</span>';

  var actions = '';
  if (f.authStatus !== 'verified') {
    actions += '<button class="action-btn action-btn-primary" onclick="openAuthModal(\'' + f.id + '\')">ğŸ” ì¸ì¦ ì‹ ì²­</button>';
  } else if (!f.shared) {
    actions += '<button class="action-btn action-btn-green" onclick="shareFile(\'' + f.id + '\')">ğŸ›ï¸ SharePlace ë“±ë¡</button>';
  } else {
    actions += '<span style="font-size:12px;color:#8b5cf6;font-weight:700;">ğŸ›ï¸ SharePlace ë“±ë¡ ì¤‘</span>';
  }
  actions += '<button class="action-btn action-btn-outline" onclick="deleteFile(\'' + f.id + '\')" style="color:#ef4444;">ì‚­ì œ</button>';

  return '<div class="file-item" id="fi-' + f.id + '">' +
    '<div class="file-icon">' + iconHtml + '</div>' +
    '<div class="file-info">' +
      '<div class="file-title">' + f.title + '</div>' +
      '<div class="file-meta">' + (f.artist || '') + ' Â· ' + (f.genre || 'ìŒì•…') + ' Â· ' + (f.fileSize || 'TL3') + '</div>' +
    '</div>' +
    '<span class="file-status ' + statusClass + '">' + statusLabel + '</span>' +
    '<div class="file-actions">' + actions + '</div>' +
  '</div>';
}

function renderAll() {
  var files = getFiles();
  var all = files;
  var pending = files.filter(function(f){ return f.authStatus !== 'verified'; });
  var verified = files.filter(function(f){ return f.authStatus === 'verified'; });
  var shared = files.filter(function(f){ return f.shared; });

  $('stat-total').textContent = all.length;
  $('stat-pending').textContent = pending.length;
  $('stat-verified').textContent = verified.length;
  $('stat-shared').textContent = shared.length;
  var contrib = Number(localStorage.getItem('tl_contrib') || 0);
  $('stat-contrib').textContent = contrib;

  // ì „ì²´
  if (all.length) {
    $('file-list-all').innerHTML = all.map(renderFileItem).join('');
    $('empty-all').style.display = 'none';
  } else {
    $('file-list-all').innerHTML = '';
    $('empty-all').style.display = 'block';
  }

  // ëŒ€ê¸°
  if (pending.length) {
    $('file-list-pending').innerHTML = pending.map(renderFileItem).join('');
    $('empty-pending').style.display = 'none';
  } else {
    $('file-list-pending').innerHTML = '';
    $('empty-pending').style.display = 'block';
  }

  // ì™„ë£Œ
  if (verified.length) {
    $('file-list-verified').innerHTML = verified.map(renderFileItem).join('');
    $('empty-verified').style.display = 'none';
  } else {
    $('file-list-verified').innerHTML = '';
    $('empty-verified').style.display = 'block';
  }
}

// ===== í˜ì´ì§€ íƒ­ =====
function switchPageTab(tab, el) {
  document.querySelectorAll('.page-tab').forEach(function(b){b.classList.remove('active');});
  el.classList.add('active');
  $('tab-my').style.display = tab === 'my' ? 'block' : 'none';
  $('tab-pending').style.display = tab === 'pending' ? 'block' : 'none';
  $('tab-verified').style.display = tab === 'verified' ? 'block' : 'none';
}

// ===== ì¸ì¦ ëª¨ë‹¬ =====
function openAuthModal(fileId) {
  var files = getFiles();
  currentFile = files.find(function(f){ return f.id === fileId; });
  if (!currentFile) return;
  $('auth-modal-filename').textContent = currentFile.title;
  $('auth-modal').classList.add('show');
  // ì´ˆê¸°í™”
  spotifySelected = null;
  proofFiles = {1: null, 2: null, 3: null};
  [1,2,3].forEach(function(n) {
    $('pz-'+n+'-preview').style.display = 'none';
    $('pz-'+n+'-ph').style.display = '';
    $('pz-'+n+'-check').textContent = '';
    $('pz-'+n).classList.remove('filled');
  });
  $('sp-results').style.display = 'none';
  $('sp-selected').style.display = 'none';
  $('sp-cost').style.display = 'none';
  $('sp-query').value = '';
  switchAuthMethod('spotify', document.querySelector('.auth-method-tab'));
}

function closeAuthModal() {
  $('auth-modal').classList.remove('show');
  currentFile = null;
}

function switchAuthMethod(method, el) {
  authMethod = method;
  document.querySelectorAll('.auth-method-tab').forEach(function(b){b.classList.remove('active');});
  el.classList.add('active');
  $('auth-spotify').style.display = method === 'spotify' ? 'block' : 'none';
  $('auth-proof').style.display = method === 'proof' ? 'block' : 'none';
}

// ===== Spotify ê²€ìƒ‰ =====
async function searchSpotify() {
  var query = $('sp-query').value.trim();
  if (!query) { showToast('ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”', 'error'); return; }
  $('sp-loading').style.display = 'block';
  $('sp-results').style.display = 'none';
  $('sp-selected').style.display = 'none';
  $('sp-cost').style.display = 'none';
  try {
    var res = await fetch('https://spotify-worker.mununglee.workers.dev/api/spotify-search', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({query: query})
    });
    var data = await res.json();
    $('sp-loading').style.display = 'none';
    if (!data.albums || !data.albums.length) {
      $('sp-results').innerHTML = '<div style="grid-column:1/-1;text-align:center;color:#6b7280;padding:20px;">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤</div>';
      $('sp-results').style.display = 'grid';
      return;
    }
    _spotifyAlbums = data.albums;
    $('sp-results').innerHTML = data.albums.map(function(a, i) {
      return '<div class="spotify-album-card" onclick="selectSpotifyAlbum('+i+')">' +
        '<img src="' + (a.coverImage || a.thumbnail) + '" alt="' + a.name + '">' +
        '<div class="spotify-album-info">' +
          '<div class="spotify-album-title">' + a.name + '</div>' +
          '<div class="spotify-album-artist">' + a.artist + '</div>' +
        '</div>' +
      '</div>';
    }).join('');
    $('sp-results').style.display = 'grid';
  } catch(e) {
    $('sp-loading').style.display = 'none';
    showToast('ê²€ìƒ‰ ì˜¤ë¥˜: ' + e.message, 'error');
  }
}

function selectSpotifyAlbum(idx) {
  var album = _spotifyAlbums[idx];
  spotifySelected = album;
  document.querySelectorAll('.spotify-album-card').forEach(function(c,i){ c.classList.toggle('selected', i===idx); });
  $('sp-cover').src = album.coverImage || album.thumbnail;
  $('sp-name').textContent = album.name;
  $('sp-artist').textContent = album.artist;
  $('sp-selected').style.display = 'flex';
  $('sp-results').style.display = 'none';
  $('sp-cost').style.display = 'flex';
}

// ===== ì¦ë¹™ ì—…ë¡œë“œ =====
function handleFile(input, n) {
  var f = input.files[0];
  if (!f) return;
  applyProof(f, n);
}
function handleDrop(e, n) {
  e.preventDefault();
  $('pz-'+n).classList.remove('over');
  var f = e.dataTransfer.files[0];
  if (f && f.type.startsWith('image/')) applyProof(f, n);
}
function applyProof(f, n) {
  proofFiles[n] = f;
  var reader = new FileReader();
  reader.onload = function(ev) {
    $('pz-'+n+'-img').src = ev.target.result;
    $('pz-'+n+'-preview').style.display = 'block';
    $('pz-'+n+'-ph').style.display = 'none';
    $('pz-'+n+'-check').textContent = 'âœ“ ' + f.name;
    $('pz-'+n).classList.add('filled');
  };
  reader.readAsDataURL(f);
}
function clearProof(n) {
  proofFiles[n] = null;
  $('pz-'+n+'-preview').style.display = 'none';
  $('pz-'+n+'-ph').style.display = '';
  $('pz-'+n+'-check').textContent = '';
  $('pz-'+n).classList.remove('filled');
}

// Ctrl+V ë¶™ì—¬ë„£ê¸°
document.addEventListener('paste', function(e) {
  if (!$('auth-modal').classList.contains('show')) return;
  if (authMethod !== 'proof') return;
  var items = (e.clipboardData || e.originalEvent.clipboardData).items;
  for (var i = 0; i < items.length; i++) {
    if (items[i].type.startsWith('image/')) {
      var f = items[i].getAsFile();
      var target = !proofFiles[1] ? '1' : !proofFiles[2] ? '2' : '3';
      applyProof(f, target);
      showToast('ğŸ“‹ ë¶™ì—¬ë„£ê¸° ì™„ë£Œ', 'success');
      e.preventDefault();
      break;
    }
  }
});

// ===== ì¸ì¦ ì œì¶œ =====
function submitAuth() {
  if (!currentFile) return;
  var user = JSON.parse(localStorage.getItem('tl_user') || '{}');
  var tl = Number(user.tl || 0);
  if (tl < 5000) { showToast('TLì´ ë¶€ì¡±í•©ë‹ˆë‹¤. 5,000 TL í•„ìš”', 'error'); return; }

  if (authMethod === 'spotify') {
    if (!spotifySelected) { showToast('Spotify ì•¨ë²”ì„ ì„ íƒí•˜ì„¸ìš”', 'error'); return; }
  } else {
    var count = [1,2,3].filter(function(n){ return proofFiles[n]; }).length;
    if (count < 1) { showToast('ìµœì†Œ 1ê°œ ì´ìƒì˜ ì¦ë¹™ ìë£Œê°€ í•„ìš”í•©ë‹ˆë‹¤', 'error'); return; }
  }

  // TL ì°¨ê°
  user.tl = tl - 5000;
  localStorage.setItem('tl_user', JSON.stringify(user));

  // íŒŒì¼ ì—…ë°ì´íŠ¸
  var files = getFiles();
  var idx = files.findIndex(function(f){ return f.id === currentFile.id; });
  if (idx > -1) {
    files[idx].authStatus = 'verified';
    files[idx].authMethod = authMethod;
    if (authMethod === 'spotify' && spotifySelected) {
      files[idx].coverImage = spotifySelected.coverImage;
      files[idx].artist = spotifySelected.artist;
      files[idx].spotifyAlbum = spotifySelected.name;
    }
    files[idx].authDate = Date.now();
    files[idx].shared = true; // ì¸ì¦ ì¦‰ì‹œ SharePlace ë“±ë¡
    saveFiles(files);
  }

  closeAuthModal();
  renderAll();
  updateNavBalance(user);
  showToast('âœ… ì¸ì¦ ì™„ë£Œ! SharePlaceì— ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
}


// ===== ì¬ìƒ =====
var currentPlayFile = null;

// ===== ê°€ê²© ì„¤ì • =====
var currentPriceFile = null;
function openPriceModal(fileId) {
  var files = getFiles();
  currentPriceFile = files.find(function(f){ return f.id === fileId; });
  if (!currentPriceFile) return;
  $('price-modal-filename').textContent = currentPriceFile.title;
  $('price-input').value = currentPriceFile.pricePerSec || 1;
  updatePricePreview();
  $('price-modal').classList.add('show');
}
function closePriceModal() { $('price-modal').classList.remove('show'); currentPriceFile = null; }
function setPrice(val) {
  $('price-input').value = val;
  updatePricePreview();
}
function updatePricePreview() {
  var p = parseFloat($('price-input').value) || 0.01;
  $('preview-30').textContent = (p * 30).toLocaleString() + ' TL';
  $('preview-180').textContent = (p * 180).toLocaleString() + ' TL';
  $('preview-600').textContent = (p * 600).toLocaleString() + ' TL';
}
function savePriceSettings() {
  if (!currentPriceFile) return;
  var p = parseFloat($('price-input').value) || 0.01;
  if (p < 1) { showToast('ìµœì†Œ 1 TL/ì´ˆ ì´ìƒ ì…ë ¥í•˜ì„¸ìš”', 'error'); return; }
  var files = getFiles();
  var idx = files.findIndex(function(f){ return f.id === currentPriceFile.id; });
  if (idx > -1) { files[idx].pricePerSec = p; saveFiles(files); }
  closePriceModal();
  renderAll();
  showToast('ê°€ê²©ì´ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤: ' + p + ' TL/ì´ˆ', 'success');
}
$('price-modal').addEventListener('click', function(e){ if(e.target===this) closePriceModal(); });

function getPulseWeight(pulse) {
  pulse = pulse || 0;
  if (pulse <= 100) return 1;
  if (pulse <= 500) return 2;
  if (pulse <= 2000) return 3;
  if (pulse <= 5000) return 5;
  return 10;
}
function getPlayCost(file, durationSec) {
  var pricePerSec = file.pricePerSec || 1;
  var dur = durationSec || 180; // ê¸°ë³¸ 3ë¶„
  var weight = getPulseWeight(file.pulse);
  var total = pricePerSec * dur * weight;
  return Math.max(1, Math.ceil(total));
}

function playMyFile(fileId) {
  var files = getFiles();
  currentPlayFile = files.find(function(f){ return f.id === fileId; });
  if (!currentPlayFile) return;
  var user = JSON.parse(localStorage.getItem('tl_user') || '{}');
  var cost = getPlayCost(currentPlayFile, currentPlayFile.durationSec);
  var balance = Number(user.tl || 0);

  $('play-modal-title').textContent = currentPlayFile.title;
  $('play-modal-artist').textContent = currentPlayFile.artist || '';
  if (currentPlayFile.coverImage) {
    $('play-modal-icon').innerHTML = '<img src="' + currentPlayFile.coverImage + '" style="width:80px;height:80px;border-radius:12px;object-fit:cover;">';
  } else {
    $('play-modal-icon').textContent = currentPlayFile.type === 'video' ? 'ğŸ¬' : 'ğŸµ';
  }
  $('play-modal-balance').textContent = balance.toLocaleString() + ' TL';
  $('play-modal-cost').textContent = cost + ' TL';
  $('play-modal-cost').style.color = cost >= 5 ? '#ef4444' : cost >= 3 ? '#8b5cf6' : '#8b5cf6';

  var pulseLabel = currentPlayFile.pulse > 0 ? ' (Pulse ' + currentPlayFile.pulse + ')' : '';
  $('play-modal-pulse').textContent = pulseLabel;

  var submitBtn = $('play-modal-submit');
  if (balance < cost) {
    submitBtn.disabled = true;
    submitBtn.textContent = 'TL ë¶€ì¡±';
    submitBtn.style.background = '#e5e7eb';
    submitBtn.style.color = '#9ca3af';
  } else {
    submitBtn.disabled = false;
    submitBtn.textContent = 'â–¶ ' + cost + ' TLë¡œ ì¬ìƒ';
    submitBtn.style.background = '#8b5cf6';
    submitBtn.style.color = 'white';
  }

  $('play-modal').classList.add('show');
}
function closePlayModal() { $('play-modal').classList.remove('show'); currentPlayFile = null; }
function confirmPlay() {
  if (!currentPlayFile) return;
  var user = JSON.parse(localStorage.getItem('tl_user') || '{}');
  var cost = getPlayCost(currentPlayFile, currentPlayFile.durationSec);
  var balance = Number(user.tl || 0);
  if (balance < cost) { showToast('TLì´ ë¶€ì¡±í•©ë‹ˆë‹¤', 'error'); return; }

  // TL ì°¨ê°
  user.tl = balance - cost;
  localStorage.setItem('tl_user', JSON.stringify(user));
  updateNavBalance(user);

  // Pulse +1
  var files = getFiles();
  var idx = files.findIndex(function(f){ return f.id === currentPlayFile.id; });
  if (idx > -1) { files[idx].pulse = (files[idx].pulse || 0) + 1; saveFiles(files); }

  localStorage.setItem('tl_current_play', JSON.stringify(currentPlayFile));
  closePlayModal();
  showToast('â–¶ ì¬ìƒ ì‹œì‘ (-' + cost + ' TL)', 'success');
  setTimeout(function(){ window.location.href = 'player.html'; }, 800);
}

// ===== ê³µìœ  ë§í¬ =====
var currentShareFile = null;
function shareLink(fileId) {
  var files = getFiles();
  currentShareFile = files.find(function(f){ return f.id === fileId; });
  if (!currentShareFile) return;
  var user = JSON.parse(localStorage.getItem('tl_user') || '{}');
  var refCode = user.username || 'user';
  var link = 'https://www.timelink.digital/open.html?file=' + fileId + '&ref=' + refCode + '&title=' + encodeURIComponent(currentShareFile.title);
  $('share-link-text').textContent = link;
  $('share-modal').classList.add('show');
}
function closeShareModal() { $('share-modal').classList.remove('show'); currentShareFile = null; }
function copyShareLink() {
  var text = $('share-link-text').textContent;
  navigator.clipboard.writeText(text).then(function() {
    showToast('ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤ ğŸ”—', 'success');
  });
}
function shareKakao() {
  var text = $('share-link-text').textContent;
  showToast('ì¹´ì¹´ì˜¤í†¡ SDK ì—°ë™ í•„ìš”', 'success');
}
function shareTwitter() {
  var title = currentShareFile ? currentShareFile.title : '';
  var link = $('share-link-text').textContent;
  var url = 'https://twitter.com/intent/tweet?text=' + encodeURIComponent('ğŸµ ' + title + ' - TimeLinkì—ì„œ ë“¤ì–´ë³´ì„¸ìš”!') + '&url=' + encodeURIComponent(link);
  window.open(url, '_blank');
}

// ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ë‹«ê¸°
$('play-modal').addEventListener('click', function(e){ if(e.target===this) closePlayModal(); });
$('share-modal').addEventListener('click', function(e){ if(e.target===this) closeShareModal(); });

// ===== íŒŒì¼ ê³µìœ /ì‚­ì œ =====
function shareFile(fileId) {
  var files = getFiles();
  var idx = files.findIndex(function(f){ return f.id === fileId; });
  if (idx > -1) {
    files[idx].shared = true;
    saveFiles(files);
    renderAll();
    showToast('ğŸ›ï¸ SharePlaceì— ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
  }
}
function deleteFile(fileId) {
  if (!confirm('íŒŒì¼ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
  var files = getFiles().filter(function(f){ return f.id !== fileId; });
  saveFiles(files);
  renderAll();
  showToast('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
}

// ===== ë„¤ë¹„ê²Œì´ì…˜ =====
function updateNavBalance(user) {
  if (!user) return;
  $('balance-tl').textContent = Number(user.tl||0).toLocaleString();
  $('balance-tlc').textContent = Number(user.tlc||0).toFixed(4);
}
function toggleDropdown() { $('dropdown')?.classList.toggle('show'); }
document.addEventListener('click', function(e) {
  if (!e.target.closest('.avatar')) $('dropdown')?.classList.remove('show');
});
function logout() {
  localStorage.removeItem('tl_user');
  localStorage.removeItem('tl_token');
  window.location.href = 'shareplace.html';
}

// ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ë‹«ê¸°
$('auth-modal').addEventListener('click', function(e) {
  if (e.target === this) closeAuthModal();
});

// ===== ì´ˆê¸°í™” =====
(function() {
  var user = JSON.parse(localStorage.getItem('tl_user') || 'null');
  if (user) {
    $('nav-auth').classList.remove('hidden');
    $('nav-guest').classList.add('hidden');
    $('balance-tl').textContent = Number(user.tl||0).toLocaleString();
    $('balance-tlc').textContent = Number(user.tlc||0).toFixed(4);
    $('avatar-letter').textContent = (user.username||'U').charAt(0).toUpperCase();
  }

  // ìƒ˜í”Œ íŒŒì¼ ì—†ìœ¼ë©´ ì¶”ê°€
  if (!getFiles().length) {
    var samples = [
      {id:'s1', title:'Midnight Vibe', artist:'ë‚˜', genre:'edm', type:'audio', fileSize:'TL3', authStatus:'pending', shared:false, pulse:0, createdAt:Date.now()-86400000},
      {id:'s2', title:'Seoul Nights', artist:'ë‚˜', genre:'kpop', type:'audio', fileSize:'TL3', authStatus:'verified', shared:true, pulse:120, createdAt:Date.now()-172800000, coverImage:''},
    ];
    saveFiles(samples);
  }

  renderAll();
})();

// =================== IndexedDB íŒŒì¼ ì €ì¥ì†Œ ===================
var TL_IDB_NAME = 'timelink_files';
var TL_IDB_VER  = 1;
var _idb = null;

function openIDB() {
  return new Promise(function(resolve, reject) {
    if (_idb) { resolve(_idb); return; }
    var req = indexedDB.open(TL_IDB_NAME, TL_IDB_VER);
    req.onupgradeneeded = function(e) {
      var db = e.target.result;
      if (!db.objectStoreNames.contains('files')) {
        db.createObjectStore('files', { keyPath: 'id' });
      }
    };
    req.onsuccess = function(e) { _idb = e.target.result; resolve(_idb); };
    req.onerror   = function(e) { reject(e.target.error); };
  });
}

function idbSave(fileId, blob) {
  return openIDB().then(function(db) {
    return new Promise(function(resolve, reject) {
      var tx = db.transaction('files', 'readwrite');
      tx.objectStore('files').put({ id: fileId, blob: blob });
      tx.oncomplete = resolve;
      tx.onerror = function(e) { reject(e.target.error); };
    });
  });
}

function idbLoad(fileId) {
  return openIDB().then(function(db) {
    return new Promise(function(resolve, reject) {
      var tx = db.transaction('files', 'readonly');
      var req = tx.objectStore('files').get(fileId);
      req.onsuccess = function(e) { resolve(e.target.result ? e.target.result.blob : null); };
      req.onerror   = function(e) { reject(e.target.error); };
    });
  });
}

function idbDelete(fileId) {
  return openIDB().then(function(db) {
    return new Promise(function(resolve) {
      var tx = db.transaction('files', 'readwrite');
      tx.objectStore('files').delete(fileId);
      tx.oncomplete = resolve;
    });
  });
}

// =================== D1 ë°±ì—”ë“œ ë™ê¸°í™” ===================
var API = 'https://timelink-backend.mununglee.workers.dev';

function syncFileToDB(file) {
  var user = JSON.parse(localStorage.getItem('tl_user') || '{}');
  if (!user.username) return;
  fetch(API + '/api/v1/library/save', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      username: user.username,
      file_id: file.id,
      title: file.title,
      artist: file.artist,
      genre: file.genre,
      cover_image: file.coverImage || '',
      auth_status: file.authStatus || 'pending',
      auth_method: file.authMethod || '',
      spotify_album: file.spotifyAlbum || '',
      pulse: file.pulse || 0,
      price_per_sec: file.pricePerSec || 1,
      shared: file.shared ? 1 : 0,
      created_at: file.createdAt || Date.now()
    })
  }).catch(function(e) { console.log('D1 sync failed (offline?):', e.message); });
}

function checkDBConnection() {
  fetch(API + '/api/v1/health')
    .then(function(r) { return r.json(); })
    .then(function(d) {
      var el = document.getElementById('db-status');
      if (el) {
        el.textContent = 'ğŸŸ¢ DB ì—°ê²°ë¨';
        el.style.color = '#7c3aed';
      }
      console.log('DB connected:', d);
    })
    .catch(function() {
      var el = document.getElementById('db-status');
      if (el) {
        el.textContent = 'ğŸ”´ DB ì˜¤í”„ë¼ì¸ (ë¡œì»¬ ì €ì¥)';
        el.style.color = '#ef4444';
      }
    });
}

// =================== í”Œë ˆì´ì–´ - IndexedDB ì—°ë™ ===================
function playMyFile(fileId) {
  var files = getFiles();
  currentPlayFile = files.find(function(f){ return f.id === fileId; });
  if (!currentPlayFile) return;

  idbLoad(fileId).then(function(blob) {
    if (blob) {
      var url = URL.createObjectURL(blob);
      currentPlayFile._blobUrl = url;
    }
    showPlayConfirm();
  }).catch(function() {
    showPlayConfirm();
  });
}

function showPlayConfirm() {
  var f = currentPlayFile;
  var user = JSON.parse(localStorage.getItem('tl_user') || '{}');
  var pricePerSec = f.pricePerSec || 1;
  var weight = getPulseWeight(f.pulse);
  var balance = Number(user.tl || 0);

  document.getElementById('play-modal-title').textContent = f.title;
  document.getElementById('play-modal-artist').textContent = f.artist || '';

  var icon = document.getElementById('play-modal-icon');
  if (f.coverImage) {
    icon.innerHTML = '<img src="' + f.coverImage + '" style="width:80px;height:80px;border-radius:12px;object-fit:cover;">';
  } else {
    icon.textContent = f.type === 'video' ? 'ğŸ¬' : 'ğŸµ';
  }

  document.getElementById('play-modal-balance').textContent = balance.toLocaleString() + ' TL';
  document.getElementById('play-modal-cost').textContent = pricePerSec + ' TL/ì´ˆ';
  document.getElementById('play-modal-pulse').textContent = f.pulse || 0;
  document.getElementById('play-modal-weight').textContent = weight > 1 ? 'Ã—' + weight + ' ê°€ì¤‘ì¹˜ ì ìš©' : 'ê°€ì¤‘ì¹˜ ì—†ìŒ';

  var noFile = !f._blobUrl && !f.fileUrl;
  var btn = document.getElementById('play-modal-submit');
  if (noFile) {
    btn.disabled = false;
    btn.textContent = 'â–¶ ì¬ìƒ (íŒŒì¼ ì—†ìŒ - í…ŒìŠ¤íŠ¸)';
    btn.style.background = '#8b5cf6';
    btn.style.color = 'white';
    document.getElementById('play-modal').classList.add('show');
  } else if (balance < pricePerSec * weight) {
    btn.disabled = true;
    btn.textContent = 'TL ë¶€ì¡±';
    btn.style.background = '#e5e7eb';
    btn.style.color = '#9ca3af';
    document.getElementById('play-modal').classList.add('show');
  } else {
    btn.disabled = false;
    btn.textContent = 'â–¶ ì¬ìƒ ì‹œì‘';
    btn.style.background = '#8b5cf6';
    btn.style.color = 'white';
    document.getElementById('play-modal').classList.add('show');
  }
}

function confirmPlay() {
  closePlayModal();
  openPlayerPanel(currentPlayFile);
}

function openPlayerPanel(f) {
  var user = JSON.parse(localStorage.getItem('tl_user') || '{}');
  var pricePerSec = f.pricePerSec || 1;
  var weight = getPulseWeight(f.pulse);
  var costPerSec = pricePerSec * weight;

  var artwork = document.getElementById('player-artwork');
  if (f.coverImage) {
    artwork.innerHTML = '<img src="' + f.coverImage + '" style="width:100%;height:100%;object-fit:cover;">';
  } else {
    artwork.textContent = f.type === 'video' ? 'ğŸ¬' : 'ğŸµ';
  }

  document.getElementById('player-title').textContent = f.title;
  document.getElementById('player-artist').textContent = f.artist || 'ì•Œ ìˆ˜ ì—†ìŒ';
  document.getElementById('player-genre-tag').textContent = f.genre || 'ìŒì•…';
  document.getElementById('player-verified-tag').style.display = f.authStatus === 'verified' ? 'inline-block' : 'none';

  var creatorInitial = (f.artist || 'ë‚˜').charAt(0).toUpperCase();
  document.getElementById('creator-avatar').textContent = creatorInitial;
  document.getElementById('creator-name').textContent = f.artist || 'ë‚˜';
  document.getElementById('creator-since').textContent = f.createdAt ? new Date(f.createdAt).toLocaleDateString('ko-KR') + ' ë“±ë¡' : '';
  document.getElementById('creator-genre').textContent = f.genre || '-';
  document.getElementById('creator-auth').textContent = f.authMethod === 'spotify' ? 'ğŸµ Spotify' : f.authStatus === 'verified' ? 'ğŸ“¸ ì¦ë¹™ ì œì¶œ' : 'ë¯¸ì¸ì¦';
  document.getElementById('creator-pulse').textContent = (f.pulse || 0).toLocaleString();
  document.getElementById('creator-price').textContent = pricePerSec + ' TL/ì´ˆ';
  document.getElementById('creator-balance').textContent = Number(user.tl||0).toLocaleString() + ' TL';
  document.getElementById('creator-per-sec').textContent = costPerSec + ' TL/ì´ˆ';

  var spotifyEl = document.getElementById('creator-spotify');
  if (f.spotifyAlbum) {
    spotifyEl.style.display = 'block';
    document.getElementById('creator-spotify-album').textContent = f.spotifyAlbum;
  } else {
    spotifyEl.style.display = 'none';
  }

  var isVideo = f.type === 'video';
  document.getElementById('player-video-wrap').style.display = isVideo ? 'block' : 'none';
  document.getElementById('player-audio-wrap').style.display = isVideo ? 'none' : 'block';

  var mediaEl = isVideo ? document.getElementById('player-video') : document.getElementById('player-audio');

  // BlobURL ìš°ì„ , ì—†ìœ¼ë©´ fileUrl
  var src = f._blobUrl || f.fileUrl || null;
  if (src) {
    mediaEl.src = src;
    mediaEl.load();
    mediaEl.play().catch(function(){});
  } else {
    var wrap = isVideo ? document.getElementById('player-video-wrap') : document.getElementById('player-audio-wrap');
    wrap.innerHTML = '<div style="background:#ede9fe;border-radius:12px;padding:20px;text-align:center;color:#92400e;">' +
      '<div style="font-size:28px;margin-bottom:8px;">âš ï¸</div>' +
      '<div style="font-weight:700;margin-bottom:4px;">íŒŒì¼ì´ ì—°ê²°ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤</div>' +
      '<div style="font-size:12px;">create.htmlì—ì„œ íŒŒì¼ì„ ë‹¤ì‹œ ì—…ë¡œë“œí•˜ê±°ë‚˜<br>ì•„ë˜ [íŒŒì¼ ì§ì ‘ ì—´ê¸°]ë¥¼ ì´ìš©í•˜ì„¸ìš”</div>' +
      '<div style="margin-top:10px;">' +
      '<input type="file" id="direct-file-input" accept="audio/*,video/*" style="display:none" onchange="loadDirectFile(this)">' +
      '<button style="margin-top:4px;padding:8px 20px;background:#8b5cf6;color:white;border:none;border-radius:8px;font-weight:700;cursor:pointer" onclick="document.getElementById(\\"direct-file-input\\").click()">ğŸ“‚ íŒŒì¼ ì§ì ‘ ì—´ê¸°</button>' +
      '<div style="margin-top:6px;font-size:11px;color:#b45309">ì´ ê¸°ê¸°ì—ì„œ IndexedDBì— ì €ì¥ë©ë‹ˆë‹¤</div>' +
      '</div>' +
    wrap.style.display = 'block';
  }

  document.getElementById('player-panel').style.bottom = '0';
  tlUsed = 0;
  document.getElementById('player-tl-used').textContent = '0 TL';

  if (playerInterval) clearInterval(playerInterval);

  if (src) {
    mediaEl.ontimeupdate = function() {
      var cur = mediaEl.currentTime, dur = mediaEl.duration || 0;
      if (dur > 0) {
        document.getElementById('player-progress').style.width = (cur/dur*100) + '%';
        var cm = Math.floor(cur/60), cs = Math.floor(cur%60);
        var dm = Math.floor(dur/60), ds = Math.floor(dur%60);
        document.getElementById('player-time').textContent = cm+':'+(cs<10?'0':'')+cs+' / '+dm+':'+(ds<10?'0':'')+ds;
      }
    };

    playerInterval = setInterval(function() {
      if (!mediaEl || mediaEl.paused) return;
      var user2 = JSON.parse(localStorage.getItem('tl_user') || '{}');
      var bal = Number(user2.tl || 0);
      if (bal < costPerSec) {
        mediaEl.pause();
        document.getElementById('play-pause-btn').textContent = 'â–¶';
        showToast('TLì´ ë¶€ì¡±í•©ë‹ˆë‹¤. ì¬ìƒì´ ì¤‘ì§€ë˜ì—ˆìŠµë‹ˆë‹¤.', 'error');
        return;
      }
      user2.tl = bal - costPerSec;
      localStorage.setItem('tl_user', JSON.stringify(user2));
      updateNavBalance(user2);
      tlUsed += costPerSec;
      document.getElementById('player-tl-used').textContent = tlUsed.toLocaleString() + ' TL';
      document.getElementById('creator-balance').textContent = Number(user2.tl).toLocaleString() + ' TL';
      if (Math.floor(mediaEl.currentTime) % 10 === 0 && Math.floor(mediaEl.currentTime) > 0) {
        var files2 = getFiles();
        var idx2 = files2.findIndex(function(fi){ return fi.id === f.id; });
        if (idx2 > -1) { files2[idx2].pulse = (files2[idx2].pulse||0) + 1; saveFiles(files2); }
      }
    }, 1000);

    mediaEl.onplay  = function() { document.getElementById('play-pause-btn').textContent = 'â¸'; };
    mediaEl.onpause = function() { document.getElementById('play-pause-btn').textContent = 'â–¶'; };
    mediaEl.onended = function() {
      clearInterval(playerInterval);
      document.getElementById('play-pause-btn').textContent = 'â–¶';
      showToast('ì¬ìƒ ì™„ë£Œ Â· ì‚¬ìš© TL: ' + tlUsed.toLocaleString(), 'success');
    };
  }
}

function loadDirectFile(input, fileId) {
  if (!fileId && currentPlayFile) fileId = currentPlayFile.id;
  var file = input.files[0];
  if (!file) return;
  var url = URL.createObjectURL(file);
  // IndexedDBì—ë„ ì €ì¥
  idbSave(fileId, file).catch(function(){});
  // í˜„ì¬ íŒŒì¼ì— blobUrl ì„¤ì •
  if (currentPlayFile && currentPlayFile.id === fileId) {
    currentPlayFile._blobUrl = url;
  }
  var isVideo = file.type.startsWith('video/');
  var mediaEl = isVideo ? document.getElementById('player-video') : document.getElementById('player-audio');
  var audioWrap = document.getElementById('player-audio-wrap');
  var videoWrap = document.getElementById('player-video-wrap');
  if (isVideo) {
    videoWrap.innerHTML = '';
    videoWrap.appendChild(document.getElementById('player-video') || (function(){var v=document.createElement('video');v.id='player-video';v.controls=true;v.style='width:100%;border-radius:12px;background:#000;max-height:200px;';return v;})());
    videoWrap.style.display = 'block';
    audioWrap.style.display = 'none';
  } else {
    audioWrap.innerHTML = '';
    var a = document.createElement('audio');
    a.id = 'player-audio';
    a.controls = true;
    a.style = 'width:100%;';
    audioWrap.appendChild(a);
    audioWrap.style.display = 'block';
    videoWrap.style.display = 'none';
  }
  var el = isVideo ? document.getElementById('player-video') : document.getElementById('player-audio');
  el.src = url;
  el.load();
  el.play().catch(function(){});
  showToast('íŒŒì¼ ë¡œë“œë¨: ' + file.name, 'success');
}

// =================== ìˆ˜ì • ëª¨ë‹¬ ì™„ì „ êµ¬í˜„ ===================
var currentEditFile = null;
var editCoverImage  = null;

function openEditModal(fileId) {
  var files = getFiles();
  currentEditFile = files.find(function(f){ return f.id === fileId; });
  if (!currentEditFile) return;

  document.getElementById('edit-modal-filename').textContent = currentEditFile.title;
  document.getElementById('edit-title').value  = currentEditFile.title || '';
  document.getElementById('edit-artist').value = currentEditFile.artist || '';
  document.getElementById('edit-price').value  = currentEditFile.pricePerSec || 1;
  document.getElementById('edit-genre').value  = currentEditFile.genre || 'etc';
  editCoverImage = currentEditFile.coverImage || null;

  var prev = document.getElementById('edit-cover-preview');
  if (editCoverImage) {
    prev.innerHTML = '<img src="' + editCoverImage + '" style="width:100%;height:100%;object-fit:cover;">';
  } else {
    prev.textContent = currentEditFile.type === 'video' ? 'ğŸ¬' : 'ğŸµ';
  }
  document.getElementById('edit-spotify-search').style.display = 'none';
  document.getElementById('edit-sp-results').innerHTML = '';
  // Load stream URL
  document.getElementById('edit-stream-url').value = currentEditFile.streamUrl || '';
  // Check IndexedDB audio status
  var statusEl = document.getElementById('edit-audio-status');
  statusEl.textContent = 'â³ íŒŒì¼ ìƒíƒœ í™•ì¸ ì¤‘...';
  idbLoad(fileId).then(function(blob) {
    if (blob) {
      var mb = (blob.size / 1024 / 1024).toFixed(1);
      statusEl.innerHTML = '<span style="color:#7c3aed;font-weight:700;">âœ… ë¡œì»¬ íŒŒì¼ ìˆìŒ (' + mb + ' MB)</span> â€” ì¬ìƒ ê°€ëŠ¥';
    } else if (currentEditFile.streamUrl) {
      statusEl.innerHTML = '<span style="color:#2563eb;font-weight:700;">ğŸ”— ìŠ¤íŠ¸ë¦¬ë° URLë§Œ</span> â€” SharePlace ì¬ìƒ ê°€ëŠ¥';
    } else {
      statusEl.innerHTML = '<span style="color:#ef4444;font-weight:700;">âŒ íŒŒì¼ ì—†ìŒ</span> â€” ì•„ë˜ì—ì„œ ì—…ë¡œë“œ í•„ìš”';
    }
  }).catch(function() {
    statusEl.innerHTML = '<span style="color:#ef4444;">âš ï¸ ìƒíƒœ í™•ì¸ ì‹¤íŒ¨</span>';
  });
  document.getElementById('edit-modal').classList.add('show');
}

function closeEditModal() {
  document.getElementById('edit-modal').classList.remove('show');
  currentEditFile = null; editCoverImage = null;
}

function handleEditCover(input) {
  var f = input.files[0]; if (!f) return;
  var reader = new FileReader();
  reader.onload = function(ev) {
    editCoverImage = ev.target.result;
    document.getElementById('edit-cover-preview').innerHTML = '<img src="' + editCoverImage + '" style="width:100%;height:100%;object-fit:cover;">';
  };
  reader.readAsDataURL(f);
}

function handleEditAudio(input) {
  var file = input.files[0];
  if (!file) return;
  var statusEl = document.getElementById('edit-audio-status');
  var mb = (file.size / 1024 / 1024).toFixed(1);
  statusEl.textContent = 'â³ ì €ì¥ ì¤‘... (' + mb + ' MB)';
  idbSave(currentEditFile.id, file).then(function() {
    statusEl.innerHTML = '<span style="color:#7c3aed;font-weight:700;">âœ… ì €ì¥ ì™„ë£Œ (' + mb + ' MB)</span> â€” ì¬ìƒ ê°€ëŠ¥';
    showToast('âœ… ì˜¤ë””ì˜¤ íŒŒì¼ ì €ì¥ë¨ (' + file.name + ')', 'success');
    // Update file type if needed
    var files = getFiles();
    var idx = files.findIndex(function(f){ return f.id === currentEditFile.id; });
    if (idx > -1) {
      files[idx].type = file.type.startsWith('video/') ? 'video' : 'audio';
      files[idx].fileName = file.name;
      saveFiles(files);
    }
  }).catch(function(err) {
    statusEl.innerHTML = '<span style="color:#ef4444;">âŒ ì €ì¥ ì‹¤íŒ¨: ' + err.message + '</span>';
    showToast('íŒŒì¼ ì €ì¥ ì‹¤íŒ¨', 'error');
  });
}

document.addEventListener('paste', function(e) {
  if (!document.getElementById('edit-modal').classList.contains('show')) return;
  var items = (e.clipboardData || e.originalEvent.clipboardData).items;
  for (var i = 0; i < items.length; i++) {
    if (items[i].type.startsWith('image/')) {
      var reader = new FileReader();
      reader.onload = function(ev) {
        editCoverImage = ev.target.result;
        document.getElementById('edit-cover-preview').innerHTML = '<img src="' + editCoverImage + '" style="width:100%;height:100%;object-fit:cover;">';
        showToast('ì´ë¯¸ì§€ ë¶™ì—¬ë„£ê¸° ì™„ë£Œ', 'success');
      };
      reader.readAsDataURL(items[i].getAsFile());
      break;
    }
  }
});

function openSpotifyCoverSearch() {
  var el = document.getElementById('edit-spotify-search');
  el.style.display = el.style.display === 'none' ? 'block' : 'none';
}

function searchEditSpotify() {
  var query = document.getElementById('edit-sp-query').value.trim();
  if (!query) return;
  var resultsEl = document.getElementById('edit-sp-results');
  resultsEl.innerHTML = '<div style="grid-column:1/-1;text-align:center;color:#6b7280;padding:10px;">â³ ê²€ìƒ‰ ì¤‘...</div>';
  fetch('https://spotify-worker.mununglee.workers.dev/api/spotify-search', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({query: query})
  }).then(function(r){ return r.json(); }).then(function(data) {
    if (!data.albums || !data.albums.length) {
      resultsEl.innerHTML = '<div style="grid-column:1/-1;text-align:center;color:#6b7280;">ê²°ê³¼ ì—†ìŒ</div>';
      return;
    }
    window._editSpotifyAlbums = data.albums;
    resultsEl.innerHTML = data.albums.map(function(a, i) {
      var img = a.coverImage || a.thumbnail || '';
      return '<div onclick="selectEditSpotify(' + i + ')" style="cursor:pointer;border:2px solid #e5e7eb;border-radius:8px;overflow:hidden;" onmouseover="this.style.borderColor='#1db954'" onmouseout="this.style.borderColor='#e5e7eb'">'
        + '<img src="' + img + '" style="width:100%;aspect-ratio:1;object-fit:cover;">'
        + '<div style="padding:4px 6px;font-size:10px;font-weight:700;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;">' + (a.name || '') + '</div></div>';
    }).join('');
  }).catch(function(e) {
    resultsEl.innerHTML = '<div style="grid-column:1/-1;color:#ef4444;">ì˜¤ë¥˜: ' + e.message + '</div>';
  });
}

function selectEditSpotify(idx) {
  var album = window._editSpotifyAlbums[idx];
  editCoverImage = album.coverImage || album.thumbnail;
  document.getElementById('edit-cover-preview').innerHTML = '<img src="' + editCoverImage + '" style="width:100%;height:100%;object-fit:cover;">';
  if (!document.getElementById('edit-artist').value) document.getElementById('edit-artist').value = album.artist || '';
  // spotifyAlbumë„ ì—…ë°ì´íŠ¸
  if (currentEditFile) currentEditFile.spotifyAlbum = album.name;
  document.getElementById('edit-spotify-search').style.display = 'none';
  showToast('Spotify ì´ë¯¸ì§€ ì ìš©ë¨', 'success');
}

function saveEdit() {
  if (!currentEditFile) return;
  var price = parseInt(document.getElementById('edit-price').value) || 1;
  if (price < 1) { showToast('ìµœì†Œ 1 TL/ì´ˆ ì´ìƒ ì…ë ¥í•˜ì„¸ìš”', 'error'); return; }

  var files = getFiles();
  var idx = files.findIndex(function(f){ return f.id === currentEditFile.id; });
  if (idx < 0) { showToast('íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤', 'error'); return; }

  files[idx].title      = document.getElementById('edit-title').value.trim()  || files[idx].title;
  files[idx].artist     = document.getElementById('edit-artist').value.trim() || files[idx].artist;
  files[idx].genre      = document.getElementById('edit-genre').value;
  files[idx].pricePerSec= price;
  if (editCoverImage) files[idx].coverImage = editCoverImage;
  if (currentEditFile.spotifyAlbum) files[idx].spotifyAlbum = currentEditFile.spotifyAlbum;
  var streamUrl = document.getElementById('edit-stream-url').value.trim();
  if (streamUrl) files[idx].streamUrl = streamUrl;

  saveFiles(files);
  syncFileToDB(files[idx]);
  closeEditModal();
  renderAll();
  showToast('âœ… ìˆ˜ì • ì €ì¥ ì™„ë£Œ Â· D1 ë™ê¸°í™” ì¤‘...', 'success');
}

document.getElementById('edit-modal').addEventListener('click', function(e) {
  if (e.target === this) closeEditModal();
});

window.addEventListener('DOMContentLoaded', function() {
  checkDBConnection();
});

</script>
<footer class="page-footer">
  <div class="footer-grid">
    <div class="footer-col">
      <div class="footer-logo"><span style="background:#8b5cf6;border-radius:6px;padding:2px 8px;color:white;font-weight:800;">âš¡</span> TimeLink</div>
      <p class="footer-tagline" data-i18n="footer_slogan">ì°½ì‘ìë¥¼ ìœ„í•œ ìƒˆë¡œìš´ ìˆ˜ìµ í”Œë«í¼</p>
    </div>
    <div class="footer-col">
      <div class="footer-col-title" data-i18n="footer_service">ì„œë¹„ìŠ¤</div>
      <a href="shareplace.html">ğŸ›ï¸ SharePlace</a>
      <a href="creator.html" data-i18n="footer_creator">ğŸµ ì°½ì‘ì í”„ë¡œê·¸ë¨</a>
      <a href="pricing.html" data-i18n="footer_pricing">ğŸ’³ ìš”ê¸ˆì œ</a>
      <a href="radio.html">â˜• ì¹´í˜ë°©ì†¡</a>
    </div>
    <div class="footer-col">
      <div class="footer-col-title" data-i18n="footer_company">íšŒì‚¬</div>
      <a href="about.html" data-i18n="footer_about">ğŸ¢ íšŒì‚¬ ì†Œê°œ</a>
      <a href="tokenomics.html" data-i18n="footer_tokenomics">âš¡ í† í° ê²½ì œ</a>
      <a href="poc.html" data-i18n="footer_poc">ğŸ“Š ê¸°ì—¬ë„ ì‹œìŠ¤í…œ</a>
      <a href="roadmap.html" data-i18n="footer_roadmap">ğŸ—ºï¸ ë¡œë“œë§µ</a>
      <a href="faq.html" data-i18n="footer_faq">â“ FAQ</a>
    </div>
    <div class="footer-col">
      <div class="footer-col-title" data-i18n="footer_legal">ë²•ë¬´</div>
      <a href="terms.html" data-i18n="page_terms">ì´ìš©ì•½ê´€</a>
      <a href="privacy.html" data-i18n="footer_privacy">ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨</a>
      <a href="copyright.html" data-i18n="page_copyright">ì €ì‘ê¶Œ ì •ì±…</a>
      <a href="copyright.html#report" style="color:#ef4444;" data-i18n="footer_report">ì €ì‘ê¶Œ ì¹¨í•´ ì‹ ê³ </a>
    </div>
  </div>
  <div class="footer-bottom">
    âš–ï¸ ëª¨ë“  íŒŒì¼ì˜ ì°½ì‘ê¶Œì€ ì°½ì‘ìì—ê²Œ ìˆìŠµë‹ˆë‹¤. Â© 2025 TimeLink. All rights reserved.
  </div>
</footer>
<script src="tl-economy.js"></script>
<script src="i18n.js"></script>
<script src="currency.js"></script>
<script>
document.addEventListener("DOMContentLoaded", function() {
  // ì–¸ì–´ ì„ íƒê¸° ì‚½ì…
  if (typeof I18N !== "undefined") {
    I18N.renderSelector("lang-selector");
  }
  // í†µí™” ì„ íƒê¸° ì‚½ì…
  if (typeof CURRENCY !== "undefined") {
    CURRENCY.renderSelector("currency-selector");
  }
});
</script>
<script>
// â”€â”€ ê³µí†µ ì¸ì¦ & ê¸€ë¡œë²Œ ì´ˆê¸°í™” â”€â”€
(function(){
  var currentUser = null;
  try { currentUser = JSON.parse(localStorage.getItem('tl_user') || 'null'); } catch(e){}

  function toggleDropdown(){ var d=document.getElementById('dropdown'); if(d) d.classList.toggle('show'); }
  window.toggleDropdown = toggleDropdown;

  function logout(){ localStorage.removeItem('tl_user'); localStorage.removeItem('auth_token'); window.location.href='index.html'; }
  window.logout = logout;

  function updateNavbar(){
    var navAuth=document.getElementById('nav-auth');
    var navGuest=document.getElementById('nav-guest');
    var balTl=document.getElementById('balance-tl');
    var balTlc=document.getElementById('balance-tlc');
    var avL=document.getElementById('avatar-letter');
    if(currentUser){
      if(navAuth) navAuth.classList.remove('hidden');
      if(navGuest) navGuest.classList.add('hidden');
      if(balTl) balTl.textContent = (currentUser.tl||0).toLocaleString();
      if(balTlc) balTlc.textContent = parseFloat(currentUser.tlc||0).toFixed(4);
      if(avL) avL.textContent = (currentUser.username||'U').charAt(0).toUpperCase();
    } else {
      if(navAuth) navAuth.classList.add('hidden');
      if(navGuest) navGuest.classList.remove('hidden');
    }
  }
  window.updateNavbar = updateNavbar;

  document.addEventListener('click', function(e){
    if(!e.target.closest('.avatar') && !e.target.closest('#dropdown')){
      var d=document.getElementById('dropdown');
      if(d) d.classList.remove('show');
    }
  });

  document.addEventListener('DOMContentLoaded', function(){
    updateNavbar();
    if(typeof I18N!=='undefined'){ I18N.lang=I18N.detect(); I18N.renderSelector('lang-selector'); I18N.applyAll(); }
    if(typeof CURRENCY!=='undefined'){ CURRENCY.current=CURRENCY.detect(); CURRENCY.renderSelector('currency-selector'); CURRENCY.applyAll(); }
  });
})();
</script>
</body>
</html>

