# run-global.ps1
# ëª¨ë“  HTML íŒŒì¼ì— ë‹¤êµ­ì  ê¸°ëŠ¥ ìë™ ì¶”ê°€ (1TL = 1ì› ê¸°ì¤€)

$folderPath = "C:\Users\win11\Desktop\timelink-frontend\TimeLink"
cd $folderPath

Write-Host "ğŸš€ TimeLink ë‹¤êµ­ì  ê¸°ëŠ¥ ì¶”ê°€ ì‹œì‘..." -ForegroundColor Cyan
Write-Host "ğŸ’° í™˜ìœ¨: 1TL = 1ì› (ê¸°ë³¸)" -ForegroundColor Yellow

# ë‹¤êµ­ì  ìŠ¤í¬ë¦½íŠ¸
$globalScript = @'

<!-- ë‹¤êµ­ì  ê¸°ëŠ¥ (ì–¸ì–´/í†µí™” ì„ íƒê¸°) -->
<style>
.language-currency-selector {
  position: fixed; top: 80px; right: 24px; z-index: 10000;
  background: white; border-radius: 999px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  padding: 4px; display: flex; gap: 2px;
}
.language-currency-selector select {
  padding: 6px 12px; border-radius: 999px; border: none;
  background: transparent; font-size: 13px; font-weight: 600;
  cursor: pointer; outline: none;
}
.language-currency-selector select:hover {
  background: #f3f4f6;
}
</style>

<script>
// ë‹¤êµ­ì  ì‹œìŠ¤í…œ (1TL = 1ì› ê¸°ì¤€)
const i18n = {
  currentLang: localStorage.getItem('language') || 'ko',
  currentCurrency: localStorage.getItem('currency') || 'KRW',
  
  translations: {
    ko: { home: 'í™ˆ', shareplace: 'ë§ˆì¼“í”Œë ˆì´ìŠ¤', library: 'ë¼ì´ë¸ŒëŸ¬ë¦¬', upload: 'ì—…ë¡œë“œ',
          player: 'í”Œë ˆì´ì–´', radio: 'ì¹´í˜ë°©ì†¡', car: 'ì¹´ëª¨ë“œ', ads: 'ê´‘ê³ ', wallet: 'ì§€ê°‘',
          login: 'ë¡œê·¸ì¸', signup: 'ì‹œì‘í•˜ê¸°', tl: 'TL', tlc: 'TLC',
          copyright: 'ëª¨ë“  íŒŒì¼ì˜ ì°½ì‘ê¶Œì€ ì°½ì‘ìì—ê²Œ ìˆìŠµë‹ˆë‹¤.',
          confirm: 'í™•ì¸', cancel: 'ì·¨ì†Œ', save: 'ì €ì¥', delete: 'ì‚­ì œ',
          tl_balance: 'TL ì”ê³ ', tlc_balance: 'TLC ì”ê³ ', total_earned: 'ì´ ìˆ˜ìµ',
          exchange: 'í™˜ì „', recharge: 'ì¶©ì „' },
    
    en: { home: 'Home', shareplace: 'Marketplace', library: 'Library', upload: 'Upload',
          player: 'Player', radio: 'Radio', car: 'Car Mode', ads: 'Ads', wallet: 'Wallet',
          login: 'Login', signup: 'Sign Up', tl: 'TL', tlc: 'TLC',
          copyright: 'All copyrights belong to the creators.',
          confirm: 'Confirm', cancel: 'Cancel', save: 'Save', delete: 'Delete',
          tl_balance: 'TL Balance', tlc_balance: 'TLC Balance', total_earned: 'Total Earned',
          exchange: 'Exchange', recharge: 'Recharge' },
    
    ja: { home: 'ãƒ›ãƒ¼ãƒ ', shareplace: 'ãƒãƒ¼ã‚±ãƒƒãƒˆãƒ—ãƒ¬ã‚¤ã‚¹', library: 'ãƒ©ã‚¤ãƒ–ãƒ©ãƒª', upload: 'ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰',
          player: 'ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼', radio: 'ãƒ©ã‚¸ã‚ª', car: 'ã‚«ãƒ¼ãƒ¢ãƒ¼ãƒ‰', ads: 'åºƒå‘Š', wallet: 'ã‚¦ã‚©ãƒ¬ãƒƒãƒˆ',
          login: 'ãƒ­ã‚°ã‚¤ãƒ³', signup: 'ç™»éŒ²', tl: 'TL', tlc: 'TLC',
          copyright: 'ã™ã¹ã¦ã®è‘—ä½œæ¨©ã¯ä½œæˆè€…ã«å¸°å±ã—ã¾ã™ã€‚',
          confirm: 'ç¢ºèª', cancel: 'ã‚­ãƒ£ãƒ³ã‚»ãƒ«', save: 'ä¿å­˜', delete: 'å‰Šé™¤',
          tl_balance: 'TLæ®‹é«˜', tlc_balance: 'TLCæ®‹é«˜', total_earned: 'ç·åç›Š',
          exchange: 'äº¤æ›', recharge: 'ãƒãƒ£ãƒ¼ã‚¸' },
    
    'zh-CN': { home: 'é¦–é¡µ', shareplace: 'å¸‚åœº', library: 'åº“', upload: 'ä¸Šä¼ ',
               player: 'æ’­æ”¾å™¨', radio: 'ç”µå°', car: 'è½¦è½½æ¨¡å¼', ads: 'å¹¿å‘Š', wallet: 'é’±åŒ…',
               login: 'ç™»å½•', signup: 'æ³¨å†Œ', tl: 'TL', tlc: 'TLC',
               copyright: 'æ‰€æœ‰ç‰ˆæƒå½’åˆ›ä½œè€…æ‰€æœ‰ã€‚',
               confirm: 'ç¡®è®¤', cancel: 'å–æ¶ˆ', save: 'ä¿å­˜', delete: 'åˆ é™¤',
               tl_balance: 'TLä½™é¢', tlc_balance: 'TLCä½™é¢', total_earned: 'æ€»æ”¶å…¥',
               exchange: 'å…‘æ¢', recharge: 'å……å€¼' },
    
    es: { home: 'Inicio', shareplace: 'Mercado', library: 'Biblioteca', upload: 'Subir',
          player: 'Reproductor', radio: 'Radio', car: 'Modo Coche', ads: 'Anuncios', wallet: 'Billetera',
          login: 'Iniciar sesiÃ³n', signup: 'Registrarse', tl: 'TL', tlc: 'TLC',
          copyright: 'Todos los derechos de autor pertenecen a los creadores.',
          confirm: 'Confirmar', cancel: 'Cancelar', save: 'Guardar', delete: 'Eliminar',
          tl_balance: 'Saldo TL', tlc_balance: 'Saldo TLC', total_earned: 'Ganancias Totales',
          exchange: 'Cambiar', recharge: 'Recargar' }
  },
  
  // í™˜ìœ¨: 1TL = 1ì› ê¸°ì¤€ (2024ë…„)
  currencies: {
    KRW: { symbol: 'â‚©', rate: 1, name: 'ì›' },        // 1TL = 1ì›
    USD: { symbol: '$', rate: 0.00075, name: 'Dollar' }, // 1TL = 0.00075$
    JPY: { symbol: 'Â¥', rate: 0.11, name: 'Yen' },      // 1TL = 0.11ì—”
    EUR: { symbol: 'â‚¬', rate: 0.0007, name: 'Euro' },   // 1TL = 0.0007ìœ ë¡œ
    CNY: { symbol: 'Â¥', rate: 0.0054, name: 'Yuan' },   // 1TL = 0.0054ìœ„ì•ˆ
    GBP: { symbol: 'Â£', rate: 0.0006, name: 'Pound' }   // 1TL = 0.0006íŒŒìš´ë“œ
  },
  
  setLanguage(lang) {
    this.currentLang = lang;
    localStorage.setItem('language', lang);
    this.updateUI();
  },
  
  setCurrency(currency) {
    this.currentCurrency = currency;
    localStorage.setItem('currency', currency);
    this.updateCurrencyDisplay();
  },
  
  updateUI() {
    const t = this.translations[this.currentLang] || this.translations.ko;
    
    // data-i18n ì†ì„±ì´ ìˆëŠ” ëª¨ë“  ìš”ì†Œ ì—…ë°ì´íŠ¸
    document.querySelectorAll('[data-i18n]').forEach(el => {
      const key = el.getAttribute('data-i18n');
      if (t[key]) {
        if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA' || el.tagName === 'SELECT') {
          el.placeholder = t[key];
        } else {
          el.textContent = t[key];
        }
      }
    });
    
    // ì €ì‘ê¶Œ ì—…ë°ì´íŠ¸
    const copyrightEl = document.querySelector('[data-i18n-copyright]');
    if (copyrightEl) copyrightEl.textContent = t.copyright;
  },
  
  updateCurrencyDisplay() {
    const currency = this.currencies[this.currentCurrency];
    
    document.querySelectorAll('[data-currency]').forEach(el => {
      const tlValue = parseFloat(el.getAttribute('data-currency')) || 0;
      const converted = tlValue * currency.rate;
      
      if (el.tagName === 'INPUT') {
        el.value = converted.toFixed(2);
      } else {
        el.textContent = currency.symbol + ' ' + converted.toLocaleString(undefined, {
          minimumFractionDigits: 0,
          maximumFractionDigits: 0
        });
      }
    });
    
    // í†µí™” ì‹¬ë³¼ ì—…ë°ì´íŠ¸
    document.querySelectorAll('[data-currency-symbol]').forEach(el => {
      el.textContent = currency.symbol;
    });
  },
  
  init() {
    // ì–¸ì–´ ì„ íƒê¸° ìƒì„±
    const selector = document.createElement('div');
    selector.className = 'language-currency-selector';
    
    const langSelect = document.createElement('select');
    langSelect.id = 'lang-select';
    const languages = [
      { code: 'ko', name: 'ğŸ‡°ğŸ‡· í•œêµ­ì–´' },
      { code: 'en', name: 'ğŸ‡ºğŸ‡¸ English' },
      { code: 'ja', name: 'ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª' },
      { code: 'zh-CN', name: 'ğŸ‡¨ğŸ‡³ ä¸­æ–‡' },
      { code: 'es', name: 'ğŸ‡ªğŸ‡¸ EspaÃ±ol' }
    ];
    
    languages.forEach(lang => {
      const option = document.createElement('option');
      option.value = lang.code;
      option.textContent = lang.name;
      option.selected = lang.code === this.currentLang;
      langSelect.appendChild(option);
    });
    
    langSelect.addEventListener('change', (e) => this.setLanguage(e.target.value));
    
    const currencySelect = document.createElement('select');
    currencySelect.id = 'currency-select';
    const currencies = [
      { code: 'KRW', name: 'â‚© KRW (1TL=1ì›)' },
      { code: 'USD', name: '$ USD' },
      { code: 'JPY', name: 'Â¥ JPY' },
      { code: 'EUR', name: 'â‚¬ EUR' },
      { code: 'CNY', name: 'Â¥ CNY' },
      { code: 'GBP', name: 'Â£ GBP' }
    ];
    
    currencies.forEach(curr => {
      const option = document.createElement('option');
      option.value = curr.code;
      option.textContent = curr.name;
      option.selected = curr.code === this.currentCurrency;
      currencySelect.appendChild(option);
    });
    
    currencySelect.addEventListener('change', (e) => this.setCurrency(e.target.value));
    
    selector.appendChild(langSelect);
    selector.appendChild(currencySelect);
    document.body.appendChild(selector);
    
    // ì´ˆê¸° ì—…ë°ì´íŠ¸
    this.updateUI();
    this.updateCurrencyDisplay();
    
    // TL ê°’ì´ ìˆëŠ” ëª¨ë“  ìš”ì†Œì— data-currency ì†ì„± ìë™ ì¶”ê°€
    document.querySelectorAll('.balance-value, [id$="-tl"], [id*="TL"]').forEach(el => {
      if (!el.hasAttribute('data-currency')) {
        const match = el.textContent.match(/\d+/g);
        if (match) {
          const value = match.join('');
          el.setAttribute('data-currency', value);
        }
      }
    });
  }
};

// í˜ì´ì§€ ë¡œë“œì‹œ ì‹¤í–‰
document.addEventListener('DOMContentLoaded', () => i18n.init());
</script>
'@

# ëª¨ë“  HTML íŒŒì¼ ì²˜ë¦¬
$files = Get-ChildItem *.html
$count = 0

foreach ($file in $files) {
    $content = Get-Content $file.FullName -Raw -Encoding UTF8
    
    # ì´ë¯¸ ë‹¤êµ­ì  ìŠ¤í¬ë¦½íŠ¸ê°€ ìˆëŠ”ì§€ í™•ì¸
    if ($content -notmatch 'i18n\.init') {
        # data-i18n ì†ì„± ì¶”ê°€ (íƒ­ ë©”ë‰´)
        $content = $content -replace '(<a href="index\.html" class="tab[^>]*>)(í™ˆ)', '$1<span data-i18n="home">$2</span>'
        $content = $content -replace '(<a href="shareplace\.html" class="tab[^>]*>)(ë§ˆì¼“í”Œë ˆì´ìŠ¤)', '$1<span data-i18n="shareplace">$2</span>'
        $content = $content -replace '(<a href="library\.html" class="tab[^>]*>)(ë¼ì´ë¸ŒëŸ¬ë¦¬)', '$1<span data-i18n="library">$2</span>'
        $content = $content -replace '(<a href="create\.html" class="tab[^>]*>)(ì—…ë¡œë“œ)', '$1<span data-i18n="upload">$2</span>'
        $content = $content -replace '(<a href="player\.html" class="tab[^>]*>)(í”Œë ˆì´ì–´)', '$1<span data-i18n="player">$2</span>'
        $content = $content -replace '(<a href="radio\.html" class="tab[^>]*>)(ì¹´í˜ë°©ì†¡)', '$1<span data-i18n="radio">$2</span>'
        $content = $content -replace '(<a href="car\.html" class="tab[^>]*>)(ì¹´ëª¨ë“œ)', '$1<span data-i18n="car">$2</span>'
        $content = $content -replace '(<a href="ads\.html" class="tab[^>]*>)(ê´‘ê³ )', '$1<span data-i18n="ads">$2</span>'
        $content = $content -replace '(<a href="wallet\.html" class="tab[^>]*>)(ì§€ê°‘)', '$1<span data-i18n="wallet">$2</span>'
        
        # ë¡œê·¸ì¸/íšŒì›ê°€ì… ë²„íŠ¼
        $content = $content -replace '>ë¡œê·¸ì¸<', '><span data-i18n="login">ë¡œê·¸ì¸</span><'
        $content = $content -replace '>ì‹œì‘í•˜ê¸° â†’<', '><span data-i18n="signup">ì‹œì‘í•˜ê¸° â†’</span><'
        
        # ì €ì‘ê¶Œ ë¬¸êµ¬
        $content = $content -replace '(ëª¨ë“  íŒŒì¼ì˜ ì°½ì‘ê¶Œì€ ì°½ì‘ìì—ê²Œ ìˆìŠµë‹ˆë‹¤\.)', '<span data-i18n-copyright>$1</span>'
        
        # TL/TLC í‘œì‹œ
        $content = $content -replace '(id="balance-tl">)(\d+,?\d*)', '$1<span data-currency="$2">$2</span>'
        $content = $content -replace '(id="wallet-tl">)(\d+,?\d*)', '$1<span data-currency="$2">$2</span>'
        $content = $content -replace '(id="file-tl">)(\d+,?\d*)', '$1<span data-currency="$2">$2</span>'
        
        # í†µí™” ì‹¬ë³¼ í‘œì‹œ
        $content = $content -replace '(TL|TLC)(?=<)', '<span data-currency-symbol>â‚©</span>'
        
        # ìŠ¤í¬ë¦½íŠ¸ ì¶”ê°€ (</body> ì•ì—)
        if ($content -match '</body>') {
            $content = $content -replace '</body>', "$globalScript`n</body>"
            $content | Set-Content $file.FullName -Encoding UTF8
            Write-Host "âœ… $($file.Name) - ë‹¤êµ­ì  ê¸°ëŠ¥ ì¶”ê°€ ì™„ë£Œ (1TL=1ì›)" -ForegroundColor Green
            $count++
        }
    } else {
        Write-Host "â­ï¸ $($file.Name) - ì´ë¯¸ ë‹¤êµ­ì  ê¸°ëŠ¥ ìˆìŒ" -ForegroundColor Yellow
    }
}

Write-Host "`nğŸ‰ ëª¨ë“  íŒŒì¼ì— ë‹¤êµ­ì  ê¸°ëŠ¥ ì¶”ê°€ ì™„ë£Œ!" -ForegroundColor Cyan
Write-Host "ğŸŒ ì–¸ì–´ ì„ íƒê¸°ì™€ í†µí™” ë³€í™˜ê¸°ê°€ ëª¨ë“  í˜ì´ì§€ì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤." -ForegroundColor White
Write-Host "ğŸ’° ê¸°ë³¸ í™˜ìœ¨: 1TL = 1ì› (KRW)" -ForegroundColor Yellow
Write-Host "ğŸ“Š ì´ $count ê°œ íŒŒì¼ ì²˜ë¦¬ë¨" -ForegroundColor Green