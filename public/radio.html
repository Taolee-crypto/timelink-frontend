<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Radio ‚Äî TimeLink</title>
<link rel="icon" href="favicon.svg" type="image/svg+xml">
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#060610;--card:rgba(255,255,255,.04);--card-h:rgba(255,255,255,.07);
  --bd:rgba(255,255,255,.08);--bd-a:rgba(0,245,160,.3);
  --ac:#00f5a0;--ac-d:rgba(0,245,160,.13);--ac-g:0 0 28px rgba(0,245,160,.35);
  --pu:#7b61ff;--pu-d:rgba(123,97,255,.13);
  --ca:#f59e0b;--ca-d:rgba(245,158,11,.11);
  --da:#ff4f4f;
  --t1:#e8e8f5;--t2:#8888aa;--t3:#44445a;
  --rf:999px;--rl:20px;--rm:14px;--rs:8px;
  --tr:all .2s cubic-bezier(.4,0,.2,1);
}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html{scroll-behavior:smooth}
body{font-family:'Syne',sans-serif;background:var(--bg);color:var(--t1);min-height:100vh;-webkit-font-smoothing:antialiased;overflow-x:hidden}
body::before{content:'';position:fixed;inset:0;pointer-events:none;z-index:0;
  background:radial-gradient(ellipse 80% 50% at 20% 10%,rgba(0,245,160,.05) 0%,transparent 60%),
             radial-gradient(ellipse 60% 40% at 80% 80%,rgba(123,97,255,.05) 0%,transparent 60%)}
.navbar{position:sticky;top:0;z-index:200;height:64px;padding:0 24px;display:flex;align-items:center;justify-content:space-between;background:rgba(6,6,16,.9);backdrop-filter:blur(20px);border-bottom:1px solid var(--bd)}
.logo{display:flex;align-items:center;gap:10px;text-decoration:none;color:var(--t1)}
.logo-icon{width:32px;height:32px;border-radius:8px;background:var(--ac);display:flex;align-items:center;justify-content:center;font-size:16px}
.logo-text{font-size:18px;font-weight:800;letter-spacing:-.5px}.logo-text span{color:var(--ac)}
.nav-links{display:flex;align-items:center;gap:4px}
.nav-link{padding:7px 14px;border-radius:var(--rf);font-size:13px;font-weight:700;text-decoration:none;color:var(--t2);transition:var(--tr)}
.nav-link:hover{color:var(--t1);background:var(--card)}.nav-link.active{background:var(--ac);color:#060610}
.bal-row{display:flex;align-items:center;gap:10px;padding:6px 14px;border-radius:var(--rf);background:var(--card);border:1px solid var(--bd)}
.bal-col{display:flex;flex-direction:column;align-items:center}
.bal-lbl{font-size:10px;color:var(--t2);font-weight:700;text-transform:uppercase}
.bal-val{font-family:'JetBrains Mono',monospace;font-size:13px;font-weight:700;color:var(--ac)}
.bal-sep{width:1px;height:20px;background:var(--bd)}
.page{padding:28px 24px 100px;max-width:1100px;margin:0 auto;position:relative;z-index:1}
.btn{display:inline-flex;align-items:center;justify-content:center;gap:7px;padding:9px 20px;border-radius:var(--rf);font-family:'Syne',sans-serif;font-size:14px;font-weight:700;cursor:pointer;transition:var(--tr);border:none;white-space:nowrap}
.btn-primary{background:var(--ac);color:#060610}.btn-primary:hover{transform:translateY(-1px);box-shadow:var(--ac-g)}
.btn-ghost{background:transparent;color:var(--t2);border:1px solid var(--bd)}.btn-ghost:hover{background:var(--card-h);color:var(--t1)}
.btn-sm{padding:5px 13px;font-size:12px}.w-full{width:100%}
.card{background:var(--card);border:1px solid var(--bd);border-radius:var(--rl);padding:24px}
/* NOW ON AIR */
.on-air-card{background:linear-gradient(135deg,rgba(0,245,160,.06),rgba(123,97,255,.04));border:1px solid var(--bd-a);border-radius:var(--rl);padding:22px;margin-bottom:24px;position:relative;overflow:hidden}
.on-air-card::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,var(--ac),var(--pu));animation:scan 3s linear infinite}
@keyframes scan{0%{transform:scaleX(0);transform-origin:left}50%{transform:scaleX(1);transform-origin:left}51%{transform:scaleX(1);transform-origin:right}100%{transform:scaleX(0);transform-origin:right}}
/* SEEK */
.seek{width:100%;height:4px;background:var(--bd);border-radius:2px;cursor:pointer;margin:12px 0 6px}
.seek-fill{height:100%;background:linear-gradient(90deg,var(--ac),var(--pu));border-radius:2px;width:0%;transition:width .5s linear}
/* RADIO GRID */
.radio-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:14px}
.radio-card{background:var(--card);border:1px solid var(--bd);border-radius:var(--rl);padding:22px;text-align:center;cursor:pointer;transition:var(--tr);position:relative;overflow:hidden}
.radio-card:hover{border-color:var(--bd-a);transform:translateY(-3px);box-shadow:0 8px 30px rgba(0,0,0,.3)}
.radio-card.playing{border-color:var(--bd-a);background:rgba(0,245,160,.05)}
.radio-card.playing::after{content:'‚ñ∂';position:absolute;top:10px;right:12px;font-size:11px;color:var(--ac)}
.radio-icon{font-size:36px;margin-bottom:10px}
.radio-name{font-weight:800;font-size:15px;margin-bottom:4px}
.radio-desc{font-size:12px;color:var(--t2);line-height:1.4;margin-bottom:8px}
.radio-rate{font-family:'JetBrains Mono',monospace;font-size:13px;font-weight:700;color:var(--ac)}
/* BADGE */
.badge{display:inline-flex;align-items:center;gap:4px;padding:3px 9px;border-radius:var(--rf);font-size:11px;font-weight:700;font-family:'JetBrains Mono',monospace}
.badge-ac{background:var(--ac-d);color:var(--ac);border:1px solid rgba(0,245,160,.2)}
.badge-pu{background:var(--pu-d);color:var(--pu);border:1px solid rgba(123,97,255,.2)}
.badge-ca{background:var(--ca-d);color:var(--ca);border:1px solid rgba(245,158,11,.3)}
.badge-live{background:rgba(255,80,80,.14);color:#ff5050;border:1px solid rgba(255,80,80,.2);display:inline-flex;align-items:center;gap:5px}
.badge-live::before{content:'';width:7px;height:7px;background:#ff5050;border-radius:50%;animation:blink 1.1s infinite}
@keyframes blink{0%,100%{opacity:1}50%{opacity:.2}}
/* CATEGORY CHIPS */
.chips{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:20px}
.chip{padding:5px 14px;border-radius:var(--rf);font-size:12px;font-weight:700;cursor:pointer;transition:var(--tr);border:1px solid var(--bd);background:transparent;color:var(--t2)}
.chip:hover{border-color:var(--bd-a);color:var(--t1)}.chip.active{background:var(--ac);color:#060610;border-color:var(--ac)}
/* CONTROLS */
.ctrl-row{display:flex;align-items:center;gap:12px;margin-top:14px}
.ctrl{background:transparent;border:1px solid var(--bd);color:var(--t1);border-radius:50%;width:40px;height:40px;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:var(--tr);font-size:15px}
.ctrl:hover{background:var(--card-h);border-color:var(--bd-a)}
.ctrl.play{width:52px;height:52px;background:var(--ac);color:#060610;border:none;font-size:20px}
.ctrl.play:hover{transform:scale(1.05);box-shadow:var(--ac-g)}
.vol-row{display:flex;align-items:center;gap:8px;flex:1}
.vol-slider{flex:1;-webkit-appearance:none;height:4px;background:var(--bd);border-radius:2px;cursor:pointer;outline:none}
.vol-slider::-webkit-slider-thumb{-webkit-appearance:none;width:13px;height:13px;background:var(--ac);border-radius:50%}
/* MINI PLAYER BAR */
.player-bar{position:fixed;bottom:0;left:0;right:0;height:70px;background:rgba(6,6,16,.97);backdrop-filter:blur(20px);border-top:1px solid var(--bd);display:flex;align-items:center;padding:0 24px;gap:16px;z-index:500}
.pb-prog{position:absolute;bottom:70px;left:0;right:0;height:3px;background:var(--bd)}
.pb-prog-fill{height:100%;background:var(--ac);width:0%;transition:width .5s linear}
.pb-thumb{width:44px;height:44px;flex-shrink:0;border-radius:8px;background:linear-gradient(135deg,var(--ac-d),var(--pu-d));display:flex;align-items:center;justify-content:center;font-size:20px}
#toast-box{position:fixed;bottom:84px;right:24px;z-index:9999;display:flex;flex-direction:column;gap:8px;pointer-events:none}
.t{padding:11px 16px;border-radius:var(--rm);font-size:13px;font-weight:600;backdrop-filter:blur(20px);border:1px solid var(--bd);animation:ti .25s ease;max-width:300px}
.t.s{background:rgba(0,245,160,.12);color:var(--ac);border-color:rgba(0,245,160,.3)}
.t.e{background:rgba(255,79,79,.12);color:var(--da);border-color:rgba(255,79,79,.3)}
.t.i{background:rgba(123,97,255,.12);color:var(--pu);border-color:rgba(123,97,255,.3)}
@keyframes ti{from{transform:translateX(100%);opacity:0}to{transform:translateX(0);opacity:1}}
.hidden{display:none!important}
@media(max-width:600px){.nav-links{display:none}.radio-grid{grid-template-columns:repeat(2,1fr)}}
/* AVATAR DROPDOWN */
.avatar-wrap{position:relative}
.avatar-btn{width:36px;height:36px;border-radius:50%;background:linear-gradient(135deg,var(--ac),var(--pu));display:flex;align-items:center;justify-content:center;font-size:14px;font-weight:800;color:#060610;cursor:pointer;border:2px solid transparent;transition:var(--tr);user-select:none}
.avatar-btn:hover{border-color:var(--ac);box-shadow:0 0 0 3px rgba(0,245,160,.15)}
.nav-dropdown{position:absolute;top:calc(100% + 10px);right:0;width:200px;background:#12121f;border:1px solid var(--bd);border-radius:var(--rm);padding:8px;z-index:999;box-shadow:0 12px 40px rgba(0,0,0,.6);animation:ddIn .15s ease}
@keyframes ddIn{from{opacity:0;transform:translateY(-6px)}to{opacity:1;transform:translateY(0)}}
.dd-user{padding:10px 12px;border-bottom:1px solid var(--bd);margin-bottom:6px}
.dd-username{font-weight:800;font-size:14px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.dd-email{font-size:11px;color:var(--t2);margin-top:2px}
.dd-item{display:flex;align-items:center;gap:10px;padding:9px 12px;border-radius:var(--rs);cursor:pointer;font-size:13px;font-weight:600;transition:var(--tr);color:var(--t1)}
.dd-item:hover{background:var(--card-h)}
.dd-item.danger{color:var(--da)}
.dd-item.danger:hover{background:rgba(255,79,79,.08)}
</style>
</head>
<body>
<audio id="aud" preload="none" style="display:none"></audio>
<div id="toast-box"></div>

<nav class="navbar">
  <a class="logo" href="index.html"><div class="logo-icon">‚ö°</div><span class="logo-text">Time<span>Link</span></span></a>
  <div class="nav-links">
    <a href="index.html" class="nav-link">üìä Dashboard</a>
    <a href="create.html" class="nav-link">üì§ Create</a>
    <a href="library.html" class="nav-link">üîç Library</a>
    <a href="player.html" class="nav-link">üé¨ Player</a>
    <a href="shareplace.html" class="nav-link">üîÑ Share</a>
    <a href="radio.html" class="nav-link active">üìª Radio</a>
    <a href="car.html" class="nav-link">üöó Car</a>
  </div>
  <!-- ÎπÑÎ°úÍ∑∏Ïù∏ -->
  <div id="nav-guest" class="nav-right">
    <a href="login.html" class="btn btn-ghost btn-sm">Î°úÍ∑∏Ïù∏</a>
    <a href="signup.html" class="btn btn-primary btn-sm">Get Started &#8594;</a>
  </div>
  <!-- Î°úÍ∑∏Ïù∏ ÌõÑ -->
  <div id="nav-auth" class="nav-right hidden">
    <div class="bal-row">
      <div class="bal-col"><span class="bal-lbl">TL</span><span class="bal-val" id="nb-tl">0</span></div>
      <div class="bal-sep"></div>
      <div class="bal-col"><span class="bal-lbl">TLC</span><span class="bal-val" style="color:var(--pu)" id="nb-tlc">0.0000</span></div>
    </div>
    <div class="avatar-wrap">
      <div class="avatar-btn" id="nav-avatar" onclick="toggleNavDD()">D</div>
      <div class="nav-dropdown hidden" id="nav-dd">
        <div class="dd-user">
          <div class="dd-username" id="dd-name">Demo</div>
          <div class="dd-email" id="dd-email">demo@timelink.digital</div>
        </div>
        <div class="dd-item" onclick="window.location.href='index.html'">üí∞ TL Ï∂©Ï†Ñ</div>
        <div class="dd-item">‚öôÔ∏è ÏÑ§Ï†ï</div>
        <div class="dd-item danger" onclick="navLogout()">&#x1F6AA; Î°úÍ∑∏ÏïÑÏõÉ</div>
      </div>
    </div>
  </div>
</nav>

<div class="page">

  <!-- NOW ON AIR -->
  <div id="on-air-sec" class="on-air-card hidden" style="margin-bottom:24px">
    <div style="display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:12px;margin-bottom:12px">
      <div style="display:flex;align-items:center;gap:12px">
        <span class="badge badge-live">ON AIR</span>
        <div>
          <div style="font-weight:800;font-size:16px" id="oa-name">‚Äî</div>
          <div style="font-size:13px;color:var(--t2)" id="oa-desc">‚Äî</div>
        </div>
      </div>
      <div style="display:flex;align-items:center;gap:10px">
        <span class="badge badge-ca">‚ö° <span id="oa-pulse">0</span></span>
        <span class="badge badge-ac">TLC: <span id="oa-tlc">0.0000</span></span>
        <button class="btn btn-ghost btn-sm" onclick="stopRadio()">‚ñ† Ï†ïÏßÄ</button>
      </div>
    </div>
    <div class="seek" onclick="seekBar(event)"><div class="seek-fill" id="oa-fill"></div></div>
    <div style="display:flex;justify-content:space-between;font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--t2);margin-bottom:10px">
      <span id="oa-cur">0:00</span><span id="oa-dur">0:00</span>
    </div>
    <div class="ctrl-row">
      <button class="ctrl play" id="oa-play-btn" onclick="togglePlay()">‚è∏</button>
      <div class="vol-row">
        <span style="font-size:16px">üîà</span>
        <input type="range" id="vol" class="vol-slider" min="0" max="100" value="80" oninput="setVol(this.value)">
        <span style="font-family:'JetBrains Mono',monospace;font-size:12px;color:var(--t2);width:34px" id="vol-lbl">80%</span>
      </div>
    </div>
  </div>

  <!-- Ïπ¥ÌÖåÍ≥†Î¶¨ ÌïÑÌÑ∞ -->
  <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;flex-wrap:wrap;gap:10px">
    <div>
      <div style="font-size:22px;font-weight:800">üìª TimeLink Radio</div>
      <div style="font-size:13px;color:var(--t2);margin-top:2px">Ïû•Î•¥Î≥Ñ ÎùºÎîîÏò§ ¬∑ Ïã§ÏãúÍ∞Ñ Pulse Ï†ÅÎ¶Ω</div>
    </div>
  </div>

  <div class="chips" id="cat-chips">
    <span class="chip active" data-cat="all" onclick="setCategory('all')">Ï†ÑÏ≤¥</span>
    <span class="chip" data-cat="kpop" onclick="setCategory('kpop')">üá∞üá∑ K-POP</span>
    <span class="chip" data-cat="jpop" onclick="setCategory('jpop')">üáØüáµ J-POP</span>
    <span class="chip" data-cat="hiphop" onclick="setCategory('hiphop')">üé§ Hip-Hop</span>
    <span class="chip" data-cat="electronic" onclick="setCategory('electronic')">‚ö° Electronic</span>
    <span class="chip" data-cat="chill" onclick="setCategory('chill')">üåä Chill</span>
    <span class="chip" data-cat="jazz" onclick="setCategory('jazz')">üé∑ Jazz</span>
    <span class="chip" data-cat="classical" onclick="setCategory('classical')">üéª Classical</span>
    <span class="chip" data-cat="lofi" onclick="setCategory('lofi')">üìö Lo-Fi</span>
    <span class="chip" data-cat="rnb" onclick="setCategory('rnb')">üíú R&B</span>
    <span class="chip" data-cat="world" onclick="setCategory('world')">üåç World</span>
  </div>

  <div class="radio-grid" id="radio-grid"></div>

</div>

<!-- ÌîåÎ†àÏù¥Ïñ¥ Î∞î -->
<div id="pb" class="player-bar hidden">
  <div class="pb-prog"><div class="pb-prog-fill" id="pb-fill"></div></div>
  <div class="pb-thumb" id="pb-icon">üìª</div>
  <div style="flex:1;min-width:0">
    <div style="font-weight:700;font-size:14px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis" id="pb-name">‚Äî</div>
    <div style="font-size:12px;color:var(--t2)" id="pb-sub">‚Äî</div>
  </div>
  <div style="display:flex;align-items:center;gap:10px;flex-shrink:0">
    <span class="badge badge-ac">‚ö° <span id="pb-pulse">0</span></span>
    <button id="pb-btn" onclick="togglePlay()" style="background:var(--ac);border:none;color:#060610;border-radius:50%;width:40px;height:40px;font-size:16px;cursor:pointer">‚è∏</button>
    <button onclick="stopRadio()" class="btn btn-ghost btn-sm">‚ñ†</button>
  </div>
</div>

<script>
const CHANNELS=[
  {id:'r1',name:'K-POP Hits',icon:'üé§',desc:'ÏµúÏã† K-POP Ï∞®Ìä∏ Top 100',cat:'kpop',rate:'1.5x',url:'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-4.mp3',color:'#ff0066'},
  {id:'r2',name:'J-POP & City Pop',icon:'üèôÔ∏è',desc:'Í∞êÏÑ± ÏãúÌã∞Ìåù & J-POP',cat:'jpop',rate:'1.3x',url:'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-9.mp3',color:'#ff6b35'},
  {id:'r3',name:'Underground Hip-Hop',icon:'üéß',desc:'Ïù∏Îîî & Ïñ∏ÎçîÍ∑∏ÎùºÏö¥Îìú',cat:'hiphop',rate:'1.4x',url:'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-5.mp3',color:'#7b61ff'},
  {id:'r4',name:'Electronic Festival',icon:'‚ö°',desc:'EDM ¬∑ Techno ¬∑ House',cat:'electronic',rate:'1.3x',url:'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3',color:'#00f5a0'},
  {id:'r5',name:'Chill Lounge',icon:'üåä',desc:'Ìé∏ÏïàÌïú Chill & Ambient',cat:'chill',rate:'1.0x',url:'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-3.mp3',color:'#06b6d4'},
  {id:'r6',name:'Late Night Jazz',icon:'üé∑',desc:'ÌÅ¥ÎûòÏãù Ïû¨Ï¶à & Î™®Îçò Ïû¨Ï¶à',cat:'jazz',rate:'1.1x',url:'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-8.mp3',color:'#f59e0b'},
  {id:'r7',name:'Classical & Cinematic',icon:'üéª',desc:'ÌÅ¥ÎûòÏãù ¬∑ Ïò§ÏºÄÏä§Ìä∏Îùº ¬∑ OST',cat:'classical',rate:'1.2x',url:'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-7.mp3',color:'#e879f9'},
  {id:'r8',name:'Lo-Fi Study',icon:'üìö',desc:'ÏßëÏ§ë ¬∑ Í≥µÎ∂Ä ¬∑ ÏΩîÎî©Ïö©',cat:'lofi',rate:'1.0x',url:'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3',color:'#84cc16'},
  {id:'r9',name:'Neo Soul & R&B',icon:'üíú',desc:'R&B ¬∑ Soul ¬∑ Neo-Soul',cat:'rnb',rate:'1.2x',url:'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-6.mp3',color:'#a855f7'},
  {id:'r10',name:'K-Hip-Hop',icon:'üá∞üá∑',desc:'ÌïúÍµ≠ ÌûôÌï© ¬∑ Ìä∏Îû©',cat:'kpop',rate:'1.4x',url:'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-10.mp3',color:'#ff0066'},
  {id:'r11',name:'Afrobeats & Latin',icon:'üåç',desc:'Afrobeats ¬∑ Reggaeton ¬∑ Cumbia',cat:'world',rate:'1.3x',url:'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-11.mp3',color:'#f97316'},
  {id:'r12',name:'Deep House',icon:'üè†',desc:'Deep House ¬∑ Garage',cat:'electronic',rate:'1.2x',url:'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-12.mp3',color:'#00f5a0'},
];

let curId=null,isPlaying=false,pulse=0,tlc=0,uiTimer=null,selCat='all';
const aud=document.getElementById('aud');

function $(i){return document.getElementById(i)}
function fmt(n){return Math.floor(n||0).toLocaleString()}
function fmtT(s){s=Math.floor(s||0);return`${Math.floor(s/60)}:${String(s%60).padStart(2,'0')}`}
function toast(msg,t='i'){const el=document.createElement('div');el.className=`t ${t}`;el.textContent=msg;$('toast-box').prepend(el);setTimeout(()=>el.remove(),3200)}

function loadWallet(){
  const u=JSON.parse(localStorage.getItem('tl_user')||'{}');
  if($('nb-tl'))$('nb-tl').textContent=fmt(u.tl||10000);
  if($('nb-tlc'))$('nb-tlc').textContent=(u.tlc||0).toFixed(4);
}

function setCategory(cat){
  selCat=cat;
  document.querySelectorAll('.chip').forEach(c=>c.classList.toggle('active',c.dataset.cat===cat));
  renderGrid();
}
function renderGrid(){
  const data=selCat==='all'?CHANNELS:CHANNELS.filter(c=>c.cat===selCat);
  $('radio-grid').innerHTML=data.map(ch=>`
    <div class="radio-card ${curId===ch.id?'playing':''}" data-id="${ch.id}" onclick="playChannel('${ch.id}')">
      <div class="radio-icon">${ch.icon}</div>
      <div class="radio-name">${ch.name}</div>
      <div class="radio-desc">${ch.desc}</div>
      <div class="radio-rate">‚ö° ${ch.rate} Pulse</div>
    </div>`).join('');
}

function playChannel(id){
  const ch=CHANNELS.find(c=>c.id===id);if(!ch)return;
  stopRadio(false);
  curId=id;pulse=0;tlc=0;
  aud.src=ch.url;aud.load();aud.volume=$('vol')?$('vol').value/100:.8;
  aud.play().then(()=>{
    setPlaying(true);startTimer();
    $('on-air-sec').classList.remove('hidden');
    $('oa-name').textContent=ch.icon+' '+ch.name;
    $('oa-desc').textContent=ch.desc+' ¬∑ '+ch.rate;
    $('pb').classList.remove('hidden');
    $('pb-icon').textContent=ch.icon;
    $('pb-name').textContent=ch.name;
    $('pb-sub').textContent=ch.desc;
    renderGrid();
    toast(`üìª ${ch.name} ÏãúÏûë!`,'s');
  }).catch(()=>toast('Ïû¨ÏÉù Ïò§Î•ò ‚Äî Îã§Ïãú ÌÅ¥Î¶≠ÌïòÏÑ∏Ïöî','e'));
}
function togglePlay(){
  if(!curId)return;
  if(isPlaying){aud.pause();setPlaying(false);clearInterval(uiTimer);}
  else{aud.play().then(()=>{setPlaying(true);startTimer();}).catch(()=>toast('Ïû¨ÏÉù Ïò§Î•ò','e'));}
}
function stopRadio(showToast=true){
  clearInterval(uiTimer);aud.pause();aud.currentTime=0;setPlaying(false);curId=null;
  $('on-air-sec').classList.add('hidden');$('pb').classList.add('hidden');
  $('oa-fill').style.width='0%';$('pb-fill').style.width='0%';
  renderGrid();if(showToast)toast('ÎùºÎîîÏò§ Ï†ïÏßÄ','i');
}
function setPlaying(v){
  isPlaying=v;
  [$('oa-play-btn'),$('pb-btn')].forEach(b=>{if(b)b.innerHTML=v?'‚è∏':'‚ñ∂';});
}
function startTimer(){
  uiTimer=setInterval(()=>{
    if(!isPlaying)return;
    pulse++;tlc+=.001;
    $('oa-pulse').textContent=fmt(pulse);$('oa-tlc').textContent=tlc.toFixed(4);$('pb-pulse').textContent=fmt(pulse);
    if(aud.duration){
      const p=(aud.currentTime/aud.duration*100).toFixed(1);
      $('oa-fill').style.width=p+'%';$('pb-fill').style.width=p+'%';
    }
    $('oa-cur').textContent=fmtT(aud.currentTime);$('oa-dur').textContent=fmtT(aud.duration||0);
    // TLC Ï†ÅÎ¶Ω
    const u=JSON.parse(localStorage.getItem('tl_user')||'{}');
    u.tlc=(u.tlc||0)+.001;localStorage.setItem('tl_user',JSON.stringify(u));
  },1000);
}
function seekBar(e){
  const rect=$('oa-fill').parentElement.getBoundingClientRect();
  const pct=Math.max(0,Math.min(1,(e.clientX-rect.left)/rect.width));
  if(aud.duration)aud.currentTime=pct*aud.duration;
}
function setVol(v){aud.volume=v/100;$('vol-lbl').textContent=v+'%';}
aud.addEventListener('ended',()=>{
  const ch=CHANNELS.find(c=>c.id===curId);
  if(ch){aud.src=ch.url;aud.load();aud.play();}
});
loadWallet();renderGrid();

// ===== NAVBAR AUTH =====
function initNavbar(){
  var user=JSON.parse(localStorage.getItem('tl_user')||'null');
  var guest=document.getElementById('nav-guest');
  var auth=document.getElementById('nav-auth');
  if(!guest||!auth)return;
  if(user&&user.username){
    guest.classList.add('hidden');
    auth.classList.remove('hidden');
    var av=document.getElementById('nav-avatar');
    if(av)av.textContent=user.username.charAt(0).toUpperCase();
    var dn=document.getElementById('dd-name');if(dn)dn.textContent=user.username;
    var de=document.getElementById('dd-email');if(de)de.textContent=user.email||'';
    var tl=document.getElementById('nb-tl');if(tl)tl.textContent=Number(user.tl||10000).toLocaleString();
    var tlc=document.getElementById('nb-tlc');if(tlc)tlc.textContent=Number(user.tlc||0).toFixed(4);
  }
}
function toggleNavDD(){var dd=document.getElementById('nav-dd');if(dd)dd.classList.toggle('hidden');}
function navLogout(){localStorage.removeItem('tl_token');localStorage.removeItem('tl_user');window.location.href='login.html';}
document.addEventListener('click',function(e){
  var wrap=document.querySelector('.avatar-wrap');
  if(wrap&&!wrap.contains(e.target)){var dd=document.getElementById('nav-dd');if(dd)dd.classList.add('hidden');}
});
window.addEventListener('DOMContentLoaded',initNavbar);
</script>
</body>
</html>
