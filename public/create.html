<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ì—…ë¡œë“œ â€” TimeLink</title>
<link rel="icon" href="favicon.svg" type="image/svg+xml">
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#060610;--card:rgba(255,255,255,.04);--card-h:rgba(255,255,255,.07);
  --bd:rgba(255,255,255,.08);--bd-a:rgba(0,245,160,.3);
  --ac:#00f5a0;--ac-d:rgba(0,245,160,.13);--ac-g:0 0 28px rgba(0,245,160,.35);
  --pu:#7b61ff;--pu-d:rgba(123,97,255,.13);
  --su:#ff7b00;--su-d:rgba(255,123,0,.11);
  --ca:#f59e0b;--ca-d:rgba(245,158,11,.11);
  --da:#ff4f4f;
  --t1:#e8e8f5;--t2:#8888aa;--t3:#44445a;
  --rf:999px;--rl:20px;--rm:14px;--rs:8px;
  --tr:all .2s cubic-bezier(.4,0,.2,1);
}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html{scroll-behavior:smooth}
body{font-family:'Syne',sans-serif;background:var(--bg);color:var(--t1);min-height:100vh;line-height:1.6;overflow-x:hidden;-webkit-font-smoothing:antialiased}
body::before{content:'';position:fixed;inset:0;pointer-events:none;z-index:0;
  background:radial-gradient(ellipse 80% 50% at 20% 10%,rgba(0,245,160,.05) 0%,transparent 60%),
             radial-gradient(ellipse 60% 40% at 80% 80%,rgba(123,97,255,.05) 0%,transparent 60%)}
.navbar{position:sticky;top:0;z-index:200;height:64px;padding:0 24px;display:flex;align-items:center;justify-content:space-between;background:rgba(6,6,16,.9);backdrop-filter:blur(20px);border-bottom:1px solid var(--bd)}
.logo{display:flex;align-items:center;gap:10px;text-decoration:none;color:var(--t1)}
.logo-icon{width:32px;height:32px;border-radius:8px;background:var(--ac);display:flex;align-items:center;justify-content:center;font-size:16px}
.logo-text{font-size:18px;font-weight:800;letter-spacing:-.5px}.logo-text span{color:var(--ac)}
.nav-right{display:flex;align-items:center;gap:8px}
.bal-row{display:flex;align-items:center;gap:10px;padding:6px 14px;border-radius:var(--rf);background:var(--card);border:1px solid var(--bd)}
.bal-col{display:flex;flex-direction:column;align-items:center}
.bal-lbl{font-size:10px;color:var(--t2);font-weight:700;text-transform:uppercase}
.bal-val{font-family:'JetBrains Mono',monospace;font-size:13px;font-weight:700;color:var(--ac)}
.bal-sep{width:1px;height:20px;background:var(--bd)}
.car-ind{display:inline-flex;align-items:center;gap:5px;padding:4px 12px;border-radius:var(--rf);font-size:12px;font-weight:700;transition:var(--tr)}
.car-ind.off{background:rgba(255,255,255,.04);color:var(--t2);border:1px solid var(--bd)}
.car-ind.on{background:var(--ca-d);color:var(--ca);border:1px solid rgba(245,158,11,.3)}
/* AVATAR DROPDOWN */
.avatar-wrap{position:relative}
.avatar-btn{width:36px;height:36px;border-radius:50%;background:linear-gradient(135deg,var(--ac),var(--pu));display:flex;align-items:center;justify-content:center;font-size:14px;font-weight:800;color:#060610;cursor:pointer;border:2px solid transparent;transition:var(--tr);user-select:none}
.avatar-btn:hover{border-color:var(--ac);box-shadow:0 0 0 3px rgba(0,245,160,.15)}
.nav-dropdown{position:absolute;top:calc(100% + 10px);right:0;width:200px;background:#12121f;border:1px solid var(--bd);border-radius:var(--rm);padding:8px;z-index:999;box-shadow:0 12px 40px rgba(0,0,0,.6);animation:ddIn .15s ease}
@keyframes ddIn{from{opacity:0;transform:translateY(-6px)}to{opacity:1;transform:translateY(0)}}
.dd-user{padding:10px 12px;border-bottom:1px solid var(--bd);margin-bottom:6px}
.dd-username{font-weight:800;font-size:14px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.dd-email{font-size:11px;color:var(--t2);margin-top:2px}
.dd-item{display:flex;align-items:center;gap:10px;padding:9px 12px;border-radius:var(--rs);cursor:pointer;font-size:13px;font-weight:600;transition:var(--tr);color:var(--t1)}
.dd-item:hover{background:var(--card-h)}
.dd-item.danger{color:var(--da)}
.dd-item.danger:hover{background:rgba(255,79,79,.08)}
/* TABS */
.tabs-bar{position:sticky;top:64px;z-index:190;padding:7px 24px;background:rgba(6,6,16,.92);backdrop-filter:blur(20px);border-bottom:1px solid var(--bd);display:flex;justify-content:center;align-items:center}.tabs-inner{display:flex;gap:4px;overflow-x:auto;scrollbar-width:none}.tabs-inner::-webkit-scrollbar{display:none}
.tab-btn{flex-shrink:0;padding:8px 18px;border-radius:var(--rf);border:none;background:transparent;color:var(--t2);font-family:'Syne',sans-serif;font-size:13px;font-weight:700;cursor:pointer;transition:var(--tr);white-space:nowrap}
.tab-btn:hover{color:var(--t1);background:var(--card)}.tab-btn.active{background:var(--ac);color:#060610}
.tab-pane{display:none;animation:fadeUp .2s ease}.tab-pane.active{display:block}
@keyframes fadeUp{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}
.page{padding:24px 24px 120px;max-width:1100px;margin:0 auto;position:relative;z-index:1}
/* BUTTONS */
.btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;padding:10px 22px;border-radius:var(--rf);font-family:'Syne',sans-serif;font-size:14px;font-weight:700;cursor:pointer;transition:var(--tr);border:none;text-decoration:none;white-space:nowrap}
.btn-primary{background:var(--ac);color:#060610}.btn-primary:hover{transform:translateY(-1px);box-shadow:var(--ac-g)}
.btn-ghost{background:transparent;color:var(--t2);border:1px solid var(--bd)}.btn-ghost:hover{background:var(--card);color:var(--t1)}
.btn-outline{background:transparent;color:var(--ac);border:1px solid var(--bd-a)}.btn-outline:hover{background:var(--ac-d)}
.btn-sp{background:var(--sp);color:#fff}.btn-sp:hover{transform:translateY(-1px);box-shadow:0 0 24px rgba(29,185,84,.4)}
.btn-ai{background:var(--su);color:#fff}.btn-ai:hover{transform:translateY(-1px);box-shadow:0 0 24px rgba(255,123,0,.4)}
.btn-ai:disabled,.btn:disabled{opacity:.4;cursor:not-allowed;transform:none!important;box-shadow:none}
.btn-sm{padding:6px 14px;font-size:12px}.btn-lg{padding:13px 30px;font-size:15px}
.btn-icon{width:40px;height:40px;padding:0;border-radius:50%}
.w-full{width:100%}
/* CARD */
.card{background:var(--card);border:1px solid var(--bd);border-radius:var(--rl);padding:24px;transition:var(--tr)}
.card-ai{border-color:rgba(255,123,0,.28);background:linear-gradient(145deg,rgba(255,123,0,.06),transparent);position:relative;overflow:hidden}
.card-ai::after{content:'AI';position:absolute;bottom:-8px;right:16px;font-size:80px;font-weight:800;color:rgba(255,123,0,.05);pointer-events:none;letter-spacing:-2px}
.sec-title{font-size:18px;font-weight:800;margin-bottom:4px}
.sec-sub{font-size:13px;color:var(--t2);margin-bottom:20px}
/* FORM */
.fg{display:flex;flex-direction:column;gap:7px;margin-bottom:14px}
.fl{font-size:11px;color:var(--t2);font-weight:700;text-transform:uppercase;letter-spacing:.5px}
.fi{background:rgba(255,255,255,.04);border:1px solid var(--bd);border-radius:var(--rm);padding:12px 16px;font-family:'Syne',sans-serif;font-size:14px;color:var(--t1);outline:none;transition:var(--tr);width:100%}
.fi:focus{border-color:var(--ac);background:rgba(0,245,160,.04);box-shadow:0 0 0 3px rgba(0,245,160,.1)}
.fi::placeholder{color:var(--t3)}
.fi.ai{border-color:rgba(255,123,0,.3);background:rgba(255,123,0,.07)}
.fi.ai:focus{border-color:var(--su);background:rgba(255,123,0,.1);box-shadow:0 0 0 3px rgba(255,123,0,.12)}
.two-col{display:grid;grid-template-columns:1fr 1fr;gap:14px}
.three-col{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px}
.divider{height:1px;background:var(--bd);margin:20px 0}
.badge{display:inline-flex;align-items:center;gap:4px;padding:3px 10px;border-radius:var(--rf);font-size:11px;font-weight:700}
.badge-ai{background:rgba(255,123,0,.15);color:var(--su);border:1px solid rgba(255,123,0,.3)}
.badge-ac{background:var(--ac-d);color:var(--ac);border:1px solid rgba(0,245,160,.2)}
.badge-ca{background:var(--ca-d);color:var(--ca);border:1px solid rgba(245,158,11,.3)}
/* AI PLATFORM GRID */
.ai-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(130px,1fr));gap:10px;margin-bottom:22px}
.ai-card{padding:16px 12px;border-radius:var(--rm);border:2px solid var(--bd);background:var(--card);cursor:pointer;text-align:center;transition:var(--tr)}
.ai-card:hover{border-color:rgba(255,123,0,.4);background:rgba(255,123,0,.04)}
.ai-card.sel{border-color:var(--su);background:var(--su-d)}
.ai-logo{font-size:28px;margin-bottom:6px}
.ai-name{font-weight:800;font-size:13px}
.ai-type{font-size:11px;color:var(--t2);margin-top:2px}
/* PROOF ZONES */
.proof-grid{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px;margin-bottom:16px}
.proof-zone{border:2px dashed var(--bd);border-radius:var(--rm);padding:18px;text-align:center;cursor:pointer;transition:var(--tr);position:relative}
.proof-zone:hover{border-color:rgba(255,123,0,.5);background:rgba(255,123,0,.04)}
.proof-zone.filled{border-color:var(--ac);border-style:solid;background:var(--ac-d)}
.pz-icon{font-size:26px;margin-bottom:6px}
.pz-name{font-size:12px;font-weight:700}
.pz-sub{font-size:11px;color:var(--t2);margin-top:2px}
.pz-check{font-size:11px;color:var(--ac);margin-top:6px;font-weight:700;min-height:16px}
/* PREVIEW BOX */
.ai-preview{display:flex;gap:18px;align-items:flex-start;background:rgba(0,0,0,.3);border-radius:var(--rm);padding:18px;margin-bottom:14px}
.ai-art{width:80px;height:80px;flex-shrink:0;border-radius:var(--rm);background:linear-gradient(135deg,var(--su-d),var(--pu-d));display:flex;align-items:center;justify-content:center;font-size:32px}
.ai-meta{flex:1}
.ai-meta-title{font-size:18px;font-weight:800}
.ai-meta-sub{font-size:13px;color:var(--t2);margin-top:3px}
.ai-meta-row{display:flex;gap:18px;flex-wrap:wrap;margin-top:12px}
.smi{display:flex;flex-direction:column;gap:2px}
.smi-lbl{font-size:10px;color:var(--t2);font-weight:700;text-transform:uppercase}
.smi-val{font-family:'JetBrains Mono',monospace;font-size:13px;font-weight:700}
.smi-val.green{color:var(--ac)}
/* TYPE SELECTOR */
.type-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:20px}
.type-card{padding:16px;border-radius:var(--rm);text-align:center;cursor:pointer;border:2px solid var(--bd);background:var(--card);transition:var(--tr)}
.type-card.sel-ac{border-color:var(--bd-a);background:var(--ac-d)}
.type-card.sel-pu{border-color:rgba(123,97,255,.4);background:var(--pu-d)}
/* DROP ZONE */
.drop-zone{border:2px dashed var(--bd);border-radius:var(--rl);padding:44px 24px;text-align:center;cursor:pointer;transition:var(--tr)}
.drop-zone:hover,.drop-zone.over{border-color:var(--ac);background:var(--ac-d)}
.file-preview{display:flex;align-items:center;gap:12px;background:var(--ac-d);border:1px solid var(--bd-a);border-radius:var(--rm);padding:12px 16px;margin-bottom:14px}
.fp-name{font-weight:700;font-size:14px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;flex:1}
/* MODEL CARDS */
.model-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.model-card{padding:14px;border-radius:var(--rm);background:var(--card);border:2px solid var(--bd);cursor:pointer;text-align:center;transition:var(--tr)}
.model-card.sel{border-color:var(--bd-a);background:var(--ac-d)}
/* TL CHARGE */
.tl-charge-box{background:rgba(245,158,11,.07);border:1px solid rgba(245,158,11,.22);border-radius:var(--rm);padding:16px}
/* TOAST */
#toast-box{position:fixed;bottom:86px;right:24px;z-index:9999;display:flex;flex-direction:column;gap:8px;pointer-events:none}
.t{padding:11px 16px;border-radius:var(--rm);font-size:13px;font-weight:600;backdrop-filter:blur(20px);border:1px solid var(--bd);animation:ti .25s ease;max-width:300px}
.t.s{background:rgba(0,245,160,.12);color:var(--ac);border-color:rgba(0,245,160,.3)}
.t.e{background:rgba(255,79,79,.12);color:var(--da);border-color:rgba(255,79,79,.3)}
.t.i{background:rgba(123,97,255,.12);color:var(--pu);border-color:rgba(123,97,255,.3)}
@keyframes ti{from{transform:translateX(100%);opacity:0}to{transform:translateX(0);opacity:1}}
.spinner{width:18px;height:18px;border:2px solid rgba(255,255,255,.15);border-top-color:currentColor;border-radius:50%;animation:sp .7s linear infinite;display:inline-block}
@keyframes sp{to{transform:rotate(360deg)}}
.hidden{display:none!important}
.ac{color:var(--ac)}.mu{color:var(--t2)}
.mt-2{margin-top:8px}.mt-4{margin-top:16px}.mb-4{margin-bottom:16px}
@media(max-width:768px){.page{padding:16px 16px 110px}.two-col{grid-template-columns:1fr}.ai-grid{grid-template-columns:repeat(4,1fr)}.bal-row{display:none}}
</style>
</head>
<body>
<div id="toast-box"></div>
<audio id="aud" preload="none" style="display:none"></audio>

<!-- NAVBAR -->
<nav class="navbar">
  <a class="logo" href="index.html">
    <div class="logo-icon">âš¡</div>
    <span class="logo-text">Time<span>Link</span></span>
  </a>
  <!-- ë¹„ë¡œê·¸ì¸ -->
  <div id="nav-guest" class="nav-right">
    <a href="login.html" class="btn btn-ghost btn-sm">ë¡œê·¸ì¸</a>
    <a href="signup.html" class="btn btn-primary btn-sm">Get Started â†’</a>
  </div>
  <!-- ë¡œê·¸ì¸ í›„ -->
  <div id="nav-auth" class="nav-right hidden">
    <div class="bal-row">
      <div class="bal-col"><span class="bal-lbl">TL</span><span class="bal-val" id="nb-tl">0</span></div>
      <div class="bal-sep"></div>
      <div class="bal-col"><span class="bal-lbl">ğŸ”’</span><span class="bal-val locked" id="nb-lo">0</span></div>
      <div class="bal-sep"></div>
      <div class="bal-col"><span class="bal-lbl">TLC</span><span class="bal-val tlc" id="nb-tlc">0.0000</span></div>
    </div>
    <span id="car-ind" class="car-ind off">ğŸš— Off</span>
    <div class="avatar-wrap">
      <div class="avatar-btn" id="nav-avatar" onclick="toggleNavDD()">D</div>
      <div class="nav-dropdown hidden" id="nav-dd">
        <div class="dd-user">
          <div class="dd-username" id="dd-name">Demo</div>
          <div class="dd-email" id="dd-email">demo@timelink.digital</div>
        </div>
        <div class="dd-item" onclick="openModal('recharge-modal')">ğŸ’° TL ì¶©ì „</div>
        <div class="dd-item" onclick="toast('ì„¤ì • ì¤€ë¹„ ì¤‘','i')">âš™ï¸ ì„¤ì •</div>
        <div class="dd-item danger" onclick="doLogout()">ğŸšª ë¡œê·¸ì•„ì›ƒ</div>
      </div>
    </div>
  </div>
</nav>

<!-- TABS (indexì™€ ë™ì¼) -->
<div class="tabs-bar">
<div class="tabs-inner">
  <button class="tab-btn" data-tab="shareplace" onclick="switchTab('shareplace')">ğŸ›ï¸ SharePlace</button>
  <button class="tab-btn" data-tab="dashboard" onclick="switchTab('dashboard')">ğŸ“Š Dashboard</button>
  <button class="tab-btn" data-tab="library"   onclick="switchTab('library')">ğŸ” Library</button>
  <button class="tab-btn active" data-tab="create"    onclick="switchTab('create')">ğŸ“¤ Create</button>
  <button class="tab-btn" data-tab="player"    onclick="switchTab('player')">ğŸ¬ Player</button>
  <button class="tab-btn" data-tab="radio"     onclick="switchTab('radio')">â˜• ì¹´í˜ë°©ì†¡</button>
  <button class="tab-btn" data-tab="car"       onclick="switchTab('car')">ğŸš— Car</button>
  <button class="tab-btn" data-tab="ads"       onclick="switchTab('ads')">ğŸ“£ ê´‘ê³ </button>
  <button class="tab-btn" data-tab="wallet"    onclick="switchTab('wallet')">ğŸ‘› ì§€ê°‘</button>
</div><!-- tabs-inner -->
</div>

<div class="page">

<!-- ========== AI ìŒì› ë“±ë¡ ========== -->
<div class="card card-ai mb-4" style="margin-bottom:24px">
  <div style="display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:4px;flex-wrap:wrap;gap:10px">
    <div>
      <div class="sec-title">ğŸ¤– AI ìŒì› ë“±ë¡</div>
      <div class="sec-sub">ìœ ë£Œ êµ¬ë… AI í”Œë«í¼ì˜ ìƒì„± ìŒì›ì„ TL íŒŒì¼ë¡œ ë³€í™˜í•˜ì„¸ìš”</div>
    </div>
    <span class="badge badge-ai">ìœ ë£Œ íšŒì› ì „ìš©</span>
  </div>

  <!-- í”Œë«í¼ ê·¸ë¦¬ë“œ -->
  <div style="font-size:11px;color:var(--t2);font-weight:700;text-transform:uppercase;letter-spacing:.5px;margin-bottom:10px">í”Œë«í¼ ì„ íƒ</div>
  <div class="ai-grid">
    <div class="ai-card sel" data-id="suno" onclick="selAI('suno')"><div class="ai-logo">ğŸµ</div><div class="ai-name">Suno</div><div class="ai-type">ìŒì•…</div></div>
    <div class="ai-card" data-id="udio" onclick="selAI('udio')"><div class="ai-logo">ğŸ¶</div><div class="ai-name">Udio</div><div class="ai-type">ìŒì•…</div></div>
    <div class="ai-card" data-id="mubert" onclick="selAI('mubert')"><div class="ai-logo">ğŸŒŠ</div><div class="ai-name">Mubert</div><div class="ai-type">ìŒì•…</div></div>
    <div class="ai-card" data-id="aiva" onclick="selAI('aiva')"><div class="ai-logo">ğŸ»</div><div class="ai-name">AIVA</div><div class="ai-type">í´ë˜ì‹</div></div>
    <div class="ai-card" data-id="soundraw" onclick="selAI('soundraw')"><div class="ai-logo">ğŸ¸</div><div class="ai-name">Soundraw</div><div class="ai-type">ìŒì•…</div></div>
    <div class="ai-card" data-id="boomy" onclick="selAI('boomy')"><div class="ai-logo">ğŸ¥</div><div class="ai-name">Boomy</div><div class="ai-type">ìŒì•…</div></div>
    <div class="ai-card" data-id="elevenlabs" onclick="selAI('elevenlabs')"><div class="ai-logo">ğŸ—£ï¸</div><div class="ai-name">ElevenLabs</div><div class="ai-type">ë³´ì´ìŠ¤</div></div>
    <div class="ai-card" data-id="beatoven" onclick="selAI('beatoven')"><div class="ai-logo">ğŸ¹</div><div class="ai-name">Beatoven</div><div class="ai-type">ìŒì•…</div></div>
    <div class="ai-card" data-id="loudly" onclick="selAI('loudly')"><div class="ai-logo">ğŸ“¢</div><div class="ai-name">Loudly</div><div class="ai-type">ìŒì•…</div></div>
    <div class="ai-card" data-id="amper" onclick="selAI('amper')"><div class="ai-logo">ğŸ”Š</div><div class="ai-name">Amper</div><div class="ai-type">ìŒì•…</div></div>
    <div class="ai-card" data-id="stable" onclick="selAI('stable')"><div class="ai-logo">ğŸ™ï¸</div><div class="ai-name">Stable Audio</div><div class="ai-type">ìŒì•…</div></div>
    <div class="ai-card" data-id="etc" onclick="selAI('etc')"><div class="ai-logo">â•</div><div class="ai-name">ê¸°íƒ€ AI</div><div class="ai-type">ì§ì ‘ ì…ë ¥</div></div>
  </div>

  <!-- êµ¬ë… ì¸ì¦ -->
  <div style="background:rgba(255,123,0,.06);border:1px solid rgba(255,123,0,.18);border-radius:var(--rm);padding:18px;margin-bottom:16px">
    <div style="font-weight:800;font-size:14px;margin-bottom:14px">ğŸ“‹ ìœ ë£Œ êµ¬ë… ì¸ì¦ â€” <span id="ai-plat-name" style="color:var(--su)">Suno</span></div>

    <div class="fg">
      <label class="fl">ìƒì„±ëœ ìŒì› URL *</label>
      <input type="text" id="ai-url" class="fi ai" placeholder="https://suno.com/song/...">
    </div>

    <!-- ìŒì› ìƒì„± í™”ë©´ ìº¡ì²˜ -->
    <div class="fg">
      <label class="fl">ìŒì› ìƒì„± í™”ë©´ ìº¡ì²˜ <span style="font-weight:400;color:var(--t3)">(ì„ íƒ)</span>
        <span style="font-weight:400;color:var(--pu);margin-left:8px">ğŸ’¡ Ctrl+V ë¶™ì—¬ë„£ê¸° ê°€ëŠ¥</span>
      </label>
      <div id="pz-song" class="proof-zone" style="padding:12px"
        ondragover="event.preventDefault();this.classList.add('over')"
        ondragleave="this.classList.remove('over')"
        ondrop="handleProofDrop(event,'song')"
        onclick="document.getElementById('pf-song').click()">
        <input type="file" id="pf-song" accept="image/*" style="display:none" onchange="handleProofFile(this,'song')">
        <div id="pz-song-preview" style="display:none;position:relative;margin-bottom:6px">
          <img id="pz-song-thumb" style="max-width:100%;max-height:100px;border-radius:6px;object-fit:cover">
          <button onclick="event.stopPropagation();clearProof('song')" style="position:absolute;top:-6px;right:-6px;width:18px;height:18px;border-radius:50%;background:#ff4f4f;color:#fff;border:none;font-size:11px;cursor:pointer;display:flex;align-items:center;justify-content:center;line-height:1">âœ•</button>
        </div>
        <div id="pz-song-placeholder" style="display:flex;align-items:center;justify-content:center;gap:10px">
          <span style="font-size:20px">ğŸ–¼ï¸</span>
          <span style="font-size:12px;color:var(--t2)">ìŒì› ìƒì„± ì‹œê°„ì´ ë³´ì´ëŠ” ìŠ¤í¬ë¦°ìƒ· Â· í´ë¦­ Â· ë“œë˜ê·¸ Â· <b style="color:var(--pu)">Ctrl+V</b></span>
        </div>
        <div class="pz-check" id="pz-song-name"></div>
      </div>
    </div>

    <div class="two-col" style="margin-bottom:14px">
      <div class="fg" style="margin-bottom:0">
        <label class="fl">êµ¬ë… í”Œëœ</label>
        <select id="ai-plan" class="fi ai">
          <option value="">ì„ íƒí•˜ì„¸ìš”</option>
          <option>Pro</option><option>Premier</option><option>Professional</option>
          <option>Creator</option><option>Business</option><option>Enterprise</option><option>Annual</option>
        </select>
      </div>
      <div class="fg" style="margin-bottom:0">
        <label class="fl">êµ¬ë… ì›”</label>
        <input type="month" id="ai-month" class="fi ai">
      </div>
    </div>

    <!-- ê¸°íƒ€ AI ì§ì ‘ ì…ë ¥ -->
    <div id="etc-fields" class="hidden mb-4">
      <div class="two-col">
        <div class="fg" style="margin-bottom:0"><label class="fl">í”Œë«í¼ ì´ë¦„</label><input type="text" id="ai-etc-name" class="fi ai" placeholder="í”Œë«í¼ ì´ë¦„"></div>
        <div class="fg" style="margin-bottom:0"><label class="fl">í”Œë«í¼ URL</label><input type="text" id="ai-etc-url" class="fi ai" placeholder="https://..."></div>
      </div>
    </div>
  </div>

  <!-- ì¸ì¦ ìë£Œ -->
  <div style="font-size:11px;color:var(--t2);font-weight:700;text-transform:uppercase;letter-spacing:.5px;margin-bottom:6px">
    ì¸ì¦ ìë£Œ <span style="font-weight:400;color:var(--t3)">(1ê°œ ì´ìƒ í•„ìˆ˜)</span>
    <span style="font-weight:400;color:var(--pu);margin-left:8px">ğŸ’¡ ìŠ¤í¬ë¦°ìƒ· í›„ Ctrl+V ë¡œ ë°”ë¡œ ë¶™ì—¬ë„£ê¸° ê°€ëŠ¥</span>
  </div>
  <div class="proof-grid">
    <!-- ì˜ìˆ˜ì¦ / ìŠ¤í¬ë¦°ìƒ· 1 -->
    <div class="proof-zone" id="pz-img"
      ondragover="event.preventDefault();this.classList.add('over')"
      ondragleave="this.classList.remove('over')"
      ondrop="handleProofDrop(event,'img')"
      onclick="document.getElementById('pf-img').click()">
      <input type="file" id="pf-img" accept="image/*,.pdf" style="display:none" onchange="handleProofFile(this,'img')">
      <div id="pz-img-preview" style="display:none;position:relative;margin-bottom:6px">
        <img id="pz-img-thumb" style="max-width:100%;max-height:80px;border-radius:6px;object-fit:cover">
        <button onclick="event.stopPropagation();clearProof('img')" style="position:absolute;top:-6px;right:-6px;width:18px;height:18px;border-radius:50%;background:#ff4f4f;color:#fff;border:none;font-size:11px;cursor:pointer;display:flex;align-items:center;justify-content:center;line-height:1">âœ•</button>
      </div>
      <div id="pz-img-placeholder">
        <div class="pz-icon">ğŸ§¾</div>
        <div class="pz-name">ê²°ì œ ì˜ìˆ˜ì¦</div>
        <div class="pz-sub">í´ë¦­ Â· ë“œë˜ê·¸ Â· <b style="color:var(--pu)">Ctrl+V</b></div>
      </div>
      <div class="pz-check" id="pz-img-name"></div>
    </div>
    <!-- êµ¬ê¸€ ì´ë©”ì¼ -->
    <div class="proof-zone" style="cursor:default">
      <div class="pz-icon">ğŸ“§</div>
      <div class="pz-name" style="margin-bottom:8px">êµ¬ê¸€ ê²°ì œ ì´ë©”ì¼</div>
      <input type="email" id="pf-email" class="fi ai" style="font-size:12px;padding:8px 12px;text-align:center" placeholder="ê²°ì œ ì´ë©”ì¼" oninput="checkEmailFilled()">
      <div class="pz-sub" style="margin-top:4px">Google Pay Â· Gmail</div>
    </div>
    <!-- ê¸°íƒ€ ì¦ë¹™ ìŠ¤í¬ë¦°ìƒ· -->
    <div class="proof-zone" id="pz-doc"
      ondragover="event.preventDefault();this.classList.add('over')"
      ondragleave="this.classList.remove('over')"
      ondrop="handleProofDrop(event,'doc')"
      onclick="document.getElementById('pf-doc').click()">
      <input type="file" id="pf-doc" accept="image/*,.pdf,.txt,.doc,.docx" style="display:none" onchange="handleProofFile(this,'doc')">
      <div id="pz-doc-preview" style="display:none;position:relative;margin-bottom:6px">
        <img id="pz-doc-thumb" style="max-width:100%;max-height:80px;border-radius:6px;object-fit:cover">
        <button onclick="event.stopPropagation();clearProof('doc')" style="position:absolute;top:-6px;right:-6px;width:18px;height:18px;border-radius:50%;background:#ff4f4f;color:#fff;border:none;font-size:11px;cursor:pointer;display:flex;align-items:center;justify-content:center;line-height:1">âœ•</button>
      </div>
      <div id="pz-doc-placeholder">
        <div class="pz-icon">ğŸ“¸</div>
        <div class="pz-name">ê¸°íƒ€ ì¦ë¹™</div>
        <div class="pz-sub">í´ë¦­ Â· ë“œë˜ê·¸ Â· <b style="color:var(--pu)">Ctrl+V</b></div>
      </div>
      <div class="pz-check" id="pz-doc-name"></div>
    </div>
  </div>

  <!-- ë¯¸ë¦¬ë³´ê¸° -->
  <div id="ai-preview" class="hidden">
    <div class="ai-preview">
      <div class="ai-art" id="ai-art-icon">ğŸµ</div>
      <div class="ai-meta">
        <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:8px">
          <span class="badge badge-ai">âœ“ êµ¬ë… ì¸ì¦</span>
          <span class="badge badge-ac">ìƒì—… ì´ìš© ê°€ëŠ¥</span>
        </div>
        <div class="ai-meta-title" id="ai-prev-title">â€”</div>
        <div class="ai-meta-sub" id="ai-prev-sub">â€”</div>
        <div class="ai-meta-row">
          <div class="smi"><span class="smi-lbl">ê¸¸ì´</span><span class="smi-val" id="ai-prev-dur">â€”</span></div>
          <div class="smi"><span class="smi-lbl">í”Œë«í¼</span><span class="smi-val" id="ai-prev-plat" style="color:var(--su)">â€”</span></div>
          <div class="smi"><span class="smi-lbl">ì „í™˜ ë³´ìƒ</span><span class="smi-val green">+1,000 TL</span></div>
        </div>
      </div>
    </div>
    <div style="display:flex;gap:10px;justify-content:flex-end">
      <button class="btn btn-ghost btn-sm" onclick="cancelPreview()">ì·¨ì†Œ</button>
      <button class="btn btn-ai btn-sm" onclick="convertAI()">âœ¨ TL íŒŒì¼ë¡œ ë³€í™˜í•˜ê¸°</button>
    </div>
  </div>
  <div id="ai-err" class="hidden" style="background:rgba(255,79,79,.08);border:1px solid rgba(255,79,79,.25);border-radius:var(--rm);padding:12px;font-size:13px;color:var(--da);margin-bottom:12px"></div>
  <div id="ai-loading" class="hidden" style="text-align:center;padding:16px">
    <div class="spinner" style="margin:0 auto;color:var(--su)"></div>
    <div style="font-size:13px;color:var(--t2);margin-top:8px">í”Œë«í¼ êµ¬ë… ì¸ì¦ í™•ì¸ ì¤‘...</div>
  </div>
  <button class="btn btn-ai w-full" id="ai-btn" onclick="verifyAI()">ğŸ” êµ¬ë… ì¸ì¦ ë° ìŒì› ê°€ì ¸ì˜¤ê¸°</button>
</div>

<!-- ========== ì§ì ‘ ì—…ë¡œë“œ ========== -->
<div class="card">
  <div class="sec-title">ğŸ“¤ ì§ì ‘ ì—…ë¡œë“œ</div>
  <div class="sec-sub">ë‚´ íŒŒì¼ì„ ì§ì ‘ ì—…ë¡œë“œí•˜ê³  TLì„ ì¶©ì „í•˜ì„¸ìš”</div>

  <!-- íŒŒì¼ íƒ€ì… -->
  <div class="type-grid">
    <div id="t-audio" class="type-card sel-ac" onclick="selType('audio')">
      <div style="font-size:28px">ğŸµ</div><div style="font-weight:700;margin-top:6px">TL3 Audio</div>
      <div style="font-size:12px;color:var(--t2);margin-top:2px">MP3 Â· WAV Â· FLAC Â· OGG</div>
    </div>
    <div id="t-video" class="type-card" onclick="selType('video')">
      <div style="font-size:28px">ğŸ¬</div><div style="font-weight:700;margin-top:6px">TL4 Video</div>
      <div style="font-size:12px;color:var(--t2);margin-top:2px">MP4 Â· MOV Â· WebM</div>
    </div>
  </div>

  <!-- ë“œë¡­ì¡´ -->
  <div id="drop-zone" class="drop-zone"
    onclick="document.getElementById('file-in').click()"
    ondragover="event.preventDefault();this.classList.add('over')"
    ondragleave="this.classList.remove('over')"
    ondrop="onDrop(event)">
    <div style="font-size:40px;margin-bottom:10px">ğŸ“‚</div>
    <div style="font-weight:700;font-size:16px;margin-bottom:4px">ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•˜ì—¬ íŒŒì¼ ì„ íƒ</div>
    <div style="font-size:13px;color:var(--t2)">ì˜¤ë””ì˜¤ Â· ì˜ìƒ Â· ìµœëŒ€ 500MB</div>
    <input type="file" id="file-in" accept="audio/*,video/*" style="display:none" onchange="onFileSelect(this.files[0])">
  </div>
  <div id="file-prev" class="file-preview hidden">
    <span style="font-size:22px" id="fp-icon">ğŸµ</span>
    <div style="flex:1;min-width:0">
      <div class="fp-name" id="fp-name">â€”</div>
      <div style="font-size:12px;color:var(--t2)" id="fp-size">â€”</div>
    </div>
    <button class="btn btn-ghost btn-sm" onclick="clearFile()">âœ•</button>
  </div>

  <!-- ë©”íƒ€ë°ì´í„° -->
  <div style="display:flex;flex-direction:column;gap:14px;margin-top:16px">
    <div class="fg"><label class="fl">ì œëª© *</label><input type="text" id="up-title" class="fi" placeholder="íŠ¸ë™ / ì˜ìƒ ì œëª©"></div>
    <div class="two-col">
      <div class="fg" style="margin-bottom:0">
        <label class="fl">ì¹´í…Œê³ ë¦¬</label>
        <select id="up-cat" class="fi">
          <optgroup label="ğŸµ ìŒì•…">
            <option value="K-POP">K-POP</option><option value="Hip-Hop">Hip-Hop</option>
            <option value="R&B">R&B</option><option value="Electronic">Electronic</option>
            <option value="Rock">Rock</option><option value="Jazz">Jazz</option>
            <option value="Classical">Classical</option><option value="Indie">Indie</option>
            <option value="Chill">Chill</option><option value="ê¸°íƒ€ ìŒì•…">ê¸°íƒ€ ìŒì•…</option>
          </optgroup>
          <optgroup label="ğŸ¬ ì˜ìƒ">
            <option value="ë®¤ì§ë¹„ë””ì˜¤">ë®¤ì§ë¹„ë””ì˜¤</option><option value="ì—¬í–‰Â·ë¸Œì´ë¡œê·¸">ì—¬í–‰Â·ë¸Œì´ë¡œê·¸</option>
            <option value="ì˜í™”Â·ë‹¨í¸">ì˜í™”Â·ë‹¨í¸</option><option value="ë‹¤íë©˜í„°ë¦¬">ë‹¤íë©˜í„°ë¦¬</option>
            <option value="ê°•ì˜-ì–¸ì–´">ê°•ì˜ â€“ ì–¸ì–´</option><option value="ê°•ì˜-ì½”ë”©">ê°•ì˜ â€“ í”„ë¡œê·¸ë˜ë°</option>
            <option value="ê°•ì˜-ê³¼í•™">ê°•ì˜ â€“ ê³¼í•™</option><option value="ê°•ì˜-ê²½ì˜">ê°•ì˜ â€“ ê²½ì˜</option>
            <option value="ê°•ì˜-ì˜ˆìˆ ">ê°•ì˜ â€“ ì˜ˆìˆ </option><option value="ê°•ì˜-ê¸°íƒ€">ê°•ì˜ â€“ ê¸°íƒ€</option>
            <option value="ì½”ë¯¸ë””">ì½”ë¯¸ë””</option><option value="ìŠ¤í¬ì¸ ">ìŠ¤í¬ì¸ </option>
            <option value="ê²Œì„">ê²Œì„</option><option value="ë‰´ìŠ¤">ë‰´ìŠ¤</option>
            <option value="ì–´ë¦°ì´">ì–´ë¦°ì´</option>
          </optgroup>
        </select>
      </div>
      <div class="fg" style="margin-bottom:0">
        <label class="fl">ìˆ˜ìµ ëª¨ë¸</label>
        <div class="model-grid">
          <div id="m73" class="model-card sel" onclick="selModel('7-3')">
            <div style="font-weight:800;font-size:15px">7:3</div>
            <div style="font-size:11px;color:var(--t2);margin-top:3px">70% TL ì¦‰ì‹œ</div>
          </div>
          <div id="m55" class="model-card" onclick="selModel('5-5')">
            <div style="font-weight:800;font-size:15px">5:5</div>
            <div style="font-size:11px;color:var(--t2);margin-top:3px">50% TLC ì±„êµ´</div>
          </div>
        </div>
      </div>
    </div>

    <!-- íŒŒì¼ TL ì¶©ì „ -->
    <div class="tl-charge-box">
      <div style="font-weight:800;font-size:14px;margin-bottom:6px">
        ğŸ’° íŒŒì¼ì— TL ì¶©ì „
        <span style="font-size:12px;font-weight:400;color:var(--t2);margin-left:6px">ì²­ì·¨ìëŠ” ì´ TLì„ ì†Œëª¨í•˜ë©° ì¬ìƒí•©ë‹ˆë‹¤</span>
      </div>
      <div style="background:rgba(0,0,0,.2);border-radius:var(--rs);padding:10px 14px;font-size:13px;color:var(--t2);margin-bottom:12px;line-height:1.5">
        â„¹ï¸ íŒŒì¼ì— ì¶©ì „ëœ TLì€ ì°½ì‘ì(ë‹¹ì‹ )ì˜ ì”ê³ ì—ì„œ ì°¨ê°ë©ë‹ˆë‹¤.<br>
        ì²­ì·¨ìê°€ ì¬ìƒí•  ë•Œë§ˆë‹¤ íŒŒì¼ TLì´ ì†Œëª¨ë˜ê³  ì²­ì·¨ìì—ê²Œ Pulse ë³´ìƒì´ ìŒ“ì…ë‹ˆë‹¤.
      </div>
      <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">
        <input type="number" id="up-ftl" class="fi" style="flex:1;min-width:120px;padding:10px 14px" value="1000" min="100" max="1000000" placeholder="ì¶©ì „í•  TL">
        <div style="display:flex;gap:6px">
          <button class="btn btn-ghost btn-sm" onclick="document.getElementById('up-ftl').value=500">500</button>
          <button class="btn btn-ghost btn-sm" onclick="document.getElementById('up-ftl').value=1000">1K</button>
          <button class="btn btn-ghost btn-sm" onclick="document.getElementById('up-ftl').value=5000">5K</button>
          <button class="btn btn-ghost btn-sm" onclick="document.getElementById('up-ftl').value=10000">10K</button>
        </div>
      </div>
      <div style="margin-top:8px;font-size:13px;color:var(--t2)">
        ë‚´ ì”ê³ : <span class="mono ac" id="my-tl-disp">â€”</span> TL
        <span style="margin-left:12px">ì¶©ì „ í›„ ì”ê³ : <span class="mono" id="after-tl-disp" style="color:var(--ca)">â€”</span> TL</span>
      </div>
    </div>
  </div>

  <button id="up-btn" class="btn btn-primary w-full mt-4" disabled onclick="doUpload()">
    íŒŒì¼ì„ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”
  </button>
</div>

<!-- í™˜ì „ ëª¨ë‹¬ (indexì—ì„œ ë³µì‚¬) -->
<div class="modal-overlay hidden" id="exchange-modal">
  <div class="modal" style="max-width:400px">
    <div class="fb mb-4">
      <div style="font-weight:800;font-size:18px">ğŸ’± TL í™˜ì „ ìš”ì²­</div>
      <button class="btn btn-ghost btn-sm" onclick="closeModal('exchange-modal')">âœ•</button>
    </div>
    <div style="background:rgba(0,245,160,.06);border:1px solid rgba(0,245,160,.15);border-radius:var(--rm);padding:14px;margin-bottom:16px">
      <div class="fb" style="font-size:13px;margin-bottom:4px">
        <span style="color:var(--t2)">í™˜ì „ ê°€ëŠ¥ëŸ‰</span>
        <span style="font-weight:800;color:var(--ac);font-family:'JetBrains Mono',monospace" id="exch-available">0 TL</span>
      </div>
      <div style="font-size:11px;color:var(--t2)">(ì†Œë¹„ TL - í™˜ì „ TL) Ã— 50%</div>
    </div>
    <div style="margin-bottom:12px">
      <div style="font-size:12px;color:var(--t2);margin-bottom:6px">í™˜ì „ ê¸ˆì•¡ (TL)</div>
      <input type="number" class="fi" id="exch-amount" placeholder="í™˜ì „í•  TL ì…ë ¥" min="100" step="100">
      <div style="font-size:11px;color:var(--t2);margin-top:4px">ìµœì†Œ 100 TL Â· ì²˜ë¦¬ 3~5 ì˜ì—…ì¼</div>
    </div>
    <div style="margin-bottom:14px">
      <div style="font-size:12px;color:var(--t2);margin-bottom:6px">ì…ê¸ˆ ê³„ì¢Œ / ì§€ê°‘ ì£¼ì†Œ</div>
      <input type="text" class="fi" id="exch-account" placeholder="ì€í–‰ê³„ì¢Œ ë˜ëŠ” ì•”í˜¸í™”í ì£¼ì†Œ">
    </div>
    <button class="btn btn-primary" style="width:100%" onclick="requestExchange()">í™˜ì „ ìš”ì²­í•˜ê¸°</button>
  </div>
</div>

<!-- ì¶©ì „ ëª¨ë‹¬ -->
<div id="recharge-modal" class="modal-overlay hidden">
  <div class="modal">
    <button class="modal-close" onclick="closeModal('recharge-modal')">âœ•</button>
    <div class="modal-title">ğŸ’° TL ì¶©ì „</div>
    <div style="display:flex;gap:8px;margin-bottom:14px;flex-wrap:wrap">
      <button class="btn btn-ghost btn-sm" onclick="$('rc-amt').value=1000">1,000</button>
      <button class="btn btn-ghost btn-sm" onclick="$('rc-amt').value=5000">5,000</button>
      <button class="btn btn-ghost btn-sm" onclick="$('rc-amt').value=10000">10,000</button>
      <button class="btn btn-ghost btn-sm" onclick="$('rc-amt').value=50000">50,000</button>
    </div>
    <div class="fg mb-4"><label class="fl">ê¸ˆì•¡ (TL)</label><input type="number" id="rc-amt" class="fi" value="1000" min="100"></div>
    <button class="btn btn-primary w-full" onclick="doRecharge()">ì¶©ì „í•˜ê¸°</button>
  </div>
</div>

<!-- ì¶©ì „ íŒŒì¼ ëª¨ë‹¬ -->
<div id="recharge-file-modal" class="modal-overlay hidden">
  <div class="modal">
    <button class="modal-close" onclick="closeModal('recharge-file-modal')">âœ•</button>
    <div class="modal-title">ğŸ’° íŒŒì¼ TL ì¶©ì „</div>
    <p style="font-size:14px;color:var(--t2);margin-bottom:16px">ì„ íƒëœ íŒŒì¼ì— TLì„ ì§ì ‘ ì¶©ì „í•©ë‹ˆë‹¤. ì²­ì·¨ìëŠ” ì´ TLì„ ì†Œëª¨í•˜ë©° íŒŒì¼ì„ ì¬ìƒí•©ë‹ˆë‹¤.</p>
    <div style="display:flex;gap:8px;margin-bottom:14px;flex-wrap:wrap">
      <button class="btn btn-ghost btn-sm" onclick="$('frc-amt').value=500">500</button>
      <button class="btn btn-ghost btn-sm" onclick="$('frc-amt').value=1000">1,000</button>
      <button class="btn btn-ghost btn-sm" onclick="$('frc-amt').value=5000">5,000</button>
    </div>
    <div class="fg mb-4"><label class="fl">ì¶©ì „í•  TL</label><input type="number" id="frc-amt" class="fi" value="1000" min="100"></div>
    <div style="font-size:13px;color:var(--t2);margin-bottom:14px">ë‚´ ì”ê³ : <span class="mono ac" id="frc-bal">â€”</span> TL</div>
    <button class="btn btn-primary w-full" onclick="doRechargeFile()">íŒŒì¼ì— ì¶©ì „í•˜ê¸°</button>
  </div>
</div>

</div><!-- .page -->

<!-- PLAYER BAR (indexì—ì„œ ë³µì‚¬) -->
<div id="player-bar" class="player-bar hidden">
  <div class="pb-prog" onclick="seekByClickBar(event)"><div class="pb-prog-fill" id="pb-fill"></div></div>
  <div class="pb-track">
    <div class="pb-thumb" id="pb-thumb">ğŸµ</div>
    <div style="min-width:0">
      <div style="font-weight:700;font-size:14px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis" id="pb-title">â€”</div>
      <div style="font-size:12px;color:var(--t2)" id="pb-artist">â€”</div>
    </div>
  </div>
  <div class="pb-controls">
    <button class="btn btn-icon btn-ghost" id="pb-play-btn" onclick="toggleAudio()">â–¶</button>
  </div>
  <div class="pb-right">
    <span class="badge badge-ac">âš¡ <span id="pb-pulse">0</span></span>
    <span class="badge badge-ca">TL: <span id="pb-ftl">â€”</span></span>
    <span class="mono mu" style="font-size:12px"><span id="pb-cur">0:00</span>/<span id="pb-dur">0:00</span></span>
    <span id="pb-car" class="badge badge-ca hidden">ğŸš— 2x</span>
  </div>
</div>

<script>
// =================== STATE ===================
const S = {
  wallet:{tl:10000,locked:0,tlc:0,
    totalEarned:0,totalSpent:0,totalExchanged:0,holdingRevenue:0,
  },
  trust:1.0,lvs:1.0,carMode:false,autoRecharge:true,
  totalSec:0,selectedFile:null,fileType:'audio',revenueModel:'7-3',
  myFiles:[],
  currentFileId:null,isPlaying:false,pulseCount:0,
  hbTimer:null,uiTimer:null,lockCountdown:30,
  shuffle:false,loop:false,speed:1,
  vidPulse:0,
  // POC
  poc:{
    index: 1.0,
    history:[],
  },
  // ì´ì˜ì œê¸°
  disputes:[],disputedTracks:{},tlSuspended:false,
  falseDisputeStrikes:0,accountForfeited:false,
  verifiedTracks:[],sunoVerified:false,
};

// =================== UTILS ===================
function $(i){return document.getElementById(i)}
function esc(s){return String(s).replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]))}
function fmt(n){return Math.floor(n).toLocaleString()}
function fmtT(s){s=Math.floor(s||0);return`${Math.floor(s/60)}:${String(s%60).padStart(2,'0')}`}
function toast(msg,t='i'){const el=document.createElement('div');el.className=`t ${t}`;el.textContent=msg;$('toast-box').prepend(el);setTimeout(()=>el.remove(),3200)}
function openModal(id){$(id).classList.remove('hidden')}
function closeModal(id){$(id).classList.add('hidden')}
document.addEventListener('click',e=>{if(e.target.classList.contains('modal-overlay'))e.target.classList.add('hidden')});

// =================== TABS ===================
function switchTab(name){
  // ëª¨ë“  í˜ì´ì§€ì—ì„œ ê³µí†µìœ¼ë¡œ ì‚¬ìš©
  if(name==='shareplace') window.location.href='index.html?tab=shareplace';
  if(name==='dashboard') window.location.href='index.html?tab=dashboard';
  if(name==='library') window.location.href='library.html';
  if(name==='create') window.location.href='create.html';
  if(name==='player') window.location.href='player.html';
  if(name==='radio') window.location.href='index.html?tab=radio';
  if(name==='car') window.location.href='index.html?tab=car';
  if(name==='ads') window.location.href='index.html?tab=ads';
  if(name==='wallet') window.location.href='index.html?tab=wallet';
}

// =================== BALANCE ===================
function updateBal(){
  const w=S.wallet;
  [['nb-tl',w.tl],['nb-lo',w.locked],['nb-tlc',w.tlc],
   ['my-tl-disp',w.tl],['frc-bal',w.tl]].forEach(([id,v])=>{
    const el=$(id);if(!el)return;
    el.textContent=v>0&&v<1?v.toFixed(4):fmt(v);
  });
}

// =================== CAR MODE ===================
function toggleCar(){
  S.carMode=!S.carMode;const v=S.carMode;
  const chk=$('car-chk');if(chk)chk.checked=v;
  const ind=$('car-ind');if(ind){ind.className=`car-ind ${v?'on':'off'}`;ind.textContent=v?'ğŸš— ON':'ğŸš— Off';}
  const hero=$('car-hero');if(hero)hero.classList.toggle('on',v);
  const badge=$('pb-car');if(badge)badge.classList.toggle('hidden',!v);
  toast(v?'ğŸš— Car Mode ON â€” 2ë°° ë³´ìƒ!':'Car Mode OFF',v?'s':'i');
}

// =================== AUDIO ENGINE (ê¸°ë³¸) ===================
const aud=$('aud');
function loadTrack(id,url,title,artist,icon='ğŸµ'){
  stopAll();
  S.currentFileId=id;S.pulseCount=0;
  aud.src=url;aud.load();aud.volume=0.8;aud.playbackRate=S.speed;
  ['pb-title','pb-artist'].forEach(i=>{const el=$(i);if(el)el.textContent=title||artist});
  const pb=$('player-bar');if(pb)pb.classList.remove('hidden');
  updateFileTLDisplay();
}
function toggleAudio(){
  if(!S.currentFileId){toast('Libraryì—ì„œ íŠ¸ë™ì„ ì„ íƒí•˜ì„¸ìš”','i');return;}
  if(S.isPlaying){aud.pause();setPlaying(false);}
  else{aud.play().then(()=>{setPlaying(true);}).catch(()=>toast('ì¬ìƒ ì˜¤ë¥˜','e'));}
}
function stopAll(){
  clearInterval(S.hbTimer);clearInterval(S.uiTimer);aud.pause();aud.currentTime=0;setPlaying(false);
  const vd=$('vid-el');if(vd&&!vd.paused)vd.pause();
}
function setPlaying(v){
  S.isPlaying=v;
  ['pb-play-btn','aud-play-btn'].forEach(id=>{const el=$(id);if(el)el.innerHTML=v?'â¸':'â–¶';});
}
function seekByClickBar(e){
  const el=e.currentTarget,rect=el.getBoundingClientRect();
  const pct=Math.max(0,Math.min(1,(e.clientX-rect.left)/rect.width));
  if(aud.duration)aud.currentTime=pct*aud.duration;
}
function setSpeed(sp){S.speed=sp;aud.playbackRate=sp;}
aud.addEventListener('ended',()=>{setPlaying(false);toast('ğŸµ ì¬ìƒ ì™„ë£Œ!','s');});

function updateFileTLDisplay(){
  const f=S.myFiles.find(x=>x.id===S.currentFileId);
  if(!f)return;
  ['pb-ftl'].forEach(id=>{const el=$(id);if(el)el.textContent=fmt(f.fileTL);});
}

// =================== AI PLATFORMS ===================
const AI_PLATFORMS={
  suno:{name:'Suno',icon:'ğŸµ',url:'suno.com'},udio:{name:'Udio',icon:'ğŸ¶',url:'udio.com'},
  mubert:{name:'Mubert',icon:'ğŸŒŠ',url:'mubert.com'},aiva:{name:'AIVA',icon:'ğŸ»',url:'aiva.ai'},
  soundraw:{name:'Soundraw',icon:'ğŸ¸',url:'soundraw.io'},boomy:{name:'Boomy',icon:'ğŸ¥',url:'boomy.com'},
  elevenlabs:{name:'ElevenLabs',icon:'ğŸ—£ï¸',url:'elevenlabs.io'},beatoven:{name:'Beatoven',icon:'ğŸ¹',url:'beatoven.ai'},
  loudly:{name:'Loudly',icon:'ğŸ“¢',url:'loudly.com'},amper:{name:'Amper',icon:'ğŸ”Š',url:'ampermusic.com'},
  stable:{name:'Stable Audio',icon:'ğŸ™ï¸',url:'stability.ai'},etc:{name:'ê¸°íƒ€ AI',icon:'â•',url:''},
};
let selPlatform='suno',selFileType='audio',selRevModel='7-3',selFile=null;
let wallet={tl:10000};

function loadWallet(){
  const u=JSON.parse(localStorage.getItem('tl_user')||'{}');
  if(u.tl)wallet.tl=u.tl;
  if($('nb-tl'))$('nb-tl').textContent=fmt(wallet.tl);
  if($('nb-tlc'))$('nb-tlc').textContent=(u.tlc||0).toFixed(4);
  if($('my-tl-disp'))$('my-tl-disp').textContent=fmt(wallet.tl);
  updateAfterTL();
}
function updateAfterTL(){
  const ftl=Number($('up-ftl').value)||0;
  const after=wallet.tl-ftl;
  const el=$('after-tl-disp');if(el){el.textContent=after>=0?fmt(after):'ë¶€ì¡±';el.style.color=after>=0?'var(--ac)':'var(--da)';}
}
$('up-ftl')&&$('up-ftl').addEventListener('input',updateAfterTL);

// ===== AI =====
function selAI(id){
  selPlatform=id;
  document.querySelectorAll('.ai-card').forEach(c=>c.classList.toggle('sel',c.dataset.id===id));
  const p=AI_PLATFORMS[id];
  $('ai-plat-name').textContent=p.name;
  $('ai-url').placeholder=id==='etc'?'https://...':`https://${p.url}/...`;
  $('etc-fields').classList.toggle('hidden',id!=='etc');
}

function verifyAI(){
  const url=$('ai-url').value.trim();
  const plan=$('ai-plan').value;
  const hasImg=$('pf-img').files.length>0;
  const hasEmail=$('pf-email').value.trim();
  const hasDoc=$('pf-doc').files.length>0;
  if(!url){toast('ìŒì› URLì„ ì…ë ¥í•˜ì„¸ìš”','e');return;}
  if(!plan){toast('êµ¬ë… í”Œëœì„ ì„ íƒí•˜ì„¸ìš”','e');return;}
  if(!hasImg&&!hasEmail&&!hasDoc){toast('ì¸ì¦ ìë£Œë¥¼ í•˜ë‚˜ ì´ìƒ ì²¨ë¶€í•˜ì„¸ìš”','e');return;}
  $('ai-loading').classList.remove('hidden');
  $('ai-preview').classList.add('hidden');$('ai-err').classList.add('hidden');$('ai-btn').disabled=true;
  setTimeout(()=>{
    const p=AI_PLATFORMS[selPlatform];
    $('ai-art-icon').textContent=p.icon;
    $('ai-prev-title').textContent=`AI Generated â€” ${p.name} (${plan})`;
    $('ai-prev-sub').textContent=`${p.name} Â· ${plan} êµ¬ë… ì¸ì¦ ì™„ë£Œ`;
    $('ai-prev-dur').textContent=fmtT(180+Math.floor(Math.random()*120));
    $('ai-prev-plat').textContent=p.name;
    $('ai-loading').classList.add('hidden');$('ai-preview').classList.remove('hidden');$('ai-btn').disabled=false;
    toast(`âœ… ${p.name} ${plan} êµ¬ë… ì¸ì¦ ì™„ë£Œ!`,'s');
  },2200);
}
function cancelPreview(){$('ai-preview').classList.add('hidden');$('ai-url').value='';}
function convertAI(){
  const p=AI_PLATFORMS[selPlatform];
  wallet.tl+=1000;loadWallet();
  const u=JSON.parse(localStorage.getItem('tl_user')||'{}');u.tl=wallet.tl;localStorage.setItem('tl_user',JSON.stringify(u));
  cancelPreview();toast(`âœ¨ ${p.name} ìŒì› ë³€í™˜ ì™„ë£Œ! +1,000 TL`,'s');
  setTimeout(()=>window.location.href='library.html',1200);
}

// ===== PROOF =====
var proofFiles = {img: null, doc: null, song: null};

function handleProofDrop(e, type){
  e.preventDefault(); e.currentTarget.classList.remove('over');
  const f = e.dataTransfer.files[0]; if(!f) return;
  applyProofFile(f, type);
}
function handleProofFile(input, type){
  const f = input.files[0]; if(!f) return;
  applyProofFile(f, type);
}
function applyProofFile(f, type){
  proofFiles[type] = f;
  const isImg = f.type.startsWith('image/');
  const thumbId = type==='img' ? 'pz-img-thumb' : type==='song' ? 'pz-song-thumb' : 'pz-doc-thumb';
  const prevId  = type==='img' ? 'pz-img-preview' : type==='song' ? 'pz-song-preview' : 'pz-doc-preview';
  const phId    = type==='img' ? 'pz-img-placeholder' : type==='song' ? 'pz-song-placeholder' : 'pz-doc-placeholder';
  const nameId  = type==='img' ? 'pz-img-name' : type==='song' ? 'pz-song-name' : 'pz-doc-name';
  const zoneId  = type==='img' ? 'pz-img' : type==='song' ? 'pz-song' : 'pz-doc';

  if(isImg){
    const reader = new FileReader();
    reader.onload = function(ev){
      $(thumbId).src = ev.target.result;
      $(prevId).style.display = 'block';
      $(phId).style.display = 'none';
    };
    reader.readAsDataURL(f);
  } else {
    $(prevId).style.display = 'none';
    $(phId).style.display = 'block';
  }
  $(nameId).textContent = 'âœ“ ' + f.name;
  $(zoneId).classList.add('filled');
}
function clearProof(type){
  proofFiles[type] = null;
  const thumbId = type==='img' ? 'pz-img-thumb' : type==='song' ? 'pz-song-thumb' : 'pz-doc-thumb';
  const prevId  = type==='img' ? 'pz-img-preview' : type==='song' ? 'pz-song-preview' : 'pz-doc-preview';
  const phId    = type==='img' ? 'pz-img-placeholder' : type==='song' ? 'pz-song-placeholder' : 'pz-doc-placeholder';
  const nameId  = type==='img' ? 'pz-img-name' : type==='song' ? 'pz-song-name' : 'pz-doc-name';
  const zoneId  = type==='img' ? 'pz-img' : type==='song' ? 'pz-song' : 'pz-doc';
  $(thumbId).src = '';
  $(prevId).style.display = 'none';
  $(phId).style.display = 'block';
  $(nameId).textContent = '';
  $(zoneId).classList.remove('filled');
}
function checkEmailFilled(){
  const v = $('pf-email').value.trim();
  document.querySelector('.proof-zone:nth-child(2)').classList.toggle('filled', v.length>0);
}

// ===== í´ë¦½ë³´ë“œ ë¶™ì—¬ë„£ê¸° (Ctrl+V) =====
document.addEventListener('paste', function(e){
  const items = (e.clipboardData || e.originalEvent.clipboardData).items;
  for(let i=0; i<items.length; i++){
    if(items[i].type.startsWith('image/')){
      const f = items[i].getAsFile();
      if(!f) continue;
      // imgê°€ ë¹„ì–´ìˆìœ¼ë©´ imgì—, ì•„ë‹ˆë©´ docì—
      const target = proofFiles.img ? 'doc' : 'img';
      applyProofFile(f, target);
      toast('ğŸ“‹ ìŠ¤í¬ë¦°ìƒ· ë¶™ì—¬ë„£ê¸° ì™„ë£Œ ('+(target==='img'?'ê²°ì œ ì˜ìˆ˜ì¦':'ê¸°íƒ€ ì¦ë¹™')+')','s');
      e.preventDefault();
      break;
    }
  }
});

// ===== UPLOAD =====
function selType(t){
  selFileType=t;
  $('t-audio').className='type-card'+(t==='audio'?' sel-ac':'');
  $('t-video').className='type-card'+(t==='video'?' sel-pu':'');
}
function selModel(m){
  selRevModel=m;
  $('m73').classList.toggle('sel',m==='7-3');$('m55').classList.toggle('sel',m==='5-5');
}
function onDrop(e){e.preventDefault();$('drop-zone').classList.remove('over');onFileSelect(e.dataTransfer.files[0]);}
function onFileSelect(f){
  if(!f)return;
  if(f.size>500*1024*1024){toast('500MBë¥¼ ì´ˆê³¼í•©ë‹ˆë‹¤','e');return;}
  selFile=f;
  const isVid=f.type.startsWith('video/');
  if(isVid)selType('video');
  $('fp-icon').textContent=isVid?'ğŸ¬':'ğŸµ';
  $('fp-name').textContent=f.name;$('fp-size').textContent=(f.size/1024/1024).toFixed(1)+' MB';
  $('file-prev').classList.remove('hidden');$('drop-zone').classList.add('hidden');
  if(!$('up-title').value)$('up-title').value=f.name.replace(/\.[^/.]+$/,'');
  $('up-btn').disabled=false;$('up-btn').textContent='íŠ¸ë™ ì—…ë¡œë“œí•˜ê¸°';
}
function clearFile(){
  selFile=null;
  $('file-prev').classList.add('hidden');$('drop-zone').classList.remove('hidden');
  $('up-btn').disabled=true;$('up-btn').textContent='íŒŒì¼ì„ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”';$('file-in').value='';
}
function doUpload(){
  if(!selFile){toast('íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”','e');return;}
  const title=$('up-title').value.trim();
  if(!title){toast('ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”','e');return;}
  const ftl=Number($('up-ftl').value)||1000;
  if(ftl>wallet.tl){toast('ì”ê³ ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤. íŒŒì¼ TL ì¶©ì „ëŸ‰ì„ ì¤„ì´ê±°ë‚˜ TLì„ ì¶©ì „í•˜ì„¸ìš”','e');return;}
  const isVid=selFile.type.startsWith('video/');
  const f={
    id:'local_'+Date.now(),title,artist:'ë‚˜',dur:0,
    url:URL.createObjectURL(selFile),
    pulse:0,genre:$('up-cat').value,country:'kr',
    type:isVid?'video':'audio',model:selRevModel,source:'upload',
    fileTL:ftl,maxFileTL:ftl,createdAt:Date.now()
  };
  // ì €ì¥
  const files=JSON.parse(localStorage.getItem('tl_myfiles')||'[]');
  files.unshift(f);localStorage.setItem('tl_myfiles',JSON.stringify(files));
  wallet.tl-=ftl;
  const u=JSON.parse(localStorage.getItem('tl_user')||'{}');u.tl=wallet.tl;localStorage.setItem('tl_user',JSON.stringify(u));
  toast('ğŸµ ì—…ë¡œë“œ ì™„ë£Œ! íŒŒì¼ì— TL ì¶©ì „ë¨','s');
  clearFile();$('up-title').value='';
  setTimeout(()=>window.location.href='library.html',1200);
}

// ===== MODAL FUNCTIONS =====
function doRecharge(){
  const a=Number($('rc-amt').value)||0;
  if(a<=0){toast('ê¸ˆì•¡ì„ ì…ë ¥í•˜ì„¸ìš”','e');return;}
  wallet.tl+=a;
  const u=JSON.parse(localStorage.getItem('tl_user')||'{}');u.tl=wallet.tl;localStorage.setItem('tl_user',JSON.stringify(u));
  updateBal();toast(`ğŸ’° ${fmt(a)} TL ì¶©ì „!`,'s');closeModal('recharge-modal');
}

function doRechargeFile(){
  const a=Number($('frc-amt').value)||0;
  if(a<=0){toast('ê¸ˆì•¡ì„ ì…ë ¥í•˜ì„¸ìš”','e');return;}
  if(a>wallet.tl){toast('ì”ê³ ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤','e');return;}
  const f=S.myFiles.find(x=>x.id===S.currentFileId);
  if(!f){toast('íŒŒì¼ì„ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”','e');return;}
  wallet.tl-=a;f.fileTL+=a;f.maxFileTL=Math.max(f.maxFileTL||f.fileTL,f.fileTL);
  updateBal();updateFileTLDisplay();toast(`ğŸ’° íŒŒì¼ì— ${fmt(a)} TL ì¶©ì „!`,'s');closeModal('recharge-file-modal');
}

function requestExchange(){
  var amt=parseInt($('exch-amount')&&$('exch-amount').value||0);
  var acct=$('exch-account')&&$('exch-account').value||'';
  var exchangeable=Math.max(0,Math.floor((S.wallet.totalSpent-S.wallet.totalExchanged)*0.5));
  if(!amt||amt<100){toast('ìµœì†Œ 100 TL ì´ìƒ ì…ë ¥í•˜ì„¸ìš”','w');return;}
  if(amt>exchangeable){toast('í™˜ì „ ê°€ëŠ¥ëŸ‰('+fmt(exchangeable)+' TL)ì„ ì´ˆê³¼í•©ë‹ˆë‹¤','w');return;}
  if(!acct){toast('ì…ê¸ˆ ê³„ì¢Œë¥¼ ì…ë ¥í•˜ì„¸ìš”','w');return;}
  S.wallet.totalExchanged+=amt;
  S.wallet.tl=Math.max(0,S.wallet.tl-amt);
  updateBal();
  closeModal('exchange-modal');
  toast('ğŸ’± í™˜ì „ ìš”ì²­ ì™„ë£Œ! '+fmt(amt)+' TL Â· 3~5 ì˜ì—…ì¼ ì²˜ë¦¬','s');
}

// ===== NAVBAR AUTH =====
function initNavbar(){
  var user=JSON.parse(localStorage.getItem('tl_user')||'null');
  var guest=document.getElementById('nav-guest');
  var auth=document.getElementById('nav-auth');
  if(!guest||!auth)return;
  if(user&&user.username){
    guest.classList.add('hidden');
    auth.classList.remove('hidden');
    var av=document.getElementById('nav-avatar');
    if(av)av.textContent=user.username.charAt(0).toUpperCase();
    var dn=document.getElementById('dd-name');if(dn)dn.textContent=user.username;
    var de=document.getElementById('dd-email');if(de)de.textContent=user.email||'';
    var tl=document.getElementById('nb-tl');if(tl)tl.textContent=fmt(user.tl||10000);
    var tlc=document.getElementById('nb-tlc');if(tlc)tlc.textContent=(user.tlc||0).toFixed(4);
  }
}
function toggleNavDD(){var dd=document.getElementById('nav-dd');if(dd)dd.classList.toggle('hidden');}
function doLogout(){localStorage.removeItem('tl_token');localStorage.removeItem('tl_user');window.location.href='login.html';}
document.addEventListener('click',function(e){
  var wrap=document.querySelector('.avatar-wrap');
  if(wrap&&!wrap.contains(e.target)){var dd=document.getElementById('nav-dd');if(dd)dd.classList.add('hidden');}
});

// ===== INIT =====
(function init(){
  initNavbar();
  loadWallet();
  // í˜„ì¬ íƒ­ active í‘œì‹œ
  document.querySelectorAll('.tab-btn').forEach(btn=>btn.classList.toggle('active',btn.dataset.tab==='create'));
  // Car ëª¨ë“œ ì´ˆê¸°í™”
  const carState=localStorage.getItem('tl_carmode')==='true';
  S.carMode=carState;
  const ind=$('car-ind');if(ind){ind.className=`car-ind ${carState?'on':'off'}`;ind.textContent=carState?'ğŸš— ON':'ğŸš— Off';}
})();
</script>
</body>
</html>