<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TimeLink</title>
<link rel="icon" href="favicon.svg" type="image/svg+xml">
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#060610;--card:rgba(255,255,255,.04);--card-h:rgba(255,255,255,.07);
  --bd:rgba(255,255,255,.08);--bd-a:rgba(0,245,160,.3);
  --ac:#00f5a0;--ac-d:rgba(0,245,160,.13);--ac-g:0 0 28px rgba(0,245,160,.35);
  --pu:#7b61ff;--pu-d:rgba(123,97,255,.13);
  --su:#ff7b00;--su-d:rgba(255,123,0,.11);
  --ca:#f59e0b;--ca-d:rgba(245,158,11,.11);
  --da:#ff4f4f;--sp:#1db954;--sp-d:rgba(29,185,84,.12);
  --t1:#e8e8f5;--t2:#8888aa;--t3:#44445a;
  --rf:999px;--rl:20px;--rm:14px;--rs:8px;
  --tr:all .2s cubic-bezier(.4,0,.2,1);
}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html{scroll-behavior:smooth}
body{font-family:'Syne',sans-serif;background:var(--bg);color:var(--t1);min-height:100vh;line-height:1.6;overflow-x:hidden;-webkit-font-smoothing:antialiased}
body::before{content:'';position:fixed;inset:0;pointer-events:none;z-index:0;
  background:radial-gradient(ellipse 80% 50% at 20% 10%,rgba(0,245,160,.05) 0%,transparent 60%),
             radial-gradient(ellipse 60% 40% at 80% 80%,rgba(123,97,255,.05) 0%,transparent 60%)}
/* NAV */
.navbar{position:sticky;top:0;z-index:200;height:64px;padding:0 24px;display:flex;align-items:center;justify-content:space-between;background:rgba(6,6,16,.9);backdrop-filter:blur(20px);border-bottom:1px solid var(--bd)}
.logo{display:flex;align-items:center;gap:10px;text-decoration:none;color:var(--t1)}
.logo-icon{width:32px;height:32px;border-radius:8px;background:var(--ac);display:flex;align-items:center;justify-content:center;font-size:16px}
.logo-text{font-size:18px;font-weight:800;letter-spacing:-.5px}.logo-text span{color:var(--ac)}
.nav-right{display:flex;align-items:center;gap:8px}
.bal-row{display:flex;align-items:center;gap:10px;padding:6px 14px;border-radius:var(--rf);background:var(--card);border:1px solid var(--bd)}
.bal-col{display:flex;flex-direction:column;align-items:center}
.bal-lbl{font-size:10px;color:var(--t2);font-weight:700;text-transform:uppercase}
.bal-val{font-family:'JetBrains Mono',monospace;font-size:13px;font-weight:700;color:var(--ac)}
.bal-val.locked{color:var(--ca)}.bal-val.tlc{color:var(--pu)}
.bal-sep{width:1px;height:20px;background:var(--bd)}
.car-ind{display:inline-flex;align-items:center;gap:5px;padding:4px 12px;border-radius:var(--rf);font-size:12px;font-weight:700;transition:var(--tr)}
.car-ind.off{background:rgba(255,255,255,.04);color:var(--t2);border:1px solid var(--bd)}
.car-ind.on{background:var(--ca-d);color:var(--ca);border:1px solid rgba(245,158,11,.3)}
/* TABS */
.tabs-bar{position:sticky;top:64px;z-index:190;padding:7px 24px;background:rgba(6,6,16,.92);backdrop-filter:blur(20px);border-bottom:1px solid var(--bd);display:flex;gap:4px;overflow-x:auto;scrollbar-width:none}
.tabs-bar::-webkit-scrollbar{display:none}
.tab-btn{flex-shrink:0;padding:8px 18px;border-radius:var(--rf);border:none;background:transparent;color:var(--t2);font-family:'Syne',sans-serif;font-size:13px;font-weight:700;cursor:pointer;transition:var(--tr);white-space:nowrap}
.tab-btn:hover{color:var(--t1);background:var(--card)}.tab-btn.active{background:var(--ac);color:#060610}
.tab-pane{display:none;animation:fadeUp .2s ease}.tab-pane.active{display:block}
@keyframes fadeUp{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}
.page{padding:24px 24px 120px;max-width:1100px;margin:0 auto;position:relative;z-index:1}
/* BUTTONS */
.btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;padding:10px 22px;border-radius:var(--rf);font-family:'Syne',sans-serif;font-size:14px;font-weight:700;cursor:pointer;transition:var(--tr);border:none;text-decoration:none;white-space:nowrap}
.btn-primary{background:var(--ac);color:#060610}.btn-primary:hover{transform:translateY(-1px);box-shadow:var(--ac-g)}
.btn-ghost{background:transparent;color:var(--t2);border:1px solid var(--bd)}.btn-ghost:hover{background:var(--card);color:var(--t1)}
.btn-outline{background:transparent;color:var(--ac);border:1px solid var(--bd-a)}.btn-outline:hover{background:var(--ac-d)}
.btn-sp{background:var(--sp);color:#fff}.btn-sp:hover{transform:translateY(-1px);box-shadow:0 0 24px rgba(29,185,84,.4)}
.btn-ai{background:var(--su);color:#fff}.btn-ai:hover{transform:translateY(-1px);box-shadow:0 0 24px rgba(255,123,0,.4)}
.btn-ai:disabled,.btn:disabled{opacity:.4;cursor:not-allowed;transform:none!important;box-shadow:none}
.btn-sm{padding:6px 14px;font-size:12px}.btn-lg{padding:13px 30px;font-size:15px}
.btn-icon{width:40px;height:40px;padding:0;border-radius:50%}
.w-full{width:100%}
/* CARD */
.card{background:var(--card);border:1px solid var(--bd);border-radius:var(--rl);padding:24px;transition:var(--tr)}
.card-ac{border-color:var(--bd-a);background:linear-gradient(135deg,rgba(0,245,160,.04),transparent)}
.card-pu{border-color:rgba(123,97,255,.25);background:linear-gradient(135deg,rgba(123,97,255,.06),transparent)}
.card-ai{border-color:rgba(255,123,0,.25);background:linear-gradient(145deg,rgba(255,123,0,.06),transparent)}
.card-sp{border-color:rgba(29,185,84,.25);background:linear-gradient(135deg,rgba(29,185,84,.05),transparent)}
.card-car{border-color:rgba(245,158,11,.25);background:linear-gradient(135deg,rgba(245,158,11,.06),transparent)}
.sec-hd{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px}
.sec-title{font-size:18px;font-weight:800}
/* STATS */
.stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:14px}
.stat-card{background:var(--card);border:1px solid var(--bd);border-radius:var(--rl);padding:20px;position:relative;overflow:hidden}
.stat-card::before{content:'';position:absolute;top:0;left:0;width:4px;height:100%;background:var(--ac)}
.stat-lbl{font-size:11px;color:var(--t2);text-transform:uppercase;font-weight:700;letter-spacing:.5px;margin-bottom:6px}
.stat-val{font-family:'JetBrains Mono',monospace;font-size:24px;font-weight:800}
.stat-val.ac{color:var(--ac)}.stat-val.lo{color:var(--ca)}.stat-val.tl{color:var(--pu)}
/* FORM */
.fg{display:flex;flex-direction:column;gap:7px;margin-bottom:14px}
.fl{font-size:11px;color:var(--t2);font-weight:700;text-transform:uppercase;letter-spacing:.5px}
.fi{background:rgba(255,255,255,.04);border:1px solid var(--bd);border-radius:var(--rm);padding:12px 16px;font-family:'Syne',sans-serif;font-size:14px;color:var(--t1);outline:none;transition:var(--tr);width:100%}
.fi:focus{border-color:var(--ac);background:rgba(0,245,160,.04);box-shadow:0 0 0 3px rgba(0,245,160,.1)}
.fi::placeholder{color:var(--t3)}
.fi.ai-focus:focus{border-color:var(--su);background:rgba(255,123,0,.04);box-shadow:0 0 0 3px rgba(255,123,0,.1)}
.two-col{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.three-col{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px}
/* DROP */
.drop-zone{border:2px dashed var(--bd);border-radius:var(--rl);padding:40px 24px;text-align:center;cursor:pointer;transition:var(--tr)}
.drop-zone:hover,.drop-zone.over{border-color:var(--ac);background:var(--ac-d)}
.drop-zone-icon{font-size:36px;margin-bottom:10px}.drop-zone-title{font-weight:700;font-size:15px;margin-bottom:4px}.drop-zone-sub{font-size:12px;color:var(--t2)}
.file-preview{display:flex;align-items:center;gap:12px;background:var(--ac-d);border:1px solid var(--bd-a);border-radius:var(--rm);padding:12px 16px;margin-bottom:12px}
.fp-name{font-weight:700;font-size:13px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;flex:1}
/* TRACK ITEMS */
.track-item{display:flex;align-items:center;gap:14px;padding:12px 16px;border-radius:var(--rm);background:var(--card);border:1px solid var(--bd);transition:var(--tr);cursor:pointer}
.track-item:hover{background:var(--card-h);border-color:var(--bd-a)}
.track-item.playing{border-color:var(--bd-a);background:rgba(0,245,160,.06)}
.track-thumb{width:46px;height:46px;flex-shrink:0;border-radius:var(--rs);background:linear-gradient(135deg,var(--ac-d),var(--pu-d));display:flex;align-items:center;justify-content:center;font-size:20px}
.track-info{flex:1;min-width:0}
.track-title{font-weight:700;font-size:14px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.track-meta{font-size:12px;color:var(--t2);margin-top:2px}
.track-actions{display:flex;align-items:center;gap:8px;flex-shrink:0}
/* TL BAR on file */
.file-tl-bar{height:3px;background:var(--bd);border-radius:2px;margin-top:4px;overflow:hidden}
.file-tl-fill{height:100%;background:linear-gradient(90deg,var(--ca),var(--ac));border-radius:2px;transition:width .5s}
/* BADGE */
.badge{display:inline-flex;align-items:center;gap:4px;padding:3px 9px;border-radius:var(--rf);font-size:11px;font-weight:700;font-family:'JetBrains Mono',monospace}
.badge-ac{background:var(--ac-d);color:var(--ac);border:1px solid rgba(0,245,160,.2)}
.badge-pu{background:var(--pu-d);color:var(--pu);border:1px solid rgba(123,97,255,.2)}
.badge-sp{background:var(--sp-d);color:var(--sp);border:1px solid rgba(29,185,84,.25)}
.badge-ai{background:rgba(255,123,0,.15);color:var(--su);border:1px solid rgba(255,123,0,.3)}
.badge-ca{background:var(--ca-d);color:var(--ca);border:1px solid rgba(245,158,11,.3)}
.badge-live{background:rgba(255,80,80,.15);color:#ff5050;border:1px solid rgba(255,80,80,.2)}
.badge-live::before{content:'';width:6px;height:6px;background:#ff5050;border-radius:50%;animation:blink 1.2s infinite}
@keyframes blink{0%,100%{opacity:1}50%{opacity:.2}}
.badge-vid{background:rgba(239,68,68,.12);color:#ef4444;border:1px solid rgba(239,68,68,.25)}
/* TOGGLE */
.toggle{position:relative;width:52px;height:28px;cursor:pointer;flex-shrink:0}
.toggle input{display:none}
.tgl-track{position:absolute;inset:0;border-radius:14px;background:var(--bd);transition:var(--tr)}
.tgl-thumb{position:absolute;top:4px;left:4px;width:20px;height:20px;border-radius:50%;background:var(--t2);font-size:12px;display:flex;align-items:center;justify-content:center;transition:var(--tr)}
.toggle input:checked~.tgl-track{background:rgba(245,158,11,.35)}
.toggle input:checked~.tgl-thumb{transform:translateX(24px);background:var(--ca)}
/* LOCKED */
.locked-track{height:6px;background:var(--bd);border-radius:3px;overflow:hidden}
.locked-fill{height:100%;width:100%;background:linear-gradient(90deg,var(--ca),var(--ac));border-radius:3px;transition:width 1s linear}
/* TRUST SVG */
.trust-svg-wrap{position:relative;width:100px;height:100px;margin:0 auto}
.trust-svg-wrap svg{transform:rotate(-90deg)}
.trust-track{fill:none;stroke:var(--bd);stroke-width:8}
.trust-fill{fill:none;stroke:var(--ac);stroke-width:8;stroke-linecap:round;stroke-dasharray:263.9;stroke-dashoffset:0;transition:stroke-dashoffset .6s ease,stroke .4s}
.trust-center{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center}
.trust-num{font-family:'JetBrains Mono',monospace;font-size:18px;font-weight:800;color:var(--ac);line-height:1}
.trust-tag{font-size:9px;color:var(--t2);font-weight:700;text-transform:uppercase;margin-top:2px}
/* NOW PLAYING */
.np-card{background:linear-gradient(135deg,rgba(0,245,160,.05),rgba(123,97,255,.04));border:1px solid var(--bd-a);border-radius:var(--rl);padding:20px;margin-bottom:24px;position:relative;overflow:hidden}
.np-card::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,var(--ac),var(--pu));animation:scan 3s linear infinite}
@keyframes scan{0%{transform:scaleX(0);transform-origin:left}50%{transform:scaleX(1);transform-origin:left}51%{transform:scaleX(1);transform-origin:right}100%{transform:scaleX(0);transform-origin:right}}
.np-seek{width:100%;height:4px;background:var(--bd);border-radius:2px;cursor:pointer;margin:10px 0 6px}
.np-seek-fill{height:100%;background:var(--ac);border-radius:2px;width:0%;transition:width .5s linear}
.np-times{display:flex;justify-content:space-between;font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--t2)}
/* SHARE */
.share-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(250px,1fr));gap:14px}
.share-card{background:var(--card);border:1px solid var(--bd);border-radius:var(--rl);padding:18px;transition:var(--tr)}
.share-card:hover{border-color:var(--bd-a);background:var(--card-h)}
.share-thumb{width:100%;height:64px;border-radius:var(--rm);background:linear-gradient(135deg,var(--ac-d),var(--pu-d));display:flex;align-items:center;justify-content:center;font-size:26px;margin-bottom:12px}
/* RADIO */
.radio-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(170px,1fr));gap:12px}
.radio-card{background:var(--card);border:1px solid var(--bd);border-radius:var(--rl);padding:20px;text-align:center;cursor:pointer;transition:var(--tr)}
.radio-card:hover{border-color:var(--bd-a);transform:translateY(-2px)}
.radio-card.playing{border-color:var(--bd-a);background:var(--ac-d)}
/* CAR */
.car-hero{background:linear-gradient(145deg,var(--ca-d),var(--card));border:2px solid rgba(245,158,11,.28);border-radius:var(--rl);padding:36px;text-align:center;margin-bottom:24px;position:relative;overflow:hidden}
.car-hero::after{content:'ğŸš—';position:absolute;bottom:-16px;right:-8px;font-size:120px;opacity:.07;pointer-events:none}
.car-hero.on{border-color:rgba(245,158,11,.55);box-shadow:0 0 40px rgba(245,158,11,.1)}
.car-rate-big{font-family:'JetBrains Mono',monospace;font-size:64px;font-weight:800;color:var(--ca);line-height:1;margin:10px 0}
.car-info-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-top:20px}
.car-info-item{background:rgba(0,0,0,.3);border-radius:var(--rm);padding:14px;text-align:center;border:1px solid rgba(245,158,11,.15)}
.car-info-label{font-size:11px;color:var(--t2);font-weight:700;text-transform:uppercase}
.car-info-value{font-family:'JetBrains Mono',monospace;font-size:20px;font-weight:700;color:var(--ca);margin-top:4px}
/* PLAYER PAGE */
.video-wrap{background:#000;border-radius:var(--rl);overflow:hidden;aspect-ratio:16/9;margin-bottom:16px;position:relative}
video{width:100%;height:100%;object-fit:contain}
.audio-art{width:100%;height:180px;border-radius:var(--rl);background:linear-gradient(135deg,var(--ac-d),var(--pu-d));display:flex;align-items:center;justify-content:center;font-size:64px;margin-bottom:16px;position:relative;overflow:hidden}
.audio-art::before{content:'';position:absolute;inset:0;background:linear-gradient(135deg,rgba(0,245,160,.08),rgba(123,97,255,.08));animation:pulse-bg 2s ease-in-out infinite}
@keyframes pulse-bg{0%,100%{opacity:.5}50%{opacity:1}}
.player-seek{width:100%;height:5px;background:var(--bd);border-radius:3px;cursor:pointer;margin:10px 0}
.player-fill{height:100%;background:linear-gradient(90deg,var(--ac),var(--pu));border-radius:3px;width:0%;transition:width .5s linear}
.player-controls{display:flex;align-items:center;justify-content:center;gap:14px;margin:14px 0}
.ctrl-btn{background:transparent;border:1px solid var(--bd);color:var(--t1);border-radius:50%;width:44px;height:44px;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:var(--tr);font-size:16px}
.ctrl-btn:hover{background:var(--card-h);border-color:var(--bd-a)}
.ctrl-btn.play{width:56px;height:56px;background:var(--ac);color:#060610;border:none;font-size:20px}
.ctrl-btn.play:hover{transform:scale(1.05);box-shadow:var(--ac-g)}
.vol-row{display:flex;align-items:center;gap:10px}
.vol-slider{flex:1;height:4px;-webkit-appearance:none;background:var(--bd);border-radius:2px;outline:none;cursor:pointer}
.vol-slider::-webkit-slider-thumb{-webkit-appearance:none;width:14px;height:14px;background:var(--ac);border-radius:50%;cursor:pointer}
/* TL per file display */
.file-tl-info{display:flex;align-items:center;justify-content:space-between;padding:10px 14px;background:var(--ca-d);border:1px solid rgba(245,158,11,.25);border-radius:var(--rm);margin-bottom:12px;font-size:13px}
/* BOTTOM PLAYER BAR */
.player-bar{position:fixed;bottom:0;left:0;right:0;height:72px;background:rgba(6,6,16,.97);backdrop-filter:blur(20px);border-top:1px solid var(--bd);display:flex;align-items:center;padding:0 24px;gap:20px;z-index:500}
.pb-prog{position:absolute;bottom:72px;left:0;right:0;height:3px;background:var(--bd);cursor:pointer}
.pb-prog-fill{height:100%;background:var(--ac);width:0%;transition:width .5s linear}
.pb-track{flex:1;min-width:0;display:flex;align-items:center;gap:12px}
.pb-thumb{width:44px;height:44px;flex-shrink:0;border-radius:8px;background:linear-gradient(135deg,var(--ac-d),var(--pu-d));display:flex;align-items:center;justify-content:center;font-size:20px}
.pb-controls{display:flex;align-items:center;gap:10px}
.pb-right{flex:1;display:flex;justify-content:flex-end;align-items:center;gap:10px}
/* SEARCH BAR */
.search-bar{display:flex;gap:10px;margin-bottom:20px}
.search-input{flex:1;background:rgba(255,255,255,.05);border:1px solid var(--bd);border-radius:var(--rf);padding:12px 20px;font-family:'Syne',sans-serif;font-size:14px;color:var(--t1);outline:none;transition:var(--tr)}
.search-input:focus{border-color:var(--ac);box-shadow:0 0 0 3px rgba(0,245,160,.1)}
.search-input::placeholder{color:var(--t3)}
/* FILTER CHIPS */
.chips{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:16px}
.chip{padding:5px 13px;border-radius:var(--rf);font-size:12px;font-weight:700;cursor:pointer;transition:var(--tr);border:1px solid var(--bd);background:transparent;color:var(--t2);white-space:nowrap}
.chip:hover{border-color:var(--bd-a);color:var(--t1)}
.chip.active{background:var(--ac);color:#060610;border-color:var(--ac)}
.chip.sp-active{background:var(--sp);color:#fff;border-color:var(--sp)}
/* MODAL */
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.78);backdrop-filter:blur(8px);z-index:1000;display:flex;align-items:center;justify-content:center;padding:24px}
.modal{background:#12121f;border:1px solid var(--bd);border-radius:24px;padding:32px;width:100%;max-width:480px;position:relative;animation:slideUp .2s ease;max-height:90vh;overflow-y:auto}
@keyframes slideUp{from{transform:translateY(18px);opacity:0}to{transform:translateY(0);opacity:1}}
.modal-title{font-size:20px;font-weight:800;margin-bottom:20px}
.modal-close{position:absolute;top:18px;right:18px;background:none;border:none;color:var(--t2);cursor:pointer;font-size:20px;line-height:1}
/* AI PLATFORM GRID */
.ai-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:10px;margin-bottom:20px}
.ai-card{padding:16px 12px;border-radius:var(--rm);border:2px solid var(--bd);background:var(--card);cursor:pointer;text-align:center;transition:var(--tr)}
.ai-card:hover{border-color:rgba(255,123,0,.4)}
.ai-card.sel{border-color:var(--su);background:var(--su-d)}
.ai-logo{font-size:28px;margin-bottom:6px}
.ai-name{font-weight:800;font-size:13px}
.ai-type{font-size:11px;color:var(--t2);margin-top:2px}
/* WEATHER */
.weather-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(110px,1fr));gap:8px;margin-bottom:16px}
.wx-card{padding:12px 8px;border-radius:var(--rm);border:2px solid var(--bd);background:var(--card);cursor:pointer;text-align:center;transition:var(--tr)}
.wx-card:hover{border-color:var(--bd-a)}.wx-card.sel{border-color:var(--ac);background:var(--ac-d)}
/* MINE */
.mine-panel{background:linear-gradient(135deg,rgba(123,97,255,.07),transparent);border:1px solid rgba(123,97,255,.25);border-radius:var(--rl);padding:20px}
/* TOAST */
#toast-box{position:fixed;bottom:86px;right:24px;z-index:9999;display:flex;flex-direction:column;gap:8px;pointer-events:none}
.t{padding:11px 16px;border-radius:var(--rm);font-size:13px;font-weight:600;backdrop-filter:blur(20px);border:1px solid var(--bd);animation:ti .25s ease;max-width:300px}
.t.s{background:rgba(0,245,160,.12);color:var(--ac);border-color:rgba(0,245,160,.3)}
.t.e{background:rgba(255,79,79,.12);color:var(--da);border-color:rgba(255,79,79,.3)}
.t.i{background:rgba(123,97,255,.12);color:var(--pu);border-color:rgba(123,97,255,.3)}
@keyframes ti{from{transform:translateX(100%);opacity:0}to{transform:translateX(0);opacity:1}}
.spinner{width:18px;height:18px;border:2px solid rgba(255,255,255,.15);border-top-color:currentColor;border-radius:50%;animation:sp .7s linear infinite;display:inline-block}
@keyframes sp{to{transform:rotate(360deg)}}
/* UTILS */
.mono{font-family:'JetBrains Mono',monospace}.ac{color:var(--ac)}.pu{color:var(--pu)}.mu{color:var(--t2)}.ca{color:var(--ca)}
.hidden{display:none!important}.divider{height:1px;background:var(--bd);margin:18px 0}
.tc{text-align:center}.flex{display:flex}.fb{display:flex;align-items:center;justify-content:space-between}
.ic{align-items:center}.gap-2{gap:8px}.gap-3{gap:12px}.gap-4{gap:16px}
.mt-2{margin-top:8px}.mt-4{margin-top:16px}.mt-6{margin-top:24px}.mb-4{margin-bottom:16px}.mb-6{margin-bottom:24px}
::-webkit-scrollbar{width:6px;height:6px}::-webkit-scrollbar-track{background:transparent}::-webkit-scrollbar-thumb{background:var(--bd);border-radius:3px}
@media(max-width:768px){.page{padding:16px 16px 110px}.stats-grid{grid-template-columns:1fr 1fr}.two-col,.three-col{grid-template-columns:1fr}.car-info-grid{grid-template-columns:1fr 1fr}.bal-row{display:none}.ai-grid{grid-template-columns:repeat(3,1fr)}}
</style>
</head>
<body>
<audio id="aud" preload="none" style="display:none"></audio>
<video id="vid" preload="none" style="display:none" playsinline></video>
<div id="toast-box"></div>
<!-- NAVBAR -->
<nav class="navbar">
  <a class="logo" href="index.html">
    <div class="logo-icon">âš¡</div>
    <span class="logo-text">Time<span>Link</span></span>
  </a>
  <div id="nav-bal" class="bal-row hidden">
    <div class="bal-col"><span class="bal-lbl">TL</span><span class="bal-val" id="nb-tl">0</span></div>
    <div class="bal-sep"></div>
    <div class="bal-col"><span class="bal-lbl">ğŸ”’</span><span class="bal-val locked" id="nb-lo">0</span></div>
    <div class="bal-sep"></div>
    <div class="bal-col"><span class="bal-lbl">TLC</span><span class="bal-val tlc" id="nb-tlc">0.0000</span></div>
  </div>
  <div class="nav-right">
    <span id="car-ind" class="car-ind off">ğŸš— Off</span>
    <span class="mono mu" id="nav-user" style="font-size:13px">Demo</span>
    <button class="btn btn-ghost btn-sm" onclick="openModal('recharge-modal')">ì¶©ì „</button>
    <button class="btn btn-ghost btn-sm" onclick="doLogout()">ë¡œê·¸ì•„ì›ƒ</button>
  </div>
</nav>

<!-- TABS -->
<div class="tabs-bar">
  <button class="tab-btn active" data-tab="dashboard" onclick="switchTab('dashboard')">ğŸ“Š Dashboard</button>
  <button class="tab-btn" data-tab="create"    onclick="switchTab('create')">ğŸ“¤ Create</button>
  <button class="tab-btn" data-tab="library"   onclick="switchTab('library')">ğŸ” Library</button>
  <button class="tab-btn" data-tab="player"    onclick="switchTab('player')">ğŸ¬ Player</button>
  <button class="tab-btn" data-tab="shareplace" onclick="switchTab('shareplace')">ğŸ”„ Share</button>
  <button class="tab-btn" data-tab="radio"     onclick="switchTab('radio')">ğŸ“» Radio</button>
  <button class="tab-btn" data-tab="car"       onclick="switchTab('car')">ğŸš— Car</button>
</div>

<div class="page">
<!-- ========== DASHBOARD ========== -->
<div id="tab-dashboard" class="tab-pane active">
  <div class="np-card mb-6">
    <div class="fb">
      <span class="badge badge-live">NOW PLAYING</span>
      <span class="mono mu" style="font-size:12px">âš¡ <span id="np-pulse">0</span> Pulse</span>
    </div>
    <div style="font-size:17px;font-weight:800;margin:8px 0 2px" id="np-title">â€” ì¬ìƒ ì¤‘ì¸ íŠ¸ë™ ì—†ìŒ</div>
    <div style="font-size:13px;color:var(--t2)" id="np-artist">Libraryì—ì„œ íŠ¸ë™ì„ ì„ íƒí•˜ê±°ë‚˜ Playerì—ì„œ ì§ì ‘ ì¬ìƒí•˜ì„¸ìš”</div>
    <div class="np-seek" id="np-seek" onclick="seekAudio(event)"><div class="np-seek-fill" id="np-fill"></div></div>
    <div class="np-times"><span id="np-cur">0:00</span><span id="np-dur">0:00</span></div>
    <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:10px">
      <span class="badge badge-ac">TL/s: <span id="np-cost">1.0</span></span>
      <span class="badge badge-pu">ë°°ìœ¨: <span id="np-mult">1.0x</span></span>
      <span class="badge badge-ca hidden" id="np-file-tl">íŒŒì¼ TL: â€”</span>
    </div>
  </div>

  <div class="stats-grid mb-6">
    <div class="stat-card">
      <div class="stat-lbl">TL ì”ê³ </div>
      <div class="stat-val ac" id="ds-tl">10,000</div>
      <button class="btn btn-outline btn-sm mt-2" onclick="openModal('recharge-modal')">ì¶©ì „í•˜ê¸°</button>
    </div>
    <div class="stat-card" style="--ac:var(--ca)">
      <div class="stat-lbl">ğŸ”’ Locked TL</div>
      <div class="stat-val lo" id="ds-lo">0</div>
      <div style="font-size:12px;color:var(--t2);margin-top:4px">30ì´ˆë§ˆë‹¤ í•´ì œ</div>
    </div>
    <div class="stat-card" style="--ac:var(--pu)">
      <div class="stat-lbl">TLC ë§ˆì´ë‹</div>
      <div class="stat-val tl" id="ds-tlc">0.0000</div>
      <button class="btn btn-sm mt-2" style="background:var(--pu-d);color:var(--pu);border:1px solid rgba(123,97,255,.3);border-radius:var(--rf);font-family:'Syne',sans-serif;font-weight:700;cursor:pointer;padding:6px 14px;font-size:12px" onclick="claimTLC()">ìˆ˜ë ¹</button>
    </div>
    <div class="stat-card">
      <div class="stat-lbl">ì´ ì²­ì·¨ì‹œê°„</div>
      <div class="stat-val" id="ds-time">0:00</div>
    </div>
  </div>

  <div class="two-col mb-6">
    <div class="card tc">
      <div style="font-weight:800;font-size:15px;margin-bottom:16px">ğŸ”® ì‹ ë¢° ì ìˆ˜</div>
      <div class="trust-svg-wrap">
        <svg width="100" height="100" viewBox="0 0 100 100">
          <circle class="trust-track" cx="50" cy="50" r="42"/>
          <circle class="trust-fill" id="trust-fill-el" cx="50" cy="50" r="42"/>
        </svg>
        <div class="trust-center"><span class="trust-num" id="trust-num">1.00</span><span class="trust-tag">Trust</span></div>
      </div>
      <div style="margin-top:14px;display:flex;flex-direction:column;gap:6px">
        <div class="fb" style="font-size:13px"><span class="mu">LVS</span><span class="mono ac" id="lvs-val">1.00</span></div>
        <div class="fb" style="font-size:13px"><span class="mu">ìµœëŒ€</span><span class="mono">1.20</span></div>
      </div>
    </div>
    <div class="card">
      <div style="font-weight:800;font-size:15px;margin-bottom:14px">âš¡ í˜„ì¬ ë°°ìœ¨</div>
      <div class="tc mb-4">
        <div class="mono" style="font-size:52px;font-weight:800;color:var(--ac);line-height:1" id="rate-big">1.0x</div>
        <div style="font-size:12px;color:var(--t2);margin-top:4px">Trust Ã— LVS Ã— Car</div>
      </div>
      <div class="fb" style="padding:10px 0;border-top:1px solid var(--bd)">
        <div><div style="font-weight:700;font-size:14px">ğŸš— Car Mode</div><div style="font-size:12px;color:var(--t2)">2ë°° ë³´ìƒ</div></div>
        <label class="toggle"><input type="checkbox" id="car-chk" onchange="toggleCar()"><div class="tgl-track"></div><div class="tgl-thumb">ğŸš—</div></label>
      </div>
      <div class="fb" style="padding:10px 0;border-top:1px solid var(--bd);margin-top:8px">
        <div><div style="font-weight:700;font-size:13px">ìë™ ì¶©ì „</div><div style="font-size:12px;color:var(--t2)">TL &lt; 2,000</div></div>
        <label class="toggle"><input type="checkbox" id="auto-chk" checked onchange="S.autoRecharge=this.checked"><div class="tgl-track"></div><div class="tgl-thumb" style="font-size:11px">âš¡</div></label>
      </div>
    </div>
  </div>

  <div class="card mb-6">
    <div style="font-weight:800;font-size:15px;margin-bottom:8px">ğŸ”“ Locked TL í•´ì œ</div>
    <div class="fb" style="font-size:13px;margin-bottom:8px">
      <span>Locked: <span class="mono ca" id="lo-display">0</span> TL</span>
      <span>í•´ì œê¹Œì§€ <span class="mono" id="lo-timer">30s</span></span>
    </div>
    <div class="locked-track"><div class="locked-fill" id="lo-fill"></div></div>
  </div>

  <div class="sec-hd"><div class="sec-title">âš¡ Hot Pulse</div><button class="btn btn-ghost btn-sm" onclick="renderHotPulse()">ìƒˆë¡œê³ ì¹¨</button></div>
  <div id="hot-pulse" style="display:flex;flex-direction:column;gap:8px"></div>
</div>
<!-- ========== CREATE ========== -->
<div id="tab-create" class="tab-pane">

  <!-- AI í”Œë«í¼ ì„ íƒ -->
  <div class="card card-ai mb-4">
    <div class="fb mb-4">
      <div>
        <div class="sec-title">ğŸ¤– AI ìŒì› ë“±ë¡</div>
        <div style="font-size:13px;color:var(--t2);margin-top:3px">ìœ ë£Œ êµ¬ë… AI í”Œë«í¼ì˜ ìƒì„± ìŒì›ì„ TL íŒŒì¼ë¡œ ë³€í™˜í•˜ì„¸ìš”</div>
      </div>
      <span class="badge badge-ai">ìœ ë£Œ íšŒì› ì „ìš©</span>
    </div>

    <!-- AI í”Œë«í¼ ì„ íƒ ê·¸ë¦¬ë“œ -->
    <div style="font-size:11px;color:var(--t2);font-weight:700;text-transform:uppercase;letter-spacing:.5px;margin-bottom:10px">í”Œë«í¼ ì„ íƒ</div>
    <div class="ai-grid" id="ai-platform-grid">
      <div class="ai-card sel" data-ai="suno" onclick="selectAI('suno')">
        <div class="ai-logo">ğŸµ</div><div class="ai-name">Suno</div><div class="ai-type">ìŒì•…</div>
      </div>
      <div class="ai-card" data-ai="udio" onclick="selectAI('udio')">
        <div class="ai-logo">ğŸ¶</div><div class="ai-name">Udio</div><div class="ai-type">ìŒì•…</div>
      </div>
      <div class="ai-card" data-ai="mubert" onclick="selectAI('mubert')">
        <div class="ai-logo">ğŸŒŠ</div><div class="ai-name">Mubert</div><div class="ai-type">ìŒì•…</div>
      </div>
      <div class="ai-card" data-ai="aiva" onclick="selectAI('aiva')">
        <div class="ai-logo">ğŸ»</div><div class="ai-name">AIVA</div><div class="ai-type">í´ë˜ì‹</div>
      </div>
      <div class="ai-card" data-ai="soundraw" onclick="selectAI('soundraw')">
        <div class="ai-logo">ğŸ¸</div><div class="ai-name">Soundraw</div><div class="ai-type">ìŒì•…</div>
      </div>
      <div class="ai-card" data-ai="boomy" onclick="selectAI('boomy')">
        <div class="ai-logo">ğŸ¥</div><div class="ai-name">Boomy</div><div class="ai-type">ìŒì•…</div>
      </div>
      <div class="ai-card" data-ai="elevenlabs" onclick="selectAI('elevenlabs')">
        <div class="ai-logo">ğŸ—£ï¸</div><div class="ai-name">ElevenLabs</div><div class="ai-type">ë³´ì´ìŠ¤</div>
      </div>
      <div class="ai-card" data-ai="beatoven" onclick="selectAI('beatoven')">
        <div class="ai-logo">ğŸ¹</div><div class="ai-name">Beatoven</div><div class="ai-type">ìŒì•…</div>
      </div>
    </div>

    <!-- ìœ ë£Œ êµ¬ë… ì¸ì¦ ì„¹ì…˜ -->
    <div style="background:rgba(255,123,0,.06);border:1px solid rgba(255,123,0,.2);border-radius:var(--rm);padding:18px;margin-bottom:16px">
      <div style="font-weight:800;font-size:14px;margin-bottom:12px">ğŸ“‹ ìœ ë£Œ êµ¬ë… ì¸ì¦ â€” <span id="ai-platform-name" style="color:var(--su)">Suno</span></div>

      <div class="fg">
        <label class="fl">ìƒì„±ëœ ìŒì› URL *</label>
        <input type="text" id="ai-url" class="fi ai-focus" placeholder="https://suno.com/song/...  ë˜ëŠ” í”Œë«í¼ ìŒì› ë§í¬">
      </div>

      <div class="two-col">
        <div class="fg" style="margin-bottom:0">
          <label class="fl">í”Œëœ ì¢…ë¥˜</label>
          <select id="ai-plan" class="fi ai-focus">
            <option value="">ì„ íƒ</option>
            <option>Pro</option>
            <option>Premier</option>
            <option>Professional</option>
            <option>Creator</option>
            <option>Business</option>
            <option>Enterprise</option>
          </select>
        </div>
        <div class="fg" style="margin-bottom:0">
          <label class="fl">êµ¬ë… ê¸°ê°„</label>
          <input type="month" id="ai-month" class="fi ai-focus">
        </div>
      </div>
    </div>

    <!-- ì¸ì¦ ìë£Œ ì—…ë¡œë“œ -->
    <div style="font-size:11px;color:var(--t2);font-weight:700;text-transform:uppercase;letter-spacing:.5px;margin-bottom:10px">ì¸ì¦ ìë£Œ (1ê°œ ì´ìƒ í•„ìˆ˜)</div>
    <div class="three-col" style="margin-bottom:16px">
      <!-- ì˜ìˆ˜ì¦ ì´ë¯¸ì§€ -->
      <div id="proof-img-zone" style="border:2px dashed var(--bd);border-radius:var(--rm);padding:18px;text-align:center;cursor:pointer;transition:var(--tr)"
        onclick="document.getElementById('proof-img-input').click()"
        ondragover="event.preventDefault();this.style.borderColor='var(--su)'"
        ondragleave="this.style.borderColor='var(--bd)'"
        ondrop="onProofImgDrop(event)">
        <div style="font-size:28px;margin-bottom:6px">ğŸ§¾</div>
        <div style="font-size:12px;font-weight:700">ê²°ì œ ì˜ìˆ˜ì¦</div>
        <div style="font-size:11px;color:var(--t2);margin-top:3px">ì´ë¯¸ì§€ / PDF</div>
        <input type="file" id="proof-img-input" accept="image/*,.pdf" style="display:none" onchange="onProofImgSelect(this.files[0])">
        <div id="proof-img-name" style="font-size:11px;color:var(--ac);margin-top:6px"></div>
      </div>
      <!-- êµ¬ê¸€ ì˜ìˆ˜ì¦ ì´ë©”ì¼ -->
      <div style="border:2px dashed var(--bd);border-radius:var(--rm);padding:18px;text-align:center">
        <div style="font-size:28px;margin-bottom:6px">ğŸ“§</div>
        <div style="font-size:12px;font-weight:700;margin-bottom:8px">êµ¬ê¸€ ê²°ì œ ì´ë©”ì¼</div>
        <input type="email" id="google-receipt-email" class="fi ai-focus" style="font-size:12px;padding:8px 12px" placeholder="ê²°ì œ ì´ë©”ì¼ ì£¼ì†Œ">
        <div style="font-size:11px;color:var(--t2);margin-top:4px">Google Pay / Gmail ì˜ìˆ˜ì¦</div>
      </div>
      <!-- ê¸°íƒ€ ê²°ì œ ì¦ë¹™ -->
      <div id="proof-doc-zone" style="border:2px dashed var(--bd);border-radius:var(--rm);padding:18px;text-align:center;cursor:pointer;transition:var(--tr)"
        onclick="document.getElementById('proof-doc-input').click()">
        <div style="font-size:28px;margin-bottom:6px">ğŸ“„</div>
        <div style="font-size:12px;font-weight:700">ê¸°íƒ€ ì¦ë¹™</div>
        <div style="font-size:11px;color:var(--t2);margin-top:3px">ìº¡ì²˜ / ë¬¸ì„œ</div>
        <input type="file" id="proof-doc-input" accept="image/*,.pdf,.txt" style="display:none" onchange="onProofDocSelect(this.files[0])">
        <div id="proof-doc-name" style="font-size:11px;color:var(--ac);margin-top:6px"></div>
      </div>
    </div>

    <!-- AI ìŒì› ë¯¸ë¦¬ë³´ê¸° -->
    <div id="ai-preview-box" class="hidden" style="background:rgba(0,0,0,.35);border-radius:var(--rm);padding:18px;margin-bottom:14px">
      <div style="display:flex;gap:16px;align-items:flex-start">
        <div style="width:80px;height:80px;flex-shrink:0;border-radius:var(--rm);background:linear-gradient(135deg,var(--su-d),var(--pu-d));display:flex;align-items:center;justify-content:center;font-size:32px" id="ai-prev-icon">ğŸµ</div>
        <div style="flex:1">
          <div style="font-size:17px;font-weight:800" id="ai-prev-title">â€”</div>
          <div style="font-size:13px;color:var(--t2);margin-top:3px" id="ai-prev-artist">â€”</div>
          <div style="display:flex;gap:14px;flex-wrap:wrap;margin-top:10px">
            <div><div style="font-size:10px;color:var(--t2);font-weight:700;text-transform:uppercase">ê¸¸ì´</div><div class="mono" style="font-size:13px;font-weight:700" id="ai-prev-dur">â€”</div></div>
            <div><div style="font-size:10px;color:var(--t2);font-weight:700;text-transform:uppercase">í”Œë«í¼</div><div class="mono" style="font-size:13px;font-weight:700;color:var(--su)" id="ai-prev-plat">â€”</div></div>
            <div><div style="font-size:10px;color:var(--t2);font-weight:700;text-transform:uppercase">ì „í™˜ ë³´ìƒ</div><div class="mono" style="font-size:13px;font-weight:700;color:var(--ac)">+1,000 TL</div></div>
          </div>
        </div>
      </div>
      <div style="display:flex;gap:10px;justify-content:flex-end;margin-top:14px">
        <button class="btn btn-ghost btn-sm" onclick="cancelAIPreview()">ì·¨ì†Œ</button>
        <button class="btn btn-ai btn-sm" onclick="convertAI()">âœ¨ TL íŒŒì¼ë¡œ ë³€í™˜</button>
      </div>
    </div>
    <div id="ai-error-box" class="hidden" style="background:rgba(255,79,79,.07);border:1px solid rgba(255,79,79,.25);border-radius:var(--rm);padding:12px;font-size:13px;color:var(--da);margin-bottom:12px"></div>
    <div id="ai-loading" class="hidden tc" style="padding:16px"><div class="spinner" style="margin:0 auto;color:var(--su)"></div><div style="font-size:13px;color:var(--t2);margin-top:8px">í”Œë«í¼ ì¸ì¦ í™•ì¸ ì¤‘...</div></div>
    <button class="btn btn-ai w-full" id="ai-verify-btn" onclick="aiVerify()">ğŸ” êµ¬ë… ì¸ì¦ ë° ìŒì› ê°€ì ¸ì˜¤ê¸°</button>
  </div>

  <!-- ì§ì ‘ ì—…ë¡œë“œ -->
  <div class="card">
    <div class="sec-title mb-4">ğŸ“¤ ì§ì ‘ ì—…ë¡œë“œ</div>
    <div class="two-col" style="margin-bottom:18px">
      <div id="type-audio" style="padding:14px;border-radius:var(--rm);border:2px solid var(--bd-a);background:var(--ac-d);cursor:pointer;text-align:center;transition:var(--tr)" onclick="selectType('audio')">
        <div style="font-size:26px">ğŸµ</div><div style="font-weight:700;margin-top:5px">TL3 Audio</div><div style="font-size:12px;color:var(--t2)">MP3, WAV, FLAC, OGG</div>
      </div>
      <div id="type-video" style="padding:14px;border-radius:var(--rm);border:2px solid var(--bd);background:var(--card);cursor:pointer;text-align:center;transition:var(--tr)" onclick="selectType('video')">
        <div style="font-size:26px">ğŸ¬</div><div style="font-weight:700;margin-top:5px">TL4 Video</div><div style="font-size:12px;color:var(--t2)">MP4, MOV, WebM</div>
      </div>
    </div>

    <div id="upload-zone" class="drop-zone" onclick="document.getElementById('file-input').click()"
      ondragover="event.preventDefault();this.classList.add('over')" ondragleave="this.classList.remove('over')" ondrop="onDrop(event)">
      <div class="drop-zone-icon">ğŸ“‚</div>
      <div class="drop-zone-title">ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•˜ì—¬ íŒŒì¼ ì„ íƒ</div>
      <div class="drop-zone-sub">ì˜¤ë””ì˜¤ / ì˜ìƒ Â· ìµœëŒ€ 500MB</div>
      <input type="file" id="file-input" accept="audio/*,video/*" style="display:none" onchange="onFileSelect(this.files[0])">
    </div>
    <div id="file-prev" class="file-preview hidden">
      <span style="font-size:22px" id="fp-icon">ğŸµ</span>
      <div style="flex:1;min-width:0">
        <div class="fp-name" id="fp-name">â€”</div>
        <div style="font-size:12px;color:var(--t2)" id="fp-size">â€”</div>
      </div>
      <button class="btn btn-ghost btn-sm" onclick="removeFile()">âœ•</button>
    </div>

    <div style="display:flex;flex-direction:column;gap:12px;margin-top:14px">
      <div class="fg"><label class="fl">ì œëª© *</label><input type="text" id="up-title" class="fi" placeholder="íŠ¸ë™ / ì˜ìƒ ì œëª©"></div>
      <div class="two-col">
        <div class="fg" style="margin-bottom:0">
          <label class="fl">ë¯¸ë””ì–´ ìœ í˜•</label>
          <select id="up-cat" class="fi">
            <optgroup label="ğŸµ ìŒì•…">
              <option value="music-kpop">K-POP</option>
              <option value="music-hiphop">Hip-Hop</option>
              <option value="music-rnb">R&B</option>
              <option value="music-electronic">Electronic</option>
              <option value="music-rock">Rock</option>
              <option value="music-jazz">Jazz</option>
              <option value="music-classical">Classical</option>
              <option value="music-indie">Indie</option>
              <option value="music-chill">Chill</option>
              <option value="music-etc">ê¸°íƒ€ ìŒì•…</option>
            </optgroup>
            <optgroup label="ğŸ¬ ì˜ìƒ">
              <option value="video-mv">ë®¤ì§ë¹„ë””ì˜¤</option>
              <option value="video-travel">ì—¬í–‰ Â· ë¸Œì´ë¡œê·¸</option>
              <option value="video-movie">ì˜í™” Â· ë‹¨í¸</option>
              <option value="video-doc">ë‹¤íë©˜í„°ë¦¬</option>
              <option value="video-lecture-lang">ê°•ì˜ â€“ ì–¸ì–´</option>
              <option value="video-lecture-coding">ê°•ì˜ â€“ í”„ë¡œê·¸ë˜ë°</option>
              <option value="video-lecture-science">ê°•ì˜ â€“ ê³¼í•™</option>
              <option value="video-lecture-biz">ê°•ì˜ â€“ ê²½ì˜Â·ë¹„ì¦ˆë‹ˆìŠ¤</option>
              <option value="video-lecture-art">ê°•ì˜ â€“ ì˜ˆìˆ </option>
              <option value="video-lecture-etc">ê°•ì˜ â€“ ê¸°íƒ€</option>
              <option value="video-comedy">ì½”ë¯¸ë””</option>
              <option value="video-sports">ìŠ¤í¬ì¸  Â· í”¼íŠ¸ë‹ˆìŠ¤</option>
              <option value="video-food">ìŒì‹ Â· ì¿ í‚¹</option>
              <option value="video-beauty">ë·°í‹° Â· íŒ¨ì…˜</option>
              <option value="video-gaming">ê²Œì„</option>
              <option value="video-news">ë‰´ìŠ¤ Â· ì‹œì‚¬</option>
              <option value="video-kids">ì–´ë¦°ì´ Â· ì• ë‹ˆ</option>
              <option value="video-etc">ê¸°íƒ€ ì˜ìƒ</option>
            </optgroup>
          </select>
        </div>
        <div class="fg" style="margin-bottom:0">
          <label class="fl">ìˆ˜ìµ ëª¨ë¸</label>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
            <div id="m73" style="padding:10px;border-radius:var(--rm);background:var(--ac-d);border:2px solid var(--bd-a);cursor:pointer;text-align:center;transition:var(--tr)" onclick="selectModel('7-3')">
              <div style="font-weight:800;font-size:14px">7:3</div><div style="font-size:11px;color:var(--t2)">70% ì¦‰ì‹œ TL</div>
            </div>
            <div id="m55" style="padding:10px;border-radius:var(--rm);background:var(--card);border:2px solid var(--bd);cursor:pointer;text-align:center;transition:var(--tr)" onclick="selectModel('5-5')">
              <div style="font-weight:800;font-size:14px">5:5</div><div style="font-size:11px;color:var(--t2)">50% TLC ì±„êµ´</div>
            </div>
          </div>
        </div>
      </div>
      <!-- íŒŒì¼ì— TL ì¶©ì „ -->
      <div style="background:rgba(245,158,11,.07);border:1px solid rgba(245,158,11,.22);border-radius:var(--rm);padding:14px">
        <div style="font-size:13px;font-weight:700;margin-bottom:8px">ğŸ’° íŒŒì¼ì— TL ì¶©ì „ <span style="font-weight:400;font-size:12px;color:var(--t2)">(ì²­ì·¨ìê°€ ì´ TLì„ ì†Œëª¨í•˜ë©° ì¬ìƒ)</span></div>
        <div style="display:flex;gap:8px;align-items:center">
          <input type="number" id="up-file-tl" class="fi" style="flex:1;padding:10px 14px" value="1000" min="100" max="100000" placeholder="ì¶©ì „í•  TL">
          <div style="display:flex;gap:6px">
            <button class="btn btn-ghost btn-sm" onclick="document.getElementById('up-file-tl').value=500">500</button>
            <button class="btn btn-ghost btn-sm" onclick="document.getElementById('up-file-tl').value=1000">1K</button>
            <button class="btn btn-ghost btn-sm" onclick="document.getElementById('up-file-tl').value=5000">5K</button>
          </div>
        </div>
        <div style="font-size:12px;color:var(--t2);margin-top:6px">ë‚´ ì”ê³ : <span class="mono ac" id="up-my-tl">10,000</span> TL</div>
      </div>
    </div>
    <button id="up-btn" class="btn btn-primary w-full mt-4" disabled onclick="doUpload()">íŒŒì¼ì„ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”</button>
  </div>
</div>
<!-- ========== LIBRARY ========== -->
<div id="tab-library" class="tab-pane">

  <!-- ê²€ìƒ‰ ì—”ì§„ -->
  <div class="card mb-4">
    <div class="fb mb-3">
      <div class="sec-title">ğŸ” ê²€ìƒ‰</div>
      <div style="display:flex;gap:8px">
        <button class="btn btn-sm" id="eng-tl-btn" style="background:var(--ac);color:#060610;border-radius:var(--rf);font-family:'Syne',sans-serif;font-weight:700;cursor:pointer;padding:6px 14px;font-size:12px" onclick="setEngine('tl')">âš¡ TimeLink</button>
        <button class="btn btn-ghost btn-sm" id="eng-sp-btn" onclick="setEngine('spotify')">ğŸµ Spotify</button>
      </div>
    </div>

    <div class="search-bar">
      <input type="text" id="lib-search" class="search-input" placeholder="ì œëª©, ì•„í‹°ìŠ¤íŠ¸, ì¥ë¥´, ì–¸ì–´ë¡œ ê²€ìƒ‰..." onkeydown="if(event.key==='Enter')doSearch()">
      <button class="btn btn-primary" onclick="doSearch()">ê²€ìƒ‰</button>
    </div>

    <!-- TimeLink í•„í„° -->
    <div id="tl-filters">
      <!-- ë¯¸ë””ì–´ íƒ€ì… -->
      <div style="font-size:11px;color:var(--t2);font-weight:700;text-transform:uppercase;letter-spacing:.5px;margin-bottom:6px">ë¯¸ë””ì–´</div>
      <div class="chips mb-4">
        <span class="chip active" data-mtype="all" onclick="setMtype('all')">ì „ì²´</span>
        <span class="chip" data-mtype="audio" onclick="setMtype('audio')">ğŸµ ìŒì•…</span>
        <span class="chip" data-mtype="video" onclick="setMtype('video')">ğŸ¬ ì˜ìƒ</span>
      </div>

      <!-- ìŒì•… ì¥ë¥´ (êµ­ê°€ë³„) â€” ìŒì•… ì„ íƒ ì‹œ í‘œì‹œ -->
      <div id="music-filters">
        <div style="font-size:11px;color:var(--t2);font-weight:700;text-transform:uppercase;letter-spacing:.5px;margin-bottom:6px">êµ­ê°€ Â· ì¥ë¥´</div>
        <div class="chips mb-3">
          <span class="chip active" data-country="all" onclick="setCountry('all')">ğŸŒ ì „ì²´</span>
          <span class="chip" data-country="kr" onclick="setCountry('kr')">ğŸ‡°ğŸ‡· í•œêµ­</span>
          <span class="chip" data-country="jp" onclick="setCountry('jp')">ğŸ‡¯ğŸ‡µ ì¼ë³¸</span>
          <span class="chip" data-country="us" onclick="setCountry('us')">ğŸ‡ºğŸ‡¸ ë¯¸êµ­</span>
          <span class="chip" data-country="uk" onclick="setCountry('uk')">ğŸ‡¬ğŸ‡§ ì˜êµ­</span>
          <span class="chip" data-country="eu" onclick="setCountry('eu')">ğŸ‡ªğŸ‡º ìœ ëŸ½</span>
          <span class="chip" data-country="latin" onclick="setCountry('latin')">ğŸ’ƒ ë¼í‹´</span>
          <span class="chip" data-country="afr" onclick="setCountry('afr')">ğŸŒ ì•„í”„ë¦¬ì¹´</span>
          <span class="chip" data-country="world" onclick="setCountry('world')">ğŸŒ ê¸°íƒ€</span>
        </div>
        <div class="chips mb-3" id="genre-chips">
          <!-- ë™ì  ìƒì„± -->
        </div>

        <!-- ë‚ ì”¨ ê¸°ë°˜ AI ê²€ìƒ‰ -->
        <div style="background:rgba(123,97,255,.07);border:1px solid rgba(123,97,255,.2);border-radius:var(--rm);padding:14px;margin-bottom:10px">
          <div style="font-weight:800;font-size:13px;margin-bottom:10px">ğŸŒ¤ï¸ AI ë‚ ì”¨ ê¸°ë°˜ ìŒì•… ì¶”ì²œ <span class="badge badge-pu" style="font-size:10px;margin-left:4px">AI</span></div>
          <div class="weather-grid" id="weather-grid">
            <div class="wx-card" data-wx="sunny" onclick="setWeather('sunny')"><div style="font-size:22px">â˜€ï¸</div><div style="font-size:11px;font-weight:700;margin-top:4px">ë§‘ìŒ</div></div>
            <div class="wx-card" data-wx="rainy" onclick="setWeather('rainy')"><div style="font-size:22px">ğŸŒ§ï¸</div><div style="font-size:11px;font-weight:700;margin-top:4px">ë¹„</div></div>
            <div class="wx-card" data-wx="cloudy" onclick="setWeather('cloudy')"><div style="font-size:22px">â˜ï¸</div><div style="font-size:11px;font-weight:700;margin-top:4px">íë¦¼</div></div>
            <div class="wx-card" data-wx="snowy" onclick="setWeather('snowy')"><div style="font-size:22px">â„ï¸</div><div style="font-size:11px;font-weight:700;margin-top:4px">ëˆˆ</div></div>
            <div class="wx-card" data-wx="stormy" onclick="setWeather('stormy')"><div style="font-size:22px">â›ˆï¸</div><div style="font-size:11px;font-weight:700;margin-top:4px">í­í’</div></div>
            <div class="wx-card" data-wx="night" onclick="setWeather('night')"><div style="font-size:22px">ğŸŒ™</div><div style="font-size:11px;font-weight:700;margin-top:4px">ë§‘ì€ ë°¤</div></div>
            <div class="wx-card" data-wx="hot" onclick="setWeather('hot')"><div style="font-size:22px">ğŸŒ¡ï¸</div><div style="font-size:11px;font-weight:700;margin-top:4px">ë”ìœ„</div></div>
            <div class="wx-card" data-wx="cold" onclick="setWeather('cold')"><div style="font-size:22px">ğŸ¥¶</div><div style="font-size:11px;font-weight:700;margin-top:4px">ì¶”ìœ„</div></div>
          </div>
          <div id="wx-ai-result" class="hidden" style="margin-top:8px;font-size:13px;color:var(--pu);background:var(--pu-d);border-radius:var(--rs);padding:10px;line-height:1.5"></div>
        </div>
      </div>

      <!-- ì˜ìƒ í•„í„° -->
      <div id="video-filters" class="hidden">
        <div style="font-size:11px;color:var(--t2);font-weight:700;text-transform:uppercase;letter-spacing:.5px;margin-bottom:6px">ì˜ìƒ ë¶„ë¥˜</div>
        <div class="chips mb-3">
          <span class="chip active" data-vcat="all" onclick="setVcat('all')">ì „ì²´</span>
          <span class="chip" data-vcat="mv" onclick="setVcat('mv')">ğŸ¬ ë®¤ì§ë¹„ë””ì˜¤</span>
          <span class="chip" data-vcat="travel" onclick="setVcat('travel')">âœˆï¸ ì—¬í–‰Â·ë¸Œì´ë¡œê·¸</span>
          <span class="chip" data-vcat="movie" onclick="setVcat('movie')">ğŸï¸ ì˜í™”Â·ë‹¨í¸</span>
          <span class="chip" data-vcat="doc" onclick="setVcat('doc')">ğŸ“½ï¸ ë‹¤í</span>
          <span class="chip" data-vcat="comedy" onclick="setVcat('comedy')">ğŸ˜‚ ì½”ë¯¸ë””</span>
          <span class="chip" data-vcat="sports" onclick="setVcat('sports')">âš½ ìŠ¤í¬ì¸ </span>
          <span class="chip" data-vcat="food" onclick="setVcat('food')">ğŸœ ìŒì‹Â·ì¿ í‚¹</span>
          <span class="chip" data-vcat="gaming" onclick="setVcat('gaming')">ğŸ® ê²Œì„</span>
          <span class="chip" data-vcat="news" onclick="setVcat('news')">ğŸ“° ë‰´ìŠ¤</span>
          <span class="chip" data-vcat="kids" onclick="setVcat('kids')">ğŸ‘¶ ì–´ë¦°ì´</span>
        </div>
        <!-- ê°•ì˜ ì„¸ë¶„í™” -->
        <div style="font-size:11px;color:var(--t2);font-weight:700;text-transform:uppercase;letter-spacing:.5px;margin-bottom:6px">ğŸ“š ê°•ì˜ ì¹´í…Œê³ ë¦¬</div>
        <div class="chips">
          <span class="chip" data-vcat="lecture-all" onclick="setVcat('lecture-all')">ğŸ“š ì „ì²´ ê°•ì˜</span>
          <span class="chip" data-vcat="lecture-lang" onclick="setVcat('lecture-lang')">ğŸ—£ï¸ ì–¸ì–´Â·ì™¸êµ­ì–´</span>
          <span class="chip" data-vcat="lecture-coding" onclick="setVcat('lecture-coding')">ğŸ’» í”„ë¡œê·¸ë˜ë°</span>
          <span class="chip" data-vcat="lecture-science" onclick="setVcat('lecture-science')">ğŸ”¬ ê³¼í•™Â·ìˆ˜í•™</span>
          <span class="chip" data-vcat="lecture-biz" onclick="setVcat('lecture-biz')">ğŸ“Š ê²½ì˜Â·ë§ˆì¼€íŒ…</span>
          <span class="chip" data-vcat="lecture-art" onclick="setVcat('lecture-art')">ğŸ¨ ì˜ˆìˆ Â·ë””ìì¸</span>
          <span class="chip" data-vcat="lecture-health" onclick="setVcat('lecture-health')">ğŸ¥ ì˜ë£ŒÂ·ê±´ê°•</span>
          <span class="chip" data-vcat="lecture-music" onclick="setVcat('lecture-music')">ğŸµ ìŒì•…Â·ì•…ê¸°</span>
          <span class="chip" data-vcat="lecture-law" onclick="setVcat('lecture-law')">âš–ï¸ ë²•í•™</span>
          <span class="chip" data-vcat="lecture-history" onclick="setVcat('lecture-history')">ğŸ“œ ì—­ì‚¬Â·ì¸ë¬¸</span>
          <span class="chip" data-vcat="lecture-finance" onclick="setVcat('lecture-finance')">ğŸ’° ê¸ˆìœµÂ·íˆ¬ì</span>
          <span class="chip" data-vcat="lecture-kids" onclick="setVcat('lecture-kids')">ğŸ§’ ì–´ë¦°ì´ êµìœ¡</span>
        </div>
      </div>
    </div>

    <!-- Spotify í•„í„° -->
    <div id="sp-filters" class="hidden">
      <div class="chips mb-2">
        <span class="chip sp-active">ğŸµ íŠ¸ë™</span>
        <span class="chip" onclick="toast('ì•¨ë²” ê²€ìƒ‰ì€ Spotify API ì—°ê²° í›„ ì§€ì›ë©ë‹ˆë‹¤','i')">ğŸ’¿ ì•¨ë²”</span>
        <span class="chip" onclick="toast('ì•„í‹°ìŠ¤íŠ¸ ê²€ìƒ‰ì€ Spotify API ì—°ê²° í›„ ì§€ì›ë©ë‹ˆë‹¤','i')">ğŸ¤ ì•„í‹°ìŠ¤íŠ¸</span>
        <span class="chip" onclick="toast('í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ê²€ìƒ‰ì€ Spotify API ì—°ê²° í›„ ì§€ì›ë©ë‹ˆë‹¤','i')">ğŸ“‹ í”Œë ˆì´ë¦¬ìŠ¤íŠ¸</span>
      </div>
      <div style="background:var(--sp-d);border:1px solid rgba(29,185,84,.2);border-radius:var(--rm);padding:10px 14px;font-size:13px;color:var(--t2)">
        â„¹ï¸ Spotify ê²€ìƒ‰ ê²°ê³¼ëŠ” ë¯¸ë¦¬ë³´ê¸°(30ì´ˆ)ë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤. ì „ì²´ ì¬ìƒì€ Spotify ì•±ì—ì„œ ì´ìš©í•˜ì„¸ìš”.
      </div>
    </div>
  </div>

  <!-- ê²€ìƒ‰ ê²°ê³¼ / ë‚´ íŒŒì¼ -->
  <div class="sec-hd">
    <div class="sec-title" id="lib-result-title">ë‚´ íŒŒì¼</div>
    <div style="display:flex;gap:8px">
      <button class="btn btn-ghost btn-sm" onclick="renderMyFiles()">ìƒˆë¡œê³ ì¹¨</button>
      <button class="btn btn-primary btn-sm" onclick="switchTab('create')">+ ì—…ë¡œë“œ</button>
    </div>
  </div>

  <!-- í†µê³„ -->
  <div class="stats-grid mb-4">
    <div class="stat-card"><div class="stat-lbl">ë‚´ íŒŒì¼</div><div class="stat-val" id="lib-cnt">0</div></div>
    <div class="stat-card"><div class="stat-lbl">ì´ Pulse</div><div class="stat-val ac" id="lib-pulse">0</div></div>
    <div class="stat-card" style="--ac:var(--pu)"><div class="stat-lbl">TLC ì”ê³ </div><div class="stat-val tl" id="lib-tlc">0</div></div>
    <div class="stat-card"><div class="stat-lbl">ë§ˆì´ë‹ ì†ë„</div><div class="stat-val" style="font-size:16px">0.001 TLC/s</div></div>
  </div>

  <!-- Mining panel -->
  <div class="mine-panel mb-4">
    <div class="fb" style="flex-wrap:wrap;gap:12px">
      <div style="display:flex;align-items:center;gap:12px">
        <span style="font-size:22px">â›ï¸</span>
        <div>
          <div style="font-weight:800;font-size:15px">TLC ë§ˆì´ë‹</div>
          <div style="font-size:12px;color:var(--t2)">ì¬ìƒ ì‹œê°„ì´ TLCë¡œ ì±„êµ´ë©ë‹ˆë‹¤</div>
        </div>
        <span class="badge badge-live">MINING</span>
      </div>
      <div style="display:flex;align-items:center;gap:20px">
        <div class="tc">
          <div style="font-size:11px;color:var(--t2)">ìˆ˜ë ¹ ê°€ëŠ¥</div>
          <div class="mono" style="font-size:26px;font-weight:700;color:var(--ac)" id="mine-pending">0.0000</div>
          <div style="font-size:11px;color:var(--t2)">TLC</div>
        </div>
        <button class="btn btn-primary" onclick="claimTLC()">ìˆ˜ë ¹í•˜ê¸°</button>
      </div>
    </div>
  </div>

  <div id="lib-results" style="display:flex;flex-direction:column;gap:8px"></div>
</div>
<!-- ========== PLAYER ========== -->
<div id="tab-player" class="tab-pane">

  <!-- Player type sub-tabs -->
  <div style="display:flex;gap:8px;margin-bottom:20px">
    <button class="btn btn-primary" id="plytype-audio" onclick="setPlayerType('audio')">ğŸµ ìŒì•… í”Œë ˆì´ì–´</button>
    <button class="btn btn-ghost" id="plytype-video" onclick="setPlayerType('video')">ğŸ¬ ì˜ìƒ í”Œë ˆì´ì–´</button>
  </div>

  <!-- ===== AUDIO PLAYER ===== -->
  <div id="audio-player-sec">
    <div class="card card-ac mb-4">
      <!-- ì•¨ë²” ì•„íŠ¸ + íŒŒí˜• ì‹œê°í™” -->
      <div class="audio-art" id="audio-art">
        <span id="audio-art-icon" style="font-size:64px">ğŸµ</span>
        <div style="position:absolute;bottom:12px;left:50%;transform:translateX(-50%);display:flex;gap:3px;align-items:flex-end" id="eq-bars">
          <div style="width:3px;background:var(--ac);border-radius:2px;animation:eq1 .8s ease-in-out infinite;opacity:.7" class="eq-bar"></div>
          <div style="width:3px;background:var(--ac);border-radius:2px;animation:eq2 .6s ease-in-out infinite;opacity:.7" class="eq-bar"></div>
          <div style="width:3px;background:var(--ac);border-radius:2px;animation:eq3 .9s ease-in-out infinite;opacity:.7" class="eq-bar"></div>
          <div style="width:3px;background:var(--ac);border-radius:2px;animation:eq1 .7s ease-in-out infinite;opacity:.7" class="eq-bar"></div>
          <div style="width:3px;background:var(--ac);border-radius:2px;animation:eq2 .5s ease-in-out infinite;opacity:.7" class="eq-bar"></div>
          <div style="width:3px;background:var(--ac);border-radius:2px;animation:eq3 .8s ease-in-out infinite;opacity:.7" class="eq-bar"></div>
          <div style="width:3px;background:var(--ac);border-radius:2px;animation:eq1 .6s ease-in-out infinite;opacity:.7" class="eq-bar"></div>
          <div style="width:3px;background:var(--ac);border-radius:2px;animation:eq2 .9s ease-in-out infinite;opacity:.7" class="eq-bar"></div>
        </div>
      </div>
      <style>
        .eq-bar{height:12px}
        @keyframes eq1{0%,100%{height:6px}50%{height:22px}}
        @keyframes eq2{0%,100%{height:18px}50%{height:8px}}
        @keyframes eq3{0%,100%{height:12px}50%{height:28px}}
        #eq-bars.paused .eq-bar{animation-play-state:paused}
      </style>

      <div class="tc" style="margin-bottom:4px">
        <div style="font-size:20px;font-weight:800" id="aud-title">â€” ì„ íƒëœ íŠ¸ë™ ì—†ìŒ</div>
        <div style="font-size:14px;color:var(--t2);margin-top:4px" id="aud-artist">Libraryì—ì„œ íŠ¸ë™ì„ ì„ íƒí•˜ì„¸ìš”</div>
      </div>

      <!-- íŒŒì¼ TL ì”ê³  -->
      <div class="file-tl-info" id="aud-file-tl-row">
        <div>
          <span style="font-weight:700">ğŸ’° íŒŒì¼ TL</span>
          <span style="font-size:12px;color:var(--t2);margin-left:6px">ì´ TLì´ ì†Œëª¨ë˜ë©° ì¬ìƒ</span>
        </div>
        <div style="display:flex;align-items:center;gap:10px">
          <div class="mono" style="font-size:18px;font-weight:800;color:var(--ca)" id="aud-ftl">â€”</div>
          <button class="btn btn-ghost btn-sm" onclick="openModal('recharge-file-modal')">ì¶©ì „</button>
        </div>
      </div>
      <div class="file-tl-bar" id="aud-ftl-bar"><div class="file-tl-fill" id="aud-ftl-fill" style="width:100%"></div></div>

      <!-- Seek bar -->
      <div class="player-seek" id="aud-seek" onclick="seekByClick(event,'audio')">
        <div class="player-fill" id="aud-seek-fill"></div>
      </div>
      <div style="display:flex;justify-content:space-between;font-family:'JetBrains Mono',monospace;font-size:12px;color:var(--t2);margin-bottom:12px">
        <span id="aud-cur">0:00</span><span id="aud-dur">0:00</span>
      </div>

      <!-- Controls -->
      <div class="player-controls">
        <button class="ctrl-btn" onclick="skipAudio(-10)" title="10ì´ˆ ë’¤ë¡œ">â®</button>
        <button class="ctrl-btn" onclick="toggleShuffle()" id="shuf-btn" title="ì…”í”Œ">ğŸ”€</button>
        <button class="ctrl-btn play" id="aud-play-btn" onclick="toggleAudio()">â–¶</button>
        <button class="ctrl-btn" onclick="toggleLoop()" id="loop-btn" title="ë°˜ë³µ">ğŸ”</button>
        <button class="ctrl-btn" onclick="skipAudio(10)" title="10ì´ˆ ì•ìœ¼ë¡œ">â­</button>
      </div>

      <!-- Volume + Speed -->
      <div class="vol-row mb-2">
        <span style="font-size:16px">ğŸ”ˆ</span>
        <input type="range" id="aud-vol" class="vol-slider" min="0" max="100" value="80" oninput="setAudVol(this.value)">
        <span class="mono mu" style="font-size:12px;width:34px" id="aud-vol-lbl">80%</span>
      </div>
      <div class="vol-row">
        <span style="font-size:13px;color:var(--t2)">ë°°ì†</span>
        <div style="display:flex;gap:6px;margin-left:8px">
          <button class="btn btn-ghost btn-sm" id="speed-05" onclick="setSpeed(0.5)">0.5x</button>
          <button class="btn btn-ghost btn-sm" id="speed-1" onclick="setSpeed(1)" style="border-color:var(--bd-a);color:var(--ac)">1x</button>
          <button class="btn btn-ghost btn-sm" id="speed-15" onclick="setSpeed(1.5)">1.5x</button>
          <button class="btn btn-ghost btn-sm" id="speed-2" onclick="setSpeed(2)">2x</button>
        </div>
      </div>
    </div>

    <!-- í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ -->
    <div class="sec-hd"><div class="sec-title">í”Œë ˆì´ë¦¬ìŠ¤íŠ¸</div></div>
    <div id="audio-playlist" style="display:flex;flex-direction:column;gap:8px"></div>
  </div>

  <!-- ===== VIDEO PLAYER ===== -->
  <div id="video-player-sec" class="hidden">
    <div class="card" style="padding:0;overflow:hidden;border-radius:var(--rl);margin-bottom:16px">
      <div class="video-wrap">
        <video id="vid-el" controls playsinline preload="metadata"
          style="width:100%;height:100%;object-fit:contain;background:#000">
        </video>
        <div id="vid-overlay" style="position:absolute;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.6);cursor:pointer;border-radius:var(--rl)" onclick="startVideo()">
          <div style="width:72px;height:72px;border-radius:50%;background:var(--ac);display:flex;align-items:center;justify-content:center;font-size:28px;color:#060610">â–¶</div>
        </div>
      </div>
    </div>

    <div class="card card-ac mb-4">
      <div class="fb mb-3">
        <div>
          <div style="font-size:18px;font-weight:800" id="vid-title">â€” ì„ íƒëœ ì˜ìƒ ì—†ìŒ</div>
          <div style="font-size:13px;color:var(--t2);margin-top:3px" id="vid-desc">Libraryì—ì„œ ì˜ìƒì„ ì„ íƒí•˜ì„¸ìš”</div>
        </div>
        <span class="badge badge-vid">ğŸ¬ VIDEO</span>
      </div>

      <!-- íŒŒì¼ TL ì”ê³  -->
      <div class="file-tl-info" id="vid-file-tl-row">
        <div>
          <span style="font-weight:700">ğŸ’° íŒŒì¼ TL</span>
          <span style="font-size:12px;color:var(--t2);margin-left:6px">ì´ TLì´ ì†Œëª¨ë˜ë©° ì¬ìƒ</span>
        </div>
        <div style="display:flex;align-items:center;gap:10px">
          <div class="mono" style="font-size:18px;font-weight:800;color:var(--ca)" id="vid-ftl">â€”</div>
          <button class="btn btn-ghost btn-sm" onclick="openModal('recharge-file-modal')">ì¶©ì „</button>
        </div>
      </div>
      <div class="file-tl-bar"><div class="file-tl-fill" id="vid-ftl-fill" style="width:100%"></div></div>

      <!-- Video controls row -->
      <div style="display:flex;align-items:center;gap:12px;margin-top:12px;flex-wrap:wrap">
        <div class="vol-row" style="flex:1">
          <span style="font-size:16px">ğŸ”ˆ</span>
          <input type="range" id="vid-vol" class="vol-slider" min="0" max="100" value="80" oninput="setVidVol(this.value)">
          <span class="mono mu" style="font-size:12px;width:34px" id="vid-vol-lbl">80%</span>
        </div>
        <div style="display:flex;gap:6px">
          <button class="btn btn-ghost btn-sm" onclick="setVidSpeed(1)">1x</button>
          <button class="btn btn-ghost btn-sm" onclick="setVidSpeed(1.5)">1.5x</button>
          <button class="btn btn-ghost btn-sm" onclick="setVidSpeed(2)">2x</button>
        </div>
        <button class="btn btn-ghost btn-sm" onclick="toggleVidFullscreen()">â›¶</button>
      </div>

      <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:12px">
        <span class="badge badge-ca">TL/s: <span id="vid-tl-rate">1.0</span></span>
        <span class="badge badge-pu">âš¡ Pulse: <span id="vid-pulse">0</span></span>
      </div>
    </div>

    <!-- ì˜ìƒ ëª©ë¡ -->
    <div class="sec-hd"><div class="sec-title">ì˜ìƒ ëª©ë¡</div></div>
    <div id="video-playlist" style="display:flex;flex-direction:column;gap:8px"></div>
  </div>
</div>
<!-- ========== SHARE PLACE ========== -->
<div id="tab-shareplace" class="tab-pane">
  <div class="sec-hd mb-3"><div class="sec-title">ğŸ”„ Share Place</div></div>
  <div style="display:flex;gap:6px;flex-wrap:wrap;margin-bottom:16px" id="share-filter-row">
    <span class="chip active" data-g="all" onclick="filterShare('all')">ì „ì²´</span>
    <span class="chip" data-g="K-POP" onclick="filterShare('K-POP')">K-POP</span>
    <span class="chip" data-g="Electronic" onclick="filterShare('Electronic')">Electronic</span>
    <span class="chip" data-g="Hip-Hop" onclick="filterShare('Hip-Hop')">Hip-Hop</span>
    <span class="chip" data-g="Chill" onclick="filterShare('Chill')">Chill</span>
    <span class="chip" data-g="Jazz" onclick="filterShare('Jazz')">Jazz</span>
  </div>
  <div class="share-grid" id="share-grid"></div>
</div>

<!-- ========== RADIO ========== -->
<div id="tab-radio" class="tab-pane">
  <div class="sec-hd mb-3">
    <div><div class="sec-title">ğŸ“» TimeLink Radio</div><div style="font-size:13px;color:var(--t2)">ì¥ë¥´ë³„ ìë™ì¬ìƒ Â· Pulse ì ë¦½</div></div>
  </div>
  <div id="radio-on" class="card card-ac hidden mb-4">
    <div class="fb">
      <div style="display:flex;align-items:center;gap:12px">
        <span class="badge badge-live">ON AIR</span>
        <div><div style="font-weight:700" id="radio-ch-name">â€”</div><div style="font-size:12px;color:var(--t2)" id="radio-ch-desc">â€”</div></div>
      </div>
      <button class="btn btn-ghost btn-sm" onclick="radioStop()">â–  ì •ì§€</button>
    </div>
  </div>
  <div class="radio-grid" id="radio-grid"></div>
</div>

<!-- ========== CAR ========== -->
<div id="tab-car" class="tab-pane">
  <div class="car-hero" id="car-hero">
    <div style="font-size:64px" id="car-emoji">ğŸš—</div>
    <div style="font-size:28px;font-weight:800;margin-top:8px">Car Mode</div>
    <div class="car-rate-big" id="car-rate-big">1.0x</div>
    <div style="font-size:14px;color:var(--t2);margin-bottom:20px">í˜„ì¬ ë³´ìƒ ë°°ìœ¨</div>
    <button class="btn btn-lg w-full" id="car-main-btn"
      style="background:var(--ca-d);color:var(--ca);border:1px solid rgba(245,158,11,.3);border-radius:var(--rf);font-family:'Syne',sans-serif;font-weight:700;cursor:pointer;padding:14px 32px;font-size:15px"
      onclick="toggleCar()">ğŸš— Car Mode í™œì„±í™”</button>
    <div class="car-info-grid">
      <div class="car-info-item"><div class="car-info-label">Pulse</div><div class="car-info-value">2x</div></div>
      <div class="car-info-item"><div class="car-info-label">TLC ì±„êµ´</div><div class="car-info-value">2x</div></div>
      <div class="car-info-item"><div class="car-info-label">ì°½ì‘ì ìˆ˜ìµ</div><div class="car-info-value">2x</div></div>
    </div>
  </div>
  <div class="card">
    <div style="font-weight:800;margin-bottom:10px">ğŸ“‹ ì´ìš© ì•ˆë‚´</div>
    <div style="display:flex;flex-direction:column;gap:8px;font-size:14px;color:var(--t2)">
      <div>âœ… ìš´ì „ ì¤‘ í™œì„±í™”í•˜ë©´ ëª¨ë“  Pulse ë³´ìƒì´ 2ë°°ë¡œ ì§€ê¸‰ë©ë‹ˆë‹¤</div>
      <div>âœ… TLC ë§ˆì´ë‹ ì†ë„ë„ 2ë°°ë¡œ ì¦ê°€í•©ë‹ˆë‹¤</div>
      <div>âš ï¸ TL ì†Œë¹„ëŸ‰ë„ 2ë°°ë¡œ ì¦ê°€í•©ë‹ˆë‹¤ (ìë™ ì¶©ì „ ì„¤ì • ê¶Œì¥)</div>
      <div>ğŸ”’ Phase 2: GPS ê¸°ë°˜ ì‹¤ì œ ì£¼í–‰ ê²€ì¦ ì˜ˆì •</div>
    </div>
  </div>
</div>

</div><!-- .page -->

<!-- ========== PLAYER BAR ========== -->
<div id="player-bar" class="player-bar hidden">
  <div class="pb-prog" onclick="seekByClickBar(event)"><div class="pb-prog-fill" id="pb-fill"></div></div>
  <div class="pb-track">
    <div class="pb-thumb" id="pb-thumb">ğŸµ</div>
    <div style="min-width:0">
      <div style="font-weight:700;font-size:14px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis" id="pb-title">â€”</div>
      <div style="font-size:12px;color:var(--t2)" id="pb-artist">â€”</div>
    </div>
  </div>
  <div class="pb-controls">
    <button class="btn btn-icon btn-ghost" id="pb-play-btn" onclick="toggleAudio()">â–¶</button>
  </div>
  <div class="pb-right">
    <span class="badge badge-ac">âš¡ <span id="pb-pulse">0</span></span>
    <span class="badge badge-ca">TL: <span id="pb-ftl">â€”</span></span>
    <span class="mono mu" style="font-size:12px"><span id="pb-cur">0:00</span>/<span id="pb-dur">0:00</span></span>
    <span id="pb-car" class="badge badge-ca hidden">ğŸš— 2x</span>
  </div>
</div>

<!-- ========== MODALS ========== -->
<div id="recharge-modal" class="modal-overlay hidden">
  <div class="modal">
    <button class="modal-close" onclick="closeModal('recharge-modal')">âœ•</button>
    <div class="modal-title">ğŸ’° TL ì¶©ì „</div>
    <div style="display:flex;gap:8px;margin-bottom:14px;flex-wrap:wrap">
      <button class="btn btn-ghost btn-sm" onclick="$('rc-amt').value=1000">1,000</button>
      <button class="btn btn-ghost btn-sm" onclick="$('rc-amt').value=5000">5,000</button>
      <button class="btn btn-ghost btn-sm" onclick="$('rc-amt').value=10000">10,000</button>
      <button class="btn btn-ghost btn-sm" onclick="$('rc-amt').value=50000">50,000</button>
    </div>
    <div class="fg mb-4"><label class="fl">ê¸ˆì•¡ (TL)</label><input type="number" id="rc-amt" class="fi" value="1000" min="100"></div>
    <button class="btn btn-primary w-full" onclick="doRecharge()">ì¶©ì „í•˜ê¸°</button>
  </div>
</div>

<div id="recharge-file-modal" class="modal-overlay hidden">
  <div class="modal">
    <button class="modal-close" onclick="closeModal('recharge-file-modal')">âœ•</button>
    <div class="modal-title">ğŸ’° íŒŒì¼ TL ì¶©ì „</div>
    <p style="font-size:14px;color:var(--t2);margin-bottom:16px">ì„ íƒëœ íŒŒì¼ì— TLì„ ì§ì ‘ ì¶©ì „í•©ë‹ˆë‹¤. ì²­ì·¨ìëŠ” ì´ TLì„ ì†Œëª¨í•˜ë©° íŒŒì¼ì„ ì¬ìƒí•©ë‹ˆë‹¤.</p>
    <div style="display:flex;gap:8px;margin-bottom:14px;flex-wrap:wrap">
      <button class="btn btn-ghost btn-sm" onclick="$('frc-amt').value=500">500</button>
      <button class="btn btn-ghost btn-sm" onclick="$('frc-amt').value=1000">1,000</button>
      <button class="btn btn-ghost btn-sm" onclick="$('frc-amt').value=5000">5,000</button>
    </div>
    <div class="fg mb-4"><label class="fl">ì¶©ì „í•  TL</label><input type="number" id="frc-amt" class="fi" value="1000" min="100"></div>
    <div style="font-size:13px;color:var(--t2);margin-bottom:14px">ë‚´ ì”ê³ : <span class="mono ac" id="frc-bal">â€”</span> TL</div>
    <button class="btn btn-primary w-full" onclick="doRechargeFile()">íŒŒì¼ì— ì¶©ì „í•˜ê¸°</button>
  </div>
</div>
<script>
// =================== STATE ===================
const S = {
  wallet:{tl:10000,locked:0,tlc:0},
  trust:1.0,lvs:1.0,carMode:false,autoRecharge:true,
  totalSec:0,selectedFile:null,fileType:'audio',revenueModel:'7-3',
  shareFilter:'all',aiPlatform:'suno',
  myFiles:[],
  currentFileId:null,isPlaying:false,pulseCount:0,
  hbTimer:null,uiTimer:null,lockCountdown:30,
  shuffle:false,loop:false,speed:1,
  engine:'tl',mtype:'all',country:'all',genre:'all',vcat:'all',weather:null,
  vidPulse:0,
};

// =================== AI PLATFORMS ===================
const AI_PLATFORMS={
  suno:{name:'Suno',icon:'ğŸµ',url:'suno.com',genres:['Pop','Electronic','Hip-Hop','R&B','Indie']},
  udio:{name:'Udio',icon:'ğŸ¶',url:'udio.com',genres:['Pop','Ambient','Jazz','Electronic','Experimental']},
  mubert:{name:'Mubert',icon:'ğŸŒŠ',url:'mubert.com',genres:['Ambient','Lo-Fi','Electronic','Meditation','Focus']},
  aiva:{name:'AIVA',icon:'ğŸ»',url:'aiva.ai',genres:['Classical','Cinematic','Orchestral','Piano','Electronic']},
  soundraw:{name:'Soundraw',icon:'ğŸ¸',url:'soundraw.io',genres:['Cinematic','Electronic','Hip-Hop','Pop','Jazz']},
  boomy:{name:'Boomy',icon:'ğŸ¥',url:'boomy.com',genres:['Pop','Hip-Hop','Electronic','Reggaeton','R&B']},
  elevenlabs:{name:'ElevenLabs',icon:'ğŸ—£ï¸',url:'elevenlabs.io',genres:['Voiceover','Podcast','Narration','ASMR']},
  beatoven:{name:'Beatoven',icon:'ğŸ¹',url:'beatoven.ai',genres:['Cinematic','Ambient','Pop','Electronic','Jazz']},
};

// =================== GENRES BY COUNTRY ===================
const GENRES={
  all:['All','Pop','Electronic','Hip-Hop','R&B','Rock','Jazz','Classical','Indie','Chill','Ambient','Lo-Fi'],
  kr:['K-POP','K-Hip-Hop','Trot','Korean Indie','K-R&B','Ballad','OST','K-EDM'],
  jp:['J-POP','City Pop','Anime OST','Enka','Visual Kei','J-Rock','J-Hip-Hop','Shibuya-kei'],
  us:['Pop','Hip-Hop','R&B','Country','Rock','Jazz','Blues','Gospel','EDM','Trap','Phonk','Indie'],
  uk:['Britpop','Grime','UK Garage','Folk','Drum&Bass','Jungle','Shoegaze','Britrock'],
  eu:['Eurodance','Schlager','Flamenco','Opera','French Pop','Italian Pop','Reggae'],
  latin:['Reggaeton','Salsa','Cumbia','Bachata','Bossa Nova','Samba','Latin Pop','Merengue'],
  afr:['Afrobeats','Afropop','Highlife','Kwaito','Amapiano','Makossa'],
  world:['Bollywood','Qawwali','K-Folk','J-Folk','Fado','Celtic','Gospel World','Worldbeat'],
};

// =================== WEATHER MOODS ===================
const WX_MOODS={
  sunny:{label:'ë§‘ìŒ',genres:['Pop','K-POP','J-POP','Reggaeton','Happy Pop'],desc:'ë°ê³  ê²½ì¾Œí•œ ìŒì•…ì„ ì¶”ì²œí•©ë‹ˆë‹¤. ì—ë„ˆì§€ ë„˜ì¹˜ëŠ” K-POPê³¼ Popì´ ì–´ìš¸ë ¤ìš”.'},
  rainy:{label:'ë¹„',genres:['Lo-Fi','Chill','Jazz','Indie','Acoustic'],desc:'ë¹—ì†Œë¦¬ì™€ ì–´ìš¸ë¦¬ëŠ” Lo-Fi, Chill, Jazzë¥¼ ì¶”ì²œí•©ë‹ˆë‹¤. ê°ì„±ì ì¸ ì‹œê°„ì„ ë³´ë‚´ì„¸ìš”.'},
  cloudy:{label:'íë¦¼',genres:['Indie','Alternative','Shoegaze','Britpop','Ambient'],desc:'íë¦° ë‚ ì”¨ì— ì–´ìš¸ë¦¬ëŠ” Indieì™€ Alternativeë¥¼ ì¶”ì²œí•©ë‹ˆë‹¤.'},
  snowy:{label:'ëˆˆ',genres:['Classical','Ambient','Piano','Acoustic','Ballad'],desc:'ì„¤ê²½ê³¼ ì–´ìš¸ë¦¬ëŠ” í´ë˜ì‹ê³¼ í”¼ì•„ë…¸ ìŒì•…ì„ ì¶”ì²œí•©ë‹ˆë‹¤.'},
  stormy:{label:'í­í’',genres:['Metal','Rock','Electronic','Drum&Bass','Industrial'],desc:'ê°•ë ¬í•œ ì—ë„ˆì§€ì˜ Rockê³¼ Electronicì„ ì¶”ì²œí•©ë‹ˆë‹¤.'},
  night:{label:'ë§‘ì€ ë°¤',genres:['Jazz','R&B','City Pop','Lounge','Neo-Soul'],desc:'ì•¼ê²½ê³¼ í•¨ê»˜í•˜ëŠ” Jazz, R&B, City Popì„ ì¶”ì²œí•©ë‹ˆë‹¤.'},
  hot:{label:'ë”ìœ„',genres:['Reggae','Reggaeton','Tropical','Afrobeats','Cumbia'],desc:'ì‹œì›í•œ ëŠë‚Œì˜ Reggae, Reggaetonì„ ì¶”ì²œí•©ë‹ˆë‹¤.'},
  cold:{label:'ì¶”ìœ„',genres:['Acoustic','Folk','Ballad','Classical','Ambient'],desc:'ë”°ëœ»í•œ Acousticê³¼ Folk ìŒì•…ìœ¼ë¡œ ì¶”ìœ„ë¥¼ ë…¹ì´ì„¸ìš”.'},
};

// =================== SAMPLE DATA ===================
const SAMPLES=[
  {id:'s1',title:'Midnight Vibe',artist:'Synthwave',dur:225,url:'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3',pulse:84200,genre:'Electronic',country:'us',type:'audio',fileTL:2000,maxFileTL:2000},
  {id:'s2',title:'Seoul Nights',artist:'K-Pop Studio',dur:189,url:'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-4.mp3',pulse:98700,genre:'K-POP',country:'kr',type:'audio',fileTL:1500,maxFileTL:1500},
  {id:'s3',title:'Sunset Groove',artist:'Chill Collective',dur:200,url:'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-3.mp3',pulse:42900,genre:'Chill',country:'us',type:'audio',fileTL:800,maxFileTL:1000},
  {id:'s4',title:'Electric Dreams',artist:'Neon Flow',dur:252,url:'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3',pulse:61500,genre:'Electronic',country:'uk',type:'audio',fileTL:3000,maxFileTL:3000},
  {id:'s5',title:'Dark Matter',artist:'Underground',dur:310,url:'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-5.mp3',pulse:33100,genre:'Hip-Hop',country:'us',type:'audio',fileTL:500,maxFileTL:1000},
  {id:'s6',title:'Golden Hour',artist:'Indie Soul',dur:243,url:'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-6.mp3',pulse:52300,genre:'Indie',country:'us',type:'audio',fileTL:1200,maxFileTL:1200},
];
const RADIO=[
  {id:'r1',name:'K-POP Hits',icon:'ğŸ¤',desc:'ìµœì‹  K-POP ì°¨íŠ¸',url:'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-4.mp3',rate:'1.5x'},
  {id:'r2',name:'Electronic',icon:'âš¡',desc:'ì‹ ë‚˜ëŠ” Electronic',url:'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3',rate:'1.2x'},
  {id:'r3',name:'Chill Lounge',icon:'ğŸŒŠ',desc:'ë¦´ë™ì‹± Chill',url:'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-3.mp3',rate:'1.0x'},
  {id:'r4',name:'Hip-Hop',icon:'ğŸ§',desc:'Underground Hip-Hop',url:'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-5.mp3',rate:'1.3x'},
  {id:'r5',name:'Jazz Soul',icon:'ğŸ·',desc:'ê³ ê¸‰ìŠ¤ëŸ¬ìš´ Jazz',url:'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-9.mp3',rate:'1.1x'},
  {id:'r6',name:'Lo-Fi Study',icon:'ğŸ“š',desc:'ì§‘ì¤‘ Lo-Fi',url:'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-8.mp3',rate:'1.0x'},
];

// =================== UTILS ===================
function $(i){return document.getElementById(i)}
function esc(s){return String(s).replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]))}
function fmt(n){return Math.floor(n).toLocaleString()}
function fmtT(s){s=Math.floor(s||0);return`${Math.floor(s/60)}:${String(s%60).padStart(2,'0')}`}
function toast(msg,t='i'){const el=document.createElement('div');el.className=`t ${t}`;el.textContent=msg;$('toast-box').prepend(el);setTimeout(()=>el.remove(),3200)}
function openModal(id){$(id).classList.remove('hidden')}
function closeModal(id){$(id).classList.add('hidden')}
document.addEventListener('click',e=>{if(e.target.classList.contains('modal-overlay'))e.target.classList.add('hidden')});

// =================== TABS ===================
function switchTab(name){
  document.querySelectorAll('.tab-btn').forEach(b=>b.classList.toggle('active',b.dataset.tab===name));
  document.querySelectorAll('.tab-pane').forEach(p=>p.classList.toggle('active',p.id===`tab-${name}`));
  if(name==='library'){renderGenreChips();renderLibResults();}
  if(name==='shareplace')renderShare();
  if(name==='player'){renderPlaylists();}
}

// =================== BALANCE ===================
function updateBal(){
  const w=S.wallet;
  [['nb-tl',w.tl],['nb-lo',w.locked],['nb-tlc',w.tlc],
   ['ds-tl',w.tl],['ds-lo',w.locked],['ds-tlc',w.tlc],
   ['lo-display',w.locked],['mine-pending',w.tlc],['lib-tlc',w.tlc],
   ['up-my-tl',w.tl],['frc-bal',w.tl]].forEach(([id,v])=>{
    const el=$(id);if(!el)return;
    el.textContent=v>0&&v<1?v.toFixed(4):fmt(v);
  });
}

// =================== TRUST ===================
function updateTrust(){
  const t=S.trust,l=S.lvs;
  const tn=$('trust-num');if(tn)tn.textContent=t.toFixed(2);
  const lv=$('lvs-val');if(lv)lv.textContent=l.toFixed(2);
  const circ=263.9,offset=circ-(Math.min(t,1.2)/1.2)*circ;
  const fill=$('trust-fill-el');
  if(fill){fill.style.strokeDashoffset=offset.toFixed(1);fill.style.stroke=t>=1.0?'var(--ac)':t>=0.9?'var(--ca)':'var(--da)';}
}
function updateRate(){
  const m=S.trust*S.lvs*(S.carMode?2:1);
  ['rate-big','car-rate-big','np-mult'].forEach(id=>{const el=$(id);if(el)el.textContent=m.toFixed(2)+'x'});
  const nc=$('np-cost');if(nc)nc.textContent=m.toFixed(2);
  const vr=$('vid-tl-rate');if(vr)vr.textContent=m.toFixed(2);
}
setInterval(()=>{
  S.trust=Math.min(1.2,Math.max(0.8,S.trust+(Math.random()-.48)*.04));
  S.lvs=Math.min(1.0,Math.max(0.5,S.lvs+(Math.random()-.46)*.03));
  updateTrust();updateRate();
},5000);

// =================== LOCKED ===================
setInterval(()=>{
  S.lockCountdown--;
  const fill=$('lo-fill'),timer=$('lo-timer');
  if(fill)fill.style.width=(S.lockCountdown/30*100)+'%';
  if(timer)timer.textContent=S.lockCountdown+'s';
  if(S.lockCountdown<=0){
    S.lockCountdown=30;
    if(S.wallet.locked>0){const r=Math.min(S.wallet.locked,50);S.wallet.locked-=r;S.wallet.tl+=r;updateBal();toast(`ğŸ”“ Locked TL í•´ì œ +${r} TL`,'s');}
  }
},1000);

// =================== CAR MODE ===================
function toggleCar(){
  S.carMode=!S.carMode;const v=S.carMode;
  const chk=$('car-chk');if(chk)chk.checked=v;
  const ind=$('car-ind');if(ind){ind.className=`car-ind ${v?'on':'off'}`;ind.textContent=v?'ğŸš— ON':'ğŸš— Off';}
  const hero=$('car-hero');if(hero)hero.classList.toggle('on',v);
  const emoji=$('car-emoji');if(emoji)emoji.textContent=v?'ğŸï¸':'ğŸš—';
  const btn=$('car-main-btn');if(btn)btn.textContent=v?'ğŸ›‘ ë¹„í™œì„±í™”':'ğŸš— Car Mode í™œì„±í™”';
  const badge=$('pb-car');if(badge)badge.classList.toggle('hidden',!v);
  updateRate();toast(v?'ğŸš— Car Mode ON â€” 2ë°° ë³´ìƒ!':'Car Mode OFF',v?'s':'i');
}

// =================== RECHARGE ===================
function doRecharge(){
  const a=Number($('rc-amt').value)||0;
  if(a<=0){toast('ê¸ˆì•¡ì„ ì…ë ¥í•˜ì„¸ìš”','e');return;}
  S.wallet.tl+=a;updateBal();toast(`ğŸ’° ${fmt(a)} TL ì¶©ì „!`,'s');closeModal('recharge-modal');
}
function doRechargeFile(){
  const a=Number($('frc-amt').value)||0;
  if(a<=0){toast('ê¸ˆì•¡ì„ ì…ë ¥í•˜ì„¸ìš”','e');return;}
  if(a>S.wallet.tl){toast('ì”ê³ ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤','e');return;}
  const f=S.myFiles.find(x=>x.id===S.currentFileId)||SAMPLES.find(x=>x.id===S.currentFileId);
  if(!f){toast('íŒŒì¼ì„ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”','e');return;}
  S.wallet.tl-=a;f.fileTL+=a;f.maxFileTL=Math.max(f.maxFileTL||f.fileTL,f.fileTL);
  updateBal();updateFileTLDisplay();toast(`ğŸ’° íŒŒì¼ì— ${fmt(a)} TL ì¶©ì „!`,'s');closeModal('recharge-file-modal');
}
function deduct(cost){
  const f=S.myFiles.find(x=>x.id===S.currentFileId)||SAMPLES.find(x=>x.id===S.currentFileId);
  if(f){
    if(f.fileTL<=0){toast('âš ï¸ íŒŒì¼ TL ì†Œì§„! ì¶©ì „ì´ í•„ìš”í•©ë‹ˆë‹¤','e');stopAll();return false;}
    f.fileTL=Math.max(0,f.fileTL-cost);
    updateFileTLDisplay();
  }
  if(S.wallet.tl<cost){
    if(S.autoRecharge&&S.wallet.tl<2000){S.wallet.tl+=5000;toast('âš¡ ìë™ì¶©ì „ +5,000 TL','i');}
    else{toast('âš ï¸ TL ì”ì•¡ ë¶€ì¡±!','e');stopAll();return false;}
  }
  S.wallet.tl-=cost;S.wallet.locked+=cost*.3;return true;
}
function updateFileTLDisplay(){
  const f=S.myFiles.find(x=>x.id===S.currentFileId)||SAMPLES.find(x=>x.id===S.currentFileId);
  if(!f)return;
  const pct=f.maxFileTL?((f.fileTL/f.maxFileTL)*100).toFixed(1):100;
  ['aud-ftl','vid-ftl','pb-ftl'].forEach(id=>{const el=$(id);if(el)el.textContent=fmt(f.fileTL);});
  ['np-file-tl'].forEach(id=>{const el=$(id);if(el){el.textContent=`íŒŒì¼ TL: ${fmt(f.fileTL)}`;el.classList.remove('hidden');}});
  const aff=$('aud-ftl-fill');if(aff)aff.style.width=pct+'%';
  const vff=$('vid-ftl-fill');if(vff)vff.style.width=pct+'%';
}

// =================== AUDIO ENGINE ===================
const aud=$('aud');
function loadTrack(id,url,title,artist,icon='ğŸµ'){
  stopAll();
  S.currentFileId=id;S.pulseCount=0;
  aud.src=url;aud.load();aud.volume=$('aud-vol')?$('aud-vol').value/100:0.8;aud.playbackRate=S.speed;
  ['np-title','pb-title','aud-title'].forEach(i=>{const el=$(i);if(el)el.textContent=title});
  ['np-artist','pb-artist','aud-artist'].forEach(i=>{const el=$(i);if(el)el.textContent=artist});
  const pb=$('player-bar');if(pb)pb.classList.remove('hidden');
  const ai=$('audio-art-icon');if(ai)ai.textContent=icon;
  updateFileTLDisplay();
  aud.play().then(()=>{setPlaying(true);startTimers();}).catch(()=>toast('ì¬ìƒ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì‹œì‘í•˜ì„¸ìš”','i'));
}
function toggleAudio(){
  if(!S.currentFileId){toast('Libraryì—ì„œ íŠ¸ë™ì„ ì„ íƒí•˜ì„¸ìš”','i');return;}
  if(S.isPlaying){aud.pause();setPlaying(false);clearInterval(S.hbTimer);clearInterval(S.uiTimer);}
  else{aud.play().then(()=>{setPlaying(true);startTimers();}).catch(()=>toast('ì¬ìƒ ì˜¤ë¥˜','e'));}
}
function stopAll(){
  clearInterval(S.hbTimer);clearInterval(S.uiTimer);aud.pause();aud.currentTime=0;setPlaying(false);
  const vd=$('vid-el');if(vd&&!vd.paused)vd.pause();
}
function setPlaying(v){
  S.isPlaying=v;
  ['pb-play-btn','aud-play-btn'].forEach(id=>{const el=$(id);if(el)el.innerHTML=v?'â¸':'â–¶';});
  const eq=$('eq-bars');if(eq)eq.classList.toggle('paused',!v);
}
function seekByClick(e,type){
  const el=e.currentTarget,rect=el.getBoundingClientRect();
  const pct=Math.max(0,Math.min(1,(e.clientX-rect.left)/rect.width));
  if(type==='audio'&&aud.duration)aud.currentTime=pct*aud.duration;
}
function seekByClickBar(e){
  const el=e.currentTarget,rect=el.getBoundingClientRect();
  const pct=Math.max(0,Math.min(1,(e.clientX-rect.left)/rect.width));
  if(aud.duration)aud.currentTime=pct*aud.duration;
}
function seekAudio(e){seekByClick(e,'audio');}
function skipAudio(sec){if(aud.duration)aud.currentTime=Math.max(0,Math.min(aud.duration,aud.currentTime+sec));}
function setAudVol(v){aud.volume=v/100;const el=$('aud-vol-lbl');if(el)el.textContent=v+'%';}
function setSpeed(sp){S.speed=sp;aud.playbackRate=sp;document.querySelectorAll('[id^="speed-"]').forEach(b=>b.style.borderColor='var(--bd)');const id='speed-'+String(sp).replace('.','');const btn=$(id);if(btn)btn.style.borderColor='var(--bd-a)';}
function toggleShuffle(){S.shuffle=!S.shuffle;const b=$('shuf-btn');if(b)b.style.color=S.shuffle?'var(--ac)':'var(--t2)';toast(S.shuffle?'ì…”í”Œ ON':'ì…”í”Œ OFF',S.shuffle?'s':'i');}
function toggleLoop(){S.loop=!S.loop;aud.loop=S.loop;const b=$('loop-btn');if(b)b.style.color=S.loop?'var(--ac)':'var(--t2)';toast(S.loop?'ë°˜ë³µ ON':'ë°˜ë³µ OFF',S.loop?'s':'i');}

function startTimers(){
  S.hbTimer=setInterval(()=>{if(!S.isPlaying)return;S.wallet.tlc+=10*.001*(S.carMode?2:1);updateBal();},10000);
  S.uiTimer=setInterval(()=>{
    if(!S.isPlaying)return;
    const cost=S.trust*S.lvs*(S.carMode?2:1);
    if(!deduct(cost))return;
    S.pulseCount++;S.totalSec++;S.vidPulse++;
    if(aud.duration){
      const p=(aud.currentTime/aud.duration)*100;
      ['np-fill','pb-fill','aud-seek-fill'].forEach(id=>{const el=$(id);if(el)el.style.width=p.toFixed(1)+'%';});
    }
    const e=fmtT(aud.currentTime),d=fmtT(aud.duration||0);
    [['np-cur',e],['np-dur',d],['pb-cur',e],['pb-dur',d],['aud-cur',e],['aud-dur',d]].forEach(([id,v])=>{const el=$(id);if(el)el.textContent=v;});
    const p=fmt(S.pulseCount);
    ['np-pulse','pb-pulse'].forEach(id=>{const el=$(id);if(el)el.textContent=p;});
    const dt=$('ds-time');if(dt)dt.textContent=fmtT(S.totalSec);
    updateBal();updateRate();
  },1000);
}
aud.addEventListener('ended',()=>{setPlaying(false);clearInterval(S.hbTimer);clearInterval(S.uiTimer);toast('ğŸµ ì¬ìƒ ì™„ë£Œ!','s');});

// =================== VIDEO ENGINE ===================
const vid=$('vid-el');
function loadVideo(id,url,title,desc){
  stopAll();S.currentFileId=id;S.vidPulse=0;
  vid.src=url;vid.load();vid.volume=$('vid-vol')?$('vid-vol').value/100:0.8;
  const vt=$('vid-title');if(vt)vt.textContent=title;
  const vd=$('vid-desc');if(vd)vd.textContent=desc||'';
  const ov=$('vid-overlay');if(ov)ov.style.display='flex';
  updateFileTLDisplay();toast('â–¶ ì¬ìƒ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì‹œì‘í•˜ì„¸ìš”','i');
}
function startVideo(){
  const ov=$('vid-overlay');if(ov)ov.style.display='none';
  vid.play().then(()=>startVidTimers()).catch(()=>toast('ì˜ìƒ ì¬ìƒ ì˜¤ë¥˜','e'));
}
let vidTimer=null;
function startVidTimers(){
  vidTimer=setInterval(()=>{
    if(vid.paused)return;
    const cost=S.trust*S.lvs*(S.carMode?2:1);
    if(!deduct(cost))return;
    S.vidPulse++;S.totalSec++;
    const vp=$('vid-pulse');if(vp)vp.textContent=fmt(S.vidPulse);
    updateBal();updateRate();
  },1000);
}
vid.addEventListener('pause',()=>{clearInterval(vidTimer);});
vid.addEventListener('ended',()=>{clearInterval(vidTimer);toast('ğŸ¬ ì˜ìƒ ì¬ìƒ ì™„ë£Œ!','s');});
function setVidVol(v){vid.volume=v/100;const el=$('vid-vol-lbl');if(el)el.textContent=v+'%';}
function setVidSpeed(sp){vid.playbackRate=sp;}
function toggleVidFullscreen(){if(!document.fullscreenElement)vid.requestFullscreen();else document.exitFullscreen();}
function setPlayerType(t){
  $('plytype-audio').className=`btn ${t==='audio'?'btn-primary':'btn-ghost'}`;
  $('plytype-video').className=`btn ${t==='video'?'btn-primary':'btn-ghost'}`;
  $('audio-player-sec').classList.toggle('hidden',t!=='audio');
  $('video-player-sec').classList.toggle('hidden',t!=='video');
}

// =================== PLAYLISTS ===================
function renderPlaylists(){
  const audioItems=SAMPLES.filter(x=>x.type==='audio').concat(S.myFiles.filter(x=>x.type!=='video'));
  const videoItems=SAMPLES.filter(x=>x.type==='video').concat(S.myFiles.filter(x=>x.type==='video'));
  const ap=$('audio-playlist');
  if(ap) ap.innerHTML=audioItems.map(f=>`
    <div class="track-item ${S.currentFileId===f.id&&S.isPlaying?'playing':''}" onclick="loadTrack('${f.id}','${esc(f.url)}','${esc(f.title)}','${esc(f.artist)}')">
      <div class="track-thumb">ğŸµ</div>
      <div class="track-info">
        <div class="track-title">${esc(f.title)}</div>
        <div class="track-meta">${esc(f.artist||'')} Â· ${f.genre||''} Â· ${fmtT(f.dur||0)}</div>
        <div class="file-tl-bar mt-2"><div class="file-tl-fill" style="width:${f.maxFileTL?(f.fileTL/f.maxFileTL*100).toFixed(0):100}%"></div></div>
      </div>
      <div class="track-actions">
        <span class="badge badge-ca">ğŸ’°${fmt(f.fileTL||0)}</span>
        <span class="badge badge-ac">âš¡${fmt(f.pulse||0)}</span>
      </div>
    </div>`).join('');
  const vp=$('video-playlist');
  if(vp&&S.myFiles.filter(x=>x.type==='video').length>0){
    vp.innerHTML=S.myFiles.filter(x=>x.type==='video').map(f=>`
      <div class="track-item" onclick="loadVideo('${f.id}','${esc(f.url)}','${esc(f.title)}','${esc(f.genre||'')}')">
        <div class="track-thumb">ğŸ¬</div>
        <div class="track-info"><div class="track-title">${esc(f.title)}</div><div class="track-meta">${f.genre||''}</div>
          <div class="file-tl-bar mt-2"><div class="file-tl-fill" style="width:${f.maxFileTL?(f.fileTL/f.maxFileTL*100).toFixed(0):100}%"></div></div>
        </div>
        <span class="badge badge-ca">ğŸ’°${fmt(f.fileTL||0)}</span>
      </div>`).join('');
  }else if(vp){vp.innerHTML='<div class="card tc" style="padding:32px"><div style="font-size:36px;margin-bottom:10px">ğŸ¬</div><div>ì—…ë¡œë“œëœ ì˜ìƒì´ ì—†ìŠµë‹ˆë‹¤</div><button class="btn btn-primary btn-sm mt-4" onclick="switchTab(\'create\')">+ ì—…ë¡œë“œ</button></div>';}
}

// =================== CREATE â€” AI ===================
function selectAI(id){
  S.aiPlatform=id;
  document.querySelectorAll('.ai-card').forEach(c=>c.classList.toggle('sel',c.dataset.ai===id));
  const p=AI_PLATFORMS[id];
  const el=$('ai-platform-name');if(el)el.textContent=p.name;
  const url=$('ai-url');if(url)url.placeholder=`https://${p.url}/...`;
}
function aiVerify(){
  const url=$('ai-url').value.trim();
  const plan=$('ai-plan').value;
  const hasImg=$('proof-img-input').files.length>0;
  const hasEmail=$('google-receipt-email').value.trim();
  const hasDoc=$('proof-doc-input').files.length>0;
  if(!url){toast('ìŒì› URLì„ ì…ë ¥í•˜ì„¸ìš”','e');return;}
  if(!plan){toast('êµ¬ë… í”Œëœì„ ì„ íƒí•˜ì„¸ìš”','e');return;}
  if(!hasImg&&!hasEmail&&!hasDoc){toast('ì¸ì¦ ìë£Œë¥¼ í•˜ë‚˜ ì´ìƒ ì²¨ë¶€í•˜ì„¸ìš” (ì˜ìˆ˜ì¦ ì´ë¯¸ì§€, ì´ë©”ì¼, ë˜ëŠ” ê¸°íƒ€ ì¦ë¹™)','e');return;}
  $('ai-loading').classList.remove('hidden');$('ai-preview-box').classList.add('hidden');
  $('ai-error-box').classList.add('hidden');$('ai-verify-btn').disabled=true;
  setTimeout(()=>{
    const p=AI_PLATFORMS[S.aiPlatform];
    $('ai-prev-icon').textContent=p.icon;
    $('ai-prev-title').textContent=`AI Generated Track (${p.name})`;
    $('ai-prev-artist').textContent=`${p.name} Â· ${plan}`;
    $('ai-prev-dur').textContent=fmtT(200+Math.floor(Math.random()*100));
    $('ai-prev-plat').textContent=p.name;
    $('ai-loading').classList.add('hidden');$('ai-preview-box').classList.remove('hidden');$('ai-verify-btn').disabled=false;
    toast(`âœ… ${p.name} ${plan} êµ¬ë… ì¸ì¦ ì™„ë£Œ!`,'s');
  },2200);
}
function cancelAIPreview(){$('ai-preview-box').classList.add('hidden');$('ai-url').value='';}
function convertAI(){
  const p=AI_PLATFORMS[S.aiPlatform];
  const f={
    id:'ai_'+Date.now(),
    title:$('ai-prev-title').textContent,
    artist:$('ai-prev-artist').textContent,
    dur:210,url:'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-7.mp3',
    pulse:0,genre:p.genres[0],country:'us',type:'audio',
    model:S.revenueModel,source:S.aiPlatform,
    fileTL:1000,maxFileTL:1000,createdAt:Date.now()
  };
  S.myFiles.unshift(f);S.wallet.tl+=1000;updateBal();
  cancelAIPreview();$('ai-url').value='';$('ai-plan').value='';
  toast(`âœ¨ ${p.name} ìŒì› â†’ TL3 ë³€í™˜ ì™„ë£Œ! +1,000 TL`,'s');
  switchTab('library');
}
function onProofImgDrop(e){e.preventDefault();e.currentTarget.style.borderColor='var(--bd)';onProofImgSelect(e.dataTransfer.files[0]);}
function onProofImgSelect(f){if(!f)return;$('proof-img-name').textContent='âœ“ '+f.name;}
function onProofDocSelect(f){if(!f)return;$('proof-doc-name').textContent='âœ“ '+f.name;}

// =================== CREATE â€” UPLOAD ===================
function selectType(t){
  S.fileType=t;
  $('type-audio').style.borderColor=t==='audio'?'var(--bd-a)':'var(--bd)';$('type-audio').style.background=t==='audio'?'var(--ac-d)':'var(--card)';
  $('type-video').style.borderColor=t==='video'?'rgba(123,97,255,.4)':'var(--bd)';$('type-video').style.background=t==='video'?'var(--pu-d)':'var(--card)';
}
function selectModel(m){
  S.revenueModel=m;
  $('m73').style.borderColor=m==='7-3'?'var(--bd-a)':'var(--bd)';$('m73').style.background=m==='7-3'?'var(--ac-d)':'var(--card)';
  $('m55').style.borderColor=m==='5-5'?'rgba(123,97,255,.4)':'var(--bd)';$('m55').style.background=m==='5-5'?'var(--pu-d)':'var(--card)';
}
function onDrop(e){e.preventDefault();e.currentTarget.classList.remove('over');onFileSelect(e.dataTransfer.files[0]);}
function onFileSelect(f){
  if(!f)return;
  if(f.size>500*1024*1024){toast('500MB ì´ˆê³¼','e');return;}
  S.selectedFile=f;
  const isVid=f.type.startsWith('video/');
  if(isVid)selectType('video');
  $('fp-icon').textContent=isVid?'ğŸ¬':'ğŸµ';
  $('fp-name').textContent=f.name;$('fp-size').textContent=(f.size/1024/1024).toFixed(1)+' MB';
  $('file-prev').classList.remove('hidden');$('upload-zone').classList.add('hidden');
  if(!$('up-title').value)$('up-title').value=f.name.replace(/\.[^/.]+$/,'');
  $('up-btn').disabled=false;$('up-btn').textContent='íŠ¸ë™ ì—…ë¡œë“œí•˜ê¸°';
}
function removeFile(){S.selectedFile=null;$('file-prev').classList.add('hidden');$('upload-zone').classList.remove('hidden');$('up-btn').disabled=true;$('up-btn').textContent='íŒŒì¼ì„ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”';$('file-input').value='';}
function doUpload(){
  if(!S.selectedFile)return;
  const title=$('up-title').value.trim();
  if(!title){toast('ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”','e');return;}
  const fileTL=Number($('up-file-tl').value)||1000;
  if(fileTL>S.wallet.tl){toast('ì”ê³ ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤','e');return;}
  const isVid=S.selectedFile.type.startsWith('video/');
  const f={
    id:'local_'+Date.now(),title,artist:'ë‚˜',
    dur:0,url:URL.createObjectURL(S.selectedFile),
    pulse:0,genre:$('up-cat').value.split('-').pop()||'ê¸°íƒ€',
    country:'kr',type:isVid?'video':'audio',
    model:S.revenueModel,source:'upload',
    fileTL,maxFileTL:fileTL,createdAt:Date.now()
  };
  S.myFiles.unshift(f);S.wallet.tl-=fileTL;updateBal();removeFile();
  toast('ğŸµ ì—…ë¡œë“œ ì™„ë£Œ! íŒŒì¼ì— TL ì¶©ì „ë¨','s');switchTab('library');
}

// =================== LIBRARY ===================
function setEngine(e){
  S.engine=e;
  $('eng-tl-btn').className=`btn btn-sm ${e==='tl'?'btn-primary':'btn-ghost'}`;$('eng-tl-btn').style.cssText=e==='tl'?'background:var(--ac);color:#060610;border-radius:var(--rf);font-family:"Syne",sans-serif;font-weight:700;cursor:pointer;padding:6px 14px;font-size:12px':'';
  $('eng-sp-btn').className=`btn btn-sm ${e==='spotify'?'btn-sp':'btn-ghost'}`;
  $('tl-filters').classList.toggle('hidden',e!=='tl');$('sp-filters').classList.toggle('hidden',e!=='spotify');
  $('lib-result-title').textContent=e==='tl'?'TimeLink íŠ¸ë™':'Spotify ê²€ìƒ‰';
  renderLibResults();
}
function setMtype(t){
  S.mtype=t;S.genre='all';
  document.querySelectorAll('[data-mtype]').forEach(c=>c.classList.toggle('active',c.dataset.mtype===t));
  $('music-filters').classList.toggle('hidden',t==='video');
  $('video-filters').classList.toggle('hidden',t==='audio');
  if(t!=='video')renderGenreChips();
  renderLibResults();
}
function setCountry(c){S.country=c;document.querySelectorAll('[data-country]').forEach(x=>x.classList.toggle('active',x.dataset.country===c));renderGenreChips();renderLibResults();}
function renderGenreChips(){
  const el=$('genre-chips');if(!el)return;
  const gs=GENRES[S.country]||GENRES.all;
  el.innerHTML=gs.map(g=>`<span class="chip ${S.genre===g||S.genre==='all'&&g==='All'?'active':''}" onclick="setGenre('${g}')">${g}</span>`).join('');
}
function setGenre(g){S.genre=g;renderGenreChips();renderLibResults();}
function setVcat(v){S.vcat=v;document.querySelectorAll('[data-vcat]').forEach(c=>c.classList.toggle('active',c.dataset.vcat===v));renderLibResults();}
function setWeather(wx){
  S.weather=wx;
  document.querySelectorAll('.wx-card').forEach(c=>c.classList.toggle('sel',c.dataset.wx===wx));
  const m=WX_MOODS[wx];
  const res=$('wx-ai-result');
  if(res&&m){res.classList.remove('hidden');res.innerHTML=`<strong>ğŸ¤– AI ì¶”ì²œ: ${m.label}</strong><br>${m.desc}<br><strong>ì¶”ì²œ ì¥ë¥´:</strong> ${m.genres.join(', ')}`;
    m.genres.forEach(g=>{if(S.genre==='all'||S.genre===g)return;});
    if(m.genres.length)setGenre(m.genres[0]);
  }
}
function doSearch(){
  const q=$('lib-search').value.trim();
  renderLibResults(q);
}
function renderLibResults(query=''){
  const el=$('lib-results');if(!el)return;
  if(S.engine==='spotify'){
    el.innerHTML=`<div class="card card-sp"><div class="fb"><div><div style="font-weight:800;font-size:16px;margin-bottom:4px">ğŸµ Spotify ê²€ìƒ‰ ê²°ê³¼</div><div style="font-size:13px;color:var(--t2)">"${esc(query||'ì „ì²´')}"</div></div><span class="badge badge-sp">Spotify</span></div><div class="divider"></div>`+
      SAMPLES.slice(0,4).map(t=>`<div class="track-item" onclick="loadTrack('${t.id}','${t.url}','${esc(t.title)}','${esc(t.artist)}')"><div class="track-thumb">ğŸµ</div><div class="track-info"><div class="track-title">${esc(t.title)} <span class="badge badge-sp" style="font-size:10px">Spotify</span></div><div class="track-meta">${esc(t.artist)} Â· ${fmtT(30)} ë¯¸ë¦¬ë³´ê¸°</div></div><button class="btn btn-sp btn-sm" onclick="event.stopPropagation();toast('Spotify ì•±ì—ì„œ ì „ì²´ ì¬ìƒí•˜ì„¸ìš”','i')">ğŸµ ì „ì²´ë³´ê¸°</button></div>`).join('')+'</div>';
    return;
  }
  const all=[...SAMPLES,...S.myFiles];
  let data=all.filter(t=>{
    if(S.mtype==='audio'&&t.type==='video')return false;
    if(S.mtype==='video'&&t.type!=='video')return false;
    if(S.country!=='all'&&t.country!==S.country)return false;
    if(S.genre!=='all'&&S.genre!=='All'&&t.genre!==S.genre)return false;
    if(query){const q=query.toLowerCase();if(!t.title.toLowerCase().includes(q)&&!((t.artist||'').toLowerCase().includes(q))&&!(t.genre||'').toLowerCase().includes(q))return false;}
    return true;
  });
  const lc=$('lib-cnt'),lp=$('lib-pulse');
  if(lc)lc.textContent=S.myFiles.length;
  if(lp)lp.textContent=fmt(S.myFiles.reduce((a,f)=>a+(f.pulse||0),0));
  if(!data.length){el.innerHTML='<div class="card tc" style="padding:40px"><div style="font-size:40px;margin-bottom:12px">ğŸ”</div><div>ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤</div></div>';return;}
  el.innerHTML=data.map(f=>`
    <div class="track-item" onclick="${f.type==='video'?`switchTab('player');setPlayerType('video');loadVideo('${f.id}','${esc(f.url)}','${esc(f.title)}','')`:`loadTrack('${f.id}','${esc(f.url)}','${esc(f.title)}','${esc(f.artist||'')}')`}">
      <div class="track-thumb">${f.type==='video'?'ğŸ¬':'ğŸµ'}</div>
      <div class="track-info">
        <div class="track-title">${esc(f.title)}${f.source&&f.source!=='upload'?`<span class="badge badge-ai" style="font-size:10px;margin-left:6px">${esc(f.source)}</span>`:''}</div>
        <div class="track-meta">${esc(f.artist||'')} Â· ${f.genre||''} Â· ${fmtT(f.dur||0)}</div>
        <div class="file-tl-bar mt-2"><div class="file-tl-fill" style="width:${f.maxFileTL?(f.fileTL/f.maxFileTL*100).toFixed(0):100}%"></div></div>
      </div>
      <div class="track-actions">
        <span class="badge badge-ca">ğŸ’°${fmt(f.fileTL||0)}</span>
        <span style="font-family:'JetBrains Mono',monospace;font-size:12px;color:var(--ac)">âš¡${fmt(f.pulse||0)}</span>
        ${f.source?`<span class="badge badge-ai" style="font-size:10px">${esc(f.source.toUpperCase())}</span>`:''}
      </div>
    </div>`).join('');
}

// =================== HOT PULSE ===================
function renderHotPulse(){
  const el=$('hot-pulse');if(!el)return;
  el.innerHTML=[...SAMPLES].sort((a,b)=>b.pulse-a.pulse).map(t=>`
    <div class="track-item" onclick="loadTrack('${t.id}','${t.url}','${esc(t.title)}','${esc(t.artist)}')">
      <div class="track-thumb">ğŸµ</div>
      <div class="track-info"><div class="track-title">${esc(t.title)}</div><div class="track-meta">${esc(t.artist)} Â· ${t.genre} Â· ${fmtT(t.dur)}</div></div>
      <div style="display:flex;align-items:center;gap:8px"><span style="font-family:'JetBrains Mono',monospace;font-size:12px;color:var(--ac)">âš¡${fmt(t.pulse)}</span><span class="badge badge-ca">ğŸ’°${fmt(t.fileTL)}</span></div>
    </div>`).join('');
}

// =================== SHARE ===================
function filterShare(g){
  S.shareFilter=g;
  document.querySelectorAll('#share-filter-row .chip').forEach(c=>c.classList.toggle('active',c.dataset.g===g));
  renderShare();
}
function renderShare(){
  const el=$('share-grid');if(!el)return;
  const data=S.shareFilter==='all'?SAMPLES:SAMPLES.filter(t=>t.genre===S.shareFilter);
  el.innerHTML=data.map(t=>`
    <div class="share-card">
      <div class="share-thumb">ğŸµ</div>
      <div style="font-weight:700;font-size:14px;margin-bottom:4px">${esc(t.title)}</div>
      <div style="font-size:12px;color:var(--t2);margin-bottom:12px">${esc(t.artist)} Â· ${t.genre} Â· âš¡ ${fmt(t.pulse)}</div>
      <div style="display:flex;gap:8px">
        <button class="btn btn-outline btn-sm" onclick="loadTrack('${t.id}','${t.url}','${esc(t.title)}','${esc(t.artist)}')">â–¶ ì¬ìƒ</button>
        <button class="btn btn-ghost btn-sm" onclick="toast('Phase 2ì—ì„œ ì§€ì›ë©ë‹ˆë‹¤','i')">ğŸ“¥</button>
      </div>
    </div>`).join('');
}

// =================== RADIO ===================
function renderRadio(){
  const g=$('radio-grid');if(!g)return;
  g.innerHTML=RADIO.map(ch=>`
    <div class="radio-card" data-ch="${ch.id}" onclick="radioPlay('${ch.id}')">
      <div style="font-size:32px;margin-bottom:8px">${ch.icon}</div>
      <div style="font-weight:700;font-size:14px">${ch.name}</div>
      <div style="font-size:12px;color:var(--t2);margin-top:3px">${ch.desc}</div>
      <div class="mono ac" style="font-size:12px;margin-top:4px">${ch.rate}</div>
    </div>`).join('');
}
function radioPlay(id){
  const ch=RADIO.find(r=>r.id===id);if(!ch)return;
  $('radio-on').classList.remove('hidden');
  $('radio-ch-name').textContent=ch.icon+' '+ch.name;$('radio-ch-desc').textContent=ch.desc+' Â· '+ch.rate;
  document.querySelectorAll('.radio-card').forEach(el=>el.classList.remove('playing'));
  document.querySelector(`.radio-card[data-ch="${id}"]`)?.classList.add('playing');
  S.currentFileId=id;
  loadTrack(id,ch.url,ch.icon+' '+ch.name,'Radio','ğŸ“»');
}
function radioStop(){stopAll();$('radio-on').classList.add('hidden');document.querySelectorAll('.radio-card').forEach(el=>el.classList.remove('playing'));}

// =================== MINING ===================
function claimTLC(){
  const p=parseFloat(S.wallet.tlc.toFixed(4));
  if(p<.0001){toast('ìˆ˜ë ¹ ê°€ëŠ¥í•œ TLCê°€ ì—†ìŠµë‹ˆë‹¤','i');return;}
  S.wallet.tlc=0;updateBal();toast(`â›ï¸ TLC ${p.toFixed(4)} ìˆ˜ë ¹!`,'s');
}

// =================== LOGOUT ===================
function doLogout(){localStorage.removeItem('tl_token');localStorage.removeItem('tl_user');toast('ë¡œê·¸ì•„ì›ƒ','i');setTimeout(()=>window.location.href='login.html',500);}

// =================== INIT ===================
(function init(){
  const user=JSON.parse(localStorage.getItem('tl_user')||'{}');
  const nu=$('nav-user');if(nu)nu.textContent=user.username||'Demo';
  if(user.tl)S.wallet.tl=user.tl;
  $('nav-bal').classList.remove('hidden');
  updateBal();updateTrust();updateRate();
  renderHotPulse();renderRadio();renderLibResults();renderShare();
  renderGenreChips();setEngine('tl');
})();
</script>
</body>
</html>
