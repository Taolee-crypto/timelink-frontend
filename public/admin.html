<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ê´€ë¦¬ì í˜ì´ì§€ - TimeLink</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: 'Inter', sans-serif; background: #f1f5f9; color: #0f172a; }

/* ë„¤ë¹„ê²Œì´ì…˜ */
.navbar {
  background: white; border-bottom: 1px solid #e2e8f0; padding: 0 24px; height: 64px;
  display: flex; align-items: center; justify-content: space-between; position: sticky; top: 0; z-index: 100;
}
.logo { display: flex; align-items: center; gap: 10px; font-size: 20px; font-weight: 800; color: #0f172a; text-decoration: none; }
.logo-icon { width: 32px; height: 32px; background: #3b82f6; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white; font-size: 16px; }
.logo span { color: #3b82f6; }

/* ê´€ë¦¬ì ë°°ì§€ */
.admin-badge {
  background: #3b82f6; color: white; padding: 4px 12px; border-radius: 999px;
  font-size: 12px; font-weight: 600; margin-left: 12px;
}

/* íƒ­ ë©”ë‰´ */
.tabs {
  background: white; border-bottom: 1px solid #e2e8f0; padding: 0 24px; display: flex; gap: 4px;
}
.tab {
  padding: 12px 20px; font-size: 14px; font-weight: 600; color: #64748b;
  cursor: pointer; border-bottom: 2px solid transparent; transition: all 0.2s;
  text-decoration: none;
}
.tab:hover { color: #3b82f6; }
.tab.active { color: #3b82f6; border-bottom-color: #3b82f6; }

/* ë©”ì¸ ì»¨í…ì¸  */
.container { max-width: 1400px; margin: 0 auto; padding: 24px; }

/* í†µê³„ ì¹´ë“œ */
.stats-grid {
  display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 24px;
}
.stat-card {
  background: white; border-radius: 16px; padding: 20px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}
.stat-label { font-size: 14px; color: #64748b; margin-bottom: 8px; }
.stat-value { font-size: 32px; font-weight: 700; color: #0f172a; }
.stat-change { font-size: 13px; color: #10b981; margin-top: 4px; }

/* ë°ì´í„° í…Œì´ë¸” */
.data-card {
  background: white; border-radius: 16px; padding: 24px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);
  margin-bottom: 24px;
}
.card-header {
  display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px;
}
.card-title { font-size: 18px; font-weight: 700; }
.card-title span { color: #64748b; font-size: 14px; font-weight: normal; margin-left: 8px; }

table {
  width: 100%; border-collapse: collapse;
}
th {
  text-align: left; padding: 12px; background: #f8fafc; color: #475569; font-size: 13px; font-weight: 600;
}
td {
  padding: 12px; border-bottom: 1px solid #e2e8f0; font-size: 14px;
}
tr:hover td { background: #f8fafc; }

/* ë°°ì§€ */
.badge {
  display: inline-block; padding: 4px 8px; border-radius: 999px; font-size: 11px; font-weight: 600;
}
.badge-success { background: #d1fae5; color: #065f46; }
.badge-warning { background: #fed7aa; color: #92400e; }
.badge-danger { background: #fee2e2; color: #991b1b; }
.badge-info { background: #dbeafe; color: #1e40af; }

/* ë²„íŠ¼ */
.btn {
  padding: 8px 16px; border-radius: 8px; font-size: 13px; font-weight: 600;
  cursor: pointer; border: none; transition: all 0.2s;
}
.btn-primary { background: #3b82f6; color: white; }
.btn-primary:hover { background: #2563eb; }
.btn-outline { background: white; border: 1px solid #e2e8f0; color: #475569; }
.btn-outline:hover { background: #f8fafc; }
.btn-sm { padding: 4px 8px; font-size: 12px; }
.btn-danger { background: #ef4444; color: white; }
.btn-danger:hover { background: #dc2626; }

/* í•„í„° ë°” */
.filter-bar {
  display: flex; gap: 12px; margin-bottom: 20px; flex-wrap: wrap;
}
.filter-input {
  padding: 8px 12px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 13px;
  min-width: 200px;
}
.filter-select {
  padding: 8px 12px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 13px;
  background: white;
}

/* ëª¨ë‹¬ */
.modal-overlay {
  position: fixed; inset: 0; background: rgba(0,0,0,0.5); display: none;
  align-items: center; justify-content: center; z-index: 1000;
}
.modal-overlay.show { display: flex; }
.modal {
  background: white; border-radius: 16px; padding: 24px; width: 90%; max-width: 400px;
}
.modal-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; }
.modal-title { font-size: 18px; font-weight: 700; }
.modal-close { background: none; border: none; font-size: 20px; cursor: pointer; color: #64748b; }

/* ì¸ì¦ ì½”ë“œ ì…ë ¥ */
.verify-input {
  width: 100%; padding: 12px; border: 1px solid #e2e8f0; border-radius: 8px;
  font-size: 16px; text-align: center; letter-spacing: 4px; margin-bottom: 16px;
}
.verify-info {
  background: #dbeafe; border-radius: 8px; padding: 12px; margin-bottom: 16px;
  font-size: 14px; color: #1e40af; text-align: center;
}

/* ë¡œê·¸ì¸ í¼ */
.login-container {
  max-width: 360px; margin: 100px auto; padding: 32px;
  background: white; border-radius: 16px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
}
.login-title { font-size: 24px; font-weight: 700; text-align: center; margin-bottom: 24px; }
.login-input {
  width: 100%; padding: 12px; border: 1px solid #e2e8f0; border-radius: 8px;
  margin-bottom: 16px; font-size: 14px;
}
.login-btn {
  width: 100%; padding: 12px; background: #3b82f6; color: white; border: none;
  border-radius: 8px; font-weight: 600; cursor: pointer;
}
.login-btn:hover { background: #2563eb; }

.hidden { display: none !important; }
</style>

<script>
// ==================== ê³µí†µ ë¡œê·¸ì¸ ìƒíƒœ ê´€ë¦¬ ====================
let currentUser = JSON.parse(localStorage.getItem('tl_user') || 'null');
let carMode = localStorage.getItem('tl_car') === 'true';

// ë„¤ë¹„ê²Œì´ì…˜ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
function updateNavbar() {
  const navAuth = document.getElementById('nav-auth');
  const navGuest = document.getElementById('nav-guest');
  const balanceTl = document.getElementById('balance-tl');
  const balanceTlc = document.getElementById('balance-tlc');
  const avatarLetter = document.getElementById('avatar-letter');
  const carStatus = document.getElementById('car-status');
  const carIndicator = document.getElementById('car-indicator');

  if (currentUser) {
    // ë¡œê·¸ì¸ ìƒíƒœ
    if (navAuth) navAuth.classList.remove('hidden');
    if (navGuest) navGuest.classList.add('hidden');
    if (balanceTl) balanceTl.innerHTML = `<span data-currency="${currentUser.tl || 0}">${(currentUser.tl || 0).toLocaleString()}</span>`;
    if (balanceTlc) balanceTlc.textContent = (currentUser.tlc || 0).toFixed(4);
    if (avatarLetter) avatarLetter.textContent = (currentUser.username || 'U').charAt(0).toUpperCase();
  } else {
    // ë¡œê·¸ì•„ì›ƒ ìƒíƒœ
    if (navAuth) navAuth.classList.add('hidden');
    if (navGuest) navGuest.classList.remove('hidden');
  }
  
  // Car Mode í‘œì‹œ
  if (carStatus) carStatus.textContent = carMode ? 'ON' : 'Off';
  if (carIndicator) carIndicator.className = 'car-indicator' + (carMode ? ' on' : '');
}

// ë“œë¡­ë‹¤ìš´ í† ê¸€
function toggleDropdown() {
  document.getElementById('dropdown')?.classList.toggle('show');
}

// ì™¸ë¶€ í´ë¦­ì‹œ ë“œë¡­ë‹¤ìš´ ë‹«ê¸°
document.addEventListener('click', (e) => {
  if (!e.target.closest('.avatar')) {
    document.getElementById('dropdown')?.classList.remove('show');
  }
});

// ë¡œê·¸ì•„ì›ƒ í•¨ìˆ˜ (ëª¨ë“  í˜ì´ì§€ì—ì„œ ë™ì¼í•˜ê²Œ ë™ì‘)
function logout() {
  // ì‚¬ìš©ì ì •ë³´ ì‚­ì œ
  localStorage.removeItem('tl_user');
  localStorage.removeItem('auth_token');
  
  // currentUser ë³€ìˆ˜ ì—…ë°ì´íŠ¸
  currentUser = null;
  
  // ë„¤ë¹„ê²Œì´ì…˜ ì—…ë°ì´íŠ¸
  updateNavbar();
  
  // ë©”ì¸ í˜ì´ì§€ë¡œ ì´ë™
  window.location.href = 'index.html';
}

// í˜ì´ì§€ ë¡œë“œì‹œ ì‹¤í–‰
document.addEventListener('DOMContentLoaded', function() {
  updateNavbar();
  
  // ë¡œê·¸ì¸ ìƒíƒœ ë³€ê²½ ê°ì§€ (ë‹¤ë¥¸ íƒ­ì—ì„œ ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ ì‹œ)
  window.addEventListener('storage', function(e) {
    if (e.key === 'tl_user') {
      currentUser = JSON.parse(e.newValue || 'null');
      updateNavbar();
    }
  });
});
</script>
<script>
// ==================== ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸ ====================
(function() {
  // í˜„ì¬ ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸
  const currentUser = JSON.parse(localStorage.getItem('tl_user') || 'null');
  const navAuth = document.getElementById('nav-auth');
  const navGuest = document.getElementById('nav-guest');
  
  // ë””ë²„ê¹…ìš© ë¡œê·¸
  console.log('Current user:', currentUser);
  console.log('navAuth exists:', !!navAuth);
  console.log('navGuest exists:', !!navGuest);
  
  // ë„¤ë¹„ê²Œì´ì…˜ ì—…ë°ì´íŠ¸
  if (currentUser) {
    if (navAuth) {
      navAuth.classList.remove('hidden');
      console.log('navAuth hidden ì œê±°ë¨');
    }
    if (navGuest) {
      navGuest.classList.add('hidden');
      console.log('navGuest hidden ì¶”ê°€ë¨');
    }
    
    // ì‚¬ìš©ì ì •ë³´ í‘œì‹œ
    const balanceTl = document.getElementById('balance-tl');
    const balanceTlc = document.getElementById('balance-tlc');
    const avatarLetter = document.getElementById('avatar-letter');
    
    if (balanceTl) balanceTl.textContent = (currentUser.tl || 0).toLocaleString();
    if (balanceTlc) balanceTlc.textContent = (currentUser.tlc || 0).toFixed(4);
    if (avatarLetter) avatarLetter.textContent = (currentUser.username || 'U').charAt(0).toUpperCase();
  } else {
    if (navAuth) {
      navAuth.classList.add('hidden');
      console.log('navAuth hidden ì¶”ê°€ë¨');
    }
    if (navGuest) {
      navGuest.classList.remove('hidden');
      console.log('navGuest hidden ì œê±°ë¨');
    }
  }
  
  // Car Mode í‘œì‹œ
  const carMode = localStorage.getItem('tl_car') === 'true';
  const carStatus = document.getElementById('car-status');
  const carIndicator = document.getElementById('car-indicator');
  
  if (carStatus) carStatus.textContent = carMode ? 'ON' : 'Off';
  if (carIndicator) carIndicator.className = 'car-indicator' + (carMode ? ' on' : '');
})();

// ë“œë¡­ë‹¤ìš´ í† ê¸€
function toggleDropdown() {
  document.getElementById('dropdown')?.classList.toggle('show');
}

// ì™¸ë¶€ í´ë¦­ì‹œ ë“œë¡­ë‹¤ìš´ ë‹«ê¸°
document.addEventListener('click', (e) => {
  if (!e.target.closest('.avatar')) {
    document.getElementById('dropdown')?.classList.remove('show');
  }
});

// ë¡œê·¸ì•„ì›ƒ í•¨ìˆ˜
function logout() {
  localStorage.removeItem('tl_user');
  localStorage.removeItem('auth_token');
  alert('ë¡œê·¸ì•„ì›ƒ ë˜ì—ˆìŠµë‹ˆë‹¤.');
  window.location.href = 'index.html';
}
</script>
</head>
<body>
<div id="admin-login" class="login-container">
  <div class="login-title">ğŸ” ê´€ë¦¬ì ë¡œê·¸ì¸</div>
  <input type="text" id="admin-id" class="login-input" placeholder="ê´€ë¦¬ì ID" value="admin">
  <input type="password" id="admin-pw" class="login-input" placeholder="ë¹„ë°€ë²ˆí˜¸" value="admin1234">
  <button class="login-btn" onclick="adminLogin()">ë¡œê·¸ì¸</button>
</div>

<div id="admin-panel" class="hidden">
  <nav class="navbar">
    <a href="index.html" class="logo"><div class="logo-icon">âš¡</div><div>Time<span>Link</span> <span class="admin-badge">ADMIN</span></div></a>
    <div style="display: flex; gap: 12px;">
      <span style="color: #64748b;">ê´€ë¦¬ì: <strong id="admin-name">admin</strong></span>
      <button class="btn btn-outline btn-sm" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
    </div>
  </nav>

  <div class="tabs">
    <a href="#" class="tab active" onclick="showTab('dashboard')">ğŸ“Š ëŒ€ì‹œë³´ë“œ</a>
    <a href="#" class="tab" onclick="showTab('users')">ğŸ‘¥ ì‚¬ìš©ì</a>
    <a href="#" class="tab" onclick="showTab('tracks')">ğŸµ íŠ¸ë™</a>
    <a href="#" class="tab" onclick="showTab('exchanges')">ğŸ’° í™˜ì „</a>
    <a href="#" class="tab" onclick="showTab('settings')">âš™ï¸ ì„¤ì •</a>
  </div>

  <div class="container">
    <!-- ëŒ€ì‹œë³´ë“œ -->
    <div id="dashboard-tab">
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-label">ì´ ì‚¬ìš©ì</div>
          <div class="stat-value" id="total-users">0</div>
          <div class="stat-change" id="new-users-today">+0 ì˜¤ëŠ˜</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">ì´ íŠ¸ë™</div>
          <div class="stat-value" id="total-tracks">0</div>
          <div class="stat-change" id="new-tracks-today">+0 ì˜¤ëŠ˜</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">ì´ TL</div>
          <div class="stat-value" id="total-tl">0</div>
          <div class="stat-change">ìœ í†µëŸ‰</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">í™˜ì „ ìš”ì²­</div>
          <div class="stat-value" id="pending-exchanges">0</div>
          <div class="stat-change">ëŒ€ê¸° ì¤‘</div>
        </div>
      </div>

      <div class="data-card">
        <div class="card-header">
          <div class="card-title">ìµœê·¼ ê°€ì…ì</div>
          <button class="btn btn-outline btn-sm" onclick="refreshData()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
        </div>
        <table id="recent-users-table">
          <thead><tr><th>ID</th><th>ì‚¬ìš©ìëª…</th><th>ì´ë©”ì¼</th><th>ì—­í• </th><th>TL</th><th>ê°€ì…ì¼</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <!-- ì‚¬ìš©ì ê´€ë¦¬ -->
    <div id="users-tab" class="hidden">
      <div class="data-card">
        <div class="card-header">
          <div class="card-title">ì „ì²´ ì‚¬ìš©ì ëª©ë¡</div>
          <div style="display: flex; gap: 8px;">
            <input type="text" class="filter-input" id="user-search" placeholder="ê²€ìƒ‰...">
            <button class="btn btn-primary btn-sm" onclick="searchUsers()">ê²€ìƒ‰</button>
          </div>
        </div>
        <table id="users-table">
          <thead><tr><th>ID</th><th>ì‚¬ìš©ìëª…</th><th>ì´ë©”ì¼</th><th>ì—­í• </th><th>TL</th><th>TLC</th><th>ì‚¬ì—…ì</th><th>ê°€ì…ì¼</th><th>ê´€ë¦¬</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <!-- íŠ¸ë™ ê´€ë¦¬ -->
    <div id="tracks-tab" class="hidden">
      <div class="data-card">
        <div class="card-header">
          <div class="card-title">ì „ì²´ íŠ¸ë™ ëª©ë¡</div>
          <button class="btn btn-primary btn-sm" onclick="refreshTracks()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
        </div>
        <table id="tracks-table">
          <thead><tr><th>ID</th><th>ì œëª©</th><th>ì•„í‹°ìŠ¤íŠ¸</th><th>ì¥ë¥´</th><th>TL</th><th>Pulse</th><th>ì¸ì¦</th><th>ì—…ë¡œë“œì¼</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <!-- í™˜ì „ ê´€ë¦¬ -->
    <div id="exchanges-tab" class="hidden">
      <div class="data-card">
        <div class="card-header">
          <div class="card-title">í™˜ì „ ìš”ì²­ ëª©ë¡</div>
          <select class="filter-select" onchange="filterExchanges(this.value)">
            <option value="all">ì „ì²´</option>
            <option value="pending">ëŒ€ê¸°ì¤‘</option>
            <option value="completed">ì™„ë£Œ</option>
          </select>
        </div>
        <table id="exchanges-table">
          <thead><tr><th>ID</th><th>ì‚¬ìš©ì</th><th>ê¸ˆì•¡(TL)</th><th>ê²°ì œë°©ì‹</th><th>ìƒíƒœ</th><th>ìš”ì²­ì¼</th><th>ì²˜ë¦¬</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <!-- ì„¤ì • (ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ + 2ì°¨ ì¸ì¦) -->
    <div id="settings-tab" class="hidden">
      <div class="data-card">
        <div class="card-header">
          <div class="card-title">âš™ï¸ ì‹œìŠ¤í…œ ì„¤ì •</div>
        </div>
        
        <!-- í™˜ìœ¨ ì„¤ì • -->
        <div style="padding: 20px; border-bottom: 1px solid #e2e8f0;">
          <h3 style="font-size: 16px; margin-bottom: 16px;">ğŸ’° í™˜ìœ¨ ì„¤ì •</h3>
          <div style="display: flex; align-items: center; gap: 12px;">
            <label style="min-width: 100px;">1TL = </label>
            <input type="number" id="exchange-rate" value="1" min="0.1" step="0.1" style="padding: 8px; border: 1px solid #e2e8f0; border-radius: 8px; width: 100px;">
            <span>ì›</span>
            <button class="btn btn-primary btn-sm" onclick="updateRate()">ì €ì¥</button>
          </div>
        </div>

        <!-- ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ (2ì°¨ ì¸ì¦ í¬í•¨) -->
        <div style="padding: 20px;">
          <h3 style="font-size: 16px; margin-bottom: 16px;">ğŸ” ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</h3>
          
          <!-- í˜„ì¬ ë¹„ë°€ë²ˆí˜¸ í™•ì¸ -->
          <div style="margin-bottom: 16px;">
            <label style="display: block; font-weight: 600; margin-bottom: 8px;">í˜„ì¬ ë¹„ë°€ë²ˆí˜¸</label>
            <input type="password" id="current-pw" placeholder="í˜„ì¬ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥" style="width: 100%; max-width: 300px; padding: 8px; border: 1px solid #e2e8f0; border-radius: 8px;">
          </div>

          <!-- 2ì°¨ ì¸ì¦ ìš”ì²­ ë²„íŠ¼ -->
          <div style="margin-bottom: 16px;">
            <button class="btn btn-primary" onclick="requestVerification()" id="request-verify-btn">
              ğŸ“§ ì´ë©”ì¼ë¡œ ì¸ì¦ì½”ë“œ ë°›ê¸°
            </button>
            <span id="verify-timer" style="margin-left: 12px; color: #64748b;"></span>
          </div>

          <!-- ì¸ì¦ ì½”ë“œ ì…ë ¥ (ì²˜ìŒì—ëŠ” ìˆ¨ê¹€) -->
          <div id="verify-section" style="margin-bottom: 16px; display: none;">
            <label style="display: block; font-weight: 600; margin-bottom: 8px;">ì¸ì¦ì½”ë“œ (mununglee@gmail.comìœ¼ë¡œ ë°œì†¡ë¨)</label>
            <div style="display: flex; gap: 8px; align-items: center;">
              <input type="text" id="verify-code" placeholder="6ìë¦¬ ì½”ë“œ ì…ë ¥" maxlength="6" style="flex: 1; padding: 8px; border: 1px solid #e2e8f0; border-radius: 8px; text-align: center; letter-spacing: 4px;">
              <button class="btn btn-outline btn-sm" onclick="verifyCode()">í™•ì¸</button>
            </div>
            <div id="verify-message" style="margin-top: 8px; font-size: 13px;"></div>
          </div>

          <!-- ìƒˆ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ (ì¸ì¦æˆåŠŸå í‘œì‹œ) -->
          <div id="new-password-section" style="display: none;">
            <div style="background: #d1fae5; border-radius: 8px; padding: 12px; margin-bottom: 16px;">
              âœ… ì´ë©”ì¼ ì¸ì¦ ì™„ë£Œ! ìƒˆ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”.
            </div>
            <div style="margin-bottom: 12px;">
              <label style="display: block; font-weight: 600; margin-bottom: 8px;">ìƒˆ ë¹„ë°€ë²ˆí˜¸</label>
              <input type="password" id="new-pw" placeholder="ìƒˆ ë¹„ë°€ë²ˆí˜¸" style="width: 100%; max-width: 300px; padding: 8px; border: 1px solid #e2e8f0; border-radius: 8px;">
            </div>
            <div style="margin-bottom: 12px;">
              <label style="display: block; font-weight: 600; margin-bottom: 8px;">ìƒˆ ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
              <input type="password" id="confirm-pw" placeholder="ë¹„ë°€ë²ˆí˜¸ í™•ì¸" style="width: 100%; max-width: 300px; padding: 8px; border: 1px solid #e2e8f0; border-radius: 8px;">
            </div>
            <button class="btn btn-primary" onclick="changePassword()">ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ì¸ì¦ ì½”ë“œ ëª¨ë‹¬ (ì‹¤ì œë¡œëŠ” ìœ„ì— ì„¹ì…˜ìœ¼ë¡œ ëŒ€ì²´) -->
<div id="verify-modal" class="modal-overlay">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-title">ğŸ“§ ì´ë©”ì¼ ì¸ì¦</div>
      <button class="modal-close" onclick="closeModal('verify-modal')">âœ•</button>
    </div>
    <div class="verify-info">
      <strong>mununglee@gmail.com</strong> ìœ¼ë¡œ<br>6ìë¦¬ ì¸ì¦ì½”ë“œê°€ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.
    </div>
    <input type="text" id="modal-verify-code" class="verify-input" placeholder="000000" maxlength="6">
    <div style="display: flex; gap: 8px;">
      <button class="btn btn-outline" style="flex: 1;" onclick="resendCode()">ì¬ì „ì†¡</button>
      <button class="btn btn-primary" style="flex: 1;" onclick="confirmCode()">í™•ì¸</button>
    </div>
  </div>
</div>

<script>
const API_URL = 'https://timelink-api.mununglee.workers.dev';
const ADMIN_EMAIL = 'mununglee@gmail.com';

// ì„ì‹œ ì €ì¥ì†Œ
let verificationCode = null;
let isVerified = false;
let timerInterval = null;

// ê´€ë¦¬ì ë¡œê·¸ì¸
function adminLogin() {
  const id = document.getElementById('admin-id').value;
  const pw = document.getElementById('admin-pw').value;
  
  if (id === 'admin' && pw === 'admin1234') {
    document.getElementById('admin-login').classList.add('hidden');
    document.getElementById('admin-panel').classList.remove('hidden');
    loadDashboard();
  } else {
    alert('ê´€ë¦¬ì ê³„ì •ì´ ì•„ë‹™ë‹ˆë‹¤.');
  }
}

// ë¡œê·¸ì•„ì›ƒ
function logout() {
  document.getElementById('admin-login').classList.remove('hidden');
  document.getElementById('admin-panel').classList.add('hidden');
  isVerified = false;
  resetPasswordSection();
}

// íƒ­ ì „í™˜
function showTab(tab) {
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  event.target.classList.add('active');
  
  document.querySelectorAll('[id$="-tab"]').forEach(t => t.classList.add('hidden'));
  document.getElementById(`${tab}-tab`).classList.remove('hidden');
  
  if (tab === 'users') loadUsers();
  if (tab === 'tracks') loadTracks();
  if (tab === 'exchanges') loadExchanges();
}

// ==================== ì´ë©”ì¼ ì¸ì¦ ê´€ë ¨ í•¨ìˆ˜ ====================

// ì¸ì¦ì½”ë“œ ìš”ì²­
function requestVerification() {
  const currentPw = document.getElementById('current-pw').value;
  
  if (!currentPw) {
    alert('í˜„ì¬ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
    return;
  }
  
  if (currentPw !== 'admin1234') {
    alert('í˜„ì¬ ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
    return;
  }
  
  // 6ìë¦¬ ëœë¤ ì½”ë“œ ìƒì„±
  verificationCode = Math.floor(100000 + Math.random() * 900000).toString();
  
  // ì´ë©”ì¼ ë°œì†¡ ì‹œë®¬ë ˆì´ì…˜ (ì‹¤ì œë¡œëŠ” ë°±ì—”ë“œ API í˜¸ì¶œ)
  console.log(`[ì´ë©”ì¼ ë°œì†¡] ${ADMIN_EMAIL}ë¡œ ì¸ì¦ì½”ë“œ ${verificationCode} ì „ì†¡`);
  
  // UI ì—…ë°ì´íŠ¸
  document.getElementById('verify-section').style.display = 'block';
  document.getElementById('request-verify-btn').disabled = true;
  document.getElementById('request-verify-btn').style.opacity = '0.5';
  
  // íƒ€ì´ë¨¸ ì‹œì‘ (3ë¶„)
  let timeLeft = 180;
  const timerDisplay = document.getElementById('verify-timer');
  
  if (timerInterval) clearInterval(timerInterval);
  
  timerInterval = setInterval(() => {
    timeLeft--;
    if (timeLeft <= 0) {
      clearInterval(timerInterval);
      timerDisplay.textContent = 'â° ì¸ì¦ì‹œê°„ ë§Œë£Œ';
      verificationCode = null;
      document.getElementById('request-verify-btn').disabled = false;
      document.getElementById('request-verify-btn').style.opacity = '1';
    } else {
      const min = Math.floor(timeLeft / 60);
      const sec = timeLeft % 60;
      timerDisplay.textContent = `â±ï¸ ${min}:${sec.toString().padStart(2, '0')}`;
    }
  }, 1000);
  
  alert(`ğŸ“§ ${ADMIN_EMAIL}ë¡œ ì¸ì¦ì½”ë“œê°€ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤. (í…ŒìŠ¤íŠ¸ìš© ì½”ë“œ: ${verificationCode})`);
}

// ì¸ì¦ì½”ë“œ í™•ì¸
function verifyCode() {
  const inputCode = document.getElementById('verify-code').value;
  
  if (!verificationCode) {
    document.getElementById('verify-message').innerHTML = 'âŒ ì¸ì¦ì½”ë“œê°€ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ìš”ì²­í•´ì£¼ì„¸ìš”.';
    document.getElementById('verify-message').style.color = '#ef4444';
    return;
  }
  
  if (inputCode === verificationCode) {
    document.getElementById('verify-message').innerHTML = 'âœ… ì¸ì¦ ì™„ë£Œ! ìƒˆ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”.';
    document.getElementById('verify-message').style.color = '#10b981';
    
    // ì¸ì¦ ì„±ê³µ
    isVerified = true;
    
    // íƒ€ì´ë¨¸ ì¤‘ì§€
    if (timerInterval) clearInterval(timerInterval);
    document.getElementById('verify-timer').textContent = 'âœ… ì¸ì¦ì™„ë£Œ';
    
    // ìƒˆ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ ì„¹ì…˜ í‘œì‹œ
    document.getElementById('new-password-section').style.display = 'block';
    document.getElementById('verify-section').style.display = 'none';
    document.getElementById('request-verify-btn').style.display = 'none';
  } else {
    document.getElementById('verify-message').innerHTML = 'âŒ ì¸ì¦ì½”ë“œê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.';
    document.getElementById('verify-message').style.color = '#ef4444';
  }
}

// ë¹„ë°€ë²ˆí˜¸ ë³€ê²½
function changePassword() {
  if (!isVerified) {
    alert('ë¨¼ì € ì´ë©”ì¼ ì¸ì¦ì„ ì™„ë£Œí•´ì£¼ì„¸ìš”.');
    return;
  }
  
  const newPw = document.getElementById('new-pw').value;
  const confirmPw = document.getElementById('confirm-pw').value;
  
  if (!newPw || !confirmPw) {
    alert('ìƒˆ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
    return;
  }
  
  if (newPw !== confirmPw) {
    alert('ìƒˆ ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
    return;
  }
  
  if (newPw.length < 6) {
    alert('ë¹„ë°€ë²ˆí˜¸ëŠ” ìµœì†Œ 6ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.');
    return;
  }
  
  // ì‹¤ì œë¡œëŠ” ë°±ì—”ë“œ API í˜¸ì¶œ
  alert('âœ… ë¹„ë°€ë²ˆí˜¸ê°€ ì„±ê³µì ìœ¼ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤. ìƒˆ ë¹„ë°€ë²ˆí˜¸ë¡œ ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.');
  
  // ì´ˆê¸°í™”
  resetPasswordSection();
  logout();
}

// ë¹„ë°€ë²ˆí˜¸ ì„¹ì…˜ ì´ˆê¸°í™”
function resetPasswordSection() {
  document.getElementById('current-pw').value = '';
  document.getElementById('verify-code').value = '';
  document.getElementById('new-pw').value = '';
  document.getElementById('confirm-pw').value = '';
  document.getElementById('verify-section').style.display = 'none';
  document.getElementById('new-password-section').style.display = 'none';
  document.getElementById('request-verify-btn').disabled = false;
  document.getElementById('request-verify-btn').style.opacity = '1';
  document.getElementById('request-verify-btn').style.display = 'block';
  document.getElementById('verify-timer').textContent = '';
  verificationCode = null;
  isVerified = false;
  if (timerInterval) clearInterval(timerInterval);
}

// ==================== ë°ì´í„° ë¡œë“œ í•¨ìˆ˜ ====================

// ëŒ€ì‹œë³´ë“œ ë°ì´í„° ë¡œë“œ
async function loadDashboard() {
  document.getElementById('total-users').textContent = '124';
  document.getElementById('new-users-today').textContent = '+3 ì˜¤ëŠ˜';
  document.getElementById('total-tracks').textContent = '356';
  document.getElementById('new-tracks-today').textContent = '+12 ì˜¤ëŠ˜';
  document.getElementById('total-tl').textContent = '1,234,567';
  document.getElementById('pending-exchanges').textContent = '5';
  
  const tbody = document.querySelector('#recent-users-table tbody');
  tbody.innerHTML = `
    <tr><td>1</td><td>demo</td><td>demo@timelink.digital</td><td>listener</td><td>10,000</td><td>2025-02-25</td></tr>
    <tr><td>2</td><td>creator1</td><td>creator@test.com</td><td>creator</td><td>15,000</td><td>2025-02-24</td></tr>
    <tr><td>3</td><td>business1</td><td>cafe@test.com</td><td>business</td><td>20,000</td><td>2025-02-23</td></tr>
  `;
}

// ì‚¬ìš©ì ëª©ë¡ ë¡œë“œ
async function loadUsers() {
  const tbody = document.querySelector('#users-table tbody');
  tbody.innerHTML = `
    <tr>
      <td>1</td><td>demo</td><td>demo@timelink.digital</td><td>listener</td><td>10,000</td><td>0.1234</td><td>-</td><td>2025-02-25</td>
      <td><button class="btn btn-outline btn-sm" onclick="editUser(1)">âœï¸</button></td>
    </tr>
  `;
}

// íŠ¸ë™ ëª©ë¡ ë¡œë“œ
async function loadTracks() {
  const tbody = document.querySelector('#tracks-table tbody');
  tbody.innerHTML = `
    <tr><td>1</td><td>Midnight Vibe</td><td>Synthwave Studio</td><td>Electronic</td><td>2,000</td><td>84,200</td><td><span class="badge badge-success">ì¸ì¦</span></td><td>2025-02-25</td></tr>
  `;
}

// í™˜ì „ ëª©ë¡ ë¡œë“œ
async function loadExchanges() {
  const tbody = document.querySelector('#exchanges-table tbody');
  tbody.innerHTML = `
    <tr>
      <td>1</td><td>demo</td><td>1,000</td><td>ì¹´ì¹´ì˜¤í˜ì´</td><td><span class="badge badge-warning">ëŒ€ê¸°ì¤‘</span></td><td>2025-02-25</td>
      <td><button class="btn btn-success btn-sm" onclick="processExchange(1)">âœ… ìŠ¹ì¸</button></td>
    </tr>
  `;
}

// í™˜ìœ¨ ì„¤ì •
function updateRate() {
  const rate = document.getElementById('exchange-rate').value;
  alert(`í™˜ìœ¨ì´ 1TL = ${rate}ì›ìœ¼ë¡œ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤.`);
}

// ê¸°íƒ€ í•¨ìˆ˜ë“¤
function refreshData() { loadDashboard(); }
function refreshTracks() { loadTracks(); }
function searchUsers() { alert('ê²€ìƒ‰ ê¸°ëŠ¥ êµ¬í˜„ ì˜ˆì •'); }
function filterExchanges(status) { alert(`'${status}' í•„í„° êµ¬í˜„ ì˜ˆì •`); }
function editUser(id) { alert(`ì‚¬ìš©ì ${id} ìˆ˜ì • êµ¬í˜„ ì˜ˆì •`); }
function processExchange(id) { alert(`í™˜ì „ ${id} ìŠ¹ì¸ êµ¬í˜„ ì˜ˆì •`); }
function closeModal(id) { document.getElementById(id).classList.remove('show'); }
function resendCode() { alert('ì¸ì¦ì½”ë“œ ì¬ì „ì†¡'); }
function confirmCode() { alert('ì¸ì¦ í™•ì¸'); }
</script>
</body>
</html>


