<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>관리자 페이지 - TimeLink</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: Inter, sans-serif; background: #f1f5f9; color: #0f172a; }

/* 네비게이션 */
.navbar {
  background: white; border-bottom: 1px solid #e2e8f0; padding: 0 24px; height: 64px;
  display: flex; align-items: center; justify-content: space-between; position: sticky; top: 0; z-index: 100;
}
.logo { display: flex; align-items: center; gap: 10px; font-size: 20px; font-weight: 800; color: #0f172a; text-decoration: none; }
.logo-icon { width: 32px; height: 32px; background: #f59e0b; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white; font-size: 16px; }
.logo span { color: #f59e0b; }

/* 관리자 배지 */
.admin-badge {
  background: #3b82f6; color: white; padding: 4px 12px; border-radius: 999px;
  font-size: 12px; font-weight: 600; margin-left: 12px;
}

/* 탭 메뉴 */
.tabs {
  background: white; border-bottom: 1px solid #e2e8f0; padding: 0 24px; display: flex; gap: 4px;
}
.tab {
  padding: 12px 20px; font-size: 14px; font-weight: 600; color: #64748b;
  cursor: pointer; border-bottom: 2px solid transparent; transition: all 0.2s;
  text-decoration: none;
}
.tab:hover { color: #3b82f6; }
.tab.active { color: #3b82f6; border-bottom-color: #3b82f6; }

/* 메인 컨텐츠 */
.container { max-width: 1400px; margin: 0 auto; padding: 24px; }

/* 통계 카드 */
.stats-grid {
  display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 24px;
}
.stat-card {
  background: white; border-radius: 16px; padding: 20px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}
.stat-label { font-size: 14px; color: #64748b; margin-bottom: 8px; }
.stat-value { font-size: 32px; font-weight: 700; color: #0f172a; }
.stat-change { font-size: 13px; color: #10b981; margin-top: 4px; }

/* 데이터 테이블 */
.data-card {
  background: white; border-radius: 16px; padding: 24px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);
  margin-bottom: 24px;
}
.card-header {
  display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px;
}
.card-title { font-size: 18px; font-weight: 700; }
.card-title span { color: #64748b; font-size: 14px; font-weight: normal; margin-left: 8px; }

table {
  width: 100%; border-collapse: collapse;
}
th {
  text-align: left; padding: 12px; background: #f8fafc; color: #475569; font-size: 13px; font-weight: 600;
}
td {
  padding: 12px; border-bottom: 1px solid #e2e8f0; font-size: 14px;
}
tr:hover td { background: #f8fafc; }

/* 배지 */
.badge {
  display: inline-block; padding: 4px 8px; border-radius: 999px; font-size: 11px; font-weight: 600;
}
.badge-success { background: #d1fae5; color: #065f46; }
.badge-warning { background: #fed7aa; color: #92400e; }
.badge-danger { background: #fee2e2; color: #991b1b; }
.badge-info { background: #dbeafe; color: #1e40af; }

/* 버튼 */
.btn {
  padding: 8px 16px; border-radius: 8px; font-size: 13px; font-weight: 600;
  cursor: pointer; border: none; transition: all 0.2s;
}
.btn-primary { background: #f59e0b; color: white; }
.btn-primary:hover { background: #d97706; }
.btn-outline { background: white; border: 1px solid #e2e8f0; color: #475569; }
.btn-outline:hover { background: #f8fafc; }
.btn-sm { padding: 4px 8px; font-size: 12px; }
.btn-danger { background: #ef4444; color: white; }
.btn-danger:hover { background: #dc2626; }

/* 필터 바 */
.filter-bar {
  display: flex; gap: 12px; margin-bottom: 20px; flex-wrap: wrap;
}
.filter-input {
  padding: 8px 12px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 13px;
  min-width: 200px;
}
.filter-select {
  padding: 8px 12px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 13px;
  background: white;
}

/* 모달 */
.modal-overlay {
  position: fixed; inset: 0; background: rgba(0,0,0,0.5); display: none;
  align-items: center; justify-content: center; z-index: 1000;
}
.modal-overlay.show { display: flex; }
.modal {
  background: white; border-radius: 16px; padding: 24px; width: 90%; max-width: 400px;
}
.modal-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; }
.modal-title { font-size: 18px; font-weight: 700; }
.modal-close { background: none; border: none; font-size: 20px; cursor: pointer; color: #64748b; }

/* 인증 코드 입력 */
.verify-input {
  width: 100%; padding: 12px; border: 1px solid #e2e8f0; border-radius: 8px;
  font-size: 16px; text-align: center; letter-spacing: 4px; margin-bottom: 16px;
}
.verify-info {
  background: #dbeafe; border-radius: 8px; padding: 12px; margin-bottom: 16px;
  font-size: 14px; color: #1e40af; text-align: center;
}

/* 로그인 폼 */
.login-container {
  max-width: 360px; margin: 100px auto; padding: 32px;
  background: white; border-radius: 16px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
}
.login-title { font-size: 24px; font-weight: 700; text-align: center; margin-bottom: 24px; }
.login-input {
  width: 100%; padding: 12px; border: 1px solid #e2e8f0; border-radius: 8px;
  margin-bottom: 16px; font-size: 14px;
}
.login-btn {
  width: 100%; padding: 12px; background: #3b82f6; color: white; border: none;
  border-radius: 8px; font-weight: 600; cursor: pointer;
}
.login-btn:hover { background: #2563eb; }

.hidden { display: none !important; }
</style>

<script>
// ====== 공통 로그인 상태 관리 ======
let currentUser = JSON.parse(localStorage.getItem("tl_user") || "null");
let carMode = localStorage.getItem("tl_car") === true;

// 네비게이션 업데이트 함수
function updateNavbar() {
  const navAuth = document.getElementById(av-auth);
  const navGuest = document.getElementById(av-guest);
  const balanceTl = document.getElementById(balance-tl);
  const balanceTlc = document.getElementById(balance-tlc);
  const avatarLetter = document.getElementById(avatar-letter);
  const carStatus = document.getElementById(car-status);
  const carIndicator = document.getElementById(car-indicator);

  if (currentUser) {
    // 로그인 상태
    if (navAuth) navAuth.classList.remove("hidden");
    if (navGuest) navGuest.classList.add("hidden");
    if (balanceTl) balanceTl.innerHTML = `<span data-currency="${currentUser.tl || 0}">${(currentUser.tl || 0).toLocaleString()}</span>`;
    if (balanceTlc) balanceTlc.textContent = (currentUser.tlc || 0).toFixed(4);
    if (avatarLetter) avatarLetter.textContent = (currentUser.username || U).charAt(0).toUpperCase();
  } else {
    // 로그아웃 상태
    if (navAuth) navAuth.classList.add("hidden");
    if (navGuest) navGuest.classList.remove("hidden");
  }
  
  // Car Mode 표시
  if (carStatus) carStatus.textContent = carMode ? ON : Off;
  if (carIndicator) carIndicator.className = car-indicator + (carMode ?  on : );
}

// 드롭다운 토글
function toggleDropdown() {
  document.getElementById("dropdown")?.classList.toggle("show");
}

// 외부 클릭시 드롭다운 닫기
document.addEventListener(click, (e) => {
  if (!e.target.closest(.avatar)) {
    document.getElementById("dropdown")?.classList.remove("show");
  }
});

// 로그아웃 함수 (모든 페이지에서 동일하게 동작)
function logout() {
  // 사용자 정보 삭제
  localStorage.removeItem(tl_user);
  localStorage.removeItem(auth_token);
  
  // currentUser 변수 업데이트
  currentUser = null;
  
  // 네비게이션 업데이트
  updateNavbar();
  
  // 메인 페이지로 이동
  window.location.href = index.html;
}

// 페이지 로드시 실행
document.addEventListener(DOMContentLoaded, function() {
  updateNavbar();
  
  // 로그인 상태 변경 감지 (다른 탭에서 로그인/로그아웃 시)
  window.addEventListener(storage, function(e) {
    if (e.key === tl_user) {
      currentUser = JSON.parse(e.newValue || null);
      updateNavbar();
    }
  });
});
</script>
<script>
// ====== 로그인 상태 확인 ======
(function() {
  // 현재 로그인 상태 확인
  const currentUser = JSON.parse(localStorage.getItem("tl_user") || "null");
  const navAuth = document.getElementById(av-auth);
  const navGuest = document.getElementById(av-guest);
  
  // 디버깅용 로그
  console.log(Current user:, currentUser);
  console.log(avAuth exists:, !!navAuth);
  console.log(avGuest exists:, !!navGuest);
  
  // 네비게이션 업데이트
  if (currentUser) {
    if (navAuth) {
      navAuth.classList.remove("hidden");
      console.log(avAuth hidden 제거됨);
    }
    if (navGuest) {
      navGuest.classList.add("hidden");
      console.log(avGuest hidden 추가됨);
    }
    
    // 사용자 정보 표시
    const balanceTl = document.getElementById(balance-tl);
    const balanceTlc = document.getElementById(balance-tlc);
    const avatarLetter = document.getElementById(avatar-letter);
    
    if (balanceTl) balanceTl.textContent = (currentUser.tl || 0).toLocaleString();
    if (balanceTlc) balanceTlc.textContent = (currentUser.tlc || 0).toFixed(4);
    if (avatarLetter) avatarLetter.textContent = (currentUser.username || U).charAt(0).toUpperCase();
  } else {
    if (navAuth) {
      navAuth.classList.add("hidden");
      console.log(avAuth hidden 추가됨);
    }
    if (navGuest) {
      navGuest.classList.remove("hidden");
      console.log(avGuest hidden 제거됨);
    }
  }
  
  // Car Mode 표시
  const carMode = localStorage.getItem("tl_car") === true;
  const carStatus = document.getElementById(car-status);
  const carIndicator = document.getElementById(car-indicator);
  
  if (carStatus) carStatus.textContent = carMode ? ON : Off;
  if (carIndicator) carIndicator.className = car-indicator + (carMode ?  on : );
})();

// 드롭다운 토글
function toggleDropdown() {
  document.getElementById("dropdown")?.classList.toggle("show");
}

// 외부 클릭시 드롭다운 닫기
document.addEventListener(click, (e) => {
  if (!e.target.closest(.avatar)) {
    document.getElementById("dropdown")?.classList.remove("show");
  }
});

// 로그아웃 함수
function logout() {
  localStorage.removeItem(tl_user);
  localStorage.removeItem(auth_token);
  alert(로그아웃 되었습니다.);
  window.location.href = index.html;
}
</script>
<script>
// ====== 로그인 상태 관리 ======
(function() {
  // 현재 로그인 사용자 확인
  const currentUser = JSON.parse(localStorage.getItem("tl_user") || "null");
  
  // DOM 요소들
  const navAuth = document.getElementById(av-auth);     // 사용자 메뉴 (TL/TLC/아바타)
  const navGuest = document.getElementById(av-guest);   // 로그인/시작하기 버튼
  
  console.log(로그인 상태:, currentUser ? ✅ 로그인됨 : ❌ 로그아웃됨);
  
  if (currentUser) {
    // ✅ 로그인됨: 사용자 메뉴 보임, 로그인 버튼 숨김
    if (navAuth) {
      navAuth.classList.remove("hidden");
      console.log(사용자 메뉴 표시);
    }
    if (navGuest) {
      navGuest.classList.add("hidden");
      console.log(로그인 버튼 숨김);
    }
    
    // 사용자 정보 업데이트
    const balanceTl = document.getElementById(balance-tl);
    const balanceTlc = document.getElementById(balance-tlc);
    const avatarLetter = document.getElementById(avatar-letter);
    
    if (balanceTl) balanceTl.textContent = (currentUser.tl || 0).toLocaleString();
    if (balanceTlc) balanceTlc.textContent = (currentUser.tlc || 0).toFixed(4);
    if (avatarLetter) avatarLetter.textContent = (currentUser.username || U).charAt(0).toUpperCase();
    
  } else {
    // ❌ 로그아웃됨: 로그인 버튼 보임, 사용자 메뉴 숨김
    if (navAuth) {
      navAuth.classList.add("hidden");
      console.log(사용자 메뉴 숨김);
    }
    if (navGuest) {
      navGuest.classList.remove("hidden");
      console.log(로그인 버튼 표시);
    }
  }
  
  // Car Mode 표시
  const carMode = localStorage.getItem("tl_car") === true;
  const carStatus = document.getElementById(car-status);
  const carIndicator = document.getElementById(car-indicator);
  
  if (carStatus) carStatus.textContent = carMode ? ON : Off;
  if (carIndicator) carIndicator.className = car-indicator + (carMode ?  on : );
})();

// 드롭다운 토글 (사용자 아이콘 클릭)
function toggleDropdown() {
  const dropdown = document.getElementById("dropdown");
  if (dropdown) {
    dropdown.classList.toggle("show");
    console.log(드롭다운 토글);
  }
}

// 외부 클릭시 드롭다운 닫기
document.addEventListener(click, function(e) {
  if (!e.target.closest(.avatar)) {
    const dropdown = document.getElementById("dropdown");
    if (dropdown) dropdown.classList.remove("show");
  }
});

// 로그아웃 함수
function logout() {
  console.log(로그아웃 실행);
  localStorage.removeItem(tl_user);
  localStorage.removeItem(auth_token);
  alert(로그아웃 되었습니다.);
  window.location.href = index.html;
}
</script>
  <script src="/activity.js"></script>`n
<!-- ===== 간단한 로컬 시간 변환 ===== -->
<script>
// UTC 시간을 사용자 로컬 시간으로 변환
function displayLocalTime() {
  document.querySelectorAll([data-utc]).forEach(el => {
    const utc = el.getAttribute(data-utc);
    if (utc) {
      el.textContent = new Date(utc).toLocaleString();
    }
  });
}

// 페이지 로드 시 실행
document.addEventListener(DOMContentLoaded, displayLocalTime);
</script>
</head>
<body>
<div id="admin-login" class="login-container">
  <div class="login-title">🔐 관리자 로그인</div>
  <input type="text" id="admin-id" class="login-input" placeholder="관리자 ID" value="admin">
  <input type="password" id="admin-pw" class="login-input" placeholder="비밀번호" value="admin1234">
  <button class="login-btn" onclick="adminLogin()"><span data-i18n="login">로그인</span></button>
</div>

<div id="admin-panel" class="hidden">
  <nav class="navbar">
    <a href="index.html" class="logo"><div class="logo-icon">⚡</div><div>Time<span>Link</span> <span class="admin-badge">ADMIN</span></div></a>
    <div style="display: flex; gap: 12px;">
      <span style="color: #64748b;">관리자: <strong id="admin-name">admin</strong></span>
      <button class="btn btn-outline btn-sm" onclick="logout()"><span data-i18n="logout">로그아웃</span></button>
    </div>
  </nav>

  <div class="tabs">
    <a href="#" class="tab active" onclick="showTab(dashboard)">📊 대시보드</a>
    <a href="#" class="tab" onclick="showTab(users)">👥 사용자</a>
    <a href="#" class="tab" onclick="showTab(tracks)">🎵 트랙</a>
    <a href="#" class="tab" onclick="showTab(exchanges)">💰 환전</a>
    <a href="#" class="tab" onclick="showTab(settings)">⚙️ 설정</a>
  </div>

  <div class="container">
    <!-- 대시보드 -->
    <div id="dashboard-tab">
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-label">총 사용자</div>
          <div class="stat-value" id="total-users">0</div>
          <div class="stat-change" id="new-users-today">+0 오늘</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">총 트랙</div>
          <div class="stat-value" id="total-tracks">0</div>
          <div class="stat-change" id="new-tracks-today">+0 오늘</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">총 TL</div>
          <div class="stat-value" id="total-tl">0</div>
          <div class="stat-change">유통량</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">환전 요청</div>
          <div class="stat-value" id="pending-exchanges">0</div>
          <div class="stat-change">대기 중</div>
        </div>
      </div>

      <div class="data-card">
        <div class="card-header">
          <div class="card-title">최근 가입자</div>
          <button class="btn btn-outline btn-sm" onclick="refreshData()">🔄 새로고침</button>
        </div>
        <table id="recent-users-table">
          <thead><tr><th>ID</th><th>사용자명</th><th>이메일</th><th>역할</th><th>TL</th><th>가입일</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <!-- 사용자 관리 -->
    <div id="users-tab" class="hidden">
      <div class="data-card">
        <div class="card-header">
          <div class="card-title">전체 사용자 목록</div>
          <div style="display: flex; gap: 8px;">
            <input type="text" class="filter-input" id="user-search" placeholder="검색...">
            <button class="btn btn-primary btn-sm" onclick="searchUsers()">검색</button>
          </div>
        </div>
        <table id="users-table">
          <thead><tr><th>ID</th><th>사용자명</th><th>이메일</th><th>역할</th><th>TL</th><th>TLC</th><th>사업자</th><th>가입일</th><th>관리</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <!-- 트랙 관리 -->
    <div id="tracks-tab" class="hidden">
      <div class="data-card">
        <div class="card-header">
          <div class="card-title">전체 트랙 목록</div>
          <button class="btn btn-primary btn-sm" onclick="refreshTracks()">🔄 새로고침</button>
        </div>
        <table id="tracks-table">
          <thead><tr><th>ID</th><th>제목</th><th>아티스트</th><th>장르</th><th>TL</th><th>Pulse</th><th>인증</th><th>업로드일</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <!-- 환전 관리 -->
    <div id="exchanges-tab" class="hidden">
      <div class="data-card">
        <div class="card-header">
          <div class="card-title">환전 요청 목록</div>
          <select class="filter-select" onchange="filterExchanges(this.value)">
            <option value="all">전체</option>
            <option value="pending">대기중</option>
            <option value="completed">완료</option>
          </select>
        </div>
        <table id="exchanges-table">
          <thead><tr><th>ID</th><th>사용자</th><th>금액(TL)</th><th>결제방식</th><th>상태</th><th>요청일</th><th>처리</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <!-- 설정 (비밀번호 변경 + 2차 인증) -->
    <div id="settings-tab" class="hidden">
      <div class="data-card">
        <div class="card-header">
          <div class="card-title">⚙️ 시스템 설정</div>
        </div>
        
        <!-- 환율 설정 -->
        <div style="padding: 20px; border-bottom: 1px solid #e2e8f0;">
          <h3 style="font-size: 16px; margin-bottom: 16px;">💰 환율 설정</h3>
          <div style="display: flex; align-items: center; gap: 12px;">
            <label style="min-width: 100px;">1TL = </label>
            <input type="number" id="exchange-rate" value="1" min="0.1" step="0.1" style="padding: 8px; border: 1px solid #e2e8f0; border-radius: 8px; width: 100px;">
            <span>원</span>
            <button class="btn btn-primary btn-sm" onclick="updateRate()">저장</button>
          </div>
        </div>

        <!-- 관리자 비밀번호 변경 (2차 인증 포함) -->
        <div style="padding: 20px;">
          <h3 style="font-size: 16px; margin-bottom: 16px;">🔐 관리자 비밀번호 변경</h3>
          
          <!-- 현재 비밀번호 확인 -->
          <div style="margin-bottom: 16px;">
            <label style="display: block; font-weight: 600; margin-bottom: 8px;">현재 비밀번호</label>
            <input type="password" id="current-pw" placeholder="현재 비밀번호 입력" style="width: 100%; max-width: 300px; padding: 8px; border: 1px solid #e2e8f0; border-radius: 8px;">
          </div>

          <!-- 2차 인증 요청 버튼 -->
          <div style="margin-bottom: 16px;">
            <button class="btn btn-primary" onclick="requestVerification()" id="request-verify-btn">
              📧 이메일로 인증코드 받기
            </button>
            <span id="verify-timer" style="margin-left: 12px; color: #64748b;"></span>
          </div>

          <!-- 인증 코드 입력 (처음에는 숨김) -->
          <div id="verify-section" style="margin-bottom: 16px; display: none;">
            <label style="display: block; font-weight: 600; margin-bottom: 8px;">인증코드 (mununglee@gmail.com으로 발송됨)</label>
            <div style="display: flex; gap: 8px; align-items: center;">
              <input type="text" id="verify-code" placeholder="6자리 코드 입력" maxlength="6" style="flex: 1; padding: 8px; border: 1px solid #e2e8f0; border-radius: 8px; text-align: center; letter-spacing: 4px;">
              <button class="btn btn-outline btn-sm" onclick="verifyCode()">확인</button>
            </div>
            <div id="verify-message" style="margin-top: 8px; font-size: 13px;"></div>
          </div>

          <!-- 새 비밀번호 입력 (인증成功后 표시) -->
          <div id="new-password-section" style="display: none;">
            <div style="background: #d1fae5; border-radius: 8px; padding: 12px; margin-bottom: 16px;">
              ✅ 이메일 인증 완료! 새 비밀번호를 설정해주세요.
            </div>
            <div style="margin-bottom: 12px;">
              <label style="display: block; font-weight: 600; margin-bottom: 8px;">새 비밀번호</label>
              <input type="password" id="new-pw" placeholder="새 비밀번호" style="width: 100%; max-width: 300px; padding: 8px; border: 1px solid #e2e8f0; border-radius: 8px;">
            </div>
            <div style="margin-bottom: 12px;">
              <label style="display: block; font-weight: 600; margin-bottom: 8px;">새 비밀번호 확인</label>
              <input type="password" id="confirm-pw" placeholder="비밀번호 확인" style="width: 100%; max-width: 300px; padding: 8px; border: 1px solid #e2e8f0; border-radius: 8px;">
            </div>
            <button class="btn btn-primary" onclick="changePassword()">비밀번호 변경</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- 인증 코드 모달 (실제로는 위에 섹션으로 대체) -->
<div id="verify-modal" class="modal-overlay">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-title">📧 이메일 인증</div>
      <button class="modal-close" onclick="closeModal(verify-modal)">✕</button>
    </div>
    <div class="verify-info">
      <strong>mununglee@gmail.com</strong> 으로<br>6자리 인증코드가 발송되었습니다.
    </div>
    <input type="text" id="modal-verify-code" class="verify-input" placeholder="000000" maxlength="6">
    <div style="display: flex; gap: 8px;">
      <button class="btn btn-outline" style="flex: 1;" onclick="resendCode()">재전송</button>
      <button class="btn btn-primary" style="flex: 1;" onclick="confirmCode()">확인</button>
    </div>
  </div>
</div>

<script>
const API_URL = https://timelink-api.mununglee.workers.dev;
const ADMIN_EMAIL = mununglee@gmail.com;

// 임시 저장소
let verificationCode = null;
let isVerified = false;
let timerInterval = null;

// 관리자 로그인
function adminLogin() {
  const id = document.getElementById(admin-id).value;
  const pw = document.getElementById(admin-pw).value;
  
  if (id === admin && pw === admin1234) {
    document.getElementById(admin-login).classList.add("hidden");
    document.getElementById(admin-panel).classList.remove("hidden");
    loadDashboard();
  } else {
    alert(관리자 계정이 아닙니다.);
  }
}

// 로그아웃
function logout() {
  document.getElementById(admin-login).classList.remove("hidden");
  document.getElementById(admin-panel).classList.add("hidden");
  isVerified = false;
  resetPasswordSection();
}

// 탭 전환
function showTab(tab) {
  document.querySelectorAll(.tab).forEach(t => t.classList.remove("active"));
  event.target.classList.add("active");
  
  document.querySelectorAll([id$="-tab"]).forEach(t => t.classList.add("hidden"));
  document.getElementById(`${tab}-tab`).classList.remove("hidden");
  
  if (tab === users) loadUsers();
  if (tab === tracks) loadTracks();
  if (tab === exchanges) loadExchanges();
}

// ====== 이메일 인증 관련 함수 ======

// 인증코드 요청
function requestVerification() {
  const currentPw = document.getElementById(current-pw).value;
  
  if (!currentPw) {
    alert(현재 비밀번호를 입력해주세요.);
    return;
  }
  
  if (currentPw !== admin1234) {
    alert(현재 비밀번호가 일치하지 않습니다.);
    return;
  }
  
  // 6자리 랜덤 코드 생성
  verificationCode = Math.floor(100000 + Math.random() * 900000).toString();
  
  // 이메일 발송 시뮬레이션 (실제로는 백엔드 API 호출)
  console.log(`[이메일 발송] ${ADMIN_EMAIL}로 인증코드 ${verificationCode} 전송`);
  
  // UI 업데이트
  document.getElementById(verify-section).style.display = block;
  document.getElementById(request-verify-btn).disabled = true;
  document.getElementById(request-verify-btn).style.opacity = 0.5;
  
  // 타이머 시작 (3분)
  let timeLeft = 180;
  const timerDisplay = document.getElementById(verify-timer);
  
  if (timerInterval) clearInterval(timerInterval);
  
  timerInterval = setInterval(() => {
    timeLeft--;
    if (timeLeft <= 0) {
      clearInterval(timerInterval);
      timerDisplay.textContent = ⏰ 인증시간 만료;
      verificationCode = null;
      document.getElementById(request-verify-btn).disabled = false;
      document.getElementById(request-verify-btn).style.opacity = 1;
    } else {
      const min = Math.floor(timeLeft / 60);
      const sec = timeLeft % 60;
      timerDisplay.textContent = `⏱️ ${min}:${sec.toString().padStart(2, 0)}`;
    }
  }, 1000);
  
  alert(`📧 ${ADMIN_EMAIL}로 인증코드가 발송되었습니다. (테스트용 코드: ${verificationCode})`);
}

// 인증코드 확인
function verifyCode() {
  const inputCode = document.getElementById(verify-code).value;
  
  if (!verificationCode) {
    document.getElementById(verify-message).innerHTML = ❌ 인증코드가 만료되었습니다. 다시 요청해주세요.;
    document.getElementById(verify-message).style.color = #ef4444;
    return;
  }
  
  if (inputCode === verificationCode) {
    document.getElementById(verify-message).innerHTML = ✅ 인증 완료! 새 비밀번호를 설정해주세요.;
    document.getElementById(verify-message).style.color = #10b981;
    
    // 인증 성공
    isVerified = true;
    
    // 타이머 중지
    if (timerInterval) clearInterval(timerInterval);
    document.getElementById(verify-timer).textContent = ✅ 인증완료;
    
    // 새 비밀번호 입력 섹션 표시
    document.getElementById(ew-password-section).style.display = block;
    document.getElementById(verify-section).style.display = one;
    document.getElementById(request-verify-btn).style.display = one;
  } else {
    document.getElementById(verify-message).innerHTML = ❌ 인증코드가 일치하지 않습니다.;
    document.getElementById(verify-message).style.color = #ef4444;
  }
}

// 비밀번호 변경
function changePassword() {
  if (!isVerified) {
    alert(먼저 이메일 인증을 완료해주세요.);
    return;
  }
  
  const newPw = document.getElementById(ew-pw).value;
  const confirmPw = document.getElementById(confirm-pw).value;
  
  if (!newPw || !confirmPw) {
    alert(새 비밀번호를 입력해주세요.);
    return;
  }
  
  if (newPw !== confirmPw) {
    alert(새 비밀번호가 일치하지 않습니다.);
    return;
  }
  
  if (newPw.length < 6) {
    alert(비밀번호는 최소 6자 이상이어야 합니다.);
    return;
  }
  
  // 실제로는 백엔드 API 호출
  alert(✅ 비밀번호가 성공적으로 변경되었습니다. 새 비밀번호로 다시 로그인해주세요.);
  
  // 초기화
  resetPasswordSection();
  logout();
}

// 비밀번호 섹션 초기화
function resetPasswordSection() {
  document.getElementById(current-pw).value = ;
  document.getElementById(verify-code).value = ;
  document.getElementById(ew-pw).value = ;
  document.getElementById(confirm-pw).value = ;
  document.getElementById(verify-section).style.display = one;
  document.getElementById(ew-password-section).style.display = one;
  document.getElementById(request-verify-btn).disabled = false;
  document.getElementById(request-verify-btn).style.opacity = 1;
  document.getElementById(request-verify-btn).style.display = block;
  document.getElementById(verify-timer).textContent = ;
  verificationCode = null;
  isVerified = false;
  if (timerInterval) clearInterval(timerInterval);
}

// ====== 데이터 로드 함수 ======

// 대시보드 데이터 로드
async function loadDashboard() {
  document.getElementById(total-users).textContent = 124;
  document.getElementById(ew-users-today).textContent = +3 오늘;
  document.getElementById(total-tracks).textContent = 356;
  document.getElementById(ew-tracks-today).textContent = +12 오늘;
  document.getElementById(total-tl).textContent = 1,234,567;
  document.getElementById(pending-exchanges).textContent = 5;
  
  const tbody = document.querySelector(#recent-users-table tbody);
  tbody.innerHTML = `
    <tr><td>1</td><td>demo</td><td>demo@timelink.digital</td><td>listener</td><td>10,000</td><td>2025-02-25</td></tr>
    <tr><td>2</td><td>creator1</td><td>creator@test.com</td><td>creator</td><td>15,000</td><td>2025-02-24</td></tr>
    <tr><td>3</td><td>business1</td><td>cafe@test.com</td><td>business</td><td>20,000</td><td>2025-02-23</td></tr>
  `;
}

// 사용자 목록 로드
async function loadUsers() {
  const tbody = document.querySelector(#users-table tbody);
  tbody.innerHTML = `
    <tr>
      <td>1</td><td>demo</td><td>demo@timelink.digital</td><td>listener</td><td>10,000</td><td>0.1234</td><td>-</td><td>2025-02-25</td>
      <td><button class="btn btn-outline btn-sm" onclick="editUser(1)">✏️</button></td>
    </tr>
  `;
}

// 트랙 목록 로드
async function loadTracks() {
  const tbody = document.querySelector(#tracks-table tbody);
  tbody.innerHTML = `
    <tr><td>1</td><td>Midnight Vibe</td><td>Synthwave Studio</td><td>Electronic</td><td>2,000</td><td>84,200</td><td><span class="badge badge-success">인증</span></td><td>2025-02-25</td></tr>
  `;
}

// 환전 목록 로드
async function loadExchanges() {
  const tbody = document.querySelector(#exchanges-table tbody);
  tbody.innerHTML = `
    <tr>
      <td>1</td><td>demo</td><td>1,000</td><td>카카오페이</td><td><span class="badge badge-warning">대기중</span></td><td>2025-02-25</td>
      <td><button class="btn btn-success btn-sm" onclick="processExchange(1)">✅ 승인</button></td>
    </tr>
  `;
}

// 환율 설정
function updateRate() {
  const rate = document.getElementById(exchange-rate).value;
  alert(`환율이 1TL = ${rate}원으로 설정되었습니다.`);
}

// 기타 함수들
function refreshData() { loadDashboard(); }
function refreshTracks() { loadTracks(); }
function searchUsers() { alert(검색 기능 구현 예정); }
function filterExchanges(status) { alert(`${status} 필터 구현 예정`); }
function editUser(id) { alert(`사용자 ${id} 수정 구현 예정`); }
function processExchange(id) { alert(`환전 ${id} 승인 구현 예정`); }
function closeModal(id) { document.getElementById("id").classList.remove("show"); }
function resendCode() { alert(인증코드 재전송); }
function confirmCode() { alert(인증 확인); }
</script>

<!-- 통일 푸터 -->
<footer class="page-footer">
  <div class="footer-links">
    <a href="#">이용약관</a>
    <a href="#">개인정보처리방침</a>
    <a href="#">저작권 침해 신고</a>
    <a href="#" style="color:#ef4444;">⚠️ 창작권 보호</a>
  </div>
  <div class="footer-copyright" style="font-size:10px; color:#9ca3af; margin-top:8px;">
    <span data-i18n-copyright>⚖️ 모든 파일의 창작권은 창작자에게 있습니다. 무단 도용 시 법적 조치를 받을 수 있습니다.
  </span></div>
</footer>
<script>
// 로그인 상태 관리
(function() {
  const currentUser = JSON.parse(localStorage.getItem("tl_user") || "null");
  const navAuth = document.getElementById(av-auth);
  const navGuest = document.getElementById(av-guest);
  
  if (currentUser) {
    if (navAuth) navAuth.classList.remove("hidden");
    if (navGuest) navGuest.classList.add("hidden");
    
    // 사용자 정보 표시
    const balanceTl = document.getElementById(balance-tl);
    const balanceTlc = document.getElementById(balance-tlc);
    const avatarLetter = document.getElementById(avatar-letter);
    
    if (balanceTl) balanceTl.textContent = (currentUser.tl || 0).toLocaleString();
    if (balanceTlc) balanceTlc.textContent = (currentUser.tlc || 0).toFixed(4);
    if (avatarLetter) avatarLetter.textContent = (currentUser.username || U).charAt(0).toUpperCase();
  } else {
    if (navAuth) navAuth.classList.add("hidden");
    if (navGuest) navGuest.classList.remove("hidden");
  }
  
  // Car mode 표시
  const carMode = localStorage.getItem("tl_car") === true;
  const carStatus = document.getElementById(car-status);
  const carIndicator = document.getElementById(car-indicator);
  
  if (carStatus) carStatus.textContent = carMode ? ON : Off;
  if (carIndicator) carIndicator.className = car-indicator + (carMode ?  on : );
})();

function toggleDropdown() {
  document.getElementById("dropdown")?.classList.toggle("show");
}

document.addEventListener(click, function(e) {
  if (!e.target.closest(.avatar)) {
    document.getElementById("dropdown")?.classList.remove("show");
  }
});

function logout() {
  localStorage.removeItem(tl_user);
  localStorage.removeItem(auth_token);
  window.location.href = index.html;
}
</script>
<!-- ===== 글로벌 변환 스크립트 (언어/통화) ===== -->
<style>
.global-selector {
  position: fixed;
  top: 80px;
  right: 24px;
  z-index: 10000;
  background: white;
  border-radius: 999px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  padding: 4px;
  display: flex;
  gap: 2px;
}
.global-selector select {
  padding: 6px 12px;
  border-radius: 999px;
  border: none;
  background: transparent;
  font-size: 13px;
  font-weight: 600;
  cursor: pointer;
  outline: none;
}
.global-selector select:hover {
  background: #f3f4f6;
}
</style>

<script>
// ============================================
// 글로벌 변환 시스템 (언어/통화)
// ============================================
const Global = {
  // 현재 설정
  lang: localStorage.getItem("global_lang") || ko,
  currency: localStorage.getItem("global_currency") || KRW,
  
  // 환율 (1 TL 기준)
  rates: {
    KRW: { symbol: ₩, rate: 1, name: 원 },
    USD: { symbol: 
</html>






, rate: 0.00075, name: Dollar },
    JPY: { symbol: ¥, rate: 0.11, name: Yen },
    EUR: { symbol: €, rate: 0.0007, name: Euro },
    CNY: { symbol: ¥, rate: 0.0054, name: Yuan },
    GBP: { symbol: £, rate: 0.0006, name: Pound }
  },
  
  // 번역 데이터
  translations: {
    // 한국어
    ko: {
      // 네비게이션
      home: 홈,
      shareplace: SharePlace,
      library: 라이브러리,
      upload: 업로드,
      player: 플레이어,
      radio: 카페방송,
      car: Car,
      moving: Moving Radio,
      ads: 광고,
      wallet: 지갑,
      chart: 차트,
      
      // 버튼
      login: 로그인,
      signup: 시작하기,
      logout: 로그아웃,
      
      // 지갑
      purchase_tl: 구매 TL,
      earned_tl: 획득 TL,
      exchange: 환전,
      recharge: 충전,
      
      // 푸터
      terms: 이용약관,
      privacy: 개인정보처리방침,
      copyright_policy: 저작권 정책,
      report: 저작권 침해 신고,
      copyright: ⚖️ 모든 파일의 창작권은 창작자에게 있습니다. 무단 도용 시 법적 조치를 받을 수 있습니다.
    },
    
    // 영어
    en: {
      home: Home,
      shareplace: SharePlace,
      library: Library,
      upload: Upload,
      player: Player,
      radio: Radio,
      car: Car,
      moving: Moving Radio,
      ads: Ads,
      wallet: Wallet,
      chart: Charts,
      
      login: Login,
      signup: Sign Up,
      logout: Logout,
      
      purchase_tl: Purchased TL,
      earned_tl: Earned TL,
      exchange: Exchange,
      recharge: Recharge,
      
      terms: Terms of Use,
      privacy: Privacy Policy,
      copyright_policy: Copyright Policy,
      report: Copyright Report,
      copyright: ⚖️ All copyrights belong to the creators. Unauthorized use may result in legal action.
    },
    
    // 일본어
    ja: {
      home: ホーム,
      shareplace: SharePlace,
      library: ライブラリ,
      upload: アップロード,
      player: プレイヤー,
      radio: ラジオ,
      car: カー,
      moving: ムービングラジオ,
      ads: 広告,
      wallet: ウォレット,
      chart: チャート,
      
      login: ログイン,
      signup: 登録,
      logout: ログアウト,
      
      purchase_tl: 購入TL,
      earned_tl: 獲得TL,
      exchange: 交換,
      recharge: チャージ,
      
      terms: 利用規約,
      privacy: プライバシーポリシー,
      copyright_policy: 著作権ポリシー,
      report: 著作権侵害報告,
      copyright: ⚖️ すべての著作権は作成者に帰属します。無断使用は法的措置の対象となります。
    },
    
    // 중국어
    zh-CN: {
      home: 首页,
      shareplace: SharePlace,
      library: 库,
      upload: 上传,
      player: 播放器,
      radio: 电台,
      car: 汽车,
      moving: 移动电台,
      ads: 广告,
      wallet: 钱包,
      chart: 图表,
      
      login: 登录,
      signup: 注册,
      logout: 退出,
      
      purchase_tl: 购买TL,
      earned_tl: 获得TL,
      exchange: 兑换,
      recharge: 充值,
      
      terms: 使用条款,
      privacy: 隐私政策,
      copyright_policy: 版权政策,
      report: 版权侵权举报,
      copyright: ⚖️ 所有版权归创作者所有。未经授权使用可能导致法律诉讼。
    },
    
    // 스페인어
    es: {
      home: Inicio,
      shareplace: SharePlace,
      library: Biblioteca,
      upload: Subir,
      player: Reproductor,
      radio: Radio,
      car: Coche,
      moving: Radio Móvil,
      ads: Anuncios,
      wallet: Cartera,
      chart: Gráficos,
      
      login: Iniciar sesión,
      signup: Registrarse,
      logout: Cerrar sesión,
      
      purchase_tl: TL Comprado,
      earned_tl: TL Ganado,
      exchange: Cambiar,
      recharge: Recargar,
      
      terms: Términos de uso,
      privacy: Política de privacidad,
      copyright_policy: Política de derechos de autor,
      report: Reportar infracción,
      copyright: ⚖️ Todos los derechos de autor pertenecen a los creadores. El uso no autorizado puede resultar en acciones legales.
    }
  },
  
  // 언어 변경
  setLang(lang) {
    this.lang = lang;
    localStorage.setItem("global_lang", lang);
    this.updateUI();
  },
  
  // 통화 변경
  setCurrency(curr) {
    this.currency = curr;
    localStorage.setItem("global_currency", curr);
    this.updateCurrency();
  },
  
  // 번역 가져오기
  t(key) {
    return this.translations[this.lang]?.[key] || 
           this.translations.ko[key] || 
           key;
  },
  
  // UI 텍스트 업데이트
  updateUI() {
    document.querySelectorAll([data-i18n]).forEach(el => {
      const key = el.getAttribute(data-i18n);
      el.textContent = this.t(key);
    });
    
    document.querySelectorAll([data-i18n-placeholder]).forEach(el => {
      const key = el.getAttribute(data-i18n-placeholder);
      el.placeholder = this.t(key);
    });
    
    document.querySelectorAll([data-i18n-value]).forEach(el => {
      const key = el.getAttribute(data-i18n-value);
      el.value = this.t(key);
    });
  },
  
  // 통화 변환
  updateCurrency() {
    const curr = this.rates[this.currency];
    
    document.querySelectorAll([data-currency]).forEach(el => {
      const tlValue = parseFloat(el.getAttribute(data-currency)) || 0;
      const converted = tlValue * curr.rate;
      
      if (el.tagName === INPUT) {
        el.value = converted.toFixed(0);
      } else {
        el.textContent = curr.symbol +   + converted.toLocaleString(undefined, {
          minimumFractionDigits: 0,
          maximumFractionDigits: 0
        });
      }
    });
    
    document.querySelectorAll([data-currency-symbol]).forEach(el => {
      el.textContent = curr.symbol;
    });
  },
  
  // 선택기 생성
  createSelector() {
    const selector = document.createElement(div);
    selector.className = global-selector;
    
    // 언어 선택
    const langSelect = document.createElement(select);
    langSelect.innerHTML = `
      <option value="ko" ${this.lang === ko ? selected : }>🇰🇷 한국어</option>
      <option value="en" ${this.lang === en ? selected : }>🇺🇸 English</option>
      <option value="ja" ${this.lang === ja ? selected : }>🇯🇵 日本語</option>
      <option value="zh-CN" ${this.lang === zh-CN ? selected : }>🇨🇳 中文</option>
      <option value="es" ${this.lang === es ? selected : }>🇪🇸 Español</option>
    `;
    langSelect.addEventListener(change, (e) => this.setLang(e.target.value));
    
    // 통화 선택
    const currSelect = document.createElement(select);
    currSelect.innerHTML = `
      <option value="KRW" ${this.currency === KRW ? selected : }>₩ KRW</option>
      <option value="USD" ${this.currency === USD ? selected : }>$ USD</option>
      <option value="JPY" ${this.currency === JPY ? selected : }>¥ JPY</option>
      <option value="EUR" ${this.currency === EUR ? selected : }>€ EUR</option>
      <option value="CNY" ${this.currency === CNY ? selected : }>¥ CNY</option>
      <option value="GBP" ${this.currency === GBP ? selected : }>£ GBP</option>
    `;
    currSelect.addEventListener(change, (e) => this.setCurrency(e.target.value));
    
    selector.appendChild(langSelect);
    selector.appendChild(currSelect);
    document.body.appendChild(selector);
  },
  
  // 초기화
  init() {
    this.createSelector();
    this.updateUI();
    this.updateCurrency();
    
    // TL 값이 있는 요소에 data-currency 속성 자동 추가
    setTimeout(() => {
      document.querySelectorAll(.balance-value, [id$="-tl"], [id*="TL"]).forEach(el => {
        if (!el.hasAttribute(data-currency)) {
          const match = el.textContent.match(/\d+/g);
          if (match) {
            const value = match.join();
            el.setAttribute(data-currency, value);
          }
        }
      });
      this.updateCurrency();
    }, 100);
  }
};

// 페이지 로드시 실행
document.addEventListener(DOMContentLoaded, () => Global.init());
</script>
</body>
</html>















