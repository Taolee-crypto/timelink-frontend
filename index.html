<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TimeLink Global ‚Äî ÏÑ∏Í≥Ñ ÏµúÏ¥à ÎîîÏßÄÌÑ∏ ÌååÏùº ÏûêÏÇ∞Ìôî ÌîåÎû´Ìèº</title>
    
    <!-- Google Fonts & Font Awesome -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        /* [Ïù¥Ï†Ñ CSS ÎèôÏùº - ÏÉùÎûµ] */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #0a0a0a;
            --bg-secondary: #111111;
            --bg-card: #1a1a1a;
            --bg-card-hover: #222222;
            --bg-nav: rgba(17, 17, 17, 0.95);
            --bg-modal: #1e1e1e;
            
            --text-primary: #ffffff;
            --text-secondary: #b3b3b3;
            --text-tertiary: #6a6a6a;
            
            --accent: #8a2be2;
            --accent-glow: rgba(138, 43, 226, 0.3);
            --accent-light: #9d4edd;
            --success: #1db954;
            --warning: #f59e0b;
            --danger: #ef4444;
            --info: #3b82f6;
            --lecture: #ff7b00;
            --video: #ff5500;
            --radio: #1db954;
            --commercial: #f093fb;
            --ad: #ffd700;
            --share: #ff9900;
            --car: #00a8ff;
            --car-detected: #4ecdc4;
            --mining-peak: #ff6b6b;
            --mining-offpeak: #4ecdc4;
            --zero-tl: #ff4444;
            
            /* Ïû•Î•¥Î≥Ñ ÏÉâÏÉÅ */
            --genre-pop: #ff6b6b;
            --genre-rock: #4ecdc4;
            --genre-hiphop: #ffd93d;
            --genre-jazz: #a8e6cf;
            --genre-classic: #b39eb5;
            --genre-edm: #ff8a5c;
            --genre-rnb: #ffb347;
            --genre-country: #c06c84;
            
            --border-color: rgba(255, 255, 255, 0.08);
            --border-hover: rgba(255, 255, 255, 0.15);
            
            --shadow-sm: 0 4px 12px rgba(0, 0, 0, 0.4);
            --shadow-md: 0 8px 24px rgba(0, 0, 0, 0.5);
            --shadow-lg: 0 16px 48px rgba(0, 0, 0, 0.6);
            
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 20px;
            --radius-xl: 28px;
            --radius-full: 9999px;
            
            --font-sans: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            
            --transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        body {
            font-family: var(--font-sans);
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            overflow-x: hidden;
        }

        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }
        ::-webkit-scrollbar-track {
            background: var(--bg-secondary);
        }
        ::-webkit-scrollbar-thumb {
            background: #333;
            border-radius: 20px;
            border: 2px solid var(--bg-secondary);
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #444;
        }

        /* Auth Container */
        .auth-container {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
            background: radial-gradient(circle at 20% 30%, #1a0b2e, #0a0a0a 80%);
            position: relative;
            overflow: hidden;
        }

        .auth-container::before {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" opacity="0.05"><path d="M20 20 L80 20 L80 80 L20 80 Z" fill="none" stroke="%238a2be2" stroke-width="1"/><circle cx="50" cy="50" r="10" fill="%238a2be2"/></svg>');
            background-size: 60px 60px;
            pointer-events: none;
        }

        .auth-box {
            background: rgba(26, 26, 26, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            padding: 48px 40px;
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-lg);
            max-width: 480px;
            width: 100%;
            border: 1px solid var(--border-color);
            animation: fadeUp 0.6s ease;
        }

        @keyframes fadeUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .logo {
            text-align: center;
            margin-bottom: 32px;
        }

        .logo h1 {
            font-size: 3.2rem;
            font-weight: 800;
            background: linear-gradient(135deg, #b983ff, #8a2be2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: -1px;
            margin-bottom: 8px;
        }

        .logo p {
            color: var(--text-secondary);
            font-size: 1rem;
            font-weight: 400;
        }

        .version-badge {
            background: rgba(138, 43, 226, 0.2);
            color: #c084fc;
            padding: 10px 24px;
            border-radius: var(--radius-full);
            font-size: 13px;
            font-weight: 600;
            text-align: center;
            margin-bottom: 32px;
            border: 1px solid rgba(138, 43, 226, 0.3);
            backdrop-filter: blur(4px);
            letter-spacing: 0.3px;
        }

        .google-login-btn {
            background: #4285F4;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            padding: 18px 24px;
            border-radius: var(--radius-full);
            margin: 30px 0;
            border: none;
            cursor: pointer;
            width: 100%;
            transition: var(--transition);
            box-shadow: 0 8px 20px rgba(66, 133, 244, 0.3);
        }

        .google-login-btn:hover {
            background: #3367D6;
            transform: translateY(-2px);
            box-shadow: 0 12px 28px rgba(66, 133, 244, 0.5);
        }

        /* Main App Container */
        .app-container {
            display: none;
            max-width: 1600px;
            margin: 0 auto;
            padding: 24px 32px;
            animation: fadeIn 0.4s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Header */
        .app-header {
            background: rgba(17, 17, 17, 0.85);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            padding: 20px 32px;
            border-radius: var(--radius-xl);
            margin-bottom: 32px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-sm);
            position: sticky;
            top: 20px;
            z-index: 100;
        }

        .header-left h1 {
            font-size: 1.8rem;
            font-weight: 800;
            background: linear-gradient(135deg, #b983ff, #8a2be2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: -0.5px;
        }

        .header-right {
            display: flex;
            gap: 24px;
            align-items: center;
        }

        .balance-cards {
            display: flex;
            gap: 16px;
        }

        .balance-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 12px 20px;
            border-radius: var(--radius-lg);
            border: 1px solid var(--border-color);
            backdrop-filter: blur(8px);
            transition: var(--transition);
            min-width: 130px;
            cursor: pointer;
        }

        .balance-card:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: var(--accent);
        }

        .balance-card .label {
            font-size: 11px;
            color: var(--text-tertiary);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 6px;
        }

        .balance-card .amount {
            font-size: 22px;
            font-weight: 800;
            color: white;
            line-height: 1.2;
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 16px 8px 12px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius-full);
            border: 1px solid var(--border-color);
            transition: var(--transition);
            cursor: pointer;
        }

        .user-profile:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: var(--accent);
        }

        .avatar-circle {
            width: 38px;
            height: 38px;
            border-radius: 50%;
            background: linear-gradient(135deg, #8a2be2, #6b21a5);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 18px;
            box-shadow: 0 2px 8px rgba(138, 43, 226, 0.3);
        }

        .user-info {
            display: flex;
            flex-direction: column;
        }

        .user-name {
            font-weight: 700;
            color: white;
            font-size: 14px;
        }

        .user-status {
            font-size: 11px;
            color: var(--text-secondary);
        }

        .btn-logout {
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-secondary);
            padding: 10px 20px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-full);
            font-weight: 600;
            font-size: 13px;
            cursor: pointer;
            transition: var(--transition);
        }

        .btn-logout:hover {
            background: rgba(239, 68, 68, 0.2);
            color: #f87171;
            border-color: #ef4444;
            transform: translateY(-2px);
        }

        /* Tab Navigation */
        .tabs-container {
            position: sticky;
            top: 100px;
            z-index: 90;
            margin-bottom: 32px;
            background: rgba(17, 17, 17, 0.7);
            backdrop-filter: blur(20px);
            border-radius: var(--radius-full);
            padding: 6px;
            border: 1px solid var(--border-color);
            overflow-x: auto;
            white-space: nowrap;
            display: flex;
        }

        .tabs {
            display: flex;
            gap: 4px;
            width: 100%;
        }

        .tab {
            padding: 12px 24px;
            border-radius: var(--radius-full);
            font-weight: 600;
            font-size: 14px;
            color: var(--text-secondary);
            transition: var(--transition);
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: transparent;
            border: none;
            white-space: nowrap;
        }

        .tab:hover {
            color: white;
            background: rgba(255, 255, 255, 0.05);
        }

        .tab.active {
            background: var(--accent);
            color: white;
            box-shadow: 0 4px 12px rgba(138, 43, 226, 0.4);
        }

        /* Tab Content */
        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .tab-content.active {
            display: block;
        }

        /* Genre Selector */
        .genre-selector {
            display: flex;
            gap: 12px;
            overflow-x: auto;
            padding: 16px 0;
            margin-bottom: 24px;
            scrollbar-width: thin;
        }

        .genre-btn {
            padding: 10px 24px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-full);
            background: transparent;
            color: var(--text-secondary);
            font-weight: 600;
            font-size: 14px;
            transition: var(--transition);
            cursor: pointer;
            white-space: nowrap;
        }

        .genre-btn:hover {
            border-color: var(--accent);
            color: white;
        }

        .genre-btn.active {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }

        .genre-btn.pop { border-color: var(--genre-pop); }
        .genre-btn.rock { border-color: var(--genre-rock); }
        .genre-btn.hiphop { border-color: var(--genre-hiphop); }
        .genre-btn.jazz { border-color: var(--genre-jazz); }
        .genre-btn.classic { border-color: var(--genre-classic); }
        .genre-btn.edm { border-color: var(--genre-edm); }
        .genre-btn.rnb { border-color: var(--genre-rnb); }
        .genre-btn.country { border-color: var(--genre-country); }

        .genre-btn.pop.active { background: var(--genre-pop); border-color: var(--genre-pop); }
        .genre-btn.rock.active { background: var(--genre-rock); border-color: var(--genre-rock); }
        .genre-btn.hiphop.active { background: var(--genre-hiphop); border-color: var(--genre-hiphop); }
        .genre-btn.jazz.active { background: var(--genre-jazz); border-color: var(--genre-jazz); }
        .genre-btn.classic.active { background: var(--genre-classic); border-color: var(--genre-classic); }
        .genre-btn.edm.active { background: var(--genre-edm); border-color: var(--genre-edm); }
        .genre-btn.rnb.active { background: var(--genre-rnb); border-color: var(--genre-rnb); }
        .genre-btn.country.active { background: var(--genre-country); border-color: var(--genre-country); }

        /* Now Playing with Genre */
        .now-playing-card {
            background: rgba(255,255,255,0.03);
            border-radius: var(--radius-xl);
            padding: 24px;
            margin-bottom: 24px;
            border-left: 6px solid;
        }

        .now-playing-card.pop { border-left-color: var(--genre-pop); }
        .now-playing-card.rock { border-left-color: var(--genre-rock); }
        .now-playing-card.hiphop { border-left-color: var(--genre-hiphop); }
        .now-playing-card.jazz { border-left-color: var(--genre-jazz); }
        .now-playing-card.classic { border-left-color: var(--genre-classic); }
        .now-playing-card.edm { border-left-color: var(--genre-edm); }
        .now-playing-card.rnb { border-left-color: var(--genre-rnb); }
        .now-playing-card.country { border-left-color: var(--genre-country); }

        .genre-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: var(--radius-full);
            font-size: 11px;
            font-weight: 700;
            margin-right: 8px;
        }

        .genre-badge.pop { background: var(--genre-pop); }
        .genre-badge.rock { background: var(--genre-rock); }
        .genre-badge.hiphop { background: var(--genre-hiphop); }
        .genre-badge.jazz { background: var(--genre-jazz); }
        .genre-badge.classic { background: var(--genre-classic); }
        .genre-badge.edm { background: var(--genre-edm); }
        .genre-badge.rnb { background: var(--genre-rnb); }
        .genre-badge.country { background: var(--genre-country); }

        /* Queue Display */
        .queue-container {
            background: rgba(255,255,255,0.02);
            border-radius: var(--radius-lg);
            padding: 20px;
            margin-top: 20px;
        }

        .queue-title {
            color: var(--text-secondary);
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 16px;
        }

        .queue-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border-bottom: 1px solid var(--border-color);
            animation: fadeIn 0.3s ease;
        }

        .queue-item:last-child {
            border-bottom: none;
        }

        .queue-item.now-playing {
            background: rgba(29, 185, 84, 0.1);
            border-radius: var(--radius-md);
        }

        .queue-genre {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .queue-genre.pop { background: var(--genre-pop); }
        .queue-genre.rock { background: var(--genre-rock); }
        .queue-genre.hiphop { background: var(--genre-hiphop); }
        .queue-genre.jazz { background: var(--genre-jazz); }
        .queue-genre.classic { background: var(--genre-classic); }
        .queue-genre.edm { background: var(--genre-edm); }
        .queue-genre.rnb { background: var(--genre-rnb); }
        .queue-genre.country { background: var(--genre-country); }

        /* Cards */
        .card {
            background: var(--bg-card);
            border-radius: var(--radius-xl);
            padding: 32px;
            margin-bottom: 32px;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-sm);
            transition: var(--transition);
        }

        .card:hover {
            border-color: var(--accent);
            box-shadow: var(--shadow-md);
        }

        .card h2 {
            font-size: 1.6rem;
            font-weight: 700;
            margin-bottom: 24px;
            background: linear-gradient(135deg, #fff, #e0e0e0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: -0.02em;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
        }

        .stat-card {
            background: var(--bg-card);
            padding: 28px;
            border-radius: var(--radius-lg);
            border: 1px solid var(--border-color);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .stat-card::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 6px;
            height: 100%;
            background: var(--accent);
            opacity: 0.7;
        }

        .stat-card:hover {
            background: var(--bg-card-hover);
            transform: translateY(-4px);
            border-color: var(--accent);
        }

        .stat-card .icon {
            font-size: 2.2rem;
            margin-bottom: 16px;
        }

        .stat-card .label {
            font-size: 12px;
            color: var(--text-tertiary);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
        }

        .stat-card .value {
            font-size: 2.2rem;
            font-weight: 800;
            color: white;
            line-height: 1.1;
        }

        /* Mining Index Display */
        .mining-index-card {
            background: linear-gradient(145deg, #1e1e2a, #15151f);
            border-radius: var(--radius-xl);
            padding: 32px;
            margin-bottom: 32px;
            border: 1px solid var(--border-color);
        }

        .index-value {
            font-size: 4rem;
            font-weight: 800;
            text-align: center;
            margin: 20px 0;
        }

        .index-peak { color: var(--mining-peak); }
        .index-offpeak { color: var(--mining-offpeak); }

        .index-timer {
            font-size: 1.5rem;
            text-align: center;
            margin: 10px 0;
            color: var(--text-secondary);
        }

        .index-graph {
            height: 100px;
            background: rgba(255,255,255,0.03);
            border-radius: var(--radius-lg);
            margin: 20px 0;
            position: relative;
            overflow: hidden;
        }

        .index-bar {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, var(--mining-peak), var(--mining-offpeak));
            transition: width 1s ease;
        }

        /* Upload Zone */
        .upload-zone {
            border: 2px dashed var(--accent);
            background: rgba(138, 43, 226, 0.05);
            border-radius: var(--radius-lg);
            padding: 60px 40px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            margin-bottom: 30px;
        }

        .upload-zone:hover {
            border-color: var(--accent-light);
            background: rgba(138, 43, 226, 0.1);
            transform: scale(1.02);
        }

        .upload-zone .icon {
            font-size: 4rem;
            margin-bottom: 20px;
            color: rgba(255, 255, 255, 0.7);
        }

        .upload-zone h3 {
            font-size: 1.5rem;
            margin-bottom: 10px;
            color: white;
        }

        .upload-zone p {
            color: var(--text-secondary);
            font-size: 14px;
        }

        /* File Type Selector */
        .file-type-selector {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
        }

        .file-type-card {
            flex: 1;
            background: rgba(255, 255, 255, 0.05);
            padding: 24px;
            border-radius: var(--radius-lg);
            text-align: center;
            cursor: pointer;
            border: 2px solid transparent;
            transition: var(--transition);
        }

        .file-type-card.selected {
            border-color: var(--success);
            background: rgba(29, 185, 84, 0.1);
        }

        .file-type-card.video.selected {
            border-color: var(--video);
            background: rgba(255, 85, 0, 0.1);
        }

        .file-type-card .icon {
            font-size: 3rem;
            margin-bottom: 12px;
        }

        .file-type-card h3 {
            color: white;
            margin-bottom: 8px;
        }

        .file-type-card .rate {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .file-type-card.audio .rate {
            color: var(--success);
        }

        .file-type-card.video .rate {
            color: var(--video);
        }

        .file-type-card .desc {
            color: var(--text-secondary);
            font-size: 12px;
        }

        /* TL3/TL4 File Card */
        .file-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
            gap: 28px;
        }

        .file-card {
            background: var(--bg-card);
            border-radius: var(--radius-xl);
            overflow: hidden;
            border: 1px solid var(--border-color);
            transition: var(--transition);
            display: flex;
            flex-direction: column;
        }

        .file-card:hover {
            transform: translateY(-6px);
            border-color: var(--accent);
            box-shadow: var(--shadow-md);
        }

        .file-thumbnail {
            height: 180px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4rem;
            color: rgba(255, 255, 255, 0.8);
            position: relative;
        }

        .file-thumbnail.audio {
            background: linear-gradient(145deg, #2a1a3a, #1e1e1e);
        }

        .file-thumbnail.video {
            background: linear-gradient(145deg, #ff7b00, #ff5500);
        }

        .badge {
            position: absolute;
            top: 16px;
            right: 16px;
            padding: 6px 16px;
            border-radius: var(--radius-full);
            font-size: 12px;
            font-weight: 700;
            color: white;
            backdrop-filter: blur(4px);
        }

        .badge-mining { background: rgba(79, 172, 254, 0.9); }
        .badge-no-tl { background: rgba(239, 68, 68, 0.9); }
        .badge-shared { background: rgba(245, 158, 11, 0.9); }
        .badge-copyright { 
            background: rgba(139, 92, 246, 0.9); 
            left: 16px;
            right: auto;
        }
        .badge-type {
            left: 16px;
            top: 60px;
            background: rgba(0,0,0,0.7);
        }
        .badge-zero {
            background: var(--zero-tl);
            left: 16px;
            top: 100px;
        }
        .badge-genre {
            left: 16px;
            top: 140px;
            background: rgba(0,0,0,0.7);
        }

        .file-info {
            padding: 24px;
        }

        .file-name {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 6px;
            color: white;
        }

        .file-artist {
            color: var(--text-secondary);
            font-size: 0.95rem;
            margin-bottom: 20px;
        }

        .info-panel {
            background: rgba(255, 255, 255, 0.03);
            padding: 16px;
            border-radius: var(--radius-md);
            margin-bottom: 20px;
            font-size: 13px;
            color: var(--text-secondary);
            border-left: 4px solid;
            line-height: 1.6;
        }

        .info-panel strong {
            color: white;
        }

        .copyright-panel { border-left-color: #8b5cf6; }
        .contract-panel { border-left-color: var(--accent); }
        .tl-panel { border-left-color: var(--warning); }
        .video-panel { border-left-color: var(--video); }
        .zero-panel { border-left-color: var(--zero-tl); }
        .genre-panel { border-left-color: var(--genre-pop); }

        .file-stats {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            font-size: 14px;
            color: var(--text-secondary);
        }

        .tl-progress {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-full);
            overflow: hidden;
            margin: 16px 0;
        }

        .tl-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent), var(--accent-light));
            transition: width 0.3s ease;
        }

        .tl-progress-empty {
            height: 100%;
            background: var(--danger);
            width: 100%;
        }

        .file-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-top: 20px;
        }

        .btn-play, .btn-charge, .btn-share, .btn-lecture, .btn-play-disabled, .btn-radio, .btn-commercial, .btn-ad, .btn-download, .btn-car, .btn-car-manual {
            padding: 14px 10px;
            border: none;
            border-radius: var(--radius-md);
            font-weight: 700;
            font-size: 14px;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            color: white;
        }

        .btn-play {
            background: var(--success);
        }

        .btn-play:hover {
            background: #1ed760;
            transform: translateY(-2px);
        }

        .btn-play-disabled {
            background: #333;
            color: #999;
            cursor: not-allowed;
            opacity: 0.7;
        }

        .btn-charge {
            background: var(--warning);
            color: black;
        }

        .btn-charge:hover {
            background: #fbbf24;
            transform: translateY(-2px);
        }

        .btn-share {
            background: var(--share);
        }

        .btn-share:hover {
            background: #ffaa00;
            transform: translateY(-2px);
        }
        
        .btn-lecture {
            background: var(--lecture);
            grid-column: span 2;
        }

        .btn-lecture:hover {
            background: #ff9500;
            transform: translateY(-2px);
        }

        .btn-radio {
            background: var(--radio);
        }

        .btn-radio:hover {
            background: #1ed760;
            transform: translateY(-2px);
        }

        .btn-commercial {
            background: var(--commercial);
            color: black;
        }

        .btn-commercial:hover {
            background: #f8b4d9;
            transform: translateY(-2px);
        }

        .btn-ad {
            background: var(--ad);
            color: black;
        }

        .btn-ad:hover {
            background: #ffed4a;
            transform: translateY(-2px);
        }

        .btn-download {
            background: var(--info);
            grid-column: span 2;
        }

        .btn-download:hover {
            background: #5a9cff;
            transform: translateY(-2px);
        }

        .btn-car {
            background: var(--car);
        }

        .btn-car:hover {
            background: #4dc3ff;
            transform: translateY(-2px);
        }

        .btn-car-manual {
            background: var(--car-detected);
            color: black;
        }

        .btn-car-manual:hover {
            background: #6fd9d0;
            transform: translateY(-2px);
        }

        /* Share Place */
        .share-header {
            background: linear-gradient(145deg, #1e1e2a, #15151f);
            border-radius: var(--radius-xl);
            padding: 32px;
            margin-bottom: 32px;
            border: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        .share-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 32px;
        }

        .share-stat-card {
            background: var(--bg-card);
            padding: 24px;
            border-radius: var(--radius-lg);
            border: 1px solid var(--border-color);
            text-align: center;
        }

        .share-stat-value {
            font-size: 2rem;
            font-weight: 800;
            color: white;
            margin-top: 8px;
        }

        .share-filter {
            display: flex;
            gap: 12px;
            margin-bottom: 32px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 10px 24px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-full);
            background: transparent;
            color: var(--text-secondary);
            font-weight: 600;
            font-size: 14px;
            transition: var(--transition);
            cursor: pointer;
        }

        .filter-btn:hover {
            border-color: var(--accent);
            color: white;
        }

        .filter-btn.active {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }

        /* Radio / Commercial */
        .radio-header {
            background: linear-gradient(145deg, #1db954, #169c46);
            border-radius: var(--radius-xl);
            padding: 32px;
            margin-bottom: 32px;
        }

        .commercial-header {
            background: linear-gradient(145deg, #f093fb, #f5576c);
            border-radius: var(--radius-xl);
            padding: 32px;
            margin-bottom: 32px;
        }

        .radio-channel-card,
        .commercial-channel-card {
            background: var(--bg-card);
            border-radius: var(--radius-xl);
            overflow: hidden;
            border: 1px solid var(--border-color);
            transition: var(--transition);
        }

        .radio-channel-card:hover,
        .commercial-channel-card:hover {
            border-color: var(--accent);
            transform: translateY(-4px);
        }

        .channel-header {
            padding: 20px;
            background: linear-gradient(145deg, #1db954, #169c46);
            color: white;
        }

        .commercial-channel-header {
            padding: 20px;
            background: linear-gradient(145deg, #f093fb, #f5576c);
            color: white;
        }

        .radio-channels {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 24px;
        }

        .channel-playlist {
            padding: 24px;
        }

        .now-playing {
            background: rgba(255, 255, 255, 0.03);
            padding: 16px;
            border-radius: var(--radius-md);
            margin-bottom: 16px;
            border-left: 4px solid var(--success);
        }

        /* Car Section */
        .car-header {
            background: linear-gradient(145deg, #00a8ff, #0097e6);
            border-radius: var(--radius-xl);
            padding: 32px;
            margin-bottom: 32px;
        }

        .car-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 32px;
        }

        .car-stat-card {
            background: var(--bg-card);
            padding: 24px;
            border-radius: var(--radius-lg);
            border: 1px solid var(--border-color);
            text-align: center;
        }

        .car-stat-value {
            font-size: 2rem;
            font-weight: 800;
            color: var(--car);
            margin-top: 8px;
        }

        .car-detection-status {
            background: rgba(0, 168, 255, 0.1);
            border-radius: var(--radius-lg);
            padding: 20px;
            margin-bottom: 24px;
            border: 1px solid var(--car);
        }

        .detection-method {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px;
            border-bottom: 1px solid var(--border-color);
        }

        .detection-method:last-child {
            border-bottom: none;
        }

        .method-active {
            color: var(--car);
            font-weight: 700;
        }

        .method-inactive {
            color: var(--text-tertiary);
        }

        .car-register-box {
            background: rgba(0, 168, 255, 0.1);
            border-radius: var(--radius-lg);
            padding: 24px;
            margin-bottom: 24px;
            border: 1px solid rgba(0, 168, 255, 0.3);
        }

        /* Player Queue */
        .player-queue {
            background: rgba(255,255,255,0.03);
            border-radius: var(--radius-lg);
            padding: 16px;
            margin-top: 20px;
        }

        .queue-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px;
            border-bottom: 1px solid var(--border-color);
        }

        .queue-item:last-child {
            border-bottom: none;
        }

        .queue-item.now-playing {
            background: rgba(29, 185, 84, 0.1);
            border-radius: var(--radius-md);
        }

        /* Video Player Container */
        .video-player-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: black;
            z-index: 10000;
            display: none;
        }

        .video-player-container video {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .video-close-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: var(--danger);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-size: 20px;
            cursor: pointer;
            z-index: 10001;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .video-close-btn:hover {
            transform: scale(1.1);
            background: #ff4444;
        }

        .video-info-bar {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0,0,0,0.7);
            backdrop-filter: blur(10px);
            padding: 16px 24px;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 10001;
        }

        /* Car Mode Badge */
        .car-mode-badge {
            position: fixed;
            top: 20px;
            left: 20px;
            background: var(--car);
            color: white;
            padding: 12px 24px;
            border-radius: var(--radius-full);
            font-weight: 700;
            z-index: 10002;
            display: flex;
            align-items: center;
            gap: 12px;
            animation: slideDown 0.3s ease;
            box-shadow: 0 4px 20px rgba(0, 168, 255, 0.3);
            border: 1px solid rgba(255,255,255,0.2);
        }

        @keyframes slideDown {
            from { transform: translateY(-100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* Modals */
        .modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(12px);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .modal-content {
            background: var(--bg-modal);
            border-radius: var(--radius-xl);
            padding: 40px;
            max-width: 600px;
            width: 100%;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-lg);
            animation: slideUp 0.4s ease;
            max-height: 90vh;
            overflow-y: auto;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .player-content {
            max-width: 700px;
        }

        .player-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: white;
            margin-bottom: 8px;
        }

        .player-artist {
            color: var(--text-secondary);
            font-size: 1.1rem;
            margin-bottom: 24px;
        }

        .player-panel {
            background: rgba(255, 255, 255, 0.03);
            padding: 20px;
            border-radius: var(--radius-md);
            margin-bottom: 20px;
            border-left: 6px solid;
        }

        .player-tl-amount {
            font-size: 2.8rem;
            font-weight: 800;
            color: white;
            line-height: 1.2;
        }

        .player-progress {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-full);
            overflow: hidden;
            margin: 24px 0;
        }

        .player-progress-fill {
            height: 100%;
            background: var(--success);
            transition: width 0.2s linear;
        }

        .player-time {
            display: flex;
            justify-content: space-between;
            color: var(--text-tertiary);
            font-size: 13px;
            margin-bottom: 24px;
        }

        .player-controls {
            display: flex;
            gap: 16px;
            justify-content: center;
        }

        /* Auto-Recharge Switch */
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 2px;
            bottom: 2px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--success);
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        /* Form Elements */
        .form-group {
            margin-bottom: 24px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-secondary);
            font-weight: 600;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 14px 18px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            font-size: 15px;
            color: white;
            transition: var(--transition);
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--accent);
            background: rgba(138, 43, 226, 0.1);
        }

        /* Toast */
        .toast {
            position: fixed;
            top: 30px;
            right: 30px;
            background: var(--bg-modal);
            backdrop-filter: blur(10px);
            padding: 16px 24px;
            border-radius: var(--radius-full);
            border-left: 6px solid var(--success);
            box-shadow: var(--shadow-lg);
            display: none;
            z-index: 3000;
            min-width: 320px;
            color: white;
            font-weight: 500;
            border: 1px solid var(--border-color);
            animation: slideInRight 0.3s ease;
        }

        @keyframes slideInRight {
            from { transform: translateX(400px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .toast.success { border-left-color: var(--success); }
        .toast.error { border-left-color: var(--danger); }
        .toast.warning { border-left-color: var(--warning); }
        .toast.info { border-left-color: var(--info); }

        /* Demo Badge */
        .demo-badge {
            background: var(--warning);
            color: black;
            padding: 4px 12px;
            border-radius: var(--radius-full);
            font-size: 11px;
            font-weight: 700;
            display: inline-block;
            margin-left: 12px;
            text-transform: uppercase;
        }

        /* Zero TL Badge */
        .zero-tl-badge {
            background: var(--zero-tl);
            color: white;
            padding: 2px 8px;
            border-radius: var(--radius-full);
            font-size: 10px;
            margin-left: 8px;
        }

        /* Charge Options */
        .charge-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-top: 20px;
        }

        .charge-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .charge-card:hover {
            border-color: var(--accent);
            transform: translateY(-2px);
        }

        .charge-card .amount {
            font-size: 1.8rem;
            font-weight: 800;
            color: var(--success);
            margin: 10px 0;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .app-container { padding: 20px; }
            .header-right { gap: 16px; }
            .balance-cards { flex-direction: column; gap: 8px; }
        }

        @media (max-width: 768px) {
            .app-header { flex-direction: column; align-items: stretch; }
            .header-right { flex-direction: column; width: 100%; }
            .tabs-container { top: auto; }
            .stats-grid { grid-template-columns: 1fr; }
            .share-stats { grid-template-columns: 1fr; }
            .car-stats { grid-template-columns: 1fr; }
            .file-list { grid-template-columns: 1fr; }
            .radio-channels { grid-template-columns: 1fr; }
            .file-type-selector { flex-direction: column; }
        }
    </style>
</head>
<body>

<!-- Toast Notification -->
<div id="toast" class="toast"></div>

<!-- Video Player Container -->
<div class="video-player-container" id="videoPlayerContainer">
    <video id="videoPlayer" controls autoplay></video>
    <button class="video-close-btn" onclick="TimeLinkSystem.player.stop()">‚úï</button>
    <div class="video-info-bar" id="videoInfoBar">
        <span id="videoTitle">Now Playing</span>
        <span id="videoTimeRemaining">TL: 0</span>
    </div>
</div>

<!-- Audio Player (Ïà®ÍπÄ) -->
<audio id="audioPlayer" style="display: none;"></audio>

<!-- Radio Player (Ïä§Ìä∏Î¶¨Î∞çÏö©) -->
<audio id="radioPlayer" style="display: none;"></audio>

<!-- Charge Modal -->
<div id="chargeModal" class="modal">
    <div class="modal-content">
        <h2 style="font-size: 1.8rem; font-weight: 700; margin-bottom: 24px; background: linear-gradient(135deg, #b983ff, #8a2be2); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
            üí∞ Charge TL
        </h2>
        <div class="form-group">
            <label>TL Amount</label>
            <input type="number" id="chargeAmount" placeholder="1000" min="100" step="100" value="1000">
            <p style="color: var(--text-secondary); font-size: 14px; margin-top: 12px;">
                Your balance: <strong id="currentTLBalance" style="color: white;">25,000</strong> TL
            </p>
        </div>
        <div style="display: flex; gap: 16px;">
            <button class="btn-play" onclick="TimeLinkSystem.file.charge()" style="flex: 1; background: var(--accent);">‚ö° Charge</button>
            <button class="btn-play" onclick="TimeLinkSystem.ui.closeChargeModal()" style="flex: 1; background: transparent; border: 1px solid var(--border-color);">Cancel</button>
        </div>
    </div>
</div>

<!-- Purchase TL Modal -->
<div id="purchaseModal" class="modal">
    <div class="modal-content">
        <h2 style="font-size: 1.8rem; font-weight: 700; margin-bottom: 24px; background: linear-gradient(135deg, #b983ff, #8a2be2); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
            üíµ Purchase TL
        </h2>
        <p style="color: var(--text-secondary); margin-bottom: 24px;">
            1 TL = 0.1Ïõê ¬∑ Î≥¥ÎÑàÏä§: ÏµúÎåÄ 20% Ï∂îÍ∞Ä
        </p>
        <div id="purchasePackages" class="charge-options"></div>
        <div style="display: flex; gap: 16px; margin-top: 24px;">
            <button class="btn-play" onclick="TimeLinkSystem.ui.closePurchaseModal()" style="flex: 1; background: transparent; border: 1px solid var(--border-color);">Close</button>
        </div>
    </div>
</div>

<!-- Lecture Purchase Modal -->
<div id="lecturePurchaseModal" class="modal">
    <div class="modal-content">
        <h2 style="font-size: 1.8rem; font-weight: 700; margin-bottom: 24px; background: linear-gradient(135deg, #ff7b00, #ff5500); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
            üìö Purchase Lecture
        </h2>
        <div id="lecturePurchaseInfo">
            <div style="font-size: 1.3rem; color: white; margin-bottom: 12px;" id="lecturePurchaseTitle">Lecture Title</div>
            <div style="color: var(--text-secondary); margin-bottom: 20px;" id="lecturePurchaseCreator">Creator</div>
            <div style="background: rgba(255, 123, 0, 0.1); padding: 20px; border-radius: var(--radius-lg); margin-bottom: 20px;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 12px;">
                    <span style="color: var(--text-secondary);">Price:</span>
                    <strong style="color: white; font-size: 1.5rem;" id="lecturePurchasePrice">0 TL</strong>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 12px;">
                    <span style="color: var(--text-secondary);">Your balance:</span>
                    <strong style="color: var(--success);" id="lecturePurchaseBalance">0 TL</strong>
                </div>
                <div style="display: flex; justify-content: space-between;">
                    <span style="color: var(--text-secondary);">After purchase:</span>
                    <strong style="color: white;" id="lecturePurchaseAfter">0 TL</strong>
                </div>
            </div>
        </div>
        <div style="display: flex; gap: 16px;">
            <button class="btn-play" onclick="TimeLinkSystem.lecture.confirmPurchase()" style="flex: 1; background: var(--lecture);">üìö Purchase</button>
            <button class="btn-play" onclick="TimeLinkSystem.ui.closeLecturePurchaseModal()" style="flex: 1; background: transparent; border: 1px solid var(--border-color);">Cancel</button>
        </div>
    </div>
</div>

<!-- Lecture Create Modal -->
<div id="lectureCreateModal" class="modal">
    <div class="modal-content" style="max-width: 600px;">
        <h2 style="font-size: 1.8rem; font-weight: 700; margin-bottom: 24px; background: linear-gradient(135deg, #ff7b00, #ff5500); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
            üìö Create Lecture
        </h2>
        <div class="form-group">
            <label>Title</label>
            <input type="text" id="lectureTitle" placeholder="Lecture title">
        </div>
        <div class="form-group">
            <label>Instructor</label>
            <input type="text" id="lectureInstructor" placeholder="Instructor name">
        </div>
        <div class="form-group">
            <label>Description</label>
            <textarea id="lectureDescription" rows="3" placeholder="Lecture description"></textarea>
        </div>
        <div class="form-group">
            <label>Category</label>
            <select id="lectureCategory">
                <option value="programming">üíª Programming</option>
                <option value="business">üìä Business</option>
                <option value="design">üé® Design</option>
                <option value="language">üåê Language</option>
                <option value="finance">üí∞ Finance</option>
            </select>
        </div>
        <div class="form-group">
            <label>Price (TL)</label>
            <input type="number" id="lecturePrice" placeholder="5000" min="100" step="100" value="5000">
            <p style="color: var(--text-secondary); font-size: 12px; margin-top: 4px;">
                ‚âà <span id="lecturePriceKRW">500</span>Ïõê
            </p>
        </div>
        <div class="upload-zone" onclick="document.getElementById('lectureFileInput').click()" style="padding: 30px; margin-bottom: 20px;">
            <div class="icon">üìπ</div>
            <h3>Select lecture video/audio</h3>
            <p>MP4, MP3, WAV (max 500MB)</p>
        </div>
        <input type="file" id="lectureFileInput" style="display: none;" accept="video/*,audio/*">
        <button class="btn-play" onclick="TimeLinkSystem.lecture.create()" style="width: 100%; padding: 18px; background: var(--lecture);">
            üìö Create Lecture
        </button>
    </div>
</div>

<!-- Car Register Modal -->
<div id="carRegisterModal" class="modal">
    <div class="modal-content">
        <h2 style="font-size: 1.8rem; font-weight: 700; margin-bottom: 24px; background: linear-gradient(135deg, #00a8ff, #0097e6); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
            üöó Register Car
        </h2>
        <div class="form-group">
            <label>Car Model</label>
            <input type="text" id="carModel" placeholder="Tesla Model 3">
        </div>
        <div class="form-group">
            <label>License Plate</label>
            <input type="text" id="carPlate" placeholder="ABC123">
        </div>
        <p style="color: var(--text-secondary); margin-bottom: 20px;">
            Registration fee: <strong>10,000 TL</strong> (one-time)
        </p>
        <div style="display: flex; gap: 16px;">
            <button class="btn-play" onclick="TimeLinkSystem.car.register()" style="flex: 1; background: var(--car);">üöó Register</button>
            <button class="btn-play" onclick="TimeLinkSystem.ui.closeCarRegisterModal()" style="flex: 1; background: transparent; border: 1px solid var(--border-color);">Cancel</button>
        </div>
    </div>
</div>

<!-- Permission Request Modal -->
<div id="permissionModal" class="modal">
    <div class="modal-content">
        <h2 style="font-size: 1.8rem; font-weight: 700; margin-bottom: 24px; background: linear-gradient(135deg, #00a8ff, #0097e6); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
            üöó Ï∞®Îüâ Í∞êÏßÄ Í∂åÌïú
        </h2>
        <p style="color: var(--text-secondary); margin-bottom: 20px;">
            Ï∞®Îüâ ÎÇ¥ Ï≤≠Ï∑® Í∞êÏßÄÎ•º ÏúÑÌï¥ Îã§Ïùå Í∂åÌïúÏù¥ ÌïÑÏöîÌï©ÎãàÎã§:
        </p>
        <div style="background: rgba(0,168,255,0.1); padding: 20px; border-radius: var(--radius-lg); margin-bottom: 24px;">
            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                <span style="font-size: 1.5rem;">üìç</span>
                <div>
                    <strong>ÏúÑÏπò Í∂åÌïú</strong>
                    <p style="font-size: 12px;">Ïù¥Îèô ÏÜçÎèÑ Í∞êÏßÄ (GPS)</p>
                </div>
            </div>
            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                <span style="font-size: 1.5rem;">üì∂</span>
                <div>
                    <strong>Bluetooth Í∂åÌïú</strong>
                    <p style="font-size: 12px;">Ï∞®Îüâ Bluetooth Ïó∞Í≤∞ Í∞êÏßÄ</p>
                </div>
            </div>
            <div style="display: flex; align-items: center; gap: 12px;">
                <span style="font-size: 1.5rem;">üì≥</span>
                <div>
                    <strong>Í∞ÄÏÜçÎèÑÍ≥Ñ Í∂åÌïú</strong>
                    <p style="font-size: 12px;">Ï∞®Îüâ ÏßÑÎèô Ìå®ÌÑ¥ Í∞êÏßÄ</p>
                </div>
            </div>
        </div>
        <div style="display: flex; gap: 16px;">
            <button class="btn-play" onclick="TimeLinkSystem.carDetection.requestAllPermissions()" style="flex: 1; background: var(--car);">‚úÖ Í∂åÌïú ÌóàÏö©</button>
            <button class="btn-play" onclick="TimeLinkSystem.ui.closePermissionModal()" style="flex: 1; background: transparent; border: 1px solid var(--border-color);">ÎÇòÏ§ëÏóê</button>
        </div>
    </div>
</div>

<!-- Player Modal (Ïò§ÎîîÏò§ Ï†ÑÏö©) -->
<div id="playerModal" class="modal">
    <div class="modal-content player-content">
        <div class="player-title" id="playerTitle">Now Playing</div>
        <div class="player-artist" id="playerArtist">Artist</div>
        
        <!-- File Type Badge -->
        <div style="margin-bottom: 16px;">
            <span id="playerTypeBadge" style="background: var(--success); padding: 4px 12px; border-radius: var(--radius-full); font-size: 12px;">TL3 Audio</span>
            <span id="playerRateBadge" style="background: var(--warning); padding: 4px 12px; border-radius: var(--radius-full); font-size: 12px; margin-left: 8px;">1TL/Ï¥à</span>
        </div>
        
        <!-- Copyright Panel -->
        <div class="player-panel" style="border-left-color: #8b5cf6;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                <span style="font-weight: 700; color: #8b5cf6;">üìã Copyright</span>
                <span style="background: #8b5cf6; color: white; padding: 4px 12px; border-radius: var(--radius-full); font-size: 11px;">Blockchain</span>
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                <div><span style="color: var(--text-secondary);">Owner</span><br><strong id="playerCopyrightOwner">Global Investor</strong></div>
                <div><span style="color: var(--text-secondary);">Reg. No.</span><br><strong id="playerCopyrightNumber">CR-2024-001234</strong></div>
            </div>
        </div>
        
        <!-- Contract Panel -->
        <div class="player-panel" style="border-left-color: var(--accent);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                <span style="font-weight: 700; color: var(--accent);">üìä Revenue Share</span>
                <span style="background: var(--accent); color: white; padding: 4px 12px; border-radius: var(--radius-full); font-size: 11px;" id="playerContractType">5:5 Contract</span>
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                <div><span style="color: var(--text-secondary);">Creator</span><br><strong id="playerCreatorShare">50%</strong></div>
                <div><span style="color: var(--text-secondary);">Platform</span><br><strong id="playerPlatformShare">50%</strong></div>
            </div>
        </div>
        
        <!-- TL Panel -->
        <div class="player-panel" style="border-left-color: var(--warning);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                <span style="font-weight: 700; color: var(--warning);">‚è≥ TL Balance</span>
                <span style="background: var(--warning); color: black; padding: 4px 12px; border-radius: var(--radius-full); font-size: 11px;" id="playerRateLabel">1s = 1TL</span>
            </div>
            <div class="player-tl-amount" id="playerTL">5,000 TL</div>
            <div style="color: var(--text-secondary); font-size: 14px;" id="playerTimeRemaining">‚âà 83 min left</div>
        </div>
        
        <!-- Revenue Panel -->
        <div class="player-panel" style="border-left-color: var(--info);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                <span style="font-weight: 700; color: var(--info);">üí∞ Live Revenue</span>
                <span style="background: var(--info); color: white; padding: 4px 12px; border-radius: var(--radius-full); font-size: 11px;" id="playerRevenueLabel">0.1TL/Ï¥à</span>
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                <div><span style="color: var(--text-secondary);">Creator</span><br><strong style="font-size: 1.3rem; color: var(--info);" id="playerCreatorRevenue">0.00 TL</strong></div>
                <div><span style="color: var(--text-secondary);">Platform</span><br><strong style="font-size: 1.3rem; color: var(--info);" id="playerPlatformRevenue">0.00 TL</strong></div>
            </div>
            <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid rgba(59,130,246,0.2);">
                <span style="color: var(--text-secondary);">Session Total</span>
                <br><strong id="playerTotalRevenue" style="color: white;">0.00 TL</strong>
            </div>
        </div>
        
        <!-- Progress -->
        <div class="player-progress">
            <div id="playerProgress" class="player-progress-fill" style="width: 0%;"></div>
        </div>
        
        <div class="player-time">
            <span id="playerCurrentTime">0:00</span>
            <span id="playerTotalTime">83:20</span>
        </div>
        
        <!-- Queue Panel -->
        <div class="player-queue" id="playerQueue">
            <h4 style="margin-bottom: 12px; color: var(--text-secondary);">‚è≠Ô∏è Next in Queue</h4>
            <div id="queueList"></div>
        </div>
        
        <!-- Auto-Recharge Panel -->
        <div class="player-panel" style="border-left-color: var(--success); margin-top: 16px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                <span style="font-weight: 700; color: var(--success);">‚ö° Auto-Recharge</span>
                <label class="switch">
                    <input type="checkbox" id="autoRechargeToggle" onchange="TimeLinkSystem.autoRecharge.toggle()">
                    <span class="slider"></span>
                </label>
            </div>
            
            <div id="autoRechargeSettings" style="opacity: 0.5;">
                <div style="display: flex; gap: 12px; margin-bottom: 12px;">
                    <div style="flex: 1;">
                        <label style="color: var(--text-secondary); font-size: 11px;">Threshold (TL)</label>
                        <select id="autoRechargeThreshold" onchange="TimeLinkSystem.autoRecharge.updateSettings()" style="width: 100%; padding: 8px; background: rgba(255,255,255,0.1); border: 1px solid var(--border-color); border-radius: var(--radius-md); color: white;">
                            <option value="60">60 TL (1 min)</option>
                            <option value="300" selected>300 TL (5 min)</option>
                            <option value="600">600 TL (10 min)</option>
                            <option value="1800">1,800 TL (30 min)</option>
                        </select>
                    </div>
                    <div style="flex: 1;">
                        <label style="color: var(--text-secondary); font-size: 11px;">Amount (TL)</label>
                        <select id="autoRechargeAmount" onchange="TimeLinkSystem.autoRecharge.updateSettings()" style="width: 100%; padding: 8px; background: rgba(255,255,255,0.1); border: 1px solid var(--border-color); border-radius: var(--radius-md); color: white;">
                            <option value="600">600 TL (10 min)</option>
                            <option value="1800">1,800 TL (30 min)</option>
                            <option value="3600" selected>3,600 TL (1 hour)</option>
                            <option value="10800">10,800 TL (3 hours)</option>
                        </select>
                    </div>
                </div>
                
                <div style="margin-top: 12px; background: rgba(255,255,255,0.03); padding: 8px 12px; border-radius: var(--radius-md);">
                    <span style="color: var(--text-secondary);">Wallet: </span>
                    <strong style="color: white;" id="autoRechargeWalletBalance">25,000 TL</strong>
                    <span style="color: var(--text-secondary); margin-left: 12px;">Debt: </span>
                    <strong style="color: var(--warning);" id="autoRechargeDebt">0 TL</strong>
                </div>
            </div>
        </div>
        
        <!-- Controls -->
        <div class="player-controls" style="margin-top: 16px;">
            <button class="btn-play" onclick="TimeLinkSystem.player.togglePlayPause()" id="playPauseBtn" style="flex: 1;">‚è∏Ô∏è Pause</button>
            <button class="btn-play" onclick="TimeLinkSystem.player.stop()" style="flex: 1; background: transparent; border: 1px solid var(--border-color);">‚èπÔ∏è Stop</button>
            <button class="btn-play" onclick="TimeLinkSystem.player.next()" style="flex: 1; background: var(--info);">‚è≠Ô∏è Next</button>
        </div>
    </div>
</div>

<!-- Ad Watch Modal -->
<div id="adWatchModal" class="modal">
    <div class="modal-content" style="text-align: center;">
        <h2 style="font-size: 2rem; font-weight: 700; margin-bottom: 24px; background: linear-gradient(135deg, #ffd700, #ffaa00); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
            üì∫ Watch Ad & Earn TL
        </h2>
        
        <div id="adTypeSelector" style="display: flex; gap: 20px; margin-bottom: 30px;">
            <div class="file-type-card" style="flex:1;" onclick="TimeLinkSystem.ad.selectType('video')">
                <div class="icon">üìπ</div>
                <h3>Video Ad</h3>
                <div class="rate" style="color: var(--ad);">30Ï¥à = 60 TL</div>
            </div>
            <div class="file-type-card" style="flex:1;" onclick="TimeLinkSystem.ad.selectType('audio')">
                <div class="icon">üéµ</div>
                <h3>Audio Ad</h3>
                <div class="rate" style="color: var(--ad);">30Ï¥à = 30 TL</div>
            </div>
        </div>
        
        <div id="adPlayerSection" style="display: none;">
            <div id="videoAdContainer" style="display: none;">
                <video id="videoAdPlayer" style="width: 100%; border-radius: var(--radius-lg);" controls></video>
            </div>
            
            <div id="audioAdContainer" style="display: none;">
                <div style="background: linear-gradient(145deg, #ffd700, #ffaa00); padding: 40px; border-radius: var(--radius-lg); margin: 20px 0;">
                    <div style="font-size: 4rem; margin-bottom: 20px;">üéµ</div>
                    <div class="ad-timer" id="adTimer">30</div>
                    <div class="ad-progress">
                        <div class="ad-progress-fill" id="adProgress" style="width: 0%;"></div>
                    </div>
                </div>
            </div>
            
            <div style="margin: 20px 0; padding: 16px; background: rgba(255,215,0,0.1); border-radius: var(--radius-lg);">
                <div style="display: flex; justify-content: space-between;">
                    <span>üí∞ ÏòàÏÉÅ Î≥¥ÏÉÅ:</span>
                    <strong id="adRewardAmount" style="color: var(--ad);">60 TL</strong>
                </div>
                <div style="display: flex; justify-content: space-between; margin-top: 8px;">
                    <span>üìä Ïò§Îäò ÎÇ®ÏùÄ Î≥¥ÏÉÅ:</span>
                    <strong id="adDailyRemaining">540 TL</strong>
                </div>
            </div>
            
            <div style="display: flex; gap: 16px; margin-top: 24px;">
                <button class="btn-play" onclick="TimeLinkSystem.ad.startWatching()" id="adStartBtn" style="flex: 1; background: var(--ad); color: black;">‚ñ∂Ô∏è Start Watching</button>
                <button class="btn-play" onclick="TimeLinkSystem.ui.closeAdModal()" style="flex: 1; background: transparent; border: 1px solid var(--border-color);">Cancel</button>
            </div>
        </div>
        
        <div id="adInitialSection">
            <div style="background: rgba(255,215,0,0.1); padding: 24px; border-radius: var(--radius-lg); margin-bottom: 24px;">
                <p>üéØ Í¥ëÍ≥†Î•º ÏãúÏ≤≠ÌïòÍ≥† TLÏùÑ Î∞õÏúºÏÑ∏Ïöî!</p>
                <p style="font-size: 14px; margin-top: 12px;">‚Ä¢ ÎπÑÎîîÏò§ Í¥ëÍ≥†: 30Ï¥à ÏãúÏ≤≠ = 60 TL</p>
                <p style="font-size: 14px;">‚Ä¢ Ïò§ÎîîÏò§ Í¥ëÍ≥†: 30Ï¥à Ï≤≠Ï∑® = 30 TL</p>
                <p style="font-size: 14px;">‚Ä¢ ÏùºÏùº ÏµúÎåÄ: 600 TL</p>
            </div>
            <button class="btn-play" onclick="TimeLinkSystem.ad.showSelector()" style="width: 100%; background: var(--ad); color: black;">üì∫ Select Ad Type</button>
        </div>
    </div>
</div>

<!-- Login Page -->
<div id="authContainer" class="auth-container">
    <div class="auth-box">
        <div class="logo">
            <h1>‚è∞ TimeLink</h1>
            <p>TL3/TL4 ‚Äî ÏùåÏïÖ Î∂ÑÎ•ò Î∞è Ïû•Î•¥ ÏãúÏä§ÌÖú</p>
        </div>
        <div class="version-badge">
            üöÄ v22.7 ¬∑ Ïû•Î•¥Î≥Ñ Ïó∞ÏÜç Ïû¨ÏÉù ¬∑ ÏùåÏïÖ Î∂ÑÎ•ò ÏãúÏä§ÌÖú <span class="demo-badge">DEMO</span>
        </div>
        
        <button class="google-login-btn" onclick="TimeLinkSystem.demo.login()">
            <i class="fab fa-google"></i> Continue with Google
        </button>
        
        <div style="background: rgba(255,255,255,0.03); border-radius: var(--radius-lg); padding: 20px; margin-top: 20px;">
            <h3 style="color: white; margin-bottom: 16px;">üéµ ÏùåÏïÖ Î∂ÑÎ•ò ÏãúÏä§ÌÖú</h3>
            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                <span class="genre-badge pop">Pop</span>
                <span class="genre-badge rock">Rock</span>
                <span class="genre-badge hiphop">Hip-Hop</span>
                <span class="genre-badge jazz">Jazz</span>
                <span class="genre-badge classic">Classic</span>
                <span class="genre-badge edm">EDM</span>
                <span class="genre-badge rnb">R&B</span>
                <span class="genre-badge country">Country</span>
            </div>
            <div style="margin-top: 16px; text-align: center;">
                <span style="color: var(--car);">üöó Ïû•Î•¥ ÏÑ†ÌÉù ÌõÑ Ïó∞ÏÜç Ïû¨ÏÉù</span> ¬∑ AI ÌÅêÎ†àÏù¥ÏÖò
            </div>
        </div>
    </div>
</div>

<!-- Main Application -->
<div id="appContainer" class="app-container" style="display: none;">
    
    <!-- Header -->
    <div class="app-header">
        <div class="header-left">
            <h1>‚è∞ TimeLink Global</h1>
            <span class="demo-badge">Ïû•Î•¥ ÏãúÏä§ÌÖú</span>
        </div>
        <div class="header-right">
            <div class="balance-cards">
                <div class="balance-card" onclick="TimeLinkSystem.ui.openPurchaseModal()">
                    <div class="label">üí∞ TL Wallet</div>
                    <div class="amount" id="walletBalance">25,000</div>
                </div>
                <div class="balance-card">
                    <div class="label">ü™ô TLC</div>
                    <div class="amount" id="tlcBalance">1,250.75</div>
                </div>
                <div class="balance-card" style="background: rgba(255,215,0,0.1);" onclick="TimeLinkSystem.ui.openAdModal()">
                    <div class="label">üì∫ Í¥ëÍ≥†Î≥¥Í∏∞</div>
                    <div class="amount" id="adRewardIndicator">+60 TL</div>
                </div>
            </div>
            <div class="user-profile">
                <div class="avatar-circle" id="userAvatar">G</div>
                <div class="user-info">
                    <div class="user-name" id="currentUsername">Global Investor</div>
                    <div class="user-status" id="userStatus">üè¢ Business</div>
                </div>
            </div>
            <button class="btn-logout" onclick="TimeLinkSystem.demo.logout()">Logout</button>
        </div>
    </div>

    <!-- Tab Navigation -->
    <div class="tabs-container">
        <div class="tabs">
            <button class="tab active" onclick="TimeLinkSystem.ui.switchTab('dashboard')">üìä Dashboard</button>
            <button class="tab" onclick="TimeLinkSystem.ui.switchTab('upload')">üì§ Create</button>
            <button class="tab" onclick="TimeLinkSystem.ui.switchTab('library')">üéµ My Files</button>
            <button class="tab" onclick="TimeLinkSystem.ui.switchTab('shareplace')">üîÑ Share Place</button>
            <button class="tab" onclick="TimeLinkSystem.ui.switchTab('radio')">üìª Radio</button>
            <button class="tab" onclick="TimeLinkSystem.ui.switchTab('commercial')">üì∫ Commercial</button>
            <button class="tab" onclick="TimeLinkSystem.ui.switchTab('car')">üöó Car</button>
            <button class="tab" onclick="TimeLinkSystem.ui.switchTab('mining')">‚õèÔ∏è Mining</button>
            <button class="tab" onclick="TimeLinkSystem.ui.switchTab('lecture')">üìö Lecture</button>
            <button class="tab" onclick="TimeLinkSystem.ui.switchTab('gold')">üèÜ Gold</button>
            <button class="tab" onclick="TimeLinkSystem.ui.switchTab('ton')">‚¨° TON</button>
        </div>
    </div>

    <!-- Dashboard -->
    <div id="tabDashboard" class="tab-content active">
        <div class="stats-grid">
            <div class="stat-card">
                <div class="icon">üí∞</div>
                <div class="label">TL Wallet</div>
                <div class="value" id="dashWallet">25,000</div>
            </div>
            <div class="stat-card">
                <div class="icon">ü™ô</div>
                <div class="label">TLC</div>
                <div class="value" id="dashTLC">1,250.75</div>
            </div>
            <div class="stat-card">
                <div class="icon">üéµ</div>
                <div class="label">TL3 Files</div>
                <div class="value" id="dashTL3">2</div>
            </div>
            <div class="stat-card">
                <div class="icon">üé¨</div>
                <div class="label">TL4 Files</div>
                <div class="value" id="dashTL4">1</div>
            </div>
        </div>
        
        <!-- Genre Distribution -->
        <div style="background: var(--bg-card); border-radius: var(--radius-xl); padding: 24px; margin-bottom: 20px;">
            <h3 style="color: white; margin-bottom: 16px;">üìä Ïû•Î•¥Î≥Ñ ÏùåÏïÖ Î∂ÑÌè¨</h3>
            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px;" id="genreDistribution"></div>
        </div>
        
        <!-- Zero TL Info -->
        <div style="background: rgba(255,68,68,0.1); border-radius: var(--radius-lg); padding: 20px; margin-bottom: 20px; border: 1px solid var(--zero-tl);">
            <div style="display: flex; align-items: center; gap: 12px;">
                <div style="font-size: 2rem;">üÜï</div>
                <div>
                    <h3 style="color: white;">ÏÉà ÌååÏùº ÏÉùÏÑ± Í∑úÏπô</h3>
                    <p style="color: var(--text-secondary);">TL3/TL4 ÌååÏùº ÏÉùÏÑ±Ïãú Ï¥àÍ∏∞ TL = 0 ¬∑ Ï∂©Ï†Ñ ÌõÑ Ïû¨ÏÉù Í∞ÄÎä•</p>
                </div>
            </div>
        </div>
        
        <!-- AI Contribution Index Display -->
        <div class="mining-index-card">
            <h2 style="color: white; margin-bottom: 16px;">ü§ñ AI Ïã§ÏãúÍ∞Ñ Í∏∞Ïó¨ÎèÑ ÏßÄÏàò</h2>
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <div>
                    <span style="color: var(--text-secondary);">ÌòÑÏû¨ ÏãúÍ∞Ñ:</span>
                    <strong style="color: white; font-size: 1.5rem; margin-left: 10px;" id="currentTimeDisplay">14:30</strong>
                </div>
                <div>
                    <span style="color: var(--text-secondary);">ÌòÑÏû¨ ÏßÄÏàò:</span>
                    <strong style="color: var(--mining-offpeak); font-size: 2.5rem; margin-left: 10px;" id="currentIndexDisplay">2.5x</strong>
                </div>
            </div>
            
            <div class="index-graph">
                <div class="index-bar" id="indexBar" style="width: 50%;"></div>
            </div>
            
            <div style="display: flex; justify-content: space-between; margin-top: 10px;">
                <span style="color: var(--mining-peak);">üî¥ ÌîºÌÅ¨ÌÉÄÏûÑ (1.0x)</span>
                <span style="color: var(--mining-offpeak);">üü¢ Ïò§ÌîÑÌîºÌÅ¨ (ÏµúÎåÄ 5.0x)</span>
            </div>
        </div>
        
        <!-- Car Detection Status -->
        <div style="background: rgba(0,168,255,0.1); border-radius: var(--radius-lg); padding: 20px; margin-bottom: 20px; border: 1px solid var(--car);">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <h3 style="color: white;">üöó Ï∞®Îüâ Í∞êÏßÄ ÏÉÅÌÉú</h3>
                    <p style="color: var(--text-secondary);" id="carDetectionStatus">Í∞êÏßÄ ÎåÄÍ∏∞Ï§ë...</p>
                </div>
                <div>
                    <span class="badge" style="background: var(--car); position: static;" id="carModeBadgeHeader">ÏùºÎ∞ò Î™®Îìú</span>
                </div>
            </div>
            <div style="display: flex; gap: 10px; margin-top: 15px;" id="detectionMethods"></div>
        </div>
        
        <!-- Platform Stats -->
        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 30px;">
            <div style="background: var(--bg-card); padding: 20px; border-radius: var(--radius-lg); text-align: center;">
                <div style="font-size: 2rem;">üìª</div>
                <div>Radio Listeners</div>
                <div style="font-size: 1.8rem; font-weight: 800;" id="radioListeners">1,234</div>
            </div>
            <div style="background: var(--bg-card); padding: 20px; border-radius: var(--radius-lg); text-align: center;">
                <div style="font-size: 2rem;">üì∫</div>
                <div>Commercial</div>
                <div style="font-size: 1.8rem; font-weight: 800;" id="commercialViewers">567</div>
            </div>
            <div style="background: var(--bg-card); padding: 20px; border-radius: var(--radius-lg); text-align: center;">
                <div style="font-size: 2rem;">üöó</div>
                <div>Car Listeners</div>
                <div style="font-size: 1.8rem; font-weight: 800;" id="carListeners">89</div>
            </div>
            <div style="background: var(--bg-card); padding: 20px; border-radius: var(--radius-lg); text-align: center;">
                <div style="font-size: 2rem;">üîÑ</div>
                <div>Shared Files</div>
                <div style="font-size: 1.8rem; font-weight: 800;" id="sharedCount">0</div>
            </div>
        </div>
    </div>

    <!-- Create TL3/TL4 -->
    <div id="tabUpload" class="tab-content">
        <div class="card">
            <h2>üì§ Create TL3 (Audio) / TL4 (Video)</h2>
            
            <div style="background: rgba(255,68,68,0.1); border-left: 6px solid var(--zero-tl); padding: 20px; border-radius: var(--radius-lg); margin-bottom: 28px;">
                <p style="color: white; font-weight: 700;">‚ö†Ô∏è Ï§ëÏöî: ÏÉùÏÑ±Îêú ÌååÏùºÏùò Ï¥àÍ∏∞ TL = 0</p>
                <p style="color: var(--text-secondary); font-size: 14px; margin-top: 8px;">
                    ÌååÏùº ÏÉùÏÑ± ÌõÑ Ï∂©Ï†ÑÌï¥Ïïº Ïû¨ÏÉùÌï† Ïàò ÏûàÏäµÎãàÎã§.<br>
                    Ï∂©Ï†ÑÏùÄ "My Files" ÌÉ≠ÏóêÏÑú Í∞ÄÎä•Ìï©ÎãàÎã§.
                </p>
            </div>
            
            <div class="file-type-selector">
                <div class="file-type-card audio selected" id="audioTypeCard" onclick="TimeLinkSystem.file.selectType('audio')">
                    <div class="icon">üéµ</div>
                    <h3>TL3 Audio</h3>
                    <div class="rate">1Ï¥à = 1TL</div>
                    <div class="desc">MP3, WAV, FLAC</div>
                    <div class="zero-tl-badge">Ï¥àÍ∏∞ TL 0</div>
                </div>
                <div class="file-type-card video" id="videoTypeCard" onclick="TimeLinkSystem.file.selectType('video')">
                    <div class="icon">üé¨</div>
                    <h3>TL4 Video</h3>
                    <div class="rate">1Ï¥à = 2TL</div>
                    <div class="desc">MP4, MOV, AVI</div>
                    <div class="zero-tl-badge">Ï¥àÍ∏∞ TL 0</div>
                </div>
            </div>
            
            <div class="upload-zone" onclick="document.getElementById('fileInput').click()">
                <div class="icon" id="uploadIcon">üéµ</div>
                <h3 id="uploadText">Click to select file</h3>
                <p id="uploadDesc">MP3, WAV, FLAC (max 100MB)</p>
            </div>
            <input type="file" id="fileInput" style="display: none;" accept="audio/*,video/*">
            
            <div id="uploadForm" style="display: none; margin-top: 32px;">
                <div class="form-group">
                    <label>Title</label>
                    <input type="text" id="songTitle" placeholder="Title">
                </div>
                <div class="form-group">
                    <label>Artist</label>
                    <input type="text" id="songArtist" placeholder="Artist name">
                </div>
                
                <!-- Genre Selection -->
                <div class="form-group">
                    <label>Genre</label>
                    <select id="songGenre">
                        <option value="pop">üé§ Pop</option>
                        <option value="rock">üé∏ Rock</option>
                        <option value="hiphop">üéß Hip-Hop</option>
                        <option value="jazz">üé∫ Jazz</option>
                        <option value="classic">üéª Classic</option>
                        <option value="edm">üíø EDM</option>
                        <option value="rnb">üéπ R&B</option>
                        <option value="country">ü§† Country</option>
                    </select>
                </div>
                
                <div style="background: rgba(139, 92, 246, 0.1); padding: 24px; border-radius: var(--radius-lg); margin-bottom: 24px;">
                    <h3 style="margin-bottom: 20px; color: #8b5cf6;">üìã Copyright</h3>
                    <div class="form-group">
                        <label>Owner</label>
                        <input type="text" id="copyrightOwner" value="Global Investor">
                    </div>
                    <div class="form-group">
                        <label>Reg. Number</label>
                        <input type="text" id="copyrightNumber" readonly style="background: rgba(0,0,0,0.2);">
                    </div>
                </div>
                
                <div style="background: rgba(138, 43, 226, 0.1); padding: 24px; border-radius: var(--radius-lg); margin-bottom: 24px;">
                    <h3 style="margin-bottom: 20px; color: var(--accent);">üìä Contract</h3>
                    <div class="form-group">
                        <select id="revenueShare">
                            <option value="55">5:5 Contract ‚Äî Mining Allowed (Creator 50%)</option>
                            <option value="73">7:3 Contract ‚Äî No Mining (Creator 70%)</option>
                        </select>
                    </div>
                </div>
                
                <div style="background: rgba(255,68,68,0.1); padding: 16px; border-radius: var(--radius-lg); margin-bottom: 24px;">
                    <p style="color: white; text-align: center;">
                        ‚ö†Ô∏è ÏÉùÏÑ±Îêú ÌååÏùºÏùò TL ÏûîÏï°: <strong style="color: var(--zero-tl);">0 TL</strong>
                    </p>
                </div>
                
                <button class="btn-play" onclick="TimeLinkSystem.file.create()" style="width: 100%; padding: 18px; background: var(--accent);">
                    ‚ú® Create File (TL 0)
                </button>
            </div>
        </div>
    </div>

    <!-- My Files -->
    <div id="tabLibrary" class="tab-content">
        <div class="card">
            <h2>üéµ My TL3/TL4 Files</h2>
            <div id="fileList" class="file-list"></div>
            <div id="emptyLibrary" style="text-align: center; padding: 80px; display: none;">
                <div style="font-size: 5rem;">üéµ</div>
                <h3 style="color: white; margin: 20px;">No files yet</h3>
                <button class="btn-play" onclick="TimeLinkSystem.ui.switchTab('upload')">Create File</button>
            </div>
        </div>
    </div>

    <!-- Share Place -->
    <div id="tabShareplace" class="tab-content">
        <div class="share-header">
            <div>
                <h2 style="color: white;">üîÑ Share Place</h2>
                <p style="color: rgba(255,255,255,0.9); margin-top: 8px;">
                    <strong>Î™®Îì† Í≥µÏú† Í≥° Î™®Ïùå ¬∑ Ïû•Î•¥Î≥Ñ ÌïÑÌÑ∞ÎßÅ</strong>
                </p>
            </div>
            <div style="background: rgba(255,255,255,0.1); padding: 12px 28px; border-radius: var(--radius-full);">
                <span style="font-weight: 700; color: white;" id="sharedCount2">0</span> Í≥°
            </div>
        </div>

        <div class="share-stats">
            <div class="share-stat-card">
                <div>Ï†ÑÏ≤¥ Í≥°</div>
                <div class="share-stat-value" id="totalSharedCount">0</div>
            </div>
            <div class="share-stat-card">
                <div>5:5 Í≥ÑÏïΩ</div>
                <div class="share-stat-value" id="shared55Count">0</div>
            </div>
            <div class="share-stat-card">
                <div>7:3 Í≥ÑÏïΩ</div>
                <div class="share-stat-value" id="shared73Count">0</div>
            </div>
        </div>

        <!-- Genre Filter -->
        <div class="genre-selector">
            <button class="genre-btn active" onclick="TimeLinkSystem.share.filterGenre('all', event)">üéµ Ï†ÑÏ≤¥</button>
            <button class="genre-btn pop" onclick="TimeLinkSystem.share.filterGenre('pop', event)">üé§ Pop</button>
            <button class="genre-btn rock" onclick="TimeLinkSystem.share.filterGenre('rock', event)">üé∏ Rock</button>
            <button class="genre-btn hiphop" onclick="TimeLinkSystem.share.filterGenre('hiphop', event)">üéß Hip-Hop</button>
            <button class="genre-btn jazz" onclick="TimeLinkSystem.share.filterGenre('jazz', event)">üé∫ Jazz</button>
            <button class="genre-btn classic" onclick="TimeLinkSystem.share.filterGenre('classic', event)">üéª Classic</button>
            <button class="genre-btn edm" onclick="TimeLinkSystem.share.filterGenre('edm', event)">üíø EDM</button>
            <button class="genre-btn rnb" onclick="TimeLinkSystem.share.filterGenre('rnb', event)">üéπ R&B</button>
            <button class="genre-btn country" onclick="TimeLinkSystem.share.filterGenre('country', event)">ü§† Country</button>
        </div>

        <div class="share-filter">
            <button class="filter-btn active" onclick="TimeLinkSystem.share.filter('all', event)">Ï†ÑÏ≤¥</button>
            <button class="filter-btn" onclick="TimeLinkSystem.share.filter('55', event)">5:5 Í≥ÑÏïΩ</button>
            <button class="filter-btn" onclick="TimeLinkSystem.share.filter('73', event)">7:3 Í≥ÑÏïΩ</button>
            <button class="filter-btn" onclick="TimeLinkSystem.share.filter('mining', event)">Ï±ÑÍµ¥ Í∞ÄÎä•</button>
        </div>

        <div id="sharedMusicList" class="file-list"></div>
    </div>

    <!-- Radio -->
    <div id="tabRadio" class="tab-content">
        <div class="radio-header">
            <div>
                <h2 style="color: white; font-size: 2rem;">üìª TimeLink Radio</h2>
                <p style="color: rgba(255,255,255,0.9);">24/7 Ïã§ÏãúÍ∞Ñ Ïä§Ìä∏Î¶¨Î∞ç ¬∑ Ïû•Î•¥ ÏÑ†ÌÉù ÌõÑ Ïó∞ÏÜç Ïû¨ÏÉù</p>
                <p style="color: rgba(255,255,255,0.9); margin-top: 12px;">
                    <strong>üéß 1Ï¥à = 0.3 ~ 0.7 TL (ÌèâÍ∑† 0.5TL)</strong>
                </p>
            </div>
            <span style="background: rgba(255,255,255,0.2); padding: 12px 28px; border-radius: var(--radius-full);">üî¥ LIVE 24/7</span>
        </div>
        
        <!-- Genre Selector for Radio -->
        <div class="genre-selector">
            <button class="genre-btn active" onclick="TimeLinkSystem.radio.selectGenre('all', event)">üéµ Ï†ÑÏ≤¥</button>
            <button class="genre-btn pop" onclick="TimeLinkSystem.radio.selectGenre('pop', event)">üé§ Pop</button>
            <button class="genre-btn rock" onclick="TimeLinkSystem.radio.selectGenre('rock', event)">üé∏ Rock</button>
            <button class="genre-btn hiphop" onclick="TimeLinkSystem.radio.selectGenre('hiphop', event)">üéß Hip-Hop</button>
            <button class="genre-btn jazz" onclick="TimeLinkSystem.radio.selectGenre('jazz', event)">üé∫ Jazz</button>
            <button class="genre-btn classic" onclick="TimeLinkSystem.radio.selectGenre('classic', event)">üéª Classic</button>
            <button class="genre-btn edm" onclick="TimeLinkSystem.radio.selectGenre('edm', event)">üíø EDM</button>
            <button class="genre-btn rnb" onclick="TimeLinkSystem.radio.selectGenre('rnb', event)">üéπ R&B</button>
            <button class="genre-btn country" onclick="TimeLinkSystem.radio.selectGenre('country', event)">ü§† Country</button>
        </div>
        
        <!-- ÌòÑÏû¨ Ïû¨ÏÉùÏ§ë (Ïû•Î•¥ ÌëúÏãú) -->
        <div class="now-playing-card" id="radioNowPlayingCard">
            <div style="display: flex; align-items: center; gap: 20px;">
                <div style="font-size: 4rem;">üìª</div>
                <div style="flex: 1;">
                    <div style="color: var(--text-secondary);">NOW PLAYING</div>
                    <div style="font-size: 1.8rem; font-weight: 700;" id="radioNowPlaying">-</div>
                    <div style="display: flex; gap: 20px; margin-top: 12px;">
                        <span>üéµ Ïû•Î•¥: <strong id="radioCurrentGenre">-</strong></span>
                        <span>üéµ ÏÜåÎ™®: <strong id="radioConsumeRate">0.5 TL/Ï¥à</strong></span>
                        <span>üë• Ï≤≠Ï∑®Ïûê: <strong id="radioListenerCount">1,234</strong></span>
                    </div>
                </div>
                <button class="btn-radio" onclick="TimeLinkSystem.radio.togglePlay()" id="radioPlayBtn">
                    üìª Îì£Í∏∞
                </button>
            </div>
        </div>
        
        <!-- Queue Display -->
        <div class="queue-container" id="radioQueue">
            <div class="queue-title">‚è≠Ô∏è Îã§Ïùå Ïû¨ÏÉù Î™©Î°ù (Ïû•Î•¥ Ïó∞ÏÜç Ïû¨ÏÉù)</div>
            <div id="radioQueueList"></div>
        </div>
        
        <div id="radioChannels" class="radio-channels"></div>
    </div>

    <!-- Commercial -->
    <div id="tabCommercial" class="tab-content">
        <div class="commercial-header">
            <div>
                <h2 style="color: white; font-size: 2rem;">üì∫ Commercial Broadcast</h2>
                <p style="color: rgba(255,255,255,0.9);">ÏÜåÏÉÅÍ≥µÏù∏ Ï†ÑÏö© ¬∑ Ï∞®Í∞ê ÏßÄÏàò 0.3Î∞∞</p>
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-top: 20px;">
                    <div style="background: rgba(255,255,255,0.1); padding: 16px; border-radius: var(--radius-lg);">
                        <div>Basic</div>
                        <div style="font-size: 1.5rem;">50,000 TL</div>
                        <div style="font-size: 12px;">1,000Î™Ö/ÏãúÍ∞Ñ</div>
                    </div>
                    <div style="background: rgba(255,255,255,0.15); padding: 16px; border-radius: var(--radius-lg); border: 1px solid white;">
                        <div>Pro</div>
                        <div style="font-size: 1.5rem;">200,000 TL</div>
                        <div style="font-size: 12px;">5,000Î™Ö/ÏãúÍ∞Ñ</div>
                    </div>
                    <div style="background: rgba(255,255,255,0.1); padding: 16px; border-radius: var(--radius-lg);">
                        <div>Enterprise</div>
                        <div style="font-size: 1.5rem;">1,000,000 TL</div>
                        <div style="font-size: 12px;">30,000Î™Ö/ÏãúÍ∞Ñ</div>
                    </div>
                </div>
            </div>
            <span style="background: rgba(255,255,255,0.2); padding: 12px 28px; border-radius: var(--radius-full);">üí∞ ÏÜåÏÉÅÍ≥µÏù∏ ÌòúÌÉù</span>
        </div>
        
        <!-- Genre Selector for Commercial -->
        <div class="genre-selector">
            <button class="genre-btn active" onclick="TimeLinkSystem.commercial.selectGenre('all', event)">üéµ Ï†ÑÏ≤¥</button>
            <button class="genre-btn pop" onclick="TimeLinkSystem.commercial.selectGenre('pop', event)">üé§ Pop</button>
            <button class="genre-btn rock" onclick="TimeLinkSystem.commercial.selectGenre('rock', event)">üé∏ Rock</button>
            <button class="genre-btn hiphop" onclick="TimeLinkSystem.commercial.selectGenre('hiphop', event)">üéß Hip-Hop</button>
            <button class="genre-btn jazz" onclick="TimeLinkSystem.commercial.selectGenre('jazz', event)">üé∫ Jazz</button>
            <button class="genre-btn classic" onclick="TimeLinkSystem.commercial.selectGenre('classic', event)">üéª Classic</button>
            <button class="genre-btn edm" onclick="TimeLinkSystem.commercial.selectGenre('edm', event)">üíø EDM</button>
            <button class="genre-btn rnb" onclick="TimeLinkSystem.commercial.selectGenre('rnb', event)">üéπ R&B</button>
            <button class="genre-btn country" onclick="TimeLinkSystem.commercial.selectGenre('country', event)">ü§† Country</button>
        </div>
        
        <!-- ÌòÑÏû¨ Î∞©ÏÜ°Ï§ë -->
        <div class="now-playing-card" style="background: linear-gradient(145deg, #f093fb, #f5576c); color: black;" id="commercialNowPlayingCard">
            <div style="display: flex; align-items: center; gap: 20px;">
                <div style="font-size: 4rem;">üì∫</div>
                <div style="flex: 1;">
                    <div>NOW BROADCASTING</div>
                    <div style="font-size: 1.8rem; font-weight: 700;" id="commercialNowPlaying">-</div>
                    <div style="display: flex; gap: 20px; margin-top: 12px;">
                        <span>üéµ Ïû•Î•¥: <strong id="commercialCurrentGenre">-</strong></span>
                        <span>üéµ ÏÜåÎ™®: <strong>0.3 TL/Ï¥à</strong> (ÏÜåÏÉÅÍ≥µÏù∏ ÌòúÌÉù)</span>
                        <span>üë• ÏãúÏ≤≠Ïûê: <strong>567</strong></span>
                    </div>
                </div>
                <button class="btn-commercial" onclick="TimeLinkSystem.commercial.togglePlay()" id="commercialPlayBtn">
                    üì∫ ÏãúÏ≤≠ÌïòÍ∏∞
                </button>
            </div>
        </div>
        
        <!-- Queue Display -->
        <div class="queue-container" id="commercialQueue">
            <div class="queue-title">‚è≠Ô∏è Îã§Ïùå Î∞©ÏÜ° Î™©Î°ù (Ïû•Î•¥ Ïó∞ÏÜç Ïû¨ÏÉù)</div>
            <div id="commercialQueueList"></div>
        </div>
        
        <div id="commercialChannels" class="radio-channels"></div>
        
        <div id="businessApplySection" class="card" style="text-align: center;">
            <h3>ÏÜåÏÉÅÍ≥µÏù∏ Îì±Î°ù</h3>
            <p style="color: var(--text-secondary); margin: 20px 0;">ÏÜåÏÉÅÍ≥µÏù∏ Îì±Î°ù Ïãú Ï∞®Í∞ê ÏßÄÏàò 0.3Î∞∞ ÌòúÌÉù</p>
            <button class="btn-play" onclick="TimeLinkSystem.business.apply()" style="background: var(--accent);">ÏÜåÏÉÅÍ≥µÏù∏ Îì±Î°ùÌïòÍ∏∞</button>
        </div>
    </div>

    <!-- Car -->
    <div id="tabCar" class="tab-content">
        <div class="car-header">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <h2 style="color: white; font-size: 2rem;">üöó Car Listening</h2>
                    <p style="color: rgba(255,255,255,0.9);">ÌÜµÌï© Í∞êÏßÄ ÏãúÏä§ÌÖú ¬∑ ÏûêÎèôÏ∞® Ï≤≠Ï∑® Ïãú 2Î∞∞ Î≥¥ÏÉÅ</p>
                </div>
                <span style="background: rgba(255,255,255,0.2); padding: 12px 28px; border-radius: var(--radius-full);" id="carModeHeader">2x Î≥¥ÏÉÅ</span>
            </div>
        </div>

        <!-- Ï∞®Îüâ Í∞êÏßÄ ÏÉÅÌÉú -->
        <div class="car-detection-status">
            <h3 style="color: white; margin-bottom: 16px;">üì° Ïã§ÏãúÍ∞Ñ Ï∞®Îüâ Í∞êÏßÄ</h3>
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px;" id="carDetectionDetail"></div>
            <div style="margin-top: 16px; padding: 12px; background: rgba(255,255,255,0.05); border-radius: var(--radius-md);">
                <span style="color: var(--text-secondary);">ÌÜµÌï© Ïã†Î¢∞ÎèÑ: </span>
                <strong style="color: var(--car);" id="carConfidence">0%</strong>
                <span style="margin-left: 20px; color: var(--text-secondary);">Í∞êÏßÄ Î∞©Ïãù: </span>
                <strong style="color: white;" id="carDetectionMethod">-</strong>
            </div>
        </div>

        <div class="car-stats">
            <div class="car-stat-card">
                <div>ÎÇ¥ Ï∞®Îüâ</div>
                <div class="car-stat-value" id="myCarsCount">2</div>
            </div>
            <div class="car-stat-card">
                <div>Ïò§Îäò Ï≤≠Ï∑®</div>
                <div class="car-stat-value" id="todayCarMinutes">0Î∂Ñ</div>
            </div>
            <div class="car-stat-card">
                <div>ÌöçÎìù Î≥¥ÏÉÅ</div>
                <div class="car-stat-value" id="carRewards">0 TL</div>
            </div>
            <div class="car-stat-card">
                <div>ÌòÑÏû¨ Î™®Îìú</div>
                <div class="car-stat-value" id="carCurrentMode">ÏùºÎ∞ò</div>
            </div>
        </div>

        <div class="car-register-box">
            <h3 style="color: white; margin-bottom: 16px;">üöò ÎÇ¥ Ï∞®Îüâ</h3>
            <div id="carList" style="margin-bottom: 20px;"></div>
            <div style="display: flex; gap: 12px;">
                <button class="btn-car" onclick="TimeLinkSystem.ui.openCarRegisterModal()" style="flex: 2;">‚ûï Ï∞®Îüâ Îì±Î°ùÌïòÍ∏∞ (10,000 TL)</button>
                <button class="btn-car-manual" onclick="TimeLinkSystem.car.toggleManualMode()" id="manualCarBtn" style="flex: 1;">
                    üöó ÏàòÎèô CAR
                </button>
            </div>
        </div>

        <!-- Genre Selector for Car -->
        <div class="genre-selector">
            <button class="genre-btn active" onclick="TimeLinkSystem.car.selectGenre('all', event)">üéµ Ï†ÑÏ≤¥</button>
            <button class="genre-btn pop" onclick="TimeLinkSystem.car.selectGenre('pop', event)">üé§ Pop</button>
            <button class="genre-btn rock" onclick="TimeLinkSystem.car.selectGenre('rock', event)">üé∏ Rock</button>
            <button class="genre-btn hiphop" onclick="TimeLinkSystem.car.selectGenre('hiphop', event)">üéß Hip-Hop</button>
            <button class="genre-btn jazz" onclick="TimeLinkSystem.car.selectGenre('jazz', event)">üé∫ Jazz</button>
            <button class="genre-btn classic" onclick="TimeLinkSystem.car.selectGenre('classic', event)">üéª Classic</button>
            <button class="genre-btn edm" onclick="TimeLinkSystem.car.selectGenre('edm', event)">üíø EDM</button>
            <button class="genre-btn rnb" onclick="TimeLinkSystem.car.selectGenre('rnb', event)">üéπ R&B</button>
            <button class="genre-btn country" onclick="TimeLinkSystem.car.selectGenre('country', event)">ü§† Country</button>
        </div>

        <!-- ÌòÑÏû¨ Ïû¨ÏÉùÏ§ë (CAR) -->
        <div class="now-playing-card" style="border-left-color: var(--car);" id="carNowPlayingCard">
            <div style="display: flex; align-items: center; gap: 20px;">
                <div style="font-size: 4rem;">üöó</div>
                <div style="flex: 1;">
                    <div style="color: var(--text-secondary);">CAR RADIO NOW PLAYING</div>
                    <div style="font-size: 1.8rem; font-weight: 700;" id="carNowPlaying">-</div>
                    <div style="display: flex; gap: 20px; margin-top: 12px;">
                        <span>üéµ Ïû•Î•¥: <strong id="carCurrentGenre">-</strong></span>
                        <span>üéµ ÏÜåÎ™®: <strong id="carConsumeRate">0.5 TL/Ï¥à</strong></span>
                        <span>üí∞ Î≥¥ÏÉÅ: <strong id="carRewardRate">1.0 TL/Ï¥à</strong> (2Î∞∞)</span>
                    </div>
                </div>
                <button class="btn-car" onclick="TimeLinkSystem.car.togglePlay()" id="carPlayBtn">
                    üöó CAR Ï≤≠Ï∑® ÏãúÏûë
                </button>
            </div>
        </div>

        <!-- Queue Display -->
        <div class="queue-container" id="carQueue">
            <div class="queue-title">‚è≠Ô∏è Îã§Ïùå Ïû¨ÏÉù Î™©Î°ù (Ïû•Î•¥ Ïó∞ÏÜç Ïû¨ÏÉù)</div>
            <div id="carQueueList"></div>
        </div>

        <div class="radio-channels" id="carChannels"></div>
    </div>

    <!-- Mining -->
    <div id="tabMining" class="tab-content">
        <div class="card">
            <h2>‚õèÔ∏è TLC Mining</h2>
            
            <div class="mining-index-card" style="margin-bottom: 24px;">
                <h3 style="color: white; margin-bottom: 16px;">ü§ñ ÌòÑÏû¨ AI Í∏∞Ïó¨ÎèÑ ÏßÄÏàò</h3>
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <span style="color: var(--text-secondary);">ÌòÑÏû¨ ÏãúÍ∞Ñ:</span>
                        <strong style="color: white; font-size: 1.3rem; margin-left: 10px;" id="miningCurrentTime">14:30</strong>
                    </div>
                    <div>
                        <span style="color: var(--text-secondary);">Ï±ÑÍµ¥ ÏßÄÏàò:</span>
                        <strong style="color: var(--mining-offpeak); font-size: 2rem; margin-left: 10px;" id="miningIndex">2.5x</strong>
                    </div>
                </div>
                <div class="index-graph" style="height: 40px; margin: 16px 0;">
                    <div class="index-bar" id="miningIndexBar" style="width: 50%;"></div>
                </div>
                <p style="color: var(--text-secondary);" id="miningTimeInfo">üìä ÌòÑÏû¨ Ïò§ÌîÑÌîºÌÅ¨ ÏãúÍ∞ÑÎåÄÎ°ú Ï±ÑÍµ¥ Ìö®Ïú® 2.5Î∞∞</p>
            </div>

            <div style="background: rgba(255,255,255,0.03); padding: 20px; border-radius: var(--radius-lg); margin-bottom: 24px;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 12px;">
                    <span>Ï±ÑÍµ¥ Í∞ÄÎä• TL (ÏûîÏï°Ïùò 30%):</span>
                    <strong id="minableTL">7,500 TL</strong>
                </div>
                <div class="form-group">
                    <label>Ï±ÑÍµ¥Ìï† TL</label>
                    <input type="number" id="miningAmount" value="1000" min="1" max="7500">
                </div>
            </div>

            <div style="background: rgba(255,215,0,0.1); padding: 20px; border-radius: var(--radius-lg); margin-bottom: 24px;">
                <h4 style="margin-bottom: 16px;">üìä ÏòàÏÉÅ Ï±ÑÍµ¥Îüâ</h4>
                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                    <span>Ìà¨ÏûÖ TL:</span>
                    <strong id="previewTL">1,000 TL</strong>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                    <span>ÌòÑÏû¨ ÏßÄÏàò:</span>
                    <strong id="previewIndex">2.5x</strong>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                    <span>ÏòàÏÉÅ TLC:</span>
                    <strong style="color: var(--success); font-size: 1.5rem;" id="previewTLC">25.00 TLC</strong>
                </div>
            </div>

            <button class="btn-play" onclick="TimeLinkSystem.mining.execute()" style="width: 100%; padding: 20px; background: linear-gradient(90deg, var(--mining-peak), var(--mining-offpeak)); color: black; font-weight: 800;">
                ‚õèÔ∏è ÌòÑÏû¨ ÏßÄÏàòÎ°ú Ï±ÑÍµ¥ÌïòÍ∏∞
            </button>
        </div>
    </div>

    <!-- Lecture Share -->
    <div id="tabLecture" class="tab-content">
        <div class="card">
            <h2>üìö Lecture Share</h2>
            <div style="display: flex; justify-content: space-between; margin-bottom: 24px;">
                <div>
                    <p style="color: var(--text-secondary);">Creator 70% / Platform 30%</p>
                </div>
                <button class="btn-play" onclick="TimeLinkSystem.lecture.openCreateModal()" style="background: var(--lecture);">üìö Create Lecture</button>
            </div>
            <div id="lectureList" class="file-list"></div>
        </div>
    </div>

    <!-- Gold -->
    <div id="tabGold" class="tab-content">
        <div class="card">
            <h2>üèÜ Gold Reserve</h2>
            <div id="goldAmount">10.24 g</div>
        </div>
    </div>

    <!-- TON -->
    <div id="tabTon" class="tab-content">
        <div class="card">
            <h2>‚¨° TON Blockchain</h2>
            <p>TLC on TON</p>
        </div>
    </div>
</div>

<script>
// ============================================================================
// TimeLink Global v22.7 - ÏùåÏïÖ Î∂ÑÎ•ò Î∞è Ïû•Î•¥ ÏãúÏä§ÌÖú
// ============================================================================

// ECONOMIC CONSTANTS
const ECONOMY = {
    TL_PRICE_KRW: 0.1,
    TL3_PER_SECOND: 1,
    TL4_PER_SECOND: 2,
    TL3_REVENUE: 0.1,
    TL4_REVENUE: 0.2,
    
    AUTO_RECHARGE_THRESHOLD: 300,
    AUTO_RECHARGE_AMOUNT: 3600,
    
    // AI Í∏∞Ïó¨ÎèÑ ÏßÄÏàò
    PEAK_HOURS: [
        { start: 12, end: 14 },
        { start: 18, end: 22 }
    ],
    PEAK_INDEX: 1.0,
    OFFPEAK_MIN_INDEX: 2.0,
    OFFPEAK_MAX_INDEX: 5.0,
    
    // Ï±ÑÍµ¥
    MINING_BASE_RATE: 0.01,
    MINING_LIMIT_RATIO: 0.3,
    
    // CAR Ï≤≠Ï∑®
    CAR_REWARD_MULTIPLIER: 2.0,
    CAR_REGISTRATION_FEE: 10000,
    
    // ÎùºÎîîÏò§/Ïª§Î®∏ÏÖú
    RADIO_BASE_CONSUME: 0.5,
    RADIO_CONSUME_VARIATION: 0.2,
    COMMERCIAL_CONSUME_DISCOUNT: 0.3,
    
    LECTURE_CREATOR_SHARE: 0.7,
    LECTURE_PLATFORM_SHARE: 0.3,
    
    SHARE_COST: 5000,
    SHARE_REVENUE_PER_SECOND: 0.01,
    
    // Í¥ëÍ≥†
    AD_VIDEO_REWARD: 60,
    AD_AUDIO_REWARD: 30,
    AD_DAILY_MAX: 600,
    AD_DURATION: 30,
    
    PACKAGES: [
        { id: 'micro', name: 'Micro', tl: 1000, price: 100, bonus: 0 },
        { id: 'starter', name: 'Starter', tl: 10000, price: 1000, bonus: 0 },
        { id: 'regular', name: 'Regular', tl: 50000, price: 5000, bonus: 5000 },
        { id: 'pro', name: 'Pro', tl: 200000, price: 20000, bonus: 30000 }
    ]
};

// Ïû•Î•¥Î≥Ñ ÏÉâÏÉÅ Îß§Ìïë
const GENRE_COLORS = {
    pop: '#ff6b6b',
    rock: '#4ecdc4',
    hiphop: '#ffd93d',
    jazz: '#a8e6cf',
    classic: '#b39eb5',
    edm: '#ff8a5c',
    rnb: '#ffb347',
    country: '#c06c84'
};

// Ïû•Î•¥Î≥Ñ Ïù¥Î™®ÏßÄ Îß§Ìïë
const GENRE_EMOJI = {
    pop: 'üé§',
    rock: 'üé∏',
    hiphop: 'üéß',
    jazz: 'üé∫',
    classic: 'üéª',
    edm: 'üíø',
    rnb: 'üéπ',
    country: 'ü§†'
};

// Blockchain
const Blockchain = {
    records: [],
    async record(data) {
        const record = { id: '0x' + Date.now().toString(16), timestamp: Date.now(), ...data };
        this.records.push(record);
        return record;
    }
};

// Copyright Registry
const CopyrightRegistry = {
    registrations: [],
    async register(data) {
        const reg = { id: 'CR-' + Date.now(), ...data, verified: true };
        this.registrations.push(reg);
        await Blockchain.record({ type: 'COPYRIGHT', ...reg });
        return reg;
    }
};

// AI Í∏∞Ïó¨ÎèÑ ÏßÄÏàò Í≥ÑÏÇ∞ ÏãúÏä§ÌÖú
const AIContributionIndex = {
    getCurrentIndex: function() {
        const now = new Date();
        const hour = now.getHours();
        
        for (const peak of ECONOMY.PEAK_HOURS) {
            if (hour >= peak.start && hour < peak.end) {
                return ECONOMY.PEAK_INDEX;
            }
        }
        
        const hourMap = {
            0: 4.5, 1: 5.0, 2: 5.0, 3: 5.0, 4: 4.8, 5: 4.5,
            6: 4.0, 7: 3.5, 8: 3.0, 9: 2.5, 10: 2.2, 11: 2.0,
            15: 2.2, 16: 2.5, 17: 3.0,
            23: 4.0
        };
        
        return hourMap[hour] || (2.0 + Math.random() * 1.5);
    },
    
    getCurrentInfo: function() {
        const now = new Date();
        const hour = now.getHours();
        const index = this.getCurrentIndex();
        
        let status = 'Ïò§ÌîÑÌîºÌÅ¨';
        let color = 'var(--mining-offpeak)';
        
        for (const peak of ECONOMY.PEAK_HOURS) {
            if (hour >= peak.start && hour < peak.end) {
                status = 'ÌîºÌÅ¨ÌÉÄÏûÑ';
                color = 'var(--mining-peak)';
                break;
            }
        }
        
        return {
            hour,
            index,
            status,
            color,
            timeString: now.toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit' })
        };
    },
    
    calculateMining: function(amount) {
        const index = this.getCurrentIndex();
        return amount * ECONOMY.MINING_BASE_RATE * index;
    }
};

// ============================================================================
// ÏùåÏïÖ Î∂ÑÎ•ò ÏãúÏä§ÌÖú
// ============================================================================

// ÏùåÏïÖ Ïû•Î•¥ Î∂ÑÎ•òÍ∏∞
class GenreClassifier {
    constructor() {
        this.genres = ['pop', 'rock', 'hiphop', 'jazz', 'classic', 'edm', 'rnb', 'country'];
    }
    
    // ÌååÏùºÏùò Ïû•Î•¥ Î∞òÌôò (ÏóÜÏúºÎ©¥ ÎûúÎç§)
    getGenre(file) {
        if (file.metadata.genre) {
            return file.metadata.genre;
        }
        
        // Ïû•Î•¥Í∞Ä ÏóÜÏúºÎ©¥ ÎûúÎç§ Ìï†Îãπ (Îç∞Î™®Ïö©)
        const randomGenre = this.genres[Math.floor(Math.random() * this.genres.length)];
        file.metadata.genre = randomGenre;
        return randomGenre;
    }
    
    // Ïû•Î•¥Î≥Ñ ÌååÏùº ÌïÑÌÑ∞ÎßÅ
    filterByGenre(files, genre) {
        if (genre === 'all') return files;
        return files.filter(file => this.getGenre(file) === genre);
    }
    
    // Ïû•Î•¥ ÌÜµÍ≥Ñ
    getGenreStats(files) {
        const stats = {};
        this.genres.forEach(genre => stats[genre] = 0);
        
        files.forEach(file => {
            const genre = this.getGenre(file);
            stats[genre] = (stats[genre] || 0) + 1;
        });
        
        return stats;
    }
}

// Ïó∞ÏÜç Ïû¨ÏÉù ÌÅê Í¥ÄÎ¶¨Ïûê
class ContinuousPlayQueue {
    constructor() {
        this.queue = [];
        this.currentIndex = -1;
        this.currentGenre = 'all';
        this.availableFiles = [];
    }
    
    // ÌÅê Ï¥àÍ∏∞Ìôî
    init(files, genre = 'all') {
        this.currentGenre = genre;
        this.availableFiles = files.filter(file => 
            genre === 'all' || file.metadata.genre === genre
        );
        
        // ÏÖîÌîå
        this.availableFiles = this.shuffleArray([...this.availableFiles]);
        this.queue = [...this.availableFiles];
        this.currentIndex = 0;
    }
    
    // Î∞∞Ïó¥ ÏÖîÌîå
    shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }
    
    // Îã§Ïùå Í≥° Í∞ÄÏ†∏Ïò§Í∏∞
    next() {
        if (this.queue.length === 0) return null;
        
        this.currentIndex++;
        if (this.currentIndex >= this.queue.length) {
            // Ìïú Î∞îÌÄ¥ ÎèåÎ©¥ Îã§Ïãú ÏÖîÌîå
            this.queue = this.shuffleArray([...this.availableFiles]);
            this.currentIndex = 0;
        }
        
        return this.queue[this.currentIndex];
    }
    
    // ÌòÑÏû¨ Í≥°
    current() {
        if (this.currentIndex >= 0 && this.currentIndex < this.queue.length) {
            return this.queue[this.currentIndex];
        }
        return null;
    }
    
    // Îã§Ïùå Í≥°Îì§ ÎØ∏Î¶¨Î≥¥Í∏∞
    previewNext(count = 5) {
        const preview = [];
        for (let i = 1; i <= count; i++) {
            const index = (this.currentIndex + i) % this.queue.length;
            preview.push(this.queue[index]);
        }
        return preview;
    }
}

// ============================================================================
// ÌÜµÌï© Ï∞®Îüâ Í∞êÏßÄ ÏãúÏä§ÌÖú
// ============================================================================

// Bluetooth Í∞êÏßÄ
class BluetoothDetection {
    constructor() {
        this.isInCar = false;
        this.deviceName = null;
        this.confidence = 0;
    }
    
    async detect() {
        if (!navigator.bluetooth) {
            this.confidence = 0;
            return false;
        }
        
        try {
            const random = Math.random();
            if (random > 0.7) {
                this.isInCar = true;
                this.deviceName = 'Tesla Model 3';
                this.confidence = 0.9;
                return true;
            }
        } catch (error) {
            console.log('Bluetooth detection failed');
        }
        
        this.isInCar = false;
        this.confidence = 0;
        return false;
    }
}

// GPS ÏÜçÎèÑ Í∞êÏßÄ
class GPSDetection {
    constructor() {
        this.isMoving = false;
        this.speed = 0;
        this.confidence = 0;
        this.watchId = null;
    }
    
    startMonitoring() {
        if (!navigator.geolocation) return;
        
        this.watchId = navigator.geolocation.watchPosition(
            (position) => {
                this.speed = position.coords.speed || 0;
                const speedKmh = this.speed * 3.6;
                
                this.isMoving = speedKmh > 10;
                this.confidence = Math.min(speedKmh / 100, 0.95);
            },
            (error) => {
                console.log('GPS error:', error);
            },
            {
                enableHighAccuracy: true,
                maximumAge: 1000,
                timeout: 5000
            }
        );
    }
    
    stopMonitoring() {
        if (this.watchId) {
            navigator.geolocation.clearWatch(this.watchId);
        }
    }
}

// Í∞ÄÏÜçÎèÑÍ≥Ñ Í∞êÏßÄ
class AccelerometerDetection {
    constructor() {
        this.isInCar = false;
        this.vibrationIntensity = 0;
        this.confidence = 0;
        this.accelerometer = null;
        this.readings = [];
    }
    
    async startDetection() {
        if (!window.Accelerometer) return;
        
        try {
            this.accelerometer = new Accelerometer({ frequency: 10 });
            
            this.accelerometer.addEventListener('reading', () => {
                const { x, y, z } = this.accelerometer;
                
                const intensity = Math.sqrt(x*x + y*y + z*z);
                
                this.readings.push({
                    intensity,
                    timestamp: Date.now()
                });
                
                if (this.readings.length > 50) {
                    this.readings.shift();
                }
                
                if (this.readings.length > 10) {
                    const avgIntensity = this.readings.reduce((sum, r) => sum + r.intensity, 0) / this.readings.length;
                    const variance = this.calculateVariance(this.readings.map(r => r.intensity));
                    
                    this.isInCar = avgIntensity > 0.5 && variance < 0.1;
                    this.vibrationIntensity = avgIntensity;
                    this.confidence = this.isInCar ? 0.8 : 0;
                }
            });
            
            this.accelerometer.start();
        } catch (error) {
            console.log('Accelerometer error:', error);
        }
    }
    
    calculateVariance(values) {
        const mean = values.reduce((a, b) => a + b, 0) / values.length;
        const squareDiffs = values.map(value => Math.pow(value - mean, 2));
        return squareDiffs.reduce((a, b) => a + b, 0) / values.length;
    }
    
    stopDetection() {
        if (this.accelerometer) {
            this.accelerometer.stop();
        }
    }
}

// Wi-Fi Í∞êÏßÄ
class WiFiDetection {
    constructor() {
        this.connectedToCar = false;
        this.networkName = null;
        this.confidence = 0;
    }
    
    async detect() {
        const random = Math.random();
        if (random > 0.8) {
            this.connectedToCar = true;
            this.networkName = 'Tesla_WiFi';
            this.confidence = 0.7;
            return true;
        }
        
        this.connectedToCar = false;
        this.confidence = 0;
        return false;
    }
}

// ÌÜµÌï© Ï∞®Îüâ Í∞êÏßÄ ÏãúÏä§ÌÖú
class IntegratedCarDetection {
    constructor() {
        this.bluetooth = new BluetoothDetection();
        this.gps = new GPSDetection();
        this.accelerometer = new AccelerometerDetection();
        this.wifi = new WiFiDetection();
        
        this.isInCar = false;
        this.confidenceLevel = 0;
        this.detectionMethods = {};
        this.primaryMethod = null;
        
        this.interval = null;
    }
    
    async startAllDetection() {
        this.gps.startMonitoring();
        await this.accelerometer.startDetection();
        
        this.interval = setInterval(() => this.analyze(), 3000);
        
        setTimeout(() => this.analyze(), 1000);
    }
    
    stopAllDetection() {
        if (this.interval) {
            clearInterval(this.interval);
        }
        this.gps.stopMonitoring();
        this.accelerometer.stopDetection();
    }
    
    async analyze() {
        const bluetoothDetected = await this.bluetooth.detect();
        const wifiDetected = await this.wifi.detect();
        
        const methods = {
            bluetooth: {
                active: this.bluetooth.isInCar,
                confidence: this.bluetooth.confidence,
                data: this.bluetooth.deviceName
            },
            gps: {
                active: this.gps.isMoving,
                confidence: this.gps.confidence,
                data: `${(this.gps.speed * 3.6).toFixed(1)} km/h`
            },
            accelerometer: {
                active: this.accelerometer.isInCar,
                confidence: this.accelerometer.confidence,
                data: `ÏßÑÎèô ${this.accelerometer.vibrationIntensity.toFixed(2)}`
            },
            wifi: {
                active: this.wifi.connectedToCar,
                confidence: this.wifi.confidence,
                data: this.wifi.networkName
            }
        };
        
        this.detectionMethods = methods;
        
        let totalConfidence = 0;
        let activeCount = 0;
        let bestMethod = null;
        let bestConfidence = 0;
        
        for (const [name, method] of Object.entries(methods)) {
            if (method.active) {
                activeCount++;
                totalConfidence += method.confidence;
                
                if (method.confidence > bestConfidence) {
                    bestConfidence = method.confidence;
                    bestMethod = name;
                }
            }
        }
        
        const wasInCar = this.isInCar;
        
        if (activeCount >= 2) {
            this.isInCar = true;
            this.confidenceLevel = totalConfidence / activeCount;
            this.primaryMethod = bestMethod;
        } else if (activeCount === 1 && bestConfidence >= 0.8) {
            this.isInCar = true;
            this.confidenceLevel = bestConfidence;
            this.primaryMethod = bestMethod;
        } else {
            this.isInCar = false;
            this.confidenceLevel = 0;
            this.primaryMethod = null;
        }
        
        if (wasInCar !== this.isInCar) {
            this.onStateChange(this.isInCar, this.confidenceLevel, this.primaryMethod);
        }
        
        this.updateUI();
    }
    
    onStateChange(isInCar, confidence, method) {
        if (isInCar) {
            TimeLinkSystem.car.onCarEnter(method, confidence);
        } else {
            TimeLinkSystem.car.onCarExit();
        }
    }
    
    updateUI() {
        const methods = this.detectionMethods;
        
        const container = document.getElementById('detectionMethods');
        const detailContainer = document.getElementById('carDetectionDetail');
        
        if (container) {
            container.innerHTML = Object.entries(methods).map(([name, method]) => `
                <span class="badge" style="background: ${method.active ? 'var(--car)' : 'var(--text-tertiary)'}; position: static;">
                    ${name === 'bluetooth' ? 'üì°' : name === 'gps' ? 'üìç' : name === 'accelerometer' ? 'üì≥' : 'üì∂'} 
                    ${name}
                </span>
            `).join('');
        }
        
        if (detailContainer) {
            detailContainer.innerHTML = Object.entries(methods).map(([name, method]) => `
                <div style="background: rgba(255,255,255,0.03); padding: 12px; border-radius: var(--radius-md);">
                    <div style="display: flex; justify-content: space-between;">
                        <span>${name === 'bluetooth' ? 'üì° Bluetooth' : name === 'gps' ? 'üìç GPS' : name === 'accelerometer' ? 'üì≥ Í∞ÄÏÜçÎèÑÍ≥Ñ' : 'üì∂ Wi-Fi'}</span>
                        <span style="color: ${method.active ? 'var(--car)' : 'var(--text-tertiary)'};">${method.active ? 'Í∞êÏßÄÎê®' : 'Í∞êÏßÄÏïàÎê®'}</span>
                    </div>
                    <div style="font-size: 12px; color: var(--text-secondary); margin-top: 4px;">
                        Ïã†Î¢∞ÎèÑ: ${(method.confidence * 100).toFixed(0)}% | ${method.data || '-'}
                    </div>
                </div>
            `).join('');
        }
        
        const confidenceEl = document.getElementById('carConfidence');
        if (confidenceEl) {
            confidenceEl.textContent = (this.confidenceLevel * 100).toFixed(0) + '%';
        }
        
        const methodEl = document.getElementById('carDetectionMethod');
        if (methodEl) {
            methodEl.textContent = this.primaryMethod || '-';
        }
        
        const statusEl = document.getElementById('carDetectionStatus');
        const modeHeader = document.getElementById('carModeHeader');
        const modeHeaderBadge = document.getElementById('carModeBadgeHeader');
        
        if (statusEl) {
            if (this.isInCar) {
                statusEl.innerHTML = `‚úÖ Ï∞®Îüâ Í∞êÏßÄÎê® (Ïã†Î¢∞ÎèÑ ${(this.confidenceLevel * 100).toFixed(0)}%) ¬∑ 2Î∞∞ Î≥¥ÏÉÅ Ï§ë!`;
                statusEl.style.color = 'var(--car)';
                if (modeHeader) modeHeader.textContent = 'üöó 2x Î≥¥ÏÉÅ (Ï∞®Îüâ Í∞êÏßÄ)';
                if (modeHeaderBadge) {
                    modeHeaderBadge.textContent = 'üöó Ï∞®Îüâ Î™®Îìú';
                    modeHeaderBadge.style.background = 'var(--car)';
                }
            } else {
                statusEl.innerHTML = '‚è∏Ô∏è Ï∞®Îüâ ÎØ∏Í∞êÏßÄ ¬∑ ÏùºÎ∞ò Î™®Îìú';
                statusEl.style.color = 'var(--text-secondary)';
                if (modeHeader) modeHeader.textContent = '2x Î≥¥ÏÉÅ';
                if (modeHeaderBadge) {
                    modeHeaderBadge.textContent = 'ÏùºÎ∞ò Î™®Îìú';
                    modeHeaderBadge.style.background = 'var(--text-tertiary)';
                }
            }
        }
    }
    
    async requestAllPermissions() {
        if (navigator.bluetooth) {
            try {
                await navigator.bluetooth.getAvailability();
            } catch (e) {}
        }
        
        if (navigator.permissions) {
            try {
                await navigator.permissions.query({ name: 'geolocation' });
            } catch (e) {}
        }
        
        if (typeof DeviceMotionEvent !== 'undefined' && 
            typeof DeviceMotionEvent.requestPermission === 'function') {
            try {
                await DeviceMotionEvent.requestPermission();
            } catch (e) {}
        }
        
        TimeLinkSystem.ui.showToast('‚úÖ Ï∞®Îüâ Í∞êÏßÄ Í∂åÌïúÏù¥ ÏÑ§Ï†ïÎêòÏóàÏäµÎãàÎã§', 'success');
        TimeLinkSystem.ui.closePermissionModal();
    }
}

// TL3 File Class (Ïû•Î•¥ Ï∂îÍ∞Ä)
class TL3File {
    constructor(data) {
        this.id = 'tl3_' + Date.now() + '_' + Math.random().toString(36);
        this.type = 'TL3';
        this.fileType = 'audio';
        this.tlPerSecond = ECONOMY.TL3_PER_SECOND;
        this.revenuePerSecond = ECONOMY.TL3_REVENUE;
        
        this.metadata = {
            title: data.title,
            artist: data.artist,
            genre: data.genre || 'pop',  // Ïû•Î•¥ Ï∂îÍ∞Ä
            duration: data.duration || 180,
            copyright: data.copyright,
            contract: data.contract
        };
        
        this.token = {
            balance: 0,
            total_charged: 0,
            total_consumed: 0
        };
        
        this.audio = { url: data.audioUrl };
        this.creatorId = data.creatorId;
        this.creatorName = data.creatorName;
        this.isShared = false;
        this.sharedAt = null;
    }
    
    async charge(amount) {
        this.token.balance += amount;
        this.token.total_charged += amount;
        return { success: true };
    }
    
    async consume(amount) {
        if (this.token.balance < amount) throw new Error('Insufficient TL');
        this.token.balance -= amount;
        this.token.total_consumed += amount;
        return { success: true };
    }
}

// TL4 File Class
class TL4File extends TL3File {
    constructor(data) {
        super(data);
        this.type = 'TL4';
        this.fileType = 'video';
        this.tlPerSecond = ECONOMY.TL4_PER_SECOND;
        this.revenuePerSecond = ECONOMY.TL4_REVENUE;
        this.resolution = data.resolution || '1920x1080';
    }
}

// Lecture Class
class Lecture {
    constructor(data) {
        this.id = 'lec_' + Date.now() + '_' + Math.random().toString(36);
        this.title = data.title;
        this.instructor = data.instructor;
        this.description = data.description;
        this.category = data.category;
        this.price = data.price;
        this.creatorId = data.creatorId;
        this.creatorName = data.creatorName;
        this.audioUrl = data.audioUrl;
        this.purchasedBy = [];
        this.salesCount = 0;
    }
    
    async purchase(userId, wallet) {
        if (this.purchasedBy.includes(userId)) throw new Error('Already purchased');
        if (wallet.balance < this.price) throw new Error('Insufficient balance');
        
        await wallet.withdraw(this.price, 'LECTURE', this.id);
        this.purchasedBy.push(userId);
        this.salesCount++;
        
        return { success: true };
    }
    
    hasUserPurchased(userId) {
        return this.purchasedBy.includes(userId);
    }
}

// Car Class
class Car {
    constructor(data) {
        this.id = 'car_' + Date.now() + '_' + Math.random().toString(36);
        this.model = data.model;
        this.plate = data.plate;
        this.ownerId = data.ownerId;
        this.registeredAt = new Date().toISOString();
        this.totalMinutes = 0;
        this.todayMinutes = 0;
        this.totalRewards = 0;
    }
    
    addListening(minutes) {
        this.totalMinutes += minutes;
        this.todayMinutes += minutes;
        const reward = minutes * 60 * ECONOMY.CAR_REWARD_MULTIPLIER * ECONOMY.RADIO_BASE_CONSUME;
        this.totalRewards += reward;
        return reward;
    }
}

// TL Wallet
class TLWallet {
    constructor(userId) {
        this.userId = userId;
        this.balance = 25000;
        this.tlcBalance = 1250.75;
        this.transactions = [];
        this.isBusiness = false;
        this.isSmallBusiness = false;
        
        this.todayAdEarnings = 0;
        this.todayVideoAds = 0;
        this.todayAudioAds = 0;
        this.lastAdReset = Date.now();
        
        this.cars = [
            new Car({ model: 'Tesla Model 3', plate: 'ABC123', ownerId: userId }),
            new Car({ model: 'Hyundai Ioniq 5', plate: 'XYZ789', ownerId: userId })
        ];
        this.todayCarMinutes = 0;
        this.totalCarRewards = 0;
        this.manualCarMode = false;
    }
    
    async withdraw(amount, reason, target) {
        if (this.balance < amount) throw new Error('Insufficient balance');
        this.balance -= amount;
        this.transactions.push({ amount, reason, target, timestamp: Date.now() });
        return { success: true };
    }
    
    async charge(amount) {
        this.balance += amount;
        return { success: true };
    }
    
    async addAdReward(type) {
        const reward = type === 'video' ? ECONOMY.AD_VIDEO_REWARD : ECONOMY.AD_AUDIO_REWARD;
        
        if (this.todayAdEarnings + reward > ECONOMY.AD_DAILY_MAX) {
            throw new Error(`Daily ad limit reached (max: ${ECONOMY.AD_DAILY_MAX} TL)`);
        }
        
        this.balance += reward;
        this.todayAdEarnings += reward;
        
        if (type === 'video') {
            this.todayVideoAds++;
        } else {
            this.todayAudioAds++;
        }
        
        await Blockchain.record({
            type: 'AD_REWARD',
            ad_type: type,
            reward: reward,
            timestamp: Date.now()
        });
        
        return reward;
    }
    
    async addCarReward(minutes) {
        const reward = minutes * 60 * ECONOMY.CAR_REWARD_MULTIPLIER * ECONOMY.RADIO_BASE_CONSUME;
        this.balance += reward;
        this.todayCarMinutes += minutes;
        this.totalCarRewards += reward;
        
        await Blockchain.record({
            type: 'CAR_REWARD',
            minutes: minutes,
            reward: reward,
            timestamp: Date.now()
        });
        
        return reward;
    }
    
    checkDailyReset() {
        const now = Date.now();
        const oneDay = 24 * 60 * 60 * 1000;
        
        if (now - this.lastAdReset > oneDay) {
            this.todayAdEarnings = 0;
            this.todayVideoAds = 0;
            this.todayAudioAds = 0;
            this.todayCarMinutes = 0;
            this.lastAdReset = now;
            
            this.cars.forEach(car => car.todayMinutes = 0);
        }
    }
}

// Radio/Commercial Data
const RadioData = {
    channels: [
        { name: 'TimeLink Pop', genre: 'pop', listeners: 1234, currentSong: 'Dynamite - BTS' },
        { name: 'TimeLink Rock', genre: 'rock', listeners: 892, currentSong: 'Bohemian Rhapsody' },
        { name: 'TimeLink Hip-Hop', genre: 'hiphop', listeners: 1567, currentSong: 'Savage - aespa' },
        { name: 'TimeLink Jazz', genre: 'jazz', listeners: 645, currentSong: 'Fly Me To The Moon' },
        { name: 'TimeLink Classic', genre: 'classic', listeners: 432, currentSong: 'Fur Elise' },
        { name: 'TimeLink EDM', genre: 'edm', listeners: 789, currentSong: 'Strobe' },
        { name: 'TimeLink R&B', genre: 'rnb', listeners: 567, currentSong: 'Blame It' },
        { name: 'TimeLink Country', genre: 'country', listeners: 321, currentSong: 'Jolene' }
    ],
    
    commercialChannels: [
        { name: 'TimeLink Business 1', freq: '109.1', listeners: 567, revenue: 12340 },
        { name: 'TimeLink Business 2', freq: '109.3', listeners: 432, revenue: 9870 }
    ]
};

// Gold Reserve
const GoldReserve = {
    totalGold: 10.24,
    transactions: []
};

// ÏùåÏïÖ Î∂ÑÎ•òÍ∏∞ Ïù∏Ïä§ÌÑ¥Ïä§
const genreClassifier = new GenreClassifier();

// Main System
const TimeLinkSystem = {
    currentUser: null,
    wallet: null,
    files: [],
    lectures: [],
    sharedFiles: [],
    currentFilter: 'all',
    currentGenreFilter: 'all',
    playInterval: null,
    radioInterval: null,
    carInterval: null,
    commercialInterval: null,
    currentPlayingFile: null,
    
    // ÌÅê Í¥ÄÎ¶¨Ïûê
    radioQueue: new ContinuousPlayQueue(),
    carQueue: new ContinuousPlayQueue(),
    commercialQueue: new ContinuousPlayQueue(),
    
    carDetection: new IntegratedCarDetection(),
    
    adInterval: null,
    currentAdType: null,
    adTimeLeft: 0,
    
    // Demo
    demo: {
        login: function() {
            TimeLinkSystem.currentUser = {
                id: 'user_' + Date.now(),
                username: 'Global Investor',
                email: 'investor@timelink.io',
                isBusiness: true,
                isSmallBusiness: false
            };
            
            TimeLinkSystem.wallet = new TLWallet(TimeLinkSystem.currentUser.id);
            
            document.getElementById('authContainer').style.display = 'none';
            document.getElementById('appContainer').style.display = 'block';
            
            // Sample data - Îã§ÏñëÌïú Ïû•Î•¥Ïùò ÏùåÏïÖ
            const dummyAudio = 'data:audio/mp3;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4LjI5LjEwMAAAAAAAAAAAAAAA//tQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAA8AAAGQAApCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJD/+5REAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA';
            
            const songs = [
                { title: 'Dynamite', artist: 'BTS', genre: 'pop' },
                { title: 'Bohemian Rhapsody', artist: 'Queen', genre: 'rock' },
                { title: 'Savage', artist: 'aespa', genre: 'hiphop' },
                { title: 'Fly Me To The Moon', artist: 'Frank Sinatra', genre: 'jazz' },
                { title: 'Fur Elise', artist: 'Beethoven', genre: 'classic' },
                { title: 'Strobe', artist: 'deadmau5', genre: 'edm' },
                { title: 'Blame It', artist: 'Jamie Foxx', genre: 'rnb' },
                { title: 'Jolene', artist: 'Dolly Parton', genre: 'country' }
            ];
            
            songs.forEach((song, index) => {
                const file = new TL3File({
                    title: song.title,
                    artist: song.artist,
                    genre: song.genre,
                    audioUrl: dummyAudio,
                    creatorId: TimeLinkSystem.currentUser.id,
                    creatorName: TimeLinkSystem.currentUser.username,
                    copyright: { owner_name: song.artist, registration_number: `CR-${1234+index}` },
                    contract: { type: index % 2 === 0 ? '55' : '73', mining_allowed: index % 2 === 0 }
                });
                TimeLinkSystem.files.push(file);
            });
            
            // TL4 file
            const videoUrl = 'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4';
            
            const fileVideo = new TL4File({
                title: 'Big Buck Bunny',
                artist: 'Blender Foundation',
                genre: 'animation',
                audioUrl: videoUrl,
                creatorId: TimeLinkSystem.currentUser.id,
                creatorName: TimeLinkSystem.currentUser.username,
                copyright: { owner_name: 'Blender', registration_number: 'CR-1236' },
                contract: { type: '55', mining_allowed: true }
            });
            
            TimeLinkSystem.files.push(fileVideo);
            
            // Lectures
            const lectures = [
                { title: 'Blockchain Masterclass', instructor: 'Park Blockchain', category: 'programming', price: 15000 },
                { title: 'Stock Investment', instructor: 'Kim Investor', category: 'finance', price: 12000 }
            ];
            
            lectures.forEach(l => {
                TimeLinkSystem.lectures.push(new Lecture({
                    ...l,
                    description: 'Sample lecture',
                    creatorId: 'creator_1',
                    creatorName: l.instructor,
                    audioUrl: dummyAudio
                }));
            });
            
            setTimeout(() => {
                TimeLinkSystem.carDetection.startAllDetection();
                TimeLinkSystem.ui.showToast('üöó Ï∞®Îüâ Í∞êÏßÄ ÏãúÏä§ÌÖúÏù¥ ÏãúÏûëÎêòÏóàÏäµÎãàÎã§', 'info');
            }, 2000);
            
            setTimeout(() => {
                TimeLinkSystem.ui.openPermissionModal();
            }, 1000);
            
            TimeLinkSystem.ui.updateAll();
            TimeLinkSystem.radio.initChannels();
            TimeLinkSystem.radio.initCommercialChannels();
            TimeLinkSystem.car.updateUI();
            TimeLinkSystem.mining.updateUI();
            TimeLinkSystem.ui.updateAdStats();
            
            setInterval(() => TimeLinkSystem.mining.updateUI(), 1000);
            
            TimeLinkSystem.ui.showToast('‚úÖ TimeLinkÏóê Ïò§Ïã† Í≤ÉÏùÑ ÌôòÏòÅÌï©ÎãàÎã§! (Ïû•Î•¥ ÏãúÏä§ÌÖú)', 'success');
        },
        
        logout: function() {
            TimeLinkSystem.player.stop();
            TimeLinkSystem.radio.stop();
            TimeLinkSystem.car.stop();
            TimeLinkSystem.commercial.stop();
            TimeLinkSystem.carDetection.stopAllDetection();
            
            if (TimeLinkSystem.adInterval) {
                clearInterval(TimeLinkSystem.adInterval);
                TimeLinkSystem.adInterval = null;
            }
            
            TimeLinkSystem.currentUser = null;
            TimeLinkSystem.wallet = null;
            document.getElementById('authContainer').style.display = 'flex';
            document.getElementById('appContainer').style.display = 'none';
        }
    },
    
    // Ad System
    ad: {
        selectedType: 'video',
        
        selectType: function(type) {
            this.selectedType = type;
            document.getElementById('adRewardAmount').textContent = 
                type === 'video' ? ECONOMY.AD_VIDEO_REWARD + ' TL' : ECONOMY.AD_AUDIO_REWARD + ' TL';
        },
        
        showSelector: function() {
            document.getElementById('adInitialSection').style.display = 'none';
            document.getElementById('adTypeSelector').style.display = 'flex';
            document.getElementById('adPlayerSection').style.display = 'block';
            this.selectType('video');
        },
        
        watch: function(type) {
            TimeLinkSystem.wallet.checkDailyReset();
            
            const remaining = ECONOMY.AD_DAILY_MAX - TimeLinkSystem.wallet.todayAdEarnings;
            if (remaining <= 0) {
                TimeLinkSystem.ui.showToast('Ïò§Îäò Í¥ëÍ≥† ÌïúÎèÑÎ•º Î™®Îëê ÏÇ¨Ïö©ÌñàÏäµÎãàÎã§', 'warning');
                return;
            }
            
            TimeLinkSystem.ad.selectedType = type;
            TimeLinkSystem.ui.openAdModal();
        },
        
        startWatching: function() {
            const type = TimeLinkSystem.ad.selectedType;
            const reward = type === 'video' ? ECONOMY.AD_VIDEO_REWARD : ECONOMY.AD_AUDIO_REWARD;
            const remaining = ECONOMY.AD_DAILY_MAX - TimeLinkSystem.wallet.todayAdEarnings;
            
            if (remaining < reward) {
                TimeLinkSystem.ui.showToast(`ÎÇ®ÏùÄ ÏùºÏùº ÌïúÎèÑ: ${remaining} TL`, 'warning');
                return;
            }
            
            document.getElementById('adStartBtn').disabled = true;
            document.getElementById('adStartBtn').innerHTML = '‚è≥ Í¥ëÍ≥† Ïû¨ÏÉù Ï§ë...';
            
            if (type === 'video') {
                document.getElementById('videoAdContainer').style.display = 'block';
                document.getElementById('audioAdContainer').style.display = 'none';
                
                const videoAd = document.getElementById('videoAdPlayer');
                videoAd.src = 'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerBlazes.mp4';
                videoAd.play();
                
                videoAd.onended = () => TimeLinkSystem.ad.complete();
                
            } else {
                document.getElementById('videoAdContainer').style.display = 'none';
                document.getElementById('audioAdContainer').style.display = 'block';
                
                TimeLinkSystem.adTimeLeft = ECONOMY.AD_DURATION;
                document.getElementById('adTimer').textContent = TimeLinkSystem.adTimeLeft;
                
                const audioAd = document.getElementById('adAudioPlayer');
                audioAd.src = 'data:audio/mp3;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4LjI5LjEwMAAAAAAAAAAAAAAA//tQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAA8AAAGQAApCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJD/+5REAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA';
                audioAd.play();
                
                TimeLinkSystem.adInterval = setInterval(() => {
                    TimeLinkSystem.adTimeLeft--;
                    document.getElementById('adTimer').textContent = TimeLinkSystem.adTimeLeft;
                    
                    const progress = ((ECONOMY.AD_DURATION - TimeLinkSystem.adTimeLeft) / ECONOMY.AD_DURATION) * 100;
                    document.getElementById('adProgress').style.width = progress + '%';
                    
                    if (TimeLinkSystem.adTimeLeft <= 0) {
                        clearInterval(TimeLinkSystem.adInterval);
                        TimeLinkSystem.adInterval = null;
                        audioAd.pause();
                        TimeLinkSystem.ad.complete();
                    }
                }, 1000);
            }
        },
        
        complete: function() {
            const type = TimeLinkSystem.ad.selectedType;
            const reward = type === 'video' ? ECONOMY.AD_VIDEO_REWARD : ECONOMY.AD_AUDIO_REWARD;
            
            TimeLinkSystem.wallet.addAdReward(type);
            
            document.getElementById('videoAdPlayer').pause();
            document.getElementById('videoAdPlayer').src = '';
            document.getElementById('adAudioPlayer').pause();
            
            document.getElementById('videoAdContainer').style.display = 'none';
            document.getElementById('audioAdContainer').style.display = 'none';
            document.getElementById('adInitialSection').style.display = 'block';
            document.getElementById('adTypeSelector').style.display = 'none';
            document.getElementById('adPlayerSection').style.display = 'none';
            document.getElementById('adStartBtn').disabled = false;
            document.getElementById('adStartBtn').innerHTML = '‚ñ∂Ô∏è Start Watching';
            
            document.getElementById('adWatchModal').style.display = 'none';
            
            TimeLinkSystem.ui.updateAll();
            TimeLinkSystem.ui.updateAdStats();
            TimeLinkSystem.ui.showToast(`üì∫ +${reward} TL Ï†ÅÎ¶Ω!`, 'success');
        }
    },
    
    // File Management
    file: {
        selectedFile: null,
        selectedFileData: null,
        currentType: 'audio',
        
        selectType: function(type) {
            TimeLinkSystem.file.currentType = type;
            
            document.getElementById('audioTypeCard').classList.remove('selected');
            document.getElementById('videoTypeCard').classList.remove('selected');
            
            if (type === 'audio') {
                document.getElementById('audioTypeCard').classList.add('selected');
                document.getElementById('uploadIcon').innerHTML = 'üéµ';
                document.getElementById('uploadText').innerHTML = 'Select audio file';
                document.getElementById('uploadDesc').innerHTML = 'MP3, WAV, FLAC (max 100MB)';
                document.getElementById('fileInput').accept = 'audio/*';
            } else {
                document.getElementById('videoTypeCard').classList.add('selected');
                document.getElementById('uploadIcon').innerHTML = 'üé¨';
                document.getElementById('uploadText').innerHTML = 'Select video file';
                document.getElementById('uploadDesc').innerHTML = 'MP4, MOV, AVI (max 500MB)';
                document.getElementById('fileInput').accept = 'video/*';
            }
        },
        
        handleSelect: function(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            TimeLinkSystem.file.selectedFile = file;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                TimeLinkSystem.file.selectedFileData = e.target.result;
                document.getElementById('uploadForm').style.display = 'block';
                
                const fileName = file.name.replace(/\.[^/.]+$/, "");
                document.getElementById('songTitle').value = fileName;
                document.getElementById('songArtist').value = TimeLinkSystem.currentUser?.username || '';
                document.getElementById('copyrightOwner').value = TimeLinkSystem.currentUser?.username || '';
                document.getElementById('copyrightNumber').value = (TimeLinkSystem.file.currentType === 'audio' ? 'TL3-' : 'TL4-') + Date.now();
            };
            
            reader.readAsDataURL(file);
        },
        
        create: async function() {
            if (!TimeLinkSystem.file.selectedFile) {
                TimeLinkSystem.ui.showToast('ÌååÏùºÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî', 'error');
                return;
            }
            
            const title = document.getElementById('songTitle').value;
            if (!title) {
                TimeLinkSystem.ui.showToast('Ï†úÎ™©ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî', 'error');
                return;
            }
            
            const copyright = await CopyrightRegistry.register({
                owner_id: TimeLinkSystem.currentUser.id,
                owner_name: document.getElementById('copyrightOwner').value,
                title: title,
                registration_number: document.getElementById('copyrightNumber').value
            });
            
            const contract = {
                type: document.getElementById('revenueShare').value,
                mining_allowed: document.getElementById('revenueShare').value === '55'
            };
            
            let file;
            if (TimeLinkSystem.file.currentType === 'audio') {
                file = new TL3File({
                    title: title,
                    artist: document.getElementById('songArtist').value,
                    genre: document.getElementById('songGenre').value,
                    audioUrl: TimeLinkSystem.file.selectedFileData,
                    creatorId: TimeLinkSystem.currentUser.id,
                    creatorName: TimeLinkSystem.currentUser.username,
                    copyright: copyright,
                    contract: contract
                });
            } else {
                file = new TL4File({
                    title: title,
                    artist: document.getElementById('songArtist').value,
                    genre: document.getElementById('songGenre').value,
                    audioUrl: TimeLinkSystem.file.selectedFileData,
                    creatorId: TimeLinkSystem.currentUser.id,
                    creatorName: TimeLinkSystem.currentUser.username,
                    copyright: copyright,
                    contract: contract
                });
            }
            
            TimeLinkSystem.files.push(file);
            TimeLinkSystem.ui.showToast(`‚úÖ ${file.type} ÌååÏùºÏù¥ ÏÉùÏÑ±ÎêòÏóàÏäµÎãàÎã§! (Ïû•Î•¥: ${GENRE_EMOJI[file.metadata.genre]} ${file.metadata.genre})`, 'success');
            
            document.getElementById('uploadForm').style.display = 'none';
            document.getElementById('fileInput').value = '';
            TimeLinkSystem.ui.updateAll();
            TimeLinkSystem.ui.switchTab('library');
        },
        
        charge: async function() {
            const amount = parseInt(document.getElementById('chargeAmount').value);
            if (!amount) return;
            
            const file = TimeLinkSystem.files.find(f => f.id === TimeLinkSystem.player.currentFileId);
            if (!file) return;
            
            try {
                await TimeLinkSystem.wallet.withdraw(amount, 'CHARGE', file.id);
                await file.charge(amount);
                TimeLinkSystem.ui.updateAll();
                TimeLinkSystem.ui.closeChargeModal();
                TimeLinkSystem.ui.showToast(`‚úÖ ${amount} TL Ï∂©Ï†ÑÎê®`, 'success');
            } catch (e) {
                TimeLinkSystem.ui.showToast(e.message, 'error');
            }
        },
        
        purchaseTL: function(packageId) {
            const pkg = ECONOMY.PACKAGES.find(p => p.id === packageId);
            if (!pkg) return;
            
            TimeLinkSystem.wallet.charge(pkg.tl + pkg.bonus);
            TimeLinkSystem.ui.updateAll();
            TimeLinkSystem.ui.closePurchaseModal();
            TimeLinkSystem.ui.showToast(`‚úÖ ${pkg.tl + pkg.bonus} TL Íµ¨Îß§ ÏôÑÎ£å`, 'success');
        },
        
        download: function(fileId) {
            const file = TimeLinkSystem.files.find(f => f.id === fileId);
            if (!file) return;
            
            if (!TimeLinkSystem.files.includes(file)) {
                TimeLinkSystem.files.push(file);
                TimeLinkSystem.ui.showToast(`‚úÖ "${file.metadata.title}" ÎÇ¥ ÎùºÏù¥Î∏åÎü¨Î¶¨Ïóê Ï∂îÍ∞ÄÎê®`, 'success');
                TimeLinkSystem.ui.updateLibrary();
            } else {
                TimeLinkSystem.ui.showToast('Ïù¥ÎØ∏ ÎÇ¥ ÌååÏùºÏóê ÏûàÏäµÎãàÎã§', 'info');
            }
        }
    },
    
    // Share Place
    share: {
        filter: function(filter, event) {
            TimeLinkSystem.currentFilter = filter;
            
            document.querySelectorAll('#tabShareplace .filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            TimeLinkSystem.ui.updateSharePlace();
        },
        
        filterGenre: function(genre, event) {
            TimeLinkSystem.currentGenreFilter = genre;
            
            document.querySelectorAll('#tabShareplace .genre-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            TimeLinkSystem.ui.updateSharePlace();
        },
        
        shareFile: async function(fileId) {
            const file = TimeLinkSystem.files.find(f => f.id === fileId);
            if (!file) return;
            
            if (file.isShared) {
                TimeLinkSystem.ui.showToast('Ïù¥ÎØ∏ Í≥µÏú†Îêú ÌååÏùºÏûÖÎãàÎã§', 'warning');
                return;
            }
            
            if (TimeLinkSystem.wallet.balance < ECONOMY.SHARE_COST) {
                TimeLinkSystem.ui.showToast(`Í≥µÏú† ÎπÑÏö© ${ECONOMY.SHARE_COST} TLÏù¥ Î∂ÄÏ°±Ìï©ÎãàÎã§`, 'error');
                return;
            }
            
            await TimeLinkSystem.wallet.withdraw(ECONOMY.SHARE_COST, 'SHARE', file.id);
            
            file.isShared = true;
            file.sharedAt = new Date().toISOString();
            
            TimeLinkSystem.sharedFiles = TimeLinkSystem.files.filter(f => f.isShared);
            
            TimeLinkSystem.ui.updateAll();
            TimeLinkSystem.ui.updateSharePlace();
            TimeLinkSystem.ui.showToast('‚úÖ ÌååÏùºÏù¥ Í≥µÏú†ÎêòÏóàÏäµÎãàÎã§!', 'success');
        }
    },
    
    // Radio System (Ïû•Î•¥ ÏßÄÏõê)
    radio: {
        currentChannel: null,
        isPlaying: false,
        currentGenre: 'all',
        
        selectGenre: function(genre, event) {
            this.currentGenre = genre;
            
            document.querySelectorAll('#tabRadio .genre-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // ÌÅê Ï¥àÍ∏∞Ìôî
            TimeLinkSystem.radioQueue.init(TimeLinkSystem.files, genre);
            
            if (this.isPlaying) {
                this.playNext();
            }
            
            this.updateQueueDisplay();
        },
        
        playNext: function() {
            const nextFile = TimeLinkSystem.radioQueue.next();
            if (!nextFile) return;
            
            this.currentChannel = nextFile.metadata.title;
            
            document.getElementById('radioNowPlaying').textContent = `${nextFile.metadata.title} - ${nextFile.metadata.artist}`;
            document.getElementById('radioCurrentGenre').innerHTML = `${GENRE_EMOJI[nextFile.metadata.genre]} ${nextFile.metadata.genre}`;
            
            // Now Playing Ïπ¥Îìú ÏÉâÏÉÅ Î≥ÄÍ≤Ω
            const card = document.getElementById('radioNowPlayingCard');
            card.className = `now-playing-card ${nextFile.metadata.genre}`;
            
            this.updateQueueDisplay();
        },
        
        updateQueueDisplay: function() {
            const preview = TimeLinkSystem.radioQueue.previewNext(5);
            const queueList = document.getElementById('radioQueueList');
            
            if (queueList) {
                queueList.innerHTML = preview.map((file, index) => `
                    <div class="queue-item">
                        <span class="queue-genre ${file.metadata.genre}"></span>
                        <span style="flex:1;">${file.metadata.title} - ${file.metadata.artist}</span>
                        <span>${GENRE_EMOJI[file.metadata.genre]}</span>
                    </div>
                `).join('');
            }
        },
        
        initChannels: function() {
            const container = document.getElementById('radioChannels');
            if (!container) return;
            
            container.innerHTML = RadioData.channels.map(ch => {
                const consumeRate = (ECONOMY.RADIO_BASE_CONSUME + (Math.random() * ECONOMY.RADIO_CONSUME_VARIATION * 2 - ECONOMY.RADIO_CONSUME_VARIATION)).toFixed(2);
                
                return `
                <div class="radio-channel-card">
                    <div class="channel-header" style="background: ${GENRE_COLORS[ch.genre]};">
                        <h3>${ch.name}</h3>
                        <p>${ch.listeners} Ï≤≠Ï∑®Ïûê</p>
                    </div>
                    <div class="channel-playlist">
                        <div class="now-playing">
                            <div>Now Playing: <strong>${ch.currentSong}</strong></div>
                            <div style="margin-top: 8px;">Ïû•Î•¥: ${GENRE_EMOJI[ch.genre]} ${ch.genre}</div>
                            <div style="margin-top: 8px; color: var(--warning);">ÏÜåÎ™®: ${consumeRate} TL/Ï¥à</div>
                        </div>
                        <button class="btn-radio" onclick="TimeLinkSystem.radio.selectGenre('${ch.genre}', event); TimeLinkSystem.radio.togglePlay()">
                            üìª ${ch.genre} Ï±ÑÎÑê Îì£Í∏∞
                        </button>
                    </div>
                </div>
            `}).join('');
        },
        
        initCommercialChannels: function() {
            const container = document.getElementById('commercialChannels');
            if (!container) return;
            
            container.innerHTML = RadioData.commercialChannels.map(ch => {
                const consumeRate = (ECONOMY.COMMERCIAL_CONSUME_DISCOUNT).toFixed(2);
                
                return `
                <div class="commercial-channel-card">
                    <div class="commercial-channel-header">
                        <h3>${ch.name}</h3>
                        <p>${ch.listeners} ÏãúÏ≤≠Ïûê</p>
                    </div>
                    <div class="channel-playlist">
                        <div class="now-playing" style="border-left-color: var(--commercial);">
                            <div>ÏÜåÏÉÅÍ≥µÏù∏ ÌäπÍ∞Ä: <strong>${consumeRate} TL/Ï¥à</strong></div>
                        </div>
                        <button class="btn-commercial" onclick="TimeLinkSystem.commercial.tuneIn('${ch.name}', ${consumeRate})">
                            üì∫ ÏãúÏ≤≠ÌïòÍ∏∞
                        </button>
                    </div>
                </div>
            `}).join('');
        },
        
        togglePlay: function() {
            if (this.isPlaying) {
                this.stop();
            } else {
                this.start();
            }
        },
        
        start: function() {
            if (TimeLinkSystem.radioInterval) {
                clearInterval(TimeLinkSystem.radioInterval);
            }
            
            // ÌÅê Ï¥àÍ∏∞Ìôî
            TimeLinkSystem.radioQueue.init(TimeLinkSystem.files, this.currentGenre);
            
            this.isPlaying = true;
            this.playNext();
            
            document.getElementById('radioPlayBtn').innerHTML = '‚è∏Ô∏è Îì£Í∏∞ Ï§ëÏßÄ';
            
            // TL ÏÜåÎ™® ÏãúÏûë
            const rate = ECONOMY.RADIO_BASE_CONSUME;
            
            TimeLinkSystem.radioInterval = setInterval(async () => {
                if (!this.isPlaying || !TimeLinkSystem.wallet) return;
                
                try {
                    await TimeLinkSystem.wallet.withdraw(rate, 'RADIO', this.currentChannel);
                    TimeLinkSystem.ui.updateAll();
                } catch (e) {
                    TimeLinkSystem.ui.showToast('TLÏù¥ Î∂ÄÏ°±ÌïòÏó¨ ÎùºÎîîÏò§Í∞Ä Ï§ëÏßÄÎê©ÎãàÎã§', 'warning');
                    this.stop();
                }
            }, 1000);
            
            // 30Ï¥àÎßàÎã§ Îã§Ïùå Í≥°ÏúºÎ°ú
            this.songInterval = setInterval(() => {
                if (this.isPlaying) {
                    this.playNext();
                }
            }, 30000);
            
            TimeLinkSystem.ui.showToast(`üìª ÎùºÎîîÏò§ Ï≤≠Ï∑® ÏãúÏûë (Ïû•Î•¥: ${this.currentGenre})`, 'success');
        },
        
        stop: function() {
            if (TimeLinkSystem.radioInterval) {
                clearInterval(TimeLinkSystem.radioInterval);
                TimeLinkSystem.radioInterval = null;
            }
            
            if (this.songInterval) {
                clearInterval(this.songInterval);
                this.songInterval = null;
            }
            
            this.isPlaying = false;
            document.getElementById('radioPlayBtn').innerHTML = 'üìª Îì£Í∏∞';
            
            TimeLinkSystem.ui.showToast('üìª ÎùºÎîîÏò§ Ï≤≠Ï∑® Ï¢ÖÎ£å', 'info');
        }
    },
    
    // Commercial System
    commercial: {
        currentChannel: null,
        isPlaying: false,
        currentGenre: 'all',
        
        selectGenre: function(genre, event) {
            this.currentGenre = genre;
            
            document.querySelectorAll('#tabCommercial .genre-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            TimeLinkSystem.commercialQueue.init(TimeLinkSystem.files, genre);
            
            if (this.isPlaying) {
                this.playNext();
            }
            
            this.updateQueueDisplay();
        },
        
        playNext: function() {
            const nextFile = TimeLinkSystem.commercialQueue.next();
            if (!nextFile) return;
            
            this.currentChannel = nextFile.metadata.title;
            
            document.getElementById('commercialNowPlaying').textContent = `${nextFile.metadata.title} - ${nextFile.metadata.artist}`;
            document.getElementById('commercialCurrentGenre').innerHTML = `${GENRE_EMOJI[nextFile.metadata.genre]} ${nextFile.metadata.genre}`;
            
            this.updateQueueDisplay();
        },
        
        updateQueueDisplay: function() {
            const preview = TimeLinkSystem.commercialQueue.previewNext(5);
            const queueList = document.getElementById('commercialQueueList');
            
            if (queueList) {
                queueList.innerHTML = preview.map((file, index) => `
                    <div class="queue-item">
                        <span class="queue-genre ${file.metadata.genre}"></span>
                        <span style="flex:1;">${file.metadata.title} - ${file.metadata.artist}</span>
                        <span>${GENRE_EMOJI[file.metadata.genre]}</span>
                    </div>
                `).join('');
            }
        },
        
        tuneIn: function(channelName, rate) {
            if (!TimeLinkSystem.wallet?.isSmallBusiness && !TimeLinkSystem.wallet?.isBusiness) {
                TimeLinkSystem.ui.showToast('ÏÜåÏÉÅÍ≥µÏù∏Îßå Ïù¥Ïö© Í∞ÄÎä•Ìï©ÎãàÎã§', 'error');
                return;
            }
            
            if (TimeLinkSystem.commercialInterval) {
                clearInterval(TimeLinkSystem.commercialInterval);
            }
            
            TimeLinkSystem.commercial.currentChannel = channelName;
            TimeLinkSystem.commercial.isPlaying = true;
            
            document.getElementById('commercialPlayBtn').innerHTML = '‚è∏Ô∏è ÏãúÏ≤≠ Ï§ëÏßÄ';
            
            TimeLinkSystem.commercialInterval = setInterval(async () => {
                if (!TimeLinkSystem.commercial.isPlaying || !TimeLinkSystem.wallet) return;
                
                try {
                    await TimeLinkSystem.wallet.withdraw(ECONOMY.COMMERCIAL_CONSUME_DISCOUNT, 'COMMERCIAL', channelName);
                    TimeLinkSystem.ui.updateAll();
                } catch (e) {
                    TimeLinkSystem.ui.showToast('TLÏù¥ Î∂ÄÏ°±ÌïòÏó¨ Î∞©ÏÜ°Ïù¥ Ï§ëÏßÄÎê©ÎãàÎã§', 'warning');
                    TimeLinkSystem.commercial.stop();
                }
            }, 1000);
            
            TimeLinkSystem.ui.showToast(`üì∫ ${channelName} ÏãúÏ≤≠ ÏãúÏûë`, 'success');
        },
        
        stop: function() {
            if (TimeLinkSystem.commercialInterval) {
                clearInterval(TimeLinkSystem.commercialInterval);
                TimeLinkSystem.commercialInterval = null;
            }
            
            TimeLinkSystem.commercial.isPlaying = false;
            document.getElementById('commercialPlayBtn').innerHTML = 'üì∫ ÏãúÏ≤≠ÌïòÍ∏∞';
            
            TimeLinkSystem.ui.showToast('üì∫ Î∞©ÏÜ° ÏãúÏ≤≠ Ï¢ÖÎ£å', 'info');
        },
        
        togglePlay: function() {
            if (this.isPlaying) {
                this.stop();
            } else {
                if (!TimeLinkSystem.wallet?.isSmallBusiness && !TimeLinkSystem.wallet?.isBusiness) {
                    TimeLinkSystem.ui.showToast('ÏÜåÏÉÅÍ≥µÏù∏Îßå Ïù¥Ïö© Í∞ÄÎä•Ìï©ÎãàÎã§', 'error');
                    return;
                }
                this.start();
            }
        },
        
        start: function() {
            if (TimeLinkSystem.commercialInterval) {
                clearInterval(TimeLinkSystem.commercialInterval);
            }
            
            TimeLinkSystem.commercialQueue.init(TimeLinkSystem.files, this.currentGenre);
            
            this.isPlaying = true;
            this.playNext();
            
            document.getElementById('commercialPlayBtn').innerHTML = '‚è∏Ô∏è ÏãúÏ≤≠ Ï§ëÏßÄ';
            
            TimeLinkSystem.commercialInterval = setInterval(async () => {
                if (!this.isPlaying || !TimeLinkSystem.wallet) return;
                
                try {
                    await TimeLinkSystem.wallet.withdraw(ECONOMY.COMMERCIAL_CONSUME_DISCOUNT, 'COMMERCIAL', this.currentChannel);
                    TimeLinkSystem.ui.updateAll();
                } catch (e) {
                    TimeLinkSystem.ui.showToast('TLÏù¥ Î∂ÄÏ°±ÌïòÏó¨ Î∞©ÏÜ°Ïù¥ Ï§ëÏßÄÎê©ÎãàÎã§', 'warning');
                    this.stop();
                }
            }, 1000);
            
            this.songInterval = setInterval(() => {
                if (this.isPlaying) {
                    this.playNext();
                }
            }, 30000);
            
            TimeLinkSystem.ui.showToast(`üì∫ ÏÉÅÏóÖ Î∞©ÏÜ° ÏãúÏûë (Ïû•Î•¥: ${this.currentGenre})`, 'success');
        }
    },
    
    // Car System (Ïû•Î•¥ ÏßÄÏõê)
    car: {
        currentChannel: null,
        isPlaying: false,
        manualMode: false,
        currentGenre: 'all',
        
        onCarEnter: function(method, confidence) {
            this.isInCar = true;
            this.detectionMethod = method;
            this.confidence = confidence;
            
            if (!this.manualMode) {
                document.getElementById('userStatus').innerHTML = 'üöó Ïö¥Ï†ÑÏ§ë ¬∑ 2x';
                
                TimeLinkSystem.ui.showToast(`üöó Ï∞®Îüâ Í∞êÏßÄÎê® (${method}) ¬∑ 2Î∞∞ Î≥¥ÏÉÅ ÏãúÏûë!`, 'success');
                
                if (TimeLinkSystem.radio.isPlaying) {
                    TimeLinkSystem.radio.stop();
                    this.start();
                }
            }
            
            this.updateUI();
        },
        
        onCarExit: function() {
            this.isInCar = false;
            this.detectionMethod = null;
            this.confidence = 0;
            
            if (!this.manualMode) {
                document.getElementById('userStatus').innerHTML = TimeLinkSystem.wallet?.isSmallBusiness ? 'üè™ ÏÜåÏÉÅÍ≥µÏù∏' : 'üè¢ Business';
                
                TimeLinkSystem.ui.showToast('üöó Ï∞®Îüâ Ïù¥ÌÉà ¬∑ ÏùºÎ∞ò Î™®ÎìúÎ°ú Ï†ÑÌôò', 'info');
                
                if (this.isPlaying) {
                    this.stop();
                }
            }
            
            this.updateUI();
        },
        
        toggleManualMode: function() {
            this.manualMode = !this.manualMode;
            const btn = document.getElementById('manualCarBtn');
            
            if (this.manualMode) {
                btn.innerHTML = '‚úÖ ÏàòÎèô CAR ON';
                btn.style.background = 'var(--car)';
                document.getElementById('userStatus').innerHTML = 'üöó ÏàòÎèô CAR ¬∑ 2x';
                TimeLinkSystem.ui.showToast('üöó ÏàòÎèô CAR Î™®Îìú ÌôúÏÑ±Ìôî', 'success');
            } else {
                btn.innerHTML = 'üöó ÏàòÎèô CAR';
                btn.style.background = 'var(--car-detected)';
                
                if (TimeLinkSystem.carDetection.isInCar) {
                    document.getElementById('userStatus').innerHTML = 'üöó Ïö¥Ï†ÑÏ§ë ¬∑ 2x';
                } else {
                    document.getElementById('userStatus').innerHTML = TimeLinkSystem.wallet?.isSmallBusiness ? 'üè™ ÏÜåÏÉÅÍ≥µÏù∏' : 'üè¢ Business';
                }
                
                TimeLinkSystem.ui.showToast('üöó ÏàòÎèô CAR Î™®Îìú ÎπÑÌôúÏÑ±Ìôî', 'info');
            }
            
            this.updateUI();
        },
        
        selectGenre: function(genre, event) {
            this.currentGenre = genre;
            
            document.querySelectorAll('#tabCar .genre-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            TimeLinkSystem.carQueue.init(TimeLinkSystem.files, genre);
            
            if (this.isPlaying) {
                this.playNext();
            }
            
            this.updateQueueDisplay();
        },
        
        playNext: function() {
            const nextFile = TimeLinkSystem.carQueue.next();
            if (!nextFile) return;
            
            this.currentChannel = nextFile.metadata.title;
            
            document.getElementById('carNowPlaying').textContent = `${nextFile.metadata.title} - ${nextFile.metadata.artist}`;
            document.getElementById('carCurrentGenre').innerHTML = `${GENRE_EMOJI[nextFile.metadata.genre]} ${nextFile.metadata.genre}`;
            
            const isCarMode = (TimeLinkSystem.carDetection.isInCar && !this.manualMode) || this.manualMode;
            const multiplier = isCarMode ? ECONOMY.CAR_REWARD_MULTIPLIER : 1;
            
            document.getElementById('carRewardRate').textContent = (ECONOMY.RADIO_BASE_CONSUME * multiplier).toFixed(2) + ' TL/Ï¥à';
            
            this.updateQueueDisplay();
        },
        
        updateQueueDisplay: function() {
            const preview = TimeLinkSystem.carQueue.previewNext(5);
            const queueList = document.getElementById('carQueueList');
            
            if (queueList) {
                queueList.innerHTML = preview.map((file, index) => `
                    <div class="queue-item">
                        <span class="queue-genre ${file.metadata.genre}"></span>
                        <span style="flex:1;">${file.metadata.title} - ${file.metadata.artist}</span>
                        <span>${GENRE_EMOJI[file.metadata.genre]}</span>
                    </div>
                `).join('');
            }
        },
        
        updateUI: function() {
            if (!TimeLinkSystem.wallet) return;
            
            document.getElementById('myCarsCount').textContent = TimeLinkSystem.wallet.cars.length;
            document.getElementById('todayCarMinutes').textContent = TimeLinkSystem.wallet.todayCarMinutes + 'Î∂Ñ';
            document.getElementById('carRewards').textContent = TimeLinkSystem.wallet.totalCarRewards.toFixed(0) + ' TL';
            
            const isCarMode = (TimeLinkSystem.carDetection.isInCar && !this.manualMode) || this.manualMode;
            document.getElementById('carCurrentMode').textContent = isCarMode ? 'üöó CAR Î™®Îìú' : 'ÏùºÎ∞ò Î™®Îìú';
            document.getElementById('carCurrentMode').style.color = isCarMode ? 'var(--car)' : 'var(--text-secondary)';
            
            const carList = document.getElementById('carList');
            if (carList) {
                carList.innerHTML = TimeLinkSystem.wallet.cars.map(car => 
                    `<p style="color: white; margin: 5px 0;">üöò ${car.model} (${car.plate})</p>`
                ).join('');
            }
        },
        
        start: function() {
            if (TimeLinkSystem.wallet.cars.length === 0 && !this.manualMode) {
                TimeLinkSystem.ui.showToast('Ï∞®ÎüâÏùÑ Î®ºÏ†Ä Îì±Î°ùÌï¥Ï£ºÏÑ∏Ïöî', 'error');
                TimeLinkSystem.ui.openCarRegisterModal();
                return;
            }
            
            if (TimeLinkSystem.carInterval) {
                clearInterval(TimeLinkSystem.carInterval);
            }
            
            TimeLinkSystem.carQueue.init(TimeLinkSystem.files, this.currentGenre);
            
            this.isPlaying = true;
            this.playNext();
            
            document.getElementById('carPlayBtn').innerHTML = '‚è∏Ô∏è Ï≤≠Ï∑® Ï§ëÏßÄ';
            
            const isCarMode = (TimeLinkSystem.carDetection.isInCar && !this.manualMode) || this.manualMode;
            const rate = ECONOMY.RADIO_BASE_CONSUME;
            
            let seconds = 0;
            TimeLinkSystem.carInterval = setInterval(async () => {
                if (!this.isPlaying || !TimeLinkSystem.wallet) return;
                
                seconds++;
                
                try {
                    await TimeLinkSystem.wallet.withdraw(rate, 'CAR_CONSUME', this.currentChannel);
                    
                    if (seconds % 60 === 0) {
                        const minutes = seconds / 60;
                        const reward = await TimeLinkSystem.wallet.addCarReward(minutes * (isCarMode ? ECONOMY.CAR_REWARD_MULTIPLIER : 1));
                        TimeLinkSystem.ui.showToast(`üöó ${minutes}Î∂Ñ Ï≤≠Ï∑® Î≥¥ÏÉÅ: ${reward.toFixed(0)} TL`, 'success');
                    }
                    
                    this.updateUI();
                } catch (e) {
                    TimeLinkSystem.ui.showToast('TLÏù¥ Î∂ÄÏ°±ÌïòÏó¨ CAR Ï≤≠Ï∑®Í∞Ä Ï§ëÏßÄÎê©ÎãàÎã§', 'warning');
                    this.stop();
                }
            }, 1000);
            
            this.songInterval = setInterval(() => {
                if (this.isPlaying) {
                    this.playNext();
                }
            }, 30000);
            
            TimeLinkSystem.ui.showToast(`üöó CAR Ï≤≠Ï∑® ÏãúÏûë (Ïû•Î•¥: ${this.currentGenre})`, 'success');
        },
        
        stop: function() {
            if (TimeLinkSystem.carInterval) {
                clearInterval(TimeLinkSystem.carInterval);
                TimeLinkSystem.carInterval = null;
            }
            
            if (this.songInterval) {
                clearInterval(this.songInterval);
                this.songInterval = null;
            }
            
            this.isPlaying = false;
            document.getElementById('carPlayBtn').innerHTML = 'üöó CAR Ï≤≠Ï∑® ÏãúÏûë';
            
            TimeLinkSystem.ui.showToast('üöó CAR Ï≤≠Ï∑® Ï¢ÖÎ£å', 'info');
        },
        
        togglePlay: function() {
            if (this.isPlaying) {
                this.stop();
            } else {
                this.start();
            }
        },
        
        register: function() {
            const model = document.getElementById('carModel').value;
            const plate = document.getElementById('carPlate').value;
            
            if (!model) {
                TimeLinkSystem.ui.showToast('Ï∞®Îüâ Î™®Îç∏ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî', 'error');
                return;
            }
            
            if (TimeLinkSystem.wallet.balance < ECONOMY.CAR_REGISTRATION_FEE) {
                TimeLinkSystem.ui.showToast(`Îì±Î°ùÎπÑ ${ECONOMY.CAR_REGISTRATION_FEE} TLÏù¥ Î∂ÄÏ°±Ìï©ÎãàÎã§`, 'error');
                return;
            }
            
            TimeLinkSystem.wallet.withdraw(ECONOMY.CAR_REGISTRATION_FEE, 'CAR_REGISTRATION', model).then(() => {
                const newCar = new Car({
                    model: model,
                    plate: plate || 'ÎØ∏Îì±Î°ù',
                    ownerId: TimeLinkSystem.currentUser.id
                });
                
                TimeLinkSystem.wallet.cars.push(newCar);
                this.updateUI();
                TimeLinkSystem.ui.closeCarRegisterModal();
                TimeLinkSystem.ui.showToast(`üöó ${model} Îì±Î°ù ÏôÑÎ£å!`, 'success');
            });
        }
    },
    
    // Business
    business: {
        apply: function() {
            TimeLinkSystem.wallet.isSmallBusiness = true;
            document.getElementById('userStatus').innerHTML = 'üè™ ÏÜåÏÉÅÍ≥µÏù∏';
            document.getElementById('businessApplySection').style.display = 'none';
            TimeLinkSystem.ui.showToast('‚úÖ ÏÜåÏÉÅÍ≥µÏù∏ Îì±Î°ù ÏôÑÎ£å! (Ï∞®Í∞ê ÏßÄÏàò 0.3Î∞∞)', 'success');
        }
    },
    
    // Auto-Recharge
    autoRecharge: {
        enabled: false,
        threshold: 300,
        amount: 3600,
        pendingDebt: 0,
        
        execute: async function(file) {
            if (!TimeLinkSystem.wallet || !file) return false;
            
            if (TimeLinkSystem.wallet.balance < this.amount * 0.5) {
                TimeLinkSystem.ui.showToast('‚ö†Ô∏è ÏßÄÍ∞ë ÏûîÏï° Î∂ÄÏ°±', 'warning');
                return false;
            }
            
            await file.charge(this.amount);
            this.pendingDebt += this.amount;
            
            TimeLinkSystem.ui.updateAll();
            TimeLinkSystem.ui.showToast(`‚ö° ÏûêÎèô Ï∂©Ï†Ñ ÏôÑÎ£å: ${this.amount} TL`, 'success');
            return true;
        },
        
        toggle: function() {
            this.enabled = !this.enabled;
            const settings = document.getElementById('autoRechargeSettings');
            const toggle = document.getElementById('autoRechargeToggle');
            
            if (settings) settings.style.opacity = this.enabled ? '1' : '0.5';
            if (toggle) toggle.checked = this.enabled;
            
            TimeLinkSystem.ui.showToast(this.enabled ? '‚ö° ÏûêÎèô Ï∂©Ï†Ñ ÏºúÏßê' : '‚ö° ÏûêÎèô Ï∂©Ï†Ñ Í∫ºÏßê', 'info');
        },
        
        updateSettings: function() {
            this.threshold = parseInt(document.getElementById('autoRechargeThreshold').value);
            this.amount = parseInt(document.getElementById('autoRechargeAmount').value);
            TimeLinkSystem.ui.showToast('‚ö° ÏÑ§Ï†ï Ï†ÄÏû•Îê®', 'success');
        }
    },
    
    // Player
    player: {
        currentFileId: null,
        isPlaying: false,
        queue: [],
        currentIndex: 0,
        
        play: function(fileId) {
            const file = TimeLinkSystem.files.find(f => f.id === fileId);
            if (!file) return;
            
            const rate = file.type === 'TL4' ? 2 : 1;
            
            if (file.token.balance < rate) {
                if (TimeLinkSystem.autoRecharge.enabled) {
                    TimeLinkSystem.autoRecharge.execute(file);
                    setTimeout(() => TimeLinkSystem.player.play(fileId), 500);
                } else {
                    TimeLinkSystem.ui.showToast('‚ö†Ô∏è TLÏù¥ Î∂ÄÏ°±Ìï©ÎãàÎã§. Ï∂©Ï†ÑÌï¥Ï£ºÏÑ∏Ïöî.', 'warning');
                }
                return;
            }
            
            TimeLinkSystem.player.stop();
            
            if (!TimeLinkSystem.player.queue.includes(file)) {
                TimeLinkSystem.player.queue = TimeLinkSystem.files.filter(f => f.token.balance >= (f.type === 'TL4' ? 2 : 1));
                TimeLinkSystem.player.currentIndex = TimeLinkSystem.player.queue.findIndex(f => f.id === fileId);
            }
            
            TimeLinkSystem.player.currentFileId = file.id;
            TimeLinkSystem.currentPlayingFile = file;
            
            if (file.type === 'TL4') {
                const videoContainer = document.getElementById('videoPlayerContainer');
                const videoPlayer = document.getElementById('videoPlayer');
                const videoTitle = document.getElementById('videoTitle');
                const videoTimeRemaining = document.getElementById('videoTimeRemaining');
                
                videoContainer.style.display = 'block';
                videoPlayer.src = file.audio.url;
                videoPlayer.load();
                
                videoTitle.textContent = `${file.metadata.title} - ${file.metadata.artist} (${file.type})`;
                
                videoPlayer.play().catch(e => {
                    TimeLinkSystem.ui.showToast('ÎπÑÎîîÏò§ Ïû¨ÏÉù Ïã§Ìå®', 'error');
                    videoContainer.style.display = 'none';
                });
                
                document.getElementById('playerModal').style.display = 'none';
                
            } else {
                const audioPlayer = document.getElementById('audioPlayer');
                
                document.getElementById('playerModal').style.display = 'flex';
                
                document.getElementById('playerTitle').textContent = file.metadata.title;
                document.getElementById('playerArtist').textContent = file.metadata.artist;
                document.getElementById('playerCopyrightOwner').textContent = file.metadata.copyright.owner_name;
                document.getElementById('playerCopyrightNumber').textContent = file.metadata.copyright.registration_number;
                document.getElementById('playerContractType').textContent = file.metadata.contract.type === '55' ? '5:5' : '7:3';
                document.getElementById('playerCreatorShare').textContent = file.metadata.contract.type === '55' ? '50%' : '70%';
                document.getElementById('playerPlatformShare').textContent = file.metadata.contract.type === '55' ? '50%' : '30%';
                document.getElementById('playerTL').textContent = file.token.balance.toLocaleString() + ' TL';
                
                document.getElementById('playerTypeBadge').textContent = file.type;
                document.getElementById('playerTypeBadge').style.background = file.type === 'TL4' ? 'var(--video)' : 'var(--success)';
                document.getElementById('playerRateBadge').textContent = rate + 'TL/Ï¥à';
                document.getElementById('playerRateLabel').textContent = `1s = ${rate}TL`;
                document.getElementById('playerRevenueLabel').textContent = file.revenuePerSecond + 'TL/Ï¥à';
                
                const minutes = Math.floor(file.token.balance / (60 * rate));
                document.getElementById('playerTimeRemaining').textContent = `‚âà ${minutes}Î∂Ñ ÎÇ®Ïùå`;
                document.getElementById('playerTotalTime').textContent = `${minutes}:00`;
                
                document.getElementById('autoRechargeWalletBalance').textContent = TimeLinkSystem.wallet.balance.toLocaleString() + ' TL';
                document.getElementById('autoRechargeDebt').textContent = TimeLinkSystem.autoRecharge.pendingDebt.toLocaleString() + ' TL';
                
                const queueList = document.getElementById('queueList');
                queueList.innerHTML = TimeLinkSystem.player.queue.slice(TimeLinkSystem.player.currentIndex + 1, TimeLinkSystem.player.currentIndex + 5).map((f, i) => `
                    <div class="queue-item">
                        <span class="queue-genre ${f.metadata.genre}"></span>
                        <span style="flex:1;">${f.metadata.title}</span>
                        <span>${f.token.balance} TL</span>
                    </div>
                `).join('');
                
                audioPlayer.src = file.audio.url;
                audioPlayer.load();
                audioPlayer.play().catch(e => {
                    TimeLinkSystem.ui.showToast('Ïò§ÎîîÏò§ Ïû¨ÏÉù Ïã§Ìå®', 'error');
                });
            }
            
            TimeLinkSystem.player.isPlaying = true;
            
            if (TimeLinkSystem.playInterval) clearInterval(TimeLinkSystem.playInterval);
            
            TimeLinkSystem.playInterval = setInterval(async () => {
                if (!TimeLinkSystem.currentPlayingFile) return;
                
                const currentFile = TimeLinkSystem.currentPlayingFile;
                const currentRate = currentFile.type === 'TL4' ? 2 : 1;
                
                try {
                    await currentFile.consume(currentRate);
                    
                    if (currentFile.type === 'TL4') {
                        const remainingMinutes = Math.floor(currentFile.token.balance / (60 * currentRate));
                        document.getElementById('videoTimeRemaining').textContent = 
                            `TL: ${currentFile.token.balance.toLocaleString()} (${remainingMinutes}Î∂Ñ ÎÇ®Ïùå)`;
                    } else {
                        document.getElementById('playerTL').textContent = currentFile.token.balance.toLocaleString() + ' TL';
                        const remainingMinutes = Math.floor(currentFile.token.balance / (60 * currentRate));
                        document.getElementById('playerTimeRemaining').textContent = `‚âà ${remainingMinutes}Î∂Ñ ÎÇ®Ïùå`;
                    }
                    
                    if (currentFile.token.balance < currentRate) {
                        TimeLinkSystem.player.next();
                    }
                } catch (e) {
                    TimeLinkSystem.player.stop();
                }
            }, 1000);
        },
        
        next: function() {
            if (TimeLinkSystem.player.queue.length === 0) return;
            
            TimeLinkSystem.player.currentIndex++;
            if (TimeLinkSystem.player.currentIndex >= TimeLinkSystem.player.queue.length) {
                TimeLinkSystem.player.currentIndex = 0;
            }
            
            const nextFile = TimeLinkSystem.player.queue[TimeLinkSystem.player.currentIndex];
            if (nextFile) {
                TimeLinkSystem.player.play(nextFile.id);
            }
        },
        
        togglePlayPause: function() {
            const file = TimeLinkSystem.files.find(f => f.id === TimeLinkSystem.player.currentFileId);
            if (!file || file.type === 'TL4') return;
            
            const audioPlayer = document.getElementById('audioPlayer');
            
            if (audioPlayer.paused) {
                audioPlayer.play();
                TimeLinkSystem.player.isPlaying = true;
                document.getElementById('playPauseBtn').innerHTML = '‚è∏Ô∏è Pause';
            } else {
                audioPlayer.pause();
                TimeLinkSystem.player.isPlaying = false;
                document.getElementById('playPauseBtn').innerHTML = '‚ñ∂Ô∏è Play';
            }
        },
        
        stop: function() {
            if (TimeLinkSystem.playInterval) {
                clearInterval(TimeLinkSystem.playInterval);
                TimeLinkSystem.playInterval = null;
            }
            
            const videoContainer = document.getElementById('videoPlayerContainer');
            const videoPlayer = document.getElementById('videoPlayer');
            videoPlayer.pause();
            videoPlayer.src = '';
            videoContainer.style.display = 'none';
            
            const audioPlayer = document.getElementById('audioPlayer');
            audioPlayer.pause();
            audioPlayer.src = '';
            
            document.getElementById('playerModal').style.display = 'none';
            
            TimeLinkSystem.currentPlayingFile = null;
            TimeLinkSystem.player.isPlaying = false;
            TimeLinkSystem.player.currentFileId = null;
            
            TimeLinkSystem.ui.updateAll();
        },
        
        openChargeModal: function(fileId) {
            if (fileId) TimeLinkSystem.player.currentFileId = fileId;
            document.getElementById('currentTLBalance').textContent = TimeLinkSystem.wallet.balance.toLocaleString();
            document.getElementById('chargeModal').style.display = 'flex';
        }
    },
    
    // Lecture
    lecture: {
        selectedFile: null,
        selectedFileData: null,
        
        openCreateModal: function() {
            document.getElementById('lectureCreateModal').style.display = 'flex';
        },
        
        handleFileSelect: function(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            TimeLinkSystem.lecture.selectedFile = file;
            
            const reader = new FileReader();
            reader.onload = e => TimeLinkSystem.lecture.selectedFileData = e.target.result;
            reader.readAsDataURL(file);
        },
        
        create: async function() {
            const title = document.getElementById('lectureTitle').value;
            const price = parseInt(document.getElementById('lecturePrice').value);
            
            if (!title || !price) {
                TimeLinkSystem.ui.showToast('Î™®Îì† Ìï≠Î™©ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî', 'error');
                return;
            }
            
            if (!TimeLinkSystem.lecture.selectedFile) {
                TimeLinkSystem.ui.showToast('ÌååÏùºÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî', 'error');
                return;
            }
            
            const lecture = new Lecture({
                title: title,
                instructor: document.getElementById('lectureInstructor').value,
                description: document.getElementById('lectureDescription').value,
                category: document.getElementById('lectureCategory').value,
                price: price,
                creatorId: TimeLinkSystem.currentUser.id,
                creatorName: TimeLinkSystem.currentUser.username,
                audioUrl: TimeLinkSystem.lecture.selectedFileData
            });
            
            TimeLinkSystem.lectures.push(lecture);
            TimeLinkSystem.ui.showToast('‚úÖ Í∞ïÏùòÍ∞Ä ÏÉùÏÑ±ÎêòÏóàÏäµÎãàÎã§!', 'success');
            document.getElementById('lectureCreateModal').style.display = 'none';
            TimeLinkSystem.lecture.updateList();
        },
        
        updateList: function() {
            const container = document.getElementById('lectureList');
            if (!container) return;
            
            if (TimeLinkSystem.lectures.length === 0) {
                container.innerHTML = '<div style="text-align:center; padding:60px;">üìö Îì±Î°ùÎêú Í∞ïÏùòÍ∞Ä ÏóÜÏäµÎãàÎã§</div>';
                return;
            }
            
            container.innerHTML = TimeLinkSystem.lectures.map(lec => {
                const purchased = lec.hasUserPurchased(TimeLinkSystem.currentUser?.id);
                
                return `
                <div class="file-card">
                    <div class="file-thumbnail video">
                        üìö
                        <span class="badge badge-copyright">${lec.category}</span>
                    </div>
                    <div class="file-info">
                        <div class="file-name">${lec.title}</div>
                        <div class="file-artist">${lec.instructor}</div>
                        <div class="info-panel video-panel">
                            <strong>üí∞ Í∞ÄÍ≤©</strong><br>
                            <span style="font-size: 1.8rem;">${lec.price.toLocaleString()} TL</span>
                        </div>
                        ${purchased ? 
                            '<button class="btn-play" style="width:100%;" onclick="TimeLinkSystem.ui.showToast(\'Í∞ïÏùò Ïû¨ÏÉù Í∏∞Îä• Ï§ÄÎπÑÏ§ë\', \'info\')">üìö ÏãúÏ≤≠ÌïòÍ∏∞</button>' :
                            `<button class="btn-lecture" onclick="TimeLinkSystem.lecture.openPurchaseModal('${lec.id}')">Íµ¨Îß§ÌïòÍ∏∞ (${lec.price} TL)</button>`
                        }
                    </div>
                </div>
            `}).join('');
        },
        
        openPurchaseModal: function(lectureId) {
            const lecture = TimeLinkSystem.lectures.find(l => l.id === lectureId);
            if (!lecture) return;
            
            TimeLinkSystem.pendingLecturePurchase = lecture;
            
            document.getElementById('lecturePurchaseTitle').textContent = lecture.title;
            document.getElementById('lecturePurchaseCreator').textContent = lecture.instructor;
            document.getElementById('lecturePurchasePrice').textContent = lecture.price.toLocaleString() + ' TL';
            document.getElementById('lecturePurchaseBalance').textContent = TimeLinkSystem.wallet.balance.toLocaleString() + ' TL';
            document.getElementById('lecturePurchaseAfter').textContent = (TimeLinkSystem.wallet.balance - lecture.price).toLocaleString() + ' TL';
            
            document.getElementById('lecturePurchaseModal').style.display = 'flex';
        },
        
        confirmPurchase: async function() {
            const lecture = TimeLinkSystem.pendingLecturePurchase;
            if (!lecture) return;
            
            try {
                await lecture.purchase(TimeLinkSystem.currentUser.id, TimeLinkSystem.wallet);
                TimeLinkSystem.ui.showToast(`‚úÖ "${lecture.title}" Íµ¨Îß§ ÏôÑÎ£å!`, 'success');
                TimeLinkSystem.ui.closeLecturePurchaseModal();
                TimeLinkSystem.lecture.updateList();
                TimeLinkSystem.ui.updateAll();
            } catch (e) {
                TimeLinkSystem.ui.showToast(e.message, 'error');
            }
        },
        
        updatePriceKRW: function() {
            const price = parseInt(document.getElementById('lecturePrice').value) || 0;
            document.getElementById('lecturePriceKRW').textContent = Math.floor(price * ECONOMY.TL_PRICE_KRW);
        }
    },
    
    // Mining System
    mining: {
        updateUI: function() {
            const indexInfo = AIContributionIndex.getCurrentInfo();
            
            document.getElementById('currentTimeDisplay').textContent = indexInfo.timeString;
            document.getElementById('currentIndexDisplay').textContent = indexInfo.index.toFixed(2) + 'x';
            document.getElementById('currentIndexDisplay').style.color = indexInfo.color;
            
            document.getElementById('miningCurrentTime').textContent = indexInfo.timeString;
            document.getElementById('miningIndex').textContent = indexInfo.index.toFixed(2) + 'x';
            document.getElementById('miningIndex').style.color = indexInfo.color;
            document.getElementById('miningTimeInfo').textContent = 
                `üìä ÌòÑÏû¨ ${indexInfo.status} ÏãúÍ∞ÑÎåÄÎ°ú Ï±ÑÍµ¥ Ìö®Ïú® ${indexInfo.index.toFixed(2)}Î∞∞`;
            
            const barWidth = (indexInfo.index / 5.0) * 100;
            document.getElementById('indexBar').style.width = barWidth + '%';
            document.getElementById('miningIndexBar').style.width = barWidth + '%';
            
            if (TimeLinkSystem.wallet) {
                const maxMining = TimeLinkSystem.wallet.balance * ECONOMY.MINING_LIMIT_RATIO;
                document.getElementById('minableTL').textContent = Math.floor(maxMining).toLocaleString() + ' TL';
                document.getElementById('miningAmount').max = Math.floor(maxMining);
                
                const amount = parseInt(document.getElementById('miningAmount').value) || 0;
                const tlc = AIContributionIndex.calculateMining(amount);
                document.getElementById('previewTL').textContent = amount.toLocaleString() + ' TL';
                document.getElementById('previewIndex').textContent = indexInfo.index.toFixed(2) + 'x';
                document.getElementById('previewTLC').textContent = tlc.toFixed(2) + ' TLC';
            }
        },
        
        execute: async function() {
            const amount = parseInt(document.getElementById('miningAmount').value);
            if (!amount) return;
            
            const hasMiningRight = TimeLinkSystem.files.some(f => f.metadata.contract?.mining_allowed);
            if (!hasMiningRight) {
                TimeLinkSystem.ui.showToast('5:5 Í≥ÑÏïΩ ÌååÏùºÏù¥ ÌïÑÏöîÌï©ÎãàÎã§', 'error');
                return;
            }
            
            const maxMining = TimeLinkSystem.wallet.balance * ECONOMY.MINING_LIMIT_RATIO;
            if (amount > maxMining) {
                TimeLinkSystem.ui.showToast(`ÏµúÎåÄ Ï±ÑÍµ¥Îüâ: ${Math.floor(maxMining)} TL`, 'error');
                return;
            }
            
            const indexInfo = AIContributionIndex.getCurrentInfo();
            const tlcEarned = AIContributionIndex.calculateMining(amount);
            
            await TimeLinkSystem.wallet.withdraw(amount, 'MINING', 'system');
            TimeLinkSystem.wallet.tlcBalance += tlcEarned;
            
            await Blockchain.record({
                type: 'MINING',
                amount: amount,
                tlcEarned: tlcEarned,
                index: indexInfo.index,
                time: indexInfo.timeString
            });
            
            TimeLinkSystem.ui.updateAll();
            TimeLinkSystem.mining.updateUI();
            TimeLinkSystem.ui.showToast(`‚õèÔ∏è ${tlcEarned.toFixed(2)} TLC Ï±ÑÍµ¥ ÏôÑÎ£å! (ÏßÄÏàò ${indexInfo.index.toFixed(2)}x)`, 'success');
        }
    },
    
    // UI
    ui: {
        switchTab: function(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById('tab' + tab.charAt(0).toUpperCase() + tab.slice(1)).classList.add('active');
            
            if (tab === 'library') TimeLinkSystem.ui.updateLibrary();
            if (tab === 'shareplace') TimeLinkSystem.ui.updateSharePlace();
            if (tab === 'lecture') TimeLinkSystem.lecture.updateList();
            if (tab === 'radio') TimeLinkSystem.radio.initChannels();
            if (tab === 'commercial') TimeLinkSystem.radio.initCommercialChannels();
            if (tab === 'car') TimeLinkSystem.car.updateUI();
            if (tab === 'mining') TimeLinkSystem.mining.updateUI();
        },
        
        updateAll: function() {
            if (!TimeLinkSystem.wallet) return;
            
            TimeLinkSystem.wallet.checkDailyReset();
            
            document.getElementById('walletBalance').textContent = TimeLinkSystem.wallet.balance.toLocaleString();
            document.getElementById('dashWallet').textContent = TimeLinkSystem.wallet.balance.toLocaleString();
            document.getElementById('currentTLBalance').textContent = TimeLinkSystem.wallet.balance.toLocaleString();
            
            document.getElementById('tlcBalance').textContent = TimeLinkSystem.wallet.tlcBalance.toFixed(2);
            document.getElementById('dashTLC').textContent = TimeLinkSystem.wallet.tlcBalance.toFixed(2);
            
            const tl3Count = TimeLinkSystem.files.filter(f => f.type === 'TL3').length;
            const tl4Count = TimeLinkSystem.files.filter(f => f.type === 'TL4').length;
            document.getElementById('dashTL3').textContent = tl3Count;
            document.getElementById('dashTL4').textContent = tl4Count;
            
            document.getElementById('autoRechargeWalletBalance').textContent = TimeLinkSystem.wallet.balance.toLocaleString() + ' TL';
            document.getElementById('autoRechargeDebt').textContent = TimeLinkSystem.autoRecharge.pendingDebt.toLocaleString() + ' TL';
            
            const sharedCount = TimeLinkSystem.files.filter(f => f.isShared).length;
            document.getElementById('sharedCount').textContent = sharedCount;
            document.getElementById('sharedCount2').textContent = sharedCount;
            
            document.getElementById('radioListeners').textContent = '1,234';
            document.getElementById('commercialViewers').textContent = '567';
            document.getElementById('carListeners').textContent = '89';
            document.getElementById('goldAmount').textContent = '10.24 g';
            
            this.updateAdStats();
            this.updateGenreDistribution();
            TimeLinkSystem.mining.updateUI();
            TimeLinkSystem.car.updateUI();
            TimeLinkSystem.carDetection.updateUI();
            TimeLinkSystem.ui.updateLibrary();
            TimeLinkSystem.ui.updateSharePlace();
        },
        
        updateGenreDistribution: function() {
            const stats = genreClassifier.getGenreStats(TimeLinkSystem.files);
            const container = document.getElementById('genreDistribution');
            
            if (container) {
                container.innerHTML = Object.entries(stats).map(([genre, count]) => `
                    <div style="text-align: center;">
                        <div style="font-size: 2rem;">${GENRE_EMOJI[genre]}</div>
                        <div style="color: ${GENRE_COLORS[genre]};">${genre}</div>
                        <div style="font-size: 1.5rem; font-weight: 700;">${count}</div>
                    </div>
                `).join('');
            }
        },
        
        updateAdStats: function() {
            if (!TimeLinkSystem.wallet) return;
            
            const remaining = ECONOMY.AD_DAILY_MAX - TimeLinkSystem.wallet.todayAdEarnings;
            document.getElementById('adRewardIndicator').innerHTML = `+${ECONOMY.AD_VIDEO_REWARD} TL`;
        },
        
        updateLibrary: function() {
            const container = document.getElementById('fileList');
            const empty = document.getElementById('emptyLibrary');
            
            if (TimeLinkSystem.files.length === 0) {
                container.innerHTML = '';
                empty.style.display = 'block';
                return;
            }
            
            empty.style.display = 'none';
            
            container.innerHTML = TimeLinkSystem.files.map(file => {
                const rate = file.type === 'TL4' ? 2 : 1;
                const hasTL = file.token.balance > 0;
                const genre = file.metadata.genre || 'pop';
                
                return `
                <div class="file-card">
                    <div class="file-thumbnail ${file.fileType}">
                        ${file.type === 'TL4' ? 'üé¨' : 'üéµ'}
                        <span class="badge badge-type" style="left:16px;">${file.type}</span>
                        <span class="badge badge-genre" style="left:16px; top:100px; background: ${GENRE_COLORS[genre]};">${GENRE_EMOJI[genre]} ${genre}</span>
                        ${!hasTL ? '<span class="badge badge-zero" style="left:16px; top:140px;">‚ö†Ô∏è TL 0</span>' : ''}
                        ${file.metadata.contract.mining_allowed ? 
                            '<span class="badge badge-mining">‚õèÔ∏è Ï±ÑÍµ¥Í∞ÄÎä•</span>' : 
                            '<span class="badge badge-no-tl">‚õî Ï±ÑÍµ¥Î∂àÍ∞Ä</span>'}
                        ${file.isShared ? '<span class="badge badge-shared">üîÑ Í≥µÏú†Îê®</span>' : ''}
                    </div>
                    <div class="file-info">
                        <div class="file-name">${file.metadata.title}</div>
                        <div class="file-artist">${file.metadata.artist}</div>
                        
                        <div class="info-panel ${!hasTL ? 'zero-panel' : 'tl-panel'}">
                            <strong>‚è≥ TL ÏûîÏï°</strong><br>
                            <span style="font-size:1.4rem; ${!hasTL ? 'color: var(--zero-tl);' : ''}">${file.token.balance.toLocaleString()}</span> TL (${rate}TL/Ï¥à)
                            ${!hasTL ? '<div style="color: var(--zero-tl); font-size:12px; margin-top:4px;">‚ö†Ô∏è Ï∂©Ï†Ñ ÌïÑÏöî</div>' : ''}
                        </div>
                        
                        <div class="file-stats">
                            <span>üìä Ï¥ù Ï∂©Ï†Ñ: ${file.token.total_charged} TL</span>
                            <span>‚è±Ô∏è Ïû¨ÏÉù: ${Math.floor(file.token.total_consumed / rate)}Ï¥à</span>
                        </div>
                        
                        <div class="file-actions">
                            ${hasTL ? 
                                `<button class="btn-play" onclick="TimeLinkSystem.player.play('${file.id}')">‚ñ∂Ô∏è Ïû¨ÏÉù</button>` : 
                                `<button class="btn-play-disabled" disabled>‚õî Ï∂©Ï†Ñ ÌïÑÏöî</button>`
                            }
                            <button class="btn-charge" onclick="TimeLinkSystem.player.openChargeModal('${file.id}')">üí∞ Ï∂©Ï†Ñ</button>
                            ${!file.isShared ? 
                                `<button class="btn-share" onclick="TimeLinkSystem.share.shareFile('${file.id}')">üîÑ Í≥µÏú†</button>` : 
                                `<button class="btn-share" style="background:#333;" disabled>‚úÖ Í≥µÏú†Îê®</button>`
                            }
                        </div>
                    </div>
                </div>
            `}).join('');
        },
        
        updateSharePlace: function() {
            const container = document.getElementById('sharedMusicList');
            
            let shared = TimeLinkSystem.files.filter(f => f.isShared);
            
            // Ïû•Î•¥ ÌïÑÌÑ∞ Ï†ÅÏö©
            if (TimeLinkSystem.currentGenreFilter !== 'all') {
                shared = shared.filter(f => f.metadata.genre === TimeLinkSystem.currentGenreFilter);
            }
            
            document.getElementById('totalSharedCount').textContent = shared.length;
            document.getElementById('shared55Count').textContent = shared.filter(f => f.metadata.contract.type === '55').length;
            document.getElementById('shared73Count').textContent = shared.filter(f => f.metadata.contract.type === '73').length;
            
            let filtered = shared;
            if (TimeLinkSystem.currentFilter === '55') {
                filtered = shared.filter(f => f.metadata.contract.type === '55');
            } else if (TimeLinkSystem.currentFilter === '73') {
                filtered = shared.filter(f => f.metadata.contract.type === '73');
            } else if (TimeLinkSystem.currentFilter === 'mining') {
                filtered = shared.filter(f => f.metadata.contract.mining_allowed);
            }
            
            if (filtered.length === 0) {
                container.innerHTML = '<div style="grid-column:1/-1; text-align:center; padding:60px;">üì≠ Í≥µÏú†Îêú ÌååÏùºÏù¥ ÏóÜÏäµÎãàÎã§</div>';
                return;
            }
            
            container.innerHTML = filtered.map(file => {
                const hasTL = file.token.balance > 0;
                const genre = file.metadata.genre || 'pop';
                
                return `
                <div class="file-card">
                    <div class="file-thumbnail ${file.fileType}">
                        ${file.type === 'TL4' ? 'üé¨' : 'üéµ'}
                        <span class="badge badge-shared">üîÑ Í≥µÏú†Îê®</span>
                        <span class="badge badge-genre" style="left:16px; top:60px; background: ${GENRE_COLORS[genre]};">${GENRE_EMOJI[genre]} ${genre}</span>
                        ${!hasTL ? '<span class="badge badge-zero" style="left:16px; top:100px;">‚ö†Ô∏è TL 0</span>' : ''}
                    </div>
                    <div class="file-info">
                        <div class="file-name">${file.metadata.title}</div>
                        <div class="file-artist">${file.metadata.artist}</div>
                        <div class="info-panel copyright-panel">
                            <strong>ÌÅ¨Î¶¨ÏóêÏù¥ÌÑ∞</strong> ${file.creatorName}
                        </div>
                        <div class="info-panel ${!hasTL ? 'zero-panel' : 'tl-panel'}">
                            <strong>‚è≥ ÎÇ®ÏùÄ TL</strong> ${file.token.balance.toLocaleString()} TL
                            ${!hasTL ? '<div style="color: var(--zero-tl); font-size:12px;">‚ö†Ô∏è Ï∂©Ï†Ñ ÌïÑÏöî</div>' : ''}
                        </div>
                        <div class="file-actions">
                            <button class="btn-download" onclick="TimeLinkSystem.file.download('${file.id}')">
                                üì• ÎÇ¥ ÎùºÏù¥Î∏åÎü¨Î¶¨Ïóê Ï∂îÍ∞Ä
                            </button>
                        </div>
                    </div>
                </div>
            `}).join('');
        },
        
        openAdModal: function() {
            TimeLinkSystem.wallet.checkDailyReset();
            
            document.getElementById('adWatchModal').style.display = 'flex';
            document.getElementById('adInitialSection').style.display = 'block';
            document.getElementById('adTypeSelector').style.display = 'none';
            document.getElementById('adPlayerSection').style.display = 'none';
        },
        
        closeAdModal: function() {
            if (TimeLinkSystem.adInterval) {
                clearInterval(TimeLinkSystem.adInterval);
                TimeLinkSystem.adInterval = null;
            }
            document.getElementById('adWatchModal').style.display = 'none';
        },
        
        openPermissionModal: function() {
            document.getElementById('permissionModal').style.display = 'flex';
        },
        
        closePermissionModal: function() {
            document.getElementById('permissionModal').style.display = 'none';
        },
        
        openCarRegisterModal: function() {
            document.getElementById('carRegisterModal').style.display = 'flex';
        },
        
        closeCarRegisterModal: function() {
            document.getElementById('carRegisterModal').style.display = 'none';
        },
        
        openPurchaseModal: function() {
            const container = document.getElementById('purchasePackages');
            container.innerHTML = ECONOMY.PACKAGES.map(pkg => `
                <div class="charge-card" onclick="TimeLinkSystem.file.purchaseTL('${pkg.id}')">
                    <div class="icon">üí∞</div>
                    <h3>${pkg.name}</h3>
                    <div class="amount">${(pkg.tl + pkg.bonus).toLocaleString()} TL</div>
                    <div>${pkg.price}Ïõê</div>
                    ${pkg.bonus > 0 ? `<div style="color:var(--success);">+${pkg.bonus} Î≥¥ÎÑàÏä§</div>` : ''}
                </div>
            `).join('');
            
            document.getElementById('purchaseModal').style.display = 'flex';
        },
        
        closePurchaseModal: function() {
            document.getElementById('purchaseModal').style.display = 'none';
        },
        
        closeChargeModal: function() {
            document.getElementById('chargeModal').style.display = 'none';
        },
        
        closeLecturePurchaseModal: function() {
            document.getElementById('lecturePurchaseModal').style.display = 'none';
            TimeLinkSystem.pendingLecturePurchase = null;
        },
        
        showToast: function(message, type = 'info') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `toast ${type}`;
            toast.style.display = 'block';
            setTimeout(() => toast.style.display = 'none', 3000);
        }
    }
};

// Car Mode Badge
TimeLinkSystem.car.showCarModeBadge = function(show) {
    const badge = document.getElementById('carModeBadge');
    if (badge) {
        if (show) {
            badge.style.display = 'flex';
        } else {
            badge.style.display = 'none';
        }
    }
};

const originalOnCarEnter = TimeLinkSystem.car.onCarEnter;
TimeLinkSystem.car.onCarEnter = function(method, confidence) {
    originalOnCarEnter.call(this, method, confidence);
    this.showCarModeBadge(true);
};

const originalOnCarExit = TimeLinkSystem.car.onCarExit;
TimeLinkSystem.car.onCarExit = function() {
    originalOnCarExit.call(this);
    if (!this.manualMode) {
        this.showCarModeBadge(false);
    }
};

const originalToggleManualMode = TimeLinkSystem.car.toggleManualMode;
TimeLinkSystem.car.toggleManualMode = function() {
    originalToggleManualMode.call(this);
    if (this.manualMode) {
        this.showCarModeBadge(true);
        document.getElementById('carModeText').textContent = 'ÏàòÎèô CAR MODE ¬∑ 2x Î≥¥ÏÉÅ';
    } else {
        if (TimeLinkSystem.carDetection.isInCar) {
            this.showCarModeBadge(true);
            document.getElementById('carModeText').textContent = 'CAR MODE ¬∑ 2x Î≥¥ÏÉÅ';
        } else {
            this.showCarModeBadge(false);
        }
    }
};

// Event Listeners
document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('fileInput').addEventListener('change', e => TimeLinkSystem.file.handleSelect(e));
    document.getElementById('lectureFileInput').addEventListener('change', e => TimeLinkSystem.lecture.handleFileSelect(e));
    document.getElementById('lecturePrice').addEventListener('input', () => TimeLinkSystem.lecture.updatePriceKRW());
    document.getElementById('miningAmount')?.addEventListener('input', () => TimeLinkSystem.mining.updateUI());
    
    window.addEventListener('click', e => {
        if (e.target.classList.contains('modal')) e.target.style.display = 'none';
    });
    
    document.getElementById('copyrightNumber').value = 'TL3-' + Date.now();
    TimeLinkSystem.file.selectType('audio');
});

// Export
window.TimeLinkSystem = TimeLinkSystem;
window.ECONOMY = ECONOMY;
window.AIContributionIndex = AIContributionIndex;
window.GENRE_COLORS = GENRE_COLORS;
window.GENRE_EMOJI = GENRE_EMOJI;
</script>

<!-- Car Mode Badge -->
<div id="carModeBadge" class="car-mode-badge" style="display: none;">
    <span>üöó</span>
    <span id="carModeText">CAR MODE ¬∑ 2x Î≥¥ÏÉÅ</span>
</div>

<!-- Status Badge -->
<div style="position: fixed; bottom: 20px; right: 20px; background: rgba(26,26,26,0.95); padding: 12px 24px; border-radius: var(--radius-full); border: 1px solid var(--border-color); z-index: 999; display: flex; gap: 12px;">
    <span style="color:var(--success);">üéµ TL3</span>
    <span style="color:var(--video);">üé¨ TL4</span>
    <span style="color:var(--ad);">üì∫ Í¥ëÍ≥†</span>
    <span style="color:var(--car);">üöó CAR 2x</span>
    <span style="color:var(--zero-tl);">üéµ Ïû•Î•¥</span>
</div>

</body>
</html>
