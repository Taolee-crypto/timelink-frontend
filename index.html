<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TimeLink â€” Time-Based Media Economy</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #0a0a0a; 
            color: #fff; 
            line-height: 1.6;
        }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        
        .header {
            background: linear-gradient(145deg, #1a0b2e, #1a1a1a);
            padding: 24px 32px;
            border-radius: 20px;
            margin-bottom: 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid rgba(138,43,226,0.3);
        }
        .header h1 {
            font-size: 2rem;
            background: linear-gradient(135deg, #b983ff, #8a2be2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .balances { display: flex; gap: 16px; }
        .balance {
            background: rgba(255,255,255,0.05);
            padding: 12px 20px;
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.1);
            cursor: pointer;
            transition: all 0.2s;
        }
        .balance:hover { border-color: #f59e0b; background: rgba(245,158,11,0.1); }
        .balance .lbl { font-size: 10px; color: #999; text-transform: uppercase; }
        .balance .amt { font-size: 22px; font-weight: 800; }
        .balance.low .amt { color: #ef4444; animation: pulse 1s infinite; }
        @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.5} }
        
        /* ì¶©ì „ ë²„íŠ¼ */
        .recharge-btn {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: black;
            border: none;
            padding: 12px 20px;
            border-radius: 12px;
            font-weight: 800;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .recharge-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(245,158,11,0.4); }
        
        .tabs {
            background: rgba(17,17,17,0.8);
            border-radius: 999px;
            padding: 8px;
            display: flex;
            gap: 6px;
            margin-bottom: 28px;
            overflow-x: auto;
        }
        .tab {
            padding: 12px 24px;
            border-radius: 999px;
            border: none;
            background: transparent;
            color: #999;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.2s;
        }
        .tab:hover { background: rgba(255,255,255,0.05); color: white; }
        .tab.active { background: #8a2be2; color: white; }
        
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        
        .card {
            background: linear-gradient(145deg, #1a1a1a, #151515);
            border-radius: 20px;
            padding: 32px;
            margin-bottom: 28px;
            border: 1px solid rgba(255,255,255,0.08);
        }
        .card h2 { 
            font-size: 1.8rem; 
            margin-bottom: 24px;
            background: linear-gradient(135deg, #fff, #e0e0e0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(360px, 1fr)); gap: 24px; }
        
        .file-card {
            background: #1e1e1e;
            border-radius: 16px;
            overflow: hidden;
            border: 1px solid rgba(255,255,255,0.08);
            transition: all 0.3s;
        }
        .file-card:hover { transform: translateY(-6px); border-color: #8a2be2; }
        
        .thumb {
            height: 160px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3.5rem;
            background: linear-gradient(145deg, #2a1a3a, #1e1e1e);
            position: relative;
        }
        .thumb.video { background: linear-gradient(145deg, #ff7b00, #ff5500); }
        .thumb-media {
            background-size: cover;
            background-position: center;
            isolation: isolate;
        }
        .thumb-media::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(180deg, rgba(0,0,0,0.1), rgba(0,0,0,0.7));
            z-index: -1;
        }
        .thumb-icon {
            width: 66px;
            height: 66px;
            border-radius: 50%;
            background: rgba(0,0,0,0.55);
            backdrop-filter: blur(6px);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .badge {
            position: absolute;
            padding: 6px 14px;
            border-radius: 999px;
            font-size: 11px;
            font-weight: 700;
            color: white;
        }
        .badge-type { left: 12px; top: 12px; background: rgba(0,0,0,0.7); }
        .badge-cert { right: 12px; top: 12px; background: rgba(255,215,0,0.9); color: black; }
        .badge-genre { left: 12px; bottom: 12px; }
        
        .info { padding: 20px; }
        .name { font-size: 1.2rem; font-weight: 700; margin-bottom: 6px; }
        .creator { color: #999; font-size: 0.9rem; margin-bottom: 16px; }
        
        .panel {
            background: rgba(255,255,255,0.03);
            padding: 14px;
            border-radius: 12px;
            margin-bottom: 16px;
            font-size: 13px;
            border-left: 4px solid #8a2be2;
        }
        
        .actions { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .btn {
            padding: 12px;
            border: none;
            border-radius: 12px;
            font-weight: 700;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .btn:hover { transform: translateY(-2px); }
        .btn-play { background: #1db954; color: white; }
        .btn-charge { background: #f59e0b; color: black; }
        .btn-share { background: #8a2be2; color: white; grid-column: span 2; }
        .btn-disabled { background: #333; color: #666; cursor: not-allowed; }
        
        .form-group { margin-bottom: 20px; }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #999;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 14px 16px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            color: white;
            font-size: 14px;
            font-family: inherit;
        }
        
        .type-selector { display: flex; gap: 20px; margin-bottom: 28px; }
        .type-card {
            flex: 1;
            background: rgba(255,255,255,0.05);
            padding: 28px;
            border-radius: 20px;
            text-align: center;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s;
        }
        .type-card:hover { transform: translateY(-4px); }
        .type-card.selected { border-color: #1db954; background: rgba(29,185,84,0.1); }
        .type-card.video.selected { border-color: #ff5500; background: rgba(255,85,0,0.1); }
        
        .upload {
            border: 2px dashed #8a2be2;
            background: rgba(138,43,226,0.05);
            border-radius: 20px;
            padding: 50px;
            text-align: center;
            cursor: pointer;
            margin-bottom: 28px;
            transition: all 0.2s;
        }
        .upload:hover { background: rgba(138,43,226,0.1); transform: scale(1.01); }
        
        .modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.92);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        .modal-content {
            background: #1e1e1e;
            border-radius: 20px;
            padding: 36px;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .toast {
            position: fixed;
            top: 28px;
            right: 28px;
            background: #1e1e1e;
            padding: 16px 24px;
            border-radius: 999px;
            display: none;
            z-index: 3000;
            min-width: 320px;
            border-left: 6px solid #1db954;
            box-shadow: 0 4px 20px rgba(0,0,0,0.4);
        }
        
        .hero {
            background: linear-gradient(145deg, #2a1a3a, #1a1a1a);
            padding: 48px;
            border-radius: 24px;
            text-align: center;
            margin-bottom: 32px;
            border: 1px solid rgba(138,43,226,0.3);
        }
        .hero h1 {
            font-size: 3rem;
            margin-bottom: 16px;
            background: linear-gradient(135deg, #b983ff, #8a2be2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .media-showcase {
            display: grid;
            grid-template-columns: 1.2fr 1fr;
            gap: 18px;
            margin-top: 22px;
        }
        .featured-banner {
            min-height: 220px;
            border-radius: 18px;
            padding: 24px;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            background:
                linear-gradient(130deg, rgba(0,0,0,0.15), rgba(0,0,0,0.7)),
                url('https://images.unsplash.com/photo-1493225457124-a3eb161ffa5f?auto=format&fit=crop&w=1400&q=80') center/cover;
            border: 1px solid rgba(255,255,255,0.12);
        }
        .featured-banner .tag {
            display: inline-block;
            padding: 6px 12px;
            background: rgba(138,43,226,0.85);
            border-radius: 999px;
            font-size: 11px;
            font-weight: 700;
            margin-bottom: 10px;
            width: fit-content;
        }
        .playlist-stack { display: grid; gap: 12px; }
        .playlist-item {
            min-height: 67px;
            border-radius: 14px;
            padding: 14px;
            border: 1px solid rgba(255,255,255,0.12);
            background-size: cover;
            background-position: center;
            display: flex;
            align-items: end;
            font-weight: 700;
        }

        @media (max-width: 900px) {
            .media-showcase { grid-template-columns: 1fr; }
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
            margin-top: 32px;
        }
        .feature-card {
            background: rgba(255,255,255,0.03);
            padding: 24px;
            border-radius: 16px;
            border: 1px solid rgba(255,255,255,0.08);
        }
        .feature-card h3 { margin: 12px 0; font-size: 1.2rem; }
        .feature-card p { color: #999; font-size: 0.9rem; line-height: 1.6; }

        .mvp-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 14px;
            margin-top: 18px;
        }
        .mvp-kpi {
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.08);
            border-radius: 14px;
            padding: 14px;
        }
        .mvp-kpi .label { color: #999; font-size: 12px; margin-bottom: 8px; }
        .mvp-kpi .value { font-size: 1.5rem; font-weight: 800; }
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 12px;
            margin-top: 16px;
        }
        
        .search-box {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 999px;
            padding: 14px 24px;
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 24px;
        }
        .search-box input {
            flex: 1;
            background: transparent;
            border: none;
            color: white;
            font-size: 15px;
            outline: none;
        }
        
        .genre-filter {
            display: flex;
            gap: 10px;
            margin-bottom: 24px;
            flex-wrap: wrap;
        }
        .genre-btn {
            padding: 8px 18px;
            border-radius: 999px;
            border: 1px solid rgba(255,255,255,0.1);
            background: transparent;
            color: #999;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        .genre-btn:hover { border-color: #8a2be2; }
        .genre-btn.active { background: #8a2be2; color: white; border-color: #8a2be2; }
        
        /* ===== TL ì¶©ì „ ëª¨ë‹¬ ìŠ¤íƒ€ì¼ ===== */
        #tlRechargeModal .modal-content {
            max-width: 560px;
            border: 1px solid rgba(245,158,11,0.4);
        }
        .recharge-header {
            text-align: center;
            margin-bottom: 28px;
        }
        .recharge-header .icon { font-size: 3rem; margin-bottom: 12px; }
        .recharge-header h2 {
            font-size: 1.8rem;
            background: linear-gradient(135deg, #f59e0b, #fbbf24);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .recharge-header p { color: #999; font-size: 14px; margin-top: 8px; }

        /* ê´‘ê³  ì„¹ì…˜ */
        .ad-section {
            background: linear-gradient(135deg, rgba(59,130,246,0.15), rgba(37,99,235,0.08));
            border: 1px solid rgba(59,130,246,0.4);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 20px;
        }
        .ad-section h3 { font-size: 1.1rem; margin-bottom: 8px; color: #60a5fa; }
        .ad-section p { color: #999; font-size: 13px; margin-bottom: 16px; }
        .ad-rewards { display: flex; gap: 12px; margin-bottom: 16px; flex-wrap: wrap; }
        .ad-reward-item {
            flex: 1;
            min-width: 120px;
            background: rgba(0,0,0,0.3);
            border-radius: 12px;
            padding: 12px;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.08);
        }
        .ad-reward-item .reward-tl { font-size: 1.4rem; font-weight: 800; color: #f59e0b; }
        .ad-reward-item .reward-label { font-size: 11px; color: #999; margin-top: 4px; }
        .ad-reward-item .reward-time { font-size: 10px; color: #60a5fa; margin-top: 2px; }

        /* ê´‘ê³  ì‹œì²­ ì§„í–‰ë°” */
        .ad-progress-container { display: none; margin-bottom: 16px; }
        .ad-progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 13px;
            color: #999;
        }
        .ad-progress-bar {
            height: 8px;
            background: rgba(255,255,255,0.1);
            border-radius: 999px;
            overflow: hidden;
        }
        .ad-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3b82f6, #60a5fa);
            border-radius: 999px;
            width: 0%;
            transition: width 0.5s linear;
        }
        .ad-visual {
            height: 120px;
            border-radius: 12px;
            background: linear-gradient(135deg, #1e3a5f, #0f2847);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 12px;
            border: 1px solid rgba(59,130,246,0.3);
            position: relative;
            overflow: hidden;
        }
        .ad-visual::before {
            content: '';
            position: absolute;
            inset: 0;
            background: repeating-linear-gradient(
                45deg,
                transparent,
                transparent 10px,
                rgba(59,130,246,0.03) 10px,
                rgba(59,130,246,0.03) 20px
            );
        }
        .ad-visual-content { text-align: center; z-index: 1; }
        .ad-visual-content .ad-brand { font-size: 1.4rem; font-weight: 800; color: #60a5fa; }
        .ad-visual-content .ad-tagline { font-size: 12px; color: #999; margin-top: 4px; }
        .ad-skip-notice {
            font-size: 11px;
            color: #666;
            text-align: center;
            margin-top: 8px;
        }

        /* êµ¬ë§¤ íŒ¨í‚¤ì§€ */
        .purchase-section {
            background: linear-gradient(135deg, rgba(245,158,11,0.1), rgba(217,119,6,0.05));
            border: 1px solid rgba(245,158,11,0.3);
            border-radius: 16px;
            padding: 24px;
        }
        .purchase-section h3 { font-size: 1.1rem; margin-bottom: 16px; color: #f59e0b; }
        .packages-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }
        .package-card {
            background: rgba(0,0,0,0.4);
            border: 2px solid rgba(245,158,11,0.2);
            border-radius: 14px;
            padding: 16px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
            position: relative;
        }
        .package-card:hover { border-color: #f59e0b; background: rgba(245,158,11,0.1); transform: translateY(-2px); }
        .package-card.popular {
            border-color: #f59e0b;
            background: linear-gradient(135deg, rgba(245,158,11,0.15), rgba(0,0,0,0.4));
        }
        .package-card .popular-badge {
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            background: #f59e0b;
            color: black;
            font-size: 10px;
            font-weight: 800;
            padding: 3px 10px;
            border-radius: 999px;
        }
        .package-card .pkg-tl { font-size: 1.5rem; font-weight: 800; color: #fbbf24; }
        .package-card .pkg-bonus { font-size: 11px; color: #22c55e; font-weight: 600; margin-top: 2px; }
        .package-card .pkg-price { font-size: 1.1rem; font-weight: 700; margin-top: 8px; color: #fff; }
        .package-card .pkg-per { font-size: 10px; color: #999; margin-top: 2px; }

        .recharge-divider {
            display: flex;
            align-items: center;
            gap: 12px;
            margin: 20px 0;
            color: #555;
            font-size: 13px;
        }
        .recharge-divider::before, .recharge-divider::after {
            content: '';
            flex: 1;
            height: 1px;
            background: rgba(255,255,255,0.08);
        }

        /* Auth Screen */
        #authScreen {
            position: fixed;
            inset: 0;
            background: linear-gradient(145deg, #1a0b2e, #0a0a0a);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }
        .auth-container {
            background: linear-gradient(145deg, #1e1e1e, #151515);
            border-radius: 24px;
            padding: 48px;
            max-width: 480px;
            width: 90%;
            border: 1px solid rgba(138,43,226,0.3);
        }
        .auth-logo { text-align: center; margin-bottom: 40px; }
        .auth-logo h1 {
            font-size: 2.5rem;
            background: linear-gradient(135deg, #b983ff, #8a2be2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 8px;
        }
        .auth-form { margin-top: 32px; }
        .auth-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #8a2be2, #b983ff);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 12px;
        }
        .auth-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 24px rgba(138,43,226,0.4); }
        .auth-switch { text-align: center; margin-top: 24px; color: #999; font-size: 14px; }
        .auth-switch a { color: #8a2be2; text-decoration: none; font-weight: 600; cursor: pointer; }
        .auth-switch a:hover { text-decoration: underline; }
        .auth-message {
            display: none;
            padding: 14px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            font-size: 14px;
            font-weight: 600;
        }

        /* íšŒì›ê°€ì… ë³´ë„ˆìŠ¤ ë°°ë„ˆ */
        .signup-bonus-banner {
            background: linear-gradient(135deg, rgba(245,158,11,0.2), rgba(34,197,94,0.1));
            border: 1px solid rgba(245,158,11,0.4);
            border-radius: 12px;
            padding: 14px 18px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .signup-bonus-banner .bonus-icon { font-size: 1.8rem; }
        .signup-bonus-banner .bonus-text { flex: 1; }
        .signup-bonus-banner .bonus-text strong { display: block; color: #f59e0b; font-size: 1rem; }
        .signup-bonus-banner .bonus-text span { font-size: 12px; color: #999; }

        #mainApp { display: none; }
        .user-info { display: flex; align-items: center; gap: 12px; flex-wrap: wrap; }
        .user-name {
            background: rgba(255,255,255,0.05);
            padding: 10px 18px;
            border-radius: 999px;
            font-weight: 600;
        }
        .logout-btn {
            background: rgba(255,68,68,0.2);
            color: #ff4444;
            border: 1px solid rgba(255,68,68,0.3);
            padding: 10px 20px;
            border-radius: 999px;
            font-weight: 600;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s;
        }
        .logout-btn:hover { background: rgba(255,68,68,0.3); }

        /* ì €TL ê²½ê³  ë°°ë„ˆ */
        #lowTlBanner {
            display: none;
            background: linear-gradient(135deg, rgba(245,158,11,0.2), rgba(239,68,68,0.1));
            border: 1px solid rgba(245,158,11,0.5);
            border-radius: 16px;
            padding: 16px 24px;
            margin-bottom: 20px;
            display: none;
            align-items: center;
            gap: 16px;
        }
        #lowTlBanner .warn-icon { font-size: 1.5rem; }
        #lowTlBanner .warn-text { flex: 1; }
        #lowTlBanner .warn-text strong { display: block; color: #f59e0b; }
        #lowTlBanner .warn-text span { font-size: 13px; color: #999; }
    </style>
</head>
<body>

<!-- Auth Screen -->
<div id="authScreen">
    <div class="auth-container">
        <div class="auth-logo">
            <h1>â° TimeLink</h1>
            <p style="color:#999;">Time-Based Media Economy</p>
        </div>
        
        <div class="auth-message" id="authMessage"></div>
        
        <!-- Login Form -->
        <div id="loginForm" class="auth-form">
            <div class="form-group">
                <label>ì´ë©”ì¼</label>
                <input type="email" id="loginEmail" placeholder="your@email.com">
            </div>
            <div class="form-group">
                <label>ë¹„ë°€ë²ˆí˜¸</label>
                <input type="password" id="loginPassword" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
            </div>
            <button class="auth-btn" onclick="Auth.login()">ë¡œê·¸ì¸</button>
            <div class="auth-switch">
                ê³„ì •ì´ ì—†ìœ¼ì‹ ê°€ìš”? <a onclick="Auth.switchAuthMode('register')">íšŒì›ê°€ì…</a>
            </div>
        </div>
        
        <!-- Register Form -->
        <div id="registerForm" class="auth-form" style="display:none;">
            <!-- ê°€ì… ë³´ë„ˆìŠ¤ ì•ˆë‚´ -->
            <div class="signup-bonus-banner">
                <div class="bonus-icon">ğŸ</div>
                <div class="bonus-text">
                    <strong>ì‹ ê·œ ê°€ì… ë³´ë„ˆìŠ¤ 10,000 TL!</strong>
                    <span>ì§€ê¸ˆ ê°€ì…í•˜ë©´ ì¦‰ì‹œ 10,000 TLì„ ë“œë¦½ë‹ˆë‹¤</span>
                </div>
            </div>

            <div class="form-group">
                <label>íšŒì› ìœ í˜•</label>
                <select id="accountType" style="margin-bottom:16px;" onchange="Auth.toggleBusinessInfo()">
                    <option value="personal">ğŸ‘¤ ì¼ë°˜ íšŒì›</option>
                    <option value="business">â˜• ì‚¬ì—…ì íšŒì› (ì¹´í˜ ìš´ì˜)</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>ì´ë¦„</label>
                <input type="text" id="regName" placeholder="í™ê¸¸ë™">
            </div>
            <div class="form-group">
                <label>ì´ë©”ì¼</label>
                <input type="email" id="regEmail" placeholder="your@email.com">
            </div>
            <div class="form-group">
                <label>ë¹„ë°€ë²ˆí˜¸</label>
                <input type="password" id="regPassword" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
            </div>
            
            <!-- ì‚¬ì—…ì ì¶”ê°€ ì •ë³´ -->
            <div id="businessInfo" style="display:none;">
                <div style="padding:16px; background:rgba(139,92,46,0.1); border:1px solid #8b5c2e; border-radius:12px; margin-bottom:16px;">
                    <div style="font-weight:700; margin-bottom:12px; color:#8b5c2e;">â˜• ì¹´í˜ ì •ë³´</div>
                    <div class="form-group">
                        <label>ì¹´í˜ ì´ë¦„</label>
                        <input type="text" id="cafeName" placeholder="ì˜ˆ: ì»¤í”¼ì•¤ë®¤ì§ ê°•ë‚¨ì ">
                    </div>
                    <div class="form-group">
                        <label>ì¹´í˜ ì£¼ì†Œ</label>
                        <input type="text" id="cafeLocation" placeholder="ì„œìš¸ ê°•ë‚¨êµ¬ í…Œí—¤ë€ë¡œ 123">
                    </div>
                    <div class="form-group">
                        <label>ì¹´í˜ ì†Œê°œ</label>
                        <textarea id="cafeDescription" rows="3" placeholder="ì¹´í˜ì˜ íŠ¹ì§•ê³¼ ë¶„ìœ„ê¸°ë¥¼ ì†Œê°œí•´ì£¼ì„¸ìš”"></textarea>
                    </div>
                    <div class="form-group">
                        <label>ì¹´í˜ ì´ë¯¸ì§€ URL</label>
                        <input type="text" id="cafeImage" placeholder="https://example.com/cafe.jpg">
                    </div>
                    <div class="form-group" style="margin-bottom:0;">
                        <label>ì˜ì—… ì‹œê°„</label>
                        <input type="text" id="cafeHours" placeholder="í‰ì¼ 09:00-22:00, ì£¼ë§ 10:00-23:00">
                    </div>
                </div>
            </div>
            
            <button class="auth-btn" onclick="Auth.register()">ğŸ ê°€ì…í•˜ê³  10,000 TL ë°›ê¸°</button>
            <div class="auth-switch">
                ì´ë¯¸ ê³„ì •ì´ ìˆìœ¼ì‹ ê°€ìš”? <a onclick="Auth.switchAuthMode('login')">ë¡œê·¸ì¸</a>
            </div>
        </div>
    </div>
</div>

<!-- Main App -->
<div id="mainApp">

<div id="toast" class="toast"></div>
<input type="file" id="fileInput" style="display:none;" accept="audio/*,video/*">

<!-- Audio Player Modal -->
<div class="modal" id="audioModal">
    <div class="modal-content">
        <h2 id="playTitle">ì¬ìƒ ì¤‘</h2>
        <p style="color:#999; margin-bottom:20px;" id="playCreator">Creator</p>
        <div class="panel">
            <strong>â³ TL Balance</strong><br>
            <span style="font-size:2rem; font-weight:800;" id="playTL">0</span> TL
        </div>
        <audio id="audioPlayer" controls style="width:100%; margin:20px 0;"></audio>
        <button class="btn" onclick="App.stopPlay()" style="width:100%; background:#f44; color:white; padding:16px;">â¹ï¸ ì •ì§€</button>
    </div>
</div>

<!-- Charge Modal -->
<div class="modal" id="chargeModal">
    <div class="modal-content">
        <h2>ğŸ’° TL ì¶©ì „</h2>
        <div class="form-group" style="margin-top:24px;">
            <label>ì¶©ì „í•  TL</label>
            <input type="number" id="chargeAmount" value="1000" min="100" step="100">
        </div>
        <div style="display:flex; gap:12px;">
            <button class="btn btn-play" onclick="App.executeCharge()" style="flex:1; padding:16px;">ì¶©ì „</button>
            <button class="btn" onclick="App.closeModal()" style="flex:1; background:#333; color:white; padding:16px;">ì·¨ì†Œ</button>
        </div>
    </div>
</div>

<!-- ===== TL ì¶©ì „ ëª¨ë‹¬ (ê´‘ê³  + êµ¬ë§¤) ===== -->
<div class="modal" id="tlRechargeModal">
    <div class="modal-content">
        <div class="recharge-header">
            <div class="icon">ğŸ’°</div>
            <h2>TL ì¶©ì „í•˜ê¸°</h2>
            <p>ê´‘ê³  ì‹œì²­ìœ¼ë¡œ ë¬´ë£Œ TLì„ ë°›ê±°ë‚˜, ë°”ë¡œ êµ¬ë§¤í•˜ì„¸ìš”</p>
        </div>

        <!-- í˜„ì¬ ì”ì•¡ í‘œì‹œ -->
        <div style="background:rgba(255,255,255,0.03); border-radius:12px; padding:16px; margin-bottom:20px; text-align:center; border:1px solid rgba(255,255,255,0.08);">
            <div style="font-size:12px; color:#999; margin-bottom:4px;">í˜„ì¬ TL ì”ì•¡</div>
            <div style="font-size:2rem; font-weight:800;" id="modalCurrentTL">0</div>
            <div style="font-size:11px; color:#666; margin-top:4px;">TL</div>
        </div>

        <!-- ê´‘ê³  ì‹œì²­ ì„¹ì…˜ -->
        <div class="ad-section">
            <h3>ğŸ“º ê´‘ê³  ì‹œì²­ìœ¼ë¡œ ë¬´ë£Œ TL íšë“</h3>
            <p>ê´‘ê³ ë¥¼ ì‹œì²­í•˜ë©´ ë¬´ë£Œë¡œ TLì„ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤ (í•˜ë£¨ ìµœëŒ€ 5íšŒ)</p>
            
            <div class="ad-rewards">
                <div class="ad-reward-item">
                    <div class="reward-tl">+500 TL</div>
                    <div class="reward-label">15ì´ˆ ê´‘ê³ </div>
                    <div class="reward-time">ë¹ ë¥¸ íšë“</div>
                </div>
                <div class="ad-reward-item">
                    <div class="reward-tl">+1,500 TL</div>
                    <div class="reward-label">30ì´ˆ ê´‘ê³ </div>
                    <div class="reward-time">ì¶”ì²œ</div>
                </div>
                <div class="ad-reward-item">
                    <div class="reward-tl">+3,000 TL</div>
                    <div class="reward-label">60ì´ˆ ê´‘ê³ </div>
                    <div class="reward-time">ìµœëŒ€ ë³´ìƒ</div>
                </div>
            </div>

            <!-- ê´‘ê³  ì§„í–‰ ì¤‘ í‘œì‹œ -->
            <div class="ad-progress-container" id="adProgressContainer">
                <div class="ad-visual" id="adVisual">
                    <div class="ad-visual-content">
                        <div class="ad-brand" id="adBrand">TimeLink Premium</div>
                        <div class="ad-tagline" id="adTagline">ìŒì•…ìœ¼ë¡œ ì—°ê²°ë˜ëŠ” ì„¸ìƒ</div>
                    </div>
                </div>
                <div class="ad-progress-label">
                    <span id="adProgressText">ê´‘ê³  ì‹œì²­ ì¤‘...</span>
                    <span id="adCountdown">30ì´ˆ</span>
                </div>
                <div class="ad-progress-bar">
                    <div class="ad-progress-fill" id="adProgressFill"></div>
                </div>
                <div class="ad-skip-notice" id="adSkipNotice">âš ï¸ ê´‘ê³ ê°€ ëë‚  ë•Œê¹Œì§€ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”</div>
            </div>

            <!-- ê´‘ê³  ì„ íƒ ë²„íŠ¼ -->
            <div id="adButtons" style="display:flex; gap:10px; flex-wrap:wrap;">
                <button class="btn" onclick="App.watchAd(15, 500)" style="flex:1; background:rgba(59,130,246,0.2); color:#60a5fa; border:1px solid rgba(59,130,246,0.4); padding:12px; font-size:13px;">
                    â–¶ï¸ 15ì´ˆ â†’ +500 TL
                </button>
                <button class="btn" onclick="App.watchAd(30, 1500)" style="flex:1; background:rgba(59,130,246,0.4); color:#60a5fa; border:1px solid rgba(59,130,246,0.6); padding:12px; font-size:13px;">
                    â–¶ï¸ 30ì´ˆ â†’ +1,500 TL â­
                </button>
                <button class="btn" onclick="App.watchAd(60, 3000)" style="flex:1; background:rgba(59,130,246,0.2); color:#60a5fa; border:1px solid rgba(59,130,246,0.4); padding:12px; font-size:13px;">
                    â–¶ï¸ 60ì´ˆ â†’ +3,000 TL
                </button>
            </div>
            <div style="margin-top:10px; text-align:center; font-size:12px; color:#666;">
                ì˜¤ëŠ˜ ë‚¨ì€ ê´‘ê³  íšŸìˆ˜: <span id="adRemaining" style="color:#f59e0b; font-weight:700;">5íšŒ</span>
            </div>
        </div>

        <div class="recharge-divider">ë˜ëŠ” ë°”ë¡œ êµ¬ë§¤</div>

        <!-- êµ¬ë§¤ íŒ¨í‚¤ì§€ ì„¹ì…˜ -->
        <div class="purchase-section">
            <h3>ğŸ›’ TL êµ¬ë§¤ íŒ¨í‚¤ì§€</h3>
            <div class="packages-grid">
                <div class="package-card" onclick="App.purchaseTL(1000, 1000)">
                    <div class="pkg-tl">1,000 TL</div>
                    <div class="pkg-price">â‚©1,000</div>
                    <div class="pkg-per">1 TL = â‚©1</div>
                </div>
                <div class="package-card popular" onclick="App.purchaseTL(5500, 5000)">
                    <div class="popular-badge">ğŸ”¥ ì¸ê¸°</div>
                    <div class="pkg-tl">5,500 TL</div>
                    <div class="pkg-bonus">+500 TL ë³´ë„ˆìŠ¤!</div>
                    <div class="pkg-price">â‚©5,000</div>
                    <div class="pkg-per">10% ì¶”ê°€ ì¦ì •</div>
                </div>
                <div class="package-card" onclick="App.purchaseTL(12000, 10000)">
                    <div class="pkg-tl">12,000 TL</div>
                    <div class="pkg-bonus">+2,000 TL ë³´ë„ˆìŠ¤!</div>
                    <div class="pkg-price">â‚©10,000</div>
                    <div class="pkg-per">20% ì¶”ê°€ ì¦ì •</div>
                </div>
                <div class="package-card" onclick="App.purchaseTL(30000, 20000)">
                    <div class="pkg-tl">30,000 TL</div>
                    <div class="pkg-bonus">+10,000 TL ë³´ë„ˆìŠ¤!</div>
                    <div class="pkg-price">â‚©20,000</div>
                    <div class="pkg-per">50% ì¶”ê°€ ì¦ì •</div>
                </div>
                <div class="package-card" onclick="App.purchaseTL(60000, 30000)" style="grid-column:span 2;">
                    <div class="pkg-tl" style="font-size:2rem;">60,000 TL</div>
                    <div class="pkg-bonus">+30,000 TL ë³´ë„ˆìŠ¤! ğŸ</div>
                    <div class="pkg-price">â‚©30,000</div>
                    <div class="pkg-per">100% ì¶”ê°€ ì¦ì • â€” ìµœê³  í˜œíƒ</div>
                </div>
            </div>
            <div style="margin-top:12px; font-size:11px; color:#666; text-align:center; line-height:1.6;">
                ğŸ’³ ì¹´ë“œ/ê³„ì¢Œì´ì²´/ì¹´ì¹´ì˜¤í˜ì´ ê²°ì œ ì§€ì› (ë°ëª¨: ì¦‰ì‹œ ì§€ê¸‰)<br>
                êµ¬ë§¤í•œ TLì€ ë§Œë£Œ ì—†ì´ ì˜êµ¬ ë³´ê´€ë©ë‹ˆë‹¤
            </div>
        </div>

        <button onclick="App.closeRechargeModal()" style="width:100%; margin-top:20px; padding:14px; background:rgba(255,255,255,0.05); border:1px solid rgba(255,255,255,0.1); border-radius:12px; color:#999; font-weight:600; cursor:pointer; font-size:14px;">
            ë‹«ê¸°
        </button>
    </div>
</div>

<div class="container">

    <!-- ì €TL ê²½ê³  ë°°ë„ˆ -->
    <div id="lowTlBanner" style="display:none; background:linear-gradient(135deg,rgba(245,158,11,0.15),rgba(239,68,68,0.08)); border:1px solid rgba(245,158,11,0.4); border-radius:16px; padding:16px 24px; margin-bottom:20px; align-items:center; gap:16px;">
        <div style="font-size:1.5rem;">âš ï¸</div>
        <div style="flex:1;">
            <strong style="color:#f59e0b; display:block;">TL ì”ì•¡ì´ ë¶€ì¡±í•©ë‹ˆë‹¤!</strong>
            <span style="font-size:13px; color:#999;">ê´‘ê³  ì‹œì²­ì´ë‚˜ TL êµ¬ë§¤ë¥¼ í†µí•´ ì¶©ì „í•˜ì„¸ìš”</span>
        </div>
        <button class="recharge-btn" onclick="App.openRechargeModal('low')">
            ğŸ’° ì§€ê¸ˆ ì¶©ì „
        </button>
    </div>

    <div class="header">
        <h1>â° TimeLink</h1>
        <div class="user-info">
            <div class="balances">
                <div class="balance" id="tlBalance" onclick="App.openRechargeModal('header')" title="í´ë¦­í•˜ì—¬ TL ì¶©ì „">
                    <div class="lbl">ğŸ’° TL <span style="font-size:9px; opacity:0.6;">ì¶©ì „ â–²</span></div>
                    <div class="amt" id="walletTL">10,000</div>
                </div>
                <div class="balance">
                    <div class="lbl">ğŸª™ TLC</div>
                    <div class="amt" id="walletTLC">0.00</div>
                </div>
            </div>
            <button class="recharge-btn" onclick="App.openRechargeModal('header')">
                ğŸ’° TL ì¶©ì „
            </button>
            <div class="user-name">ğŸ‘¤ <span id="userName">User</span></div>
            <button class="logout-btn" onclick="App.resetDatabase()" style="background:rgba(255,165,0,0.2); color:#ffa500; border-color:rgba(255,165,0,0.3);">ğŸ”„ ë¦¬ì…‹</button>
            <button class="logout-btn" onclick="Auth.logout()">ë¡œê·¸ì•„ì›ƒ</button>
        </div>
    </div>

    <div class="tabs">
        <button class="tab active" onclick="App.switchTab('dashboard', event)">ğŸ“Š Dashboard</button>
        <button class="tab" onclick="App.switchTab('create', event)">ğŸ“¤ Create</button>
        <button class="tab" onclick="App.switchTab('myfiles', event)">ğŸµ My Files</button>
        <button class="tab" onclick="App.switchTab('share', event)">ğŸ”„ Share Place</button>
        <button class="tab" onclick="App.switchTab('cafe', event)">â˜• Cafe</button>
        <button class="tab" onclick="App.switchTab('car', event)">ğŸš—ğŸš¶ Car & Walk</button>
        <button class="tab" onclick="App.switchTab('mining', event)">â›ï¸ Mining</button>
        <button class="tab" onclick="App.switchTab('lecture', event)">ğŸ“š Lecture</button>
        <button class="tab" onclick="App.switchTab('gold', event)">ğŸ† Gold</button>
        <button class="tab" onclick="App.switchTab('ton', event)">â¬¡ TLC Wallet</button>
    </div>

    <!-- Dashboard -->
    <div id="tabDashboard" class="tab-content active">
        <div class="hero">
            <h1>â° TimeLink</h1>
            <p style="font-size:1.2rem; color:#999;">Time-Based Media Economy</p>
            <div class="media-showcase">
                <div class="featured-banner">
                    <span class="tag">LIVE FEATURED</span>
                    <div style="font-size:1.4rem; font-weight:800;">Tonight's Global Chill Session</div>
                    <div style="color:#d0d0d0; font-size:0.9rem; margin-top:4px;">Moonlight Synth Â· Coffee Lounge Â· Late Drive</div>
                </div>
                <div class="playlist-stack">
                    <div class="playlist-item" style="background-image:linear-gradient(120deg,rgba(0,0,0,.2),rgba(0,0,0,.65)),url('https://images.unsplash.com/photo-1511379938547-c1f69419868d?auto=format&fit=crop&w=1000&q=80');">AI DJ Picks Â· Rainy Cafe</div>
                    <div class="playlist-item" style="background-image:linear-gradient(120deg,rgba(0,0,0,.2),rgba(0,0,0,.65)),url('https://images.unsplash.com/photo-1459749411175-04bf5292ceea?auto=format&fit=crop&w=1000&q=80');">Creator Spotlight Â· Indie Seoul</div>
                    <div class="playlist-item" style="background-image:linear-gradient(120deg,rgba(0,0,0,.2),rgba(0,0,0,.65)),url('https://images.unsplash.com/photo-1470225620780-dba8ba36b745?auto=format&fit=crop&w=1000&q=80');">Drive Mode Â· Highway Energy</div>
                </div>
            </div>
        </div>

        <div class="card">
            <h2>ğŸš€ MVP ë¹ ë¥¸ ì‹¤í–‰</h2>
            <p style="color:#999; line-height:1.8;">ì§€ê¸ˆì€ í•µì‹¬ í”Œë¡œìš°(ì—…ë¡œë“œ â†’ ê³µìœ  â†’ ì²­ì·¨/ì±„êµ´) ê²€ì¦ì´ ìš°ì„ ì…ë‹ˆë‹¤.</p>
            <div class="mvp-grid">
                <div class="mvp-kpi"><div class="label">ì—…ë¡œë“œ íŒŒì¼</div><div class="value" id="mvpFileCount">0ê°œ</div></div>
                <div class="mvp-kpi"><div class="label">ê³µìœ  íŒŒì¼</div><div class="value" id="mvpSharedCount">0ê°œ</div></div>
                <div class="mvp-kpi"><div class="label">ëˆ„ì  TL ìˆ˜ìµ</div><div class="value" id="mvpTotalBalance">0 TL</div></div>
                <div class="mvp-kpi"><div class="label">ì±„êµ´ëœ TLC</div><div class="value" id="mvpMinedTlc">0.00 TLC</div></div>
            </div>
            <div class="quick-actions">
                <button class="btn btn-play" onclick="App.switchTab('create')">1) ì½˜í…ì¸  ì—…ë¡œë“œ</button>
                <button class="btn btn-share" onclick="App.switchTab('myfiles')">2) íŒŒì¼ ê³µìœ /ì¶©ì „</button>
                <button class="btn" style="background:#0ea5e9; color:white;" onclick="App.switchTab('share')">3) Share Place ì²­ì·¨</button>
                <button class="btn btn-charge" onclick="App.switchTab('mining')">4) TLC ì±„êµ´</button>
            </div>
        </div>

        <div class="card">
            <h2>ğŸ¯ TimeLinkë€?</h2>
            <p style="color:#999; line-height:1.8; margin-bottom:24px;">TimeLinkëŠ” ì‹œê°„ ê¸°ë°˜ ë¯¸ë””ì–´ ê²½ì œ í”Œë«í¼ì…ë‹ˆë‹¤.</p>
            <div class="feature-grid">
                <div class="feature-card"><div style="font-size:2.5rem;">ğŸ“¤</div><h3>Create</h3><p>MP3/MP4ë¥¼ TL3/TL4ë¡œ ë³€í™˜. Suno/Udio AI ìë™ ì¸ì¦.</p></div>
                <div class="feature-card"><div style="font-size:2.5rem;">ğŸµ</div><h3>My Files</h3><p>TL ì¶©ì „ í›„ ì¬ìƒ. ë³¸ì¸ íŒŒì¼ë„ ì²­ì·¨ ê°€ëŠ¥.</p></div>
                <div class="feature-card"><div style="font-size:2.5rem;">ğŸ”„</div><h3>Share Place</h3><p>AI DJ íë ˆì´ì…˜. ì²­ì·¨ì TL ì†Œë¹„ â†’ ì°½ì‘ì TL íšë“.</p></div>
                <div class="feature-card"><div style="font-size:2.5rem;">ğŸš—ğŸš¶</div><h3>Car & Walk</h3><p>ì´ë™ ì¤‘ ìŒì•… ì¬ìƒ = ìµœëŒ€ 2ë°° ë³´ìƒ.</p></div>
                <div class="feature-card"><div style="font-size:2.5rem;">â›ï¸</div><h3>Mining</h3><p>TLì˜ ìµœëŒ€ 50%ë¥¼ TLCë¡œ ì±„êµ´. ê¸°ì—¬ì§€ìˆ˜ ë³€ë™.</p></div>
                <div class="feature-card"><div style="font-size:2.5rem;">ğŸ†</div><h3>Gold Reserve</h3><p>í”Œë«í¼ ìˆ˜ìµ 10% â†’ ê¸ˆ êµ¬ë§¤ â†’ TLC ê°€ì¹˜ ìœ ì§€.</p></div>
            </div>
        </div>
    </div>

    <!-- Create -->
    <div id="tabCreate" class="tab-content">
        <div class="card">
            <h2>ğŸ“¤ Create TL3/TL4</h2>
            <div class="type-selector">
                <div class="type-card audio selected" id="audioCard" onclick="App.selectType('audio')">
                    <div style="font-size:3rem;">ğŸµ</div>
                    <h3>TL3 Audio</h3>
                    <div style="color:#1db954; font-weight:700; margin-top:10px;">1ì´ˆ = 1 TL</div>
                    <p style="color:#999; font-size:13px; margin-top:8px;">MP3, WAV, FLAC</p>
                </div>
                <div class="type-card video" id="videoCard" onclick="App.selectType('video')">
                    <div style="font-size:3rem;">ğŸ¬</div>
                    <h3>TL4 Video</h3>
                    <div style="color:#ff5500; font-weight:700; margin-top:10px;">1ì´ˆ = 2 TL</div>
                    <p style="color:#999; font-size:13px; margin-top:8px;">MP4, MOV, AVI</p>
                </div>
            </div>

            <div class="upload" onclick="document.getElementById('fileInput').click()">
                <div style="font-size:3.5rem; margin-bottom:16px;" id="uploadIcon">ğŸµ</div>
                <h3 id="uploadTitle">íŒŒì¼ ì„ íƒí•˜ê¸°</h3>
                <p style="color:#999; margin-top:8px;" id="uploadDesc">MP3, WAV, FLAC</p>
            </div>

            <div id="uploadForm" style="display:none;">
                <div class="file-info-panel" style="background:rgba(138,43,226,0.1); border:1px solid #8a2be2; border-radius:12px; padding:16px; margin-bottom:20px;">
                    <div style="display:flex; justify-content:space-between; margin-bottom:8px; color:#999;"><span>íŒŒì¼ëª…</span><span style="color:#fff; font-weight:600;" id="infoFileName">-</span></div>
                    <div style="display:flex; justify-content:space-between; margin-bottom:8px; color:#999;"><span>íŒŒì¼ í¬ê¸°</span><span style="color:#fff; font-weight:600;" id="infoFileSize">-</span></div>
                    <div style="display:flex; justify-content:space-between; margin-bottom:8px; color:#999;"><span>ì¬ìƒ ì‹œê°„</span><span style="color:#fff; font-weight:600;" id="infoDuration">ê³„ì‚° ì¤‘...</span></div>
                    <div style="display:flex; justify-content:space-between; margin-bottom:8px; color:#999;"><span>ë³€í™˜ ìœ í˜•</span><span style="color:#fff; font-weight:600;" id="infoType">TL3 (ì˜¤ë””ì˜¤)</span></div>
                    <div style="margin-top:12px; text-align:center;"><span style="background:#8a2be2; color:white; padding:4px 12px; border-radius:999px; font-size:12px; font-weight:600;" id="durationBadge">-</span></div>
                </div>

                <div class="form-group"><label>ğŸ“ ì œëª©</label><input type="text" id="fileTitle" placeholder="íŒŒì¼ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”"></div>
                <div class="form-group"><label>ğŸ¤ ì°½ì‘ì ì´ë¦„</label><input type="text" id="fileCreator" placeholder="ì°½ì‘ì ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”"></div>
                <div class="form-group">
                    <label>ğŸ¤– AI ì°½ì‘ íˆ´ (ì¸ì¦)</label>
                    <select id="creatorTool">
                        <option value="suno">ğŸµ Suno AI (ìë™ ì¸ì¦)</option>
                        <option value="udio">ğŸµ Udio AI (ìë™ ì¸ì¦)</option>
                        <option value="custom">ğŸ¹ ì§ì ‘ ì‘ê³¡ (ìˆ˜ë™ ê²€í† )</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>ğŸ¼ ì¥ë¥´</label>
                    <select id="fileGenre">
                        <option value="pop">ğŸ¤ Pop</option><option value="rock">ğŸ¸ Rock</option>
                        <option value="hiphop">ğŸ§ Hip Hop</option><option value="jazz">ğŸº Jazz</option>
                        <option value="classic">ğŸ» Classic</option><option value="edm">ğŸ’¿ EDM</option>
                        <option value="kpop">ğŸ‡°ğŸ‡· K-Pop</option><option value="indie">ğŸ¹ Indie</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>ğŸ˜Œ ëŠë‚Œ (AI DJ íë ˆì´ì…˜)</label>
                    <select id="fileMood">
                        <option value="energetic">ğŸ”¥ Energetic</option><option value="chill">ğŸ˜Œ Chill</option>
                        <option value="focus">ğŸ¯ Focus</option><option value="workout">ğŸ’ª Workout</option>
                        <option value="romantic">ğŸ’• Romantic</option><option value="sad">ğŸ˜¢ Sad</option>
                        <option value="happy">ğŸ˜Š Happy</option><option value="sleep">ğŸ˜´ Sleep</option>
                    </select>
                </div>
                <div class="form-group"><label>ğŸ“ ì„¤ëª…</label><textarea id="fileDesc" rows="3" placeholder="íŒŒì¼ì— ëŒ€í•œ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea></div>
                <div class="form-group">
                    <label>ğŸ’° ìˆ˜ìµ ê³„ì•½</label>
                    <select id="revenue">
                        <option value="55">5:5 (ì°½ì‘ì 50% / í”Œë«í¼ 50%)</option>
                        <option value="73">7:3 (ì°½ì‘ì 70% / í”Œë«í¼ 30%)</option>
                    </select>
                </div>
                <button class="btn btn-play" onclick="App.convert()" style="width:100%; padding:18px; font-size:1.1rem;">âœ¨ TL íŒŒì¼ë¡œ ë³€í™˜í•˜ê¸°</button>
            </div>
        </div>
    </div>

    <!-- My Files -->
    <div id="tabMyfiles" class="tab-content">
        <div class="card">
            <h2>ğŸµ My Files</h2>
            <div id="myFilesList" class="grid"></div>
        </div>
    </div>

    <!-- Share Place -->
    <div id="tabShare" class="tab-content">
        <div class="card">
            <h2>ğŸ”„ Share Place</h2>
            <div class="search-box">
                <span style="font-size:1.2rem;">ğŸ”</span>
                <input type="text" placeholder="ê²€ìƒ‰..." onkeyup="App.searchShare()">
            </div>
            <div class="genre-filter">
                <button class="genre-btn active" onclick="App.filterGenre('all')">ì „ì²´</button>
                <button class="genre-btn" onclick="App.filterGenre('pop')">ğŸ¤ Pop</button>
                <button class="genre-btn" onclick="App.filterGenre('rock')">ğŸ¸ Rock</button>
                <button class="genre-btn" onclick="App.filterGenre('hiphop')">ğŸ§ Hip Hop</button>
                <button class="genre-btn" onclick="App.filterGenre('jazz')">ğŸº Jazz</button>
                <button class="genre-btn" onclick="App.filterGenre('classic')">ğŸ» Classic</button>
                <button class="genre-btn" onclick="App.filterGenre('edm')">ğŸ’¿ EDM</button>
                <button class="genre-btn" onclick="App.filterGenre('kpop')">ğŸ‡°ğŸ‡· K-Pop</button>
                <button class="genre-btn" onclick="App.filterGenre('indie')">ğŸ¹ Indie</button>
            </div>
            <div id="sharePlaceContent"></div>
        </div>
    </div>

    <!-- Cafe Broadcasting -->
    <div id="tabCafe" class="tab-content">
        <div class="card">
            <h2>â˜• Cafe Broadcasting - AI DJ</h2>
            <p style="color:#999; margin-bottom:24px;">AI DJì—ê²Œ ì›í•˜ëŠ” ìŒì•… ë¶„ìœ„ê¸°ë¥¼ ë§í•´ë³´ì„¸ìš”</p>
            <div class="panel" style="background:rgba(138,43,226,0.1); border-color:#8a2be2;">
                <strong>ğŸ¤– AI DJì—ê²Œ ìš”ì²­í•˜ê¸°</strong><br>
                <div style="margin-top:12px;">
                    <textarea id="aiDjRequest" rows="3" placeholder="ì˜ˆì‹œ:&#10;- ì˜¤ëŠ˜ì€ ë¹„ ì˜¤ëŠ” ë‚  ë¶„ìœ„ê¸°ë¡œ ì¬ì¦ˆ ìŒì•… í‹€ì–´ì¤˜&#10;- í¬ë¦¬ìŠ¤ë§ˆìŠ¤ ëŠë‚Œì˜ ë”°ëœ»í•œ ìŒì•…&#10;- í™œê¸°ì°¬ ì•„ì¹¨ ìš´ë™í•  ë•Œ ë“£ê¸° ì¢‹ì€ ìŒì•…" style="width:100%; background:rgba(0,0,0,0.3); border:1px solid rgba(255,255,255,0.1); border-radius:8px; padding:12px; color:white; font-size:14px; resize:vertical;"></textarea>
                </div>
                <button class="btn btn-play" onclick="App.requestAiDj()" style="width:100%; margin-top:12px; padding:14px;">ğŸµ AI DJ íë ˆì´ì…˜ ì‹œì‘</button>
            </div>
            <div class="panel" style="margin-top:16px; background:rgba(101,67,33,0.1); border-color:#654321;">
                <strong>ğŸµ Now Playing</strong><br>
                <div style="font-size:1.3rem; font-weight:700; margin-top:8px; color:#8b5c2e;" id="cafeNowPlaying">AI DJ ëŒ€ê¸° ì¤‘...</div>
                <div style="color:#999; margin-top:4px; font-size:13px;" id="cafeCreator">-</div>
                <div style="margin-top:12px; padding-top:12px; border-top:1px solid rgba(255,255,255,0.05);">
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <span style="color:#999; font-size:13px;">AI íë ˆì´ì…˜</span>
                        <span style="font-weight:700; color:#8a2be2;" id="aiDjTheme">-</span>
                    </div>
                </div>
            </div>
            <div style="display:flex; gap:12px; margin-top:20px;">
                <button class="btn btn-play" onclick="App.startCafe()" style="flex:1; padding:16px;">â–¶ï¸ ì¬ìƒ</button>
                <button class="btn" onclick="App.skipCafeSong()" style="flex:1; background:#f59e0b; color:black; padding:16px;">â­ï¸ ë‹¤ìŒ ê³¡</button>
                <button class="btn" onclick="App.stopCafe()" style="flex:1; background:#f44; color:white; padding:16px;">â¹ï¸ ì •ì§€</button>
            </div>
        </div>
        <div class="card" style="margin-top:24px;">
            <h2>ğŸª ë“±ë¡ëœ ì¹´í˜ ê°¤ëŸ¬ë¦¬</h2>
            <div id="cafeGallery" style="display:grid; grid-template-columns:repeat(auto-fill,minmax(320px,1fr)); gap:20px;"></div>
        </div>
    </div>

    <!-- Car & Walk -->
    <div id="tabCar" class="tab-content">
        <div class="card">
            <h2>ğŸš—ğŸš¶ Car & Walk - ì´ë™ ì¤‘ AI DJ & 2ë°° ë³´ìƒ</h2>
            <div class="panel" style="background:rgba(59,130,246,0.1); border-color:#3b82f6;">
                <strong>ğŸƒ Movement AI ìƒíƒœ</strong><br>
                <div style="font-size:1.5rem; font-weight:800; margin-top:8px; color:#3b82f6;" id="movementStatus">ì •ì§€ ì¤‘</div>
                <div style="color:#999; font-size:13px; margin-top:4px;" id="movementType">-</div>
            </div>
            <div class="panel" style="margin-top:16px;">
                <strong>ğŸ’° í˜„ì¬ ë³´ìƒ ë°°ìœ¨</strong><br>
                <div style="font-size:2rem; font-weight:800; margin-top:8px;" id="rewardMultiplier">Ã—1.0</div>
            </div>
            <div class="panel" style="margin-top:16px;">
                <strong>ğŸµ í˜„ì¬ ì¬ìƒ ì¤‘</strong><br>
                <div style="font-size:1.2rem; font-weight:700; margin-top:8px;" id="carNowPlaying">ëŒ€ê¸° ì¤‘...</div>
                <div style="color:#999; margin-top:4px;" id="carCreator">-</div>
            </div>
            <div style="display:flex; gap:12px; margin-top:20px;">
                <button class="btn btn-play" onclick="App.startCarWalk()" style="flex:1; padding:18px;">ğŸš— ì´ë™ ëª¨ë“œ ì‹œì‘</button>
                <button class="btn" onclick="App.stopCarWalk()" style="flex:1; background:#f44; color:white; padding:18px;">â¹ï¸ ì •ì§€</button>
            </div>
        </div>
    </div>

    <!-- Mining -->
    <div id="tabMining" class="tab-content">
        <div class="card">
            <h2>â›ï¸ Mining</h2>
            <div class="panel"><strong>ê¸°ì—¬ ì§€ìˆ˜ (CI)</strong><br><span style="font-size:2rem; font-weight:800;" id="ciValue">1.00x</span></div>
            <div class="form-group">
                <label>ì±„êµ´í•  TL (ìµœëŒ€: <span id="miningMax">5000</span> TL)</label>
                <input type="number" id="miningAmount" value="100" min="1">
            </div>
            <button class="btn btn-play" onclick="App.mine()" style="width:100%; padding:18px;">â›ï¸ TLC ì±„êµ´ ì‹œì‘</button>
            <div style="margin-top:20px; color:#999; font-size:14px; line-height:1.6;">
                <p>â€¢ TLì˜ ìµœëŒ€ 50%ë¥¼ TLCë¡œ ì±„êµ´ ê°€ëŠ¥</p>
                <p>â€¢ 100 TL = 1 TLC Ã— CI (ê¸°ì—¬ì§€ìˆ˜)</p>
                <p>â€¢ í”Œë«í¼ ìˆ˜ìˆ˜ë£Œ 10% (ê¸ˆ êµ¬ë§¤ì— ì‚¬ìš©)</p>
            </div>
        </div>
    </div>

    <!-- Lecture -->
    <div id="tabLecture" class="tab-content">
        <div class="card">
            <h2>ğŸ“š Lecture - êµìœ¡ ì½˜í…ì¸ </h2>
            <div class="panel" style="background:rgba(168,85,247,0.1); border-color:#a855f7;">
                <strong>ğŸ“ í•™ìŠµ ì§„í–‰ë¥ </strong><br>
                <div style="margin-top:12px;">
                    <div style="background:rgba(255,255,255,0.1); height:24px; border-radius:12px; overflow:hidden;">
                        <div id="lectureProgress" style="background:linear-gradient(90deg,#a855f7,#ec4899); height:100%; width:0%; transition:width 0.3s;"></div>
                    </div>
                    <div style="text-align:center; margin-top:8px; font-weight:700;" id="lectureProgressText">0%</div>
                </div>
            </div>
            <div class="panel" style="margin-top:16px;"><strong>ğŸµ í˜„ì¬ ê°•ì˜</strong><br><div style="font-size:1.2rem; font-weight:700; margin-top:8px;" id="lectureNowPlaying">ê°•ì˜ ì„ íƒ ëŒ€ê¸° ì¤‘...</div><div style="color:#999; margin-top:4px;" id="lectureCreator">-</div></div>
            <div style="display:flex; gap:12px; margin-top:20px;">
                <button class="btn btn-play" onclick="App.startLecture()" style="flex:1; padding:18px;">ğŸ“š ê°•ì˜ ì‹œì‘</button>
                <button class="btn" onclick="App.stopLecture()" style="flex:1; background:#f44; color:white; padding:18px;">â¹ï¸ ì •ì§€</button>
            </div>
        </div>
    </div>

    <!-- Gold -->
    <div id="tabGold" class="tab-content">
        <div class="card">
            <h2>ğŸ† Gold Reserve</h2>
            <div class="panel" style="background:rgba(255,215,0,0.1); border-color:#ffd700;">
                <strong>ğŸ’° ë³´ìœ  ê¸ˆ</strong><br>
                <span style="font-size:2.5rem; font-weight:800; color:#ffd700;" id="goldAmount">0.0000 g</span>
            </div>
            <div style="margin-top:24px; display:flex; gap:12px; justify-content:center;">
                <button class="genre-btn" onclick="App.setGoldPeriod('day')" id="goldDay">ì¼ê°„</button>
                <button class="genre-btn active" onclick="App.setGoldPeriod('week')" id="goldWeek">ì£¼ê°„</button>
                <button class="genre-btn" onclick="App.setGoldPeriod('month')" id="goldMonth">ì›”ê°„</button>
                <button class="genre-btn" onclick="App.setGoldPeriod('year')" id="goldYear">ì—°ê°„</button>
            </div>
            <div style="margin-top:20px; background:rgba(0,0,0,0.3); padding:20px; border-radius:16px;">
                <canvas id="goldChart" width="600" height="300" style="max-width:100%;"></canvas>
            </div>
        </div>
    </div>

    <!-- TLC Wallet -->
    <div id="tabTon" class="tab-content">
        <div class="card">
            <h2>â›ï¸ Mining & TLC Wallet</h2>
            <div class="panel" style="background:rgba(138,43,226,0.1); border-color:#8a2be2;">
                <strong>ğŸ’ TLC ì§€ê°‘</strong><br>
                <div style="font-size:2.5rem; font-weight:800; color:#8a2be2; margin-top:8px;" id="tlcWalletAmount">0.00 TLC</div>
                <div style="color:#999; font-size:13px; margin-top:8px;">â‰ˆ $<span id="tlcUsdValue">0.00</span> USD</div>
            </div>
            <div style="margin-top:24px;">
                <h3 style="font-size:1.2rem; margin-bottom:16px;">â›ï¸ TLC ì±„êµ´</h3>
                <div class="panel"><strong>ê¸°ì—¬ ì§€ìˆ˜ (CI)</strong><br><span style="font-size:2rem; font-weight:800;" id="ciValueWallet">1.00x</span></div>
                <div class="form-group" style="margin-top:16px;">
                    <label>ì±„êµ´í•  TL (ìµœëŒ€: <span id="miningMaxWallet">5000</span> TL)</label>
                    <input type="number" id="miningAmountWallet" value="100" min="1">
                </div>
                <button class="btn btn-play" onclick="App.mineToWallet()" style="width:100%; padding:18px;">â›ï¸ TLC ì±„êµ´í•˜ê¸°</button>
            </div>
            <div style="margin-top:32px; padding-top:24px; border-top:1px solid rgba(255,255,255,0.1);">
                <h3 style="font-size:1.2rem; margin-bottom:16px;">â¬¡ TON ë¸”ë¡ì²´ì¸ ì „ì†¡</h3>
                <div class="form-group"><label>TON ì§€ê°‘ ì£¼ì†Œ</label><input type="text" id="tonWalletAddress" placeholder="UQxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"></div>
                <div class="form-group"><label>ì „ì†¡í•  TLC</label><input type="number" id="tonTransferAmount" placeholder="0.00" step="0.01" min="0.01"></div>
                <button class="btn" onclick="App.transferToTon()" style="width:100%; background:#0098ea; color:white; padding:18px;">â¬¡ TONìœ¼ë¡œ ì „ì†¡</button>
            </div>
            <div style="margin-top:32px; padding-top:24px; border-top:1px solid rgba(255,255,255,0.1);">
                <h3 style="font-size:1.2rem; margin-bottom:16px;">ğŸ“œ ê±°ë˜ ë‚´ì—­</h3>
                <div id="walletHistory" style="max-height:200px; overflow-y:auto;"><div style="text-align:center; padding:40px; color:#666;">ì•„ì§ ê±°ë˜ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤</div></div>
            </div>
        </div>
    </div>

</div>

</div>

<script>
// ==================== INDEXEDDB HELPER ====================
const DB = {
    dbName: 'TimeLinkDB',
    storeName: 'files',
    db: null,
    blobUrls: {},

    async reset() {
        if (this.db) { this.db.close(); this.db = null; }
        this.revokeAllBlobUrls();
        return new Promise((resolve, reject) => {
            const request = indexedDB.deleteDatabase(this.dbName);
            request.onsuccess = () => resolve();
            request.onerror = () => reject(request.error);
            request.onblocked = () => console.warn('IndexedDB ì‚­ì œê°€ ì°¨ë‹¨ë¨');
        });
    },

    async open() {
        return new Promise((resolve, reject) => {
            const request = indexedDB.open(this.dbName, 4);
            request.onerror = () => reject(request.error);
            request.onsuccess = () => { this.db = request.result; resolve(); };
            request.onupgradeneeded = (event) => {
                const db = event.target.result;
                if (db.objectStoreNames.contains(this.storeName)) db.deleteObjectStore(this.storeName);
                db.createObjectStore(this.storeName, { keyPath: 'id' });
            };
        });
    },

    async saveFile(fileData) {
        if (!this.db) await this.open();
        return new Promise((resolve, reject) => {
            const tx = this.db.transaction([this.storeName], 'readwrite');
            const request = tx.objectStore(this.storeName).put(fileData);
            request.onsuccess = () => resolve();
            request.onerror = () => reject(request.error);
        });
    },

    async getFile(id) {
        if (!this.db) await this.open();
        return new Promise((resolve, reject) => {
            const tx = this.db.transaction([this.storeName], 'readonly');
            const request = tx.objectStore(this.storeName).get(id);
            request.onsuccess = () => resolve(request.result);
            request.onerror = () => reject(request.error);
        });
    },

    async deleteFile(id) {
        if (!this.db) await this.open();
        if (this.blobUrls[id]) { URL.revokeObjectURL(this.blobUrls[id]); delete this.blobUrls[id]; }
        return new Promise((resolve, reject) => {
            const tx = this.db.transaction([this.storeName], 'readwrite');
            const request = tx.objectStore(this.storeName).delete(id);
            request.onsuccess = () => resolve();
            request.onerror = () => reject(request.error);
        });
    },

    async getBlobUrl(id, mimeType) {
        if (this.blobUrls[id]) return this.blobUrls[id];
        const fileData = await this.getFile(id);
        if (!fileData || !fileData.arrayBuffer) throw new Error('íŒŒì¼ ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.');
        const blob = new Blob([fileData.arrayBuffer], { type: mimeType });
        const blobUrl = URL.createObjectURL(blob);
        this.blobUrls[id] = blobUrl;
        return blobUrl;
    },

    revokeAllBlobUrls() {
        Object.values(this.blobUrls).forEach(url => URL.revokeObjectURL(url));
        this.blobUrls = {};
    }
};

// ==================== AUTH ====================
const Auth = {
    currentUser: null,

    async init() {
        try {
            await DB.open();
        } catch (error) {
            if (error.name === 'VersionError') { await DB.reset(); await DB.open(); }
            else throw error;
        }
        const savedUser = localStorage.getItem('timelink_current_user');
        if (savedUser) {
            this.currentUser = JSON.parse(savedUser);
            await App.loadUserData();
            this.showMainApp();
        } else {
            this.showLoginScreen();
        }
    },

    showLoginScreen() {
        document.getElementById('authScreen').style.display = 'flex';
        document.getElementById('mainApp').style.display = 'none';
    },

    showMainApp() {
        document.getElementById('authScreen').style.display = 'none';
        document.getElementById('mainApp').style.display = 'block';
        document.getElementById('userName').textContent = this.currentUser.name;
        App.updateAll();
    },

    toggleBusinessInfo() {
        const type = document.getElementById('accountType').value;
        document.getElementById('businessInfo').style.display = type === 'business' ? 'block' : 'none';
    },

    async register() {
        const name = document.getElementById('regName').value.trim();
        const email = document.getElementById('regEmail').value.trim().toLowerCase();
        const password = document.getElementById('regPassword').value;
        const accountType = document.getElementById('accountType').value;

        if (!name || !email || !password) return this.showAuthMessage('ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”', 'error');
        if (password.length < 6) return this.showAuthMessage('ë¹„ë°€ë²ˆí˜¸ëŠ” ìµœì†Œ 6ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤', 'error');

        const users = this.getAllUsers();
        if (users[email]) return this.showAuthMessage('ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì´ë©”ì¼ì…ë‹ˆë‹¤', 'error');

        // âœ… ì‹ ê·œ ê°€ì… ì‹œ 10,000 TL ì§€ê¸‰
        const newUser = {
            name, email, password,
            accountType: accountType || 'personal',
            createdAt: Date.now(),
            wallet: { tl: 10000, tlc: 0 },  // ê°€ì… ë³´ë„ˆìŠ¤ 10,000 TL
            files: [],
            gold: 0,
            adWatchedToday: 0,
            adLastDate: new Date().toDateString()
        };

        if (accountType === 'business') {
            newUser.cafeInfo = {
                name: document.getElementById('cafeName').value.trim() || '',
                location: document.getElementById('cafeLocation').value.trim() || '',
                description: document.getElementById('cafeDescription').value.trim() || '',
                image: document.getElementById('cafeImage').value.trim() || '',
                hours: document.getElementById('cafeHours').value.trim() || '',
                comments: []
            };
        }

        users[email] = newUser;
        localStorage.setItem('timelink_users', JSON.stringify(users));
        this.currentUser = newUser;
        localStorage.setItem('timelink_current_user', JSON.stringify(newUser));
        this.showMainApp();
        App.toast('ğŸ ê°€ì… ì™„ë£Œ! 10,000 TLì´ ì§€ê¸‰ë˜ì—ˆìŠµë‹ˆë‹¤!');
    },

    async login() {
        const email = document.getElementById('loginEmail').value.trim().toLowerCase();
        const password = document.getElementById('loginPassword').value;
        if (!email || !password) return this.showAuthMessage('ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”', 'error');

        const users = this.getAllUsers();
        const user = users[email];
        if (!user) return this.showAuthMessage('ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì´ë©”ì¼ì…ë‹ˆë‹¤', 'error');
        if (user.password !== password) return this.showAuthMessage('ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤', 'error');

        this.currentUser = user;
        localStorage.setItem('timelink_current_user', JSON.stringify(user));
        await App.loadUserData();
        this.showAuthMessage('âœ… ë¡œê·¸ì¸ ì„±ê³µ!', 'success');
        setTimeout(() => this.showMainApp(), 500);
    },

    async logout() {
        if (confirm('ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
            await this.saveUserData();
            try { await DB.reset(); } catch(e) {}
            await DB.open();
            localStorage.removeItem('timelink_current_user');
            this.currentUser = null;
            App.wallet = { tl: 0, tlc: 0 };
            App.files = [];
            App.gold = 0;
            this.showLoginScreen();
        }
    },

    getAllUsers() {
        const d = localStorage.getItem('timelink_users');
        return d ? JSON.parse(d) : {};
    },

    async saveUserData() {
        if (!this.currentUser) return;
        const users = this.getAllUsers();
        const userCopy = { ...this.currentUser };
        userCopy.files = App.files.map(f => { const { url, ...meta } = f; return meta; });
        userCopy.wallet = App.wallet;
        userCopy.gold = App.gold;
        userCopy.adWatchedToday = App.adWatchedToday;
        userCopy.adLastDate = App.adLastDate;
        users[this.currentUser.email] = userCopy;
        localStorage.setItem('timelink_users', JSON.stringify(users));
        localStorage.setItem('timelink_current_user', JSON.stringify(userCopy));
    },

    switchAuthMode(mode) {
        document.getElementById('loginForm').style.display = mode === 'login' ? 'block' : 'none';
        document.getElementById('registerForm').style.display = mode === 'register' ? 'block' : 'none';
    },

    showAuthMessage(msg, type) {
        const el = document.getElementById('authMessage');
        el.textContent = msg;
        el.style.display = 'block';
        el.style.background = type === 'success' ? 'rgba(29,185,84,0.2)' : 'rgba(255,68,68,0.2)';
        el.style.color = type === 'success' ? '#1db954' : '#ff4444';
        el.style.border = `1px solid ${type === 'success' ? '#1db954' : '#ff4444'}`;
        setTimeout(() => el.style.display = 'none', 3000);
    }
};

// ==================== MAIN APP ====================
const App = {
    wallet: { tl: 10000, tlc: 0 },
    files: [],
    gold: 0,
    goldHistory: [],
    goldPeriod: 'week',
    walletHistory: [],
    tlcPrice: 1.00,
    type: 'audio',
    selectedFile: null,
    selectedFileDuration: 0,
    chargeTarget: null,
    playInterval: null,
    currentFile: null,
    currentGenre: 'all',
    ci: 1.0,
    cafeActive: false,
    cafeMood: 'chill',
    cafeQueue: [],
    cafeIndex: 0,
    carWalkActive: false,
    movementMultiplier: 1.0,
    lectureActive: false,
    lectureProgress: 0,
    
    // ê´‘ê³  ê´€ë ¨
    adWatchedToday: 0,
    adLastDate: new Date().toDateString(),
    adMaxPerDay: 5,
    adWatching: false,
    adTimer: null,

    init() {
        const fileInput = document.getElementById('fileInput');
        fileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (!file) return;
            if (!file.type.startsWith('audio/') && !file.type.startsWith('video/')) {
                App.toast('ì˜¤ë””ì˜¤ ë˜ëŠ” ë¹„ë””ì˜¤ íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤');
                e.target.value = '';
                return;
            }
            App.selectedFile = file;
            document.getElementById('infoFileName').textContent = file.name;
            document.getElementById('infoFileSize').textContent = (file.size / 1024 / 1024).toFixed(2) + ' MB';
            document.getElementById('infoType').textContent = App.type === 'audio' ? 'TL3 (ì˜¤ë””ì˜¤)' : 'TL4 (ë¹„ë””ì˜¤)';
            document.getElementById('infoDuration').textContent = 'ê³„ì‚° ì¤‘...';
            document.getElementById('durationBadge').textContent = 'â±ï¸ ê³„ì‚° ì¤‘';

            if (file.type.startsWith('audio/')) {
                const audio = new Audio();
                audio.src = URL.createObjectURL(file);
                audio.onloadedmetadata = function() {
                    const d = Math.floor(audio.duration);
                    App.selectedFileDuration = d;
                    const m = Math.floor(d/60), s = d%60;
                    document.getElementById('infoDuration').textContent = `${m}:${s.toString().padStart(2,'0')} (${d}ì´ˆ)`;
                    document.getElementById('durationBadge').textContent = `â±ï¸ ${m}:${s.toString().padStart(2,'0')}`;
                    URL.revokeObjectURL(audio.src);
                };
                audio.onerror = () => { App.selectedFileDuration = 180; };
            } else if (file.type.startsWith('video/')) {
                const video = document.createElement('video');
                video.preload = 'metadata';
                video.src = URL.createObjectURL(file);
                video.onloadedmetadata = function() {
                    const d = Math.floor(video.duration);
                    App.selectedFileDuration = d;
                    const m = Math.floor(d/60), s = d%60;
                    document.getElementById('infoDuration').textContent = `${m}:${s.toString().padStart(2,'0')} (${d}ì´ˆ)`;
                    document.getElementById('durationBadge').textContent = `â±ï¸ ${m}:${s.toString().padStart(2,'0')}`;
                    URL.revokeObjectURL(video.src);
                };
                video.onerror = () => { App.selectedFileDuration = 180; };
            }

            document.getElementById('uploadForm').style.display = 'block';
            document.getElementById('fileTitle').value = file.name.replace(/\.[^/.]+$/, '');
            App.toast(`íŒŒì¼ ì„ íƒ ì™„ë£Œ: ${file.name}`);
        });

        setInterval(() => {
            App.ci = 1.0 + Math.random();
            const ciEl = document.getElementById('ciValue');
            if (ciEl) ciEl.textContent = App.ci.toFixed(2) + 'x';
            const ciWEl = document.getElementById('ciValueWallet');
            if (ciWEl) ciWEl.textContent = App.ci.toFixed(2) + 'x';
        }, 3000);

        setTimeout(() => App.drawGoldChart(), 1000);
        App.updateAll();
        
        // ë‚ ì§œ ë³€ê²½ ì‹œ ê´‘ê³  ì¹´ìš´íŠ¸ ë¦¬ì…‹
        App.checkAdDailyReset();
    },

    // ==================== ê´‘ê³  & êµ¬ë§¤ ì‹œìŠ¤í…œ ====================
    checkAdDailyReset() {
        const today = new Date().toDateString();
        if (this.adLastDate !== today) {
            this.adWatchedToday = 0;
            this.adLastDate = today;
        }
    },

    openRechargeModal(context) {
        this.checkAdDailyReset();
        const remaining = this.adMaxPerDay - this.adWatchedToday;
        
        document.getElementById('modalCurrentTL').textContent = this.wallet.tl.toLocaleString();
        document.getElementById('adRemaining').textContent = remaining + 'íšŒ';
        
        // ê´‘ê³  ë²„íŠ¼ ìƒíƒœ
        const adButtons = document.getElementById('adButtons');
        if (remaining <= 0) {
            adButtons.innerHTML = `<div style="width:100%; text-align:center; padding:14px; background:rgba(255,255,255,0.03); border-radius:12px; color:#666; font-size:14px;">ì˜¤ëŠ˜ ê´‘ê³  ì‹œì²­ íšŸìˆ˜ë¥¼ ëª¨ë‘ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤<br><span style="font-size:12px;">ë‚´ì¼ ë‹¤ì‹œ ì‹œì²­í•˜ì„¸ìš” (ë§¤ì¼ 5íšŒ ì´ˆê¸°í™”)</span></div>`;
        } else {
            adButtons.innerHTML = `
                <button class="btn" onclick="App.watchAd(15, 500)" style="flex:1; background:rgba(59,130,246,0.2); color:#60a5fa; border:1px solid rgba(59,130,246,0.4); padding:12px; font-size:13px;">â–¶ï¸ 15ì´ˆ â†’ +500 TL</button>
                <button class="btn" onclick="App.watchAd(30, 1500)" style="flex:1; background:rgba(59,130,246,0.4); color:#60a5fa; border:1px solid rgba(59,130,246,0.6); padding:12px; font-size:13px;">â–¶ï¸ 30ì´ˆ â†’ +1,500 TL â­</button>
                <button class="btn" onclick="App.watchAd(60, 3000)" style="flex:1; background:rgba(59,130,246,0.2); color:#60a5fa; border:1px solid rgba(59,130,246,0.4); padding:12px; font-size:13px;">â–¶ï¸ 60ì´ˆ â†’ +3,000 TL</button>
            `;
            adButtons.style.display = 'flex';
        }
        
        // ì§„í–‰ ì¤‘ì¸ ê´‘ê³  ì´ˆê¸°í™”
        document.getElementById('adProgressContainer').style.display = 'none';
        adButtons.style.display = remaining > 0 ? 'flex' : 'block';
        
        document.getElementById('tlRechargeModal').style.display = 'flex';
    },

    closeRechargeModal() {
        // ê´‘ê³  ì‹œì²­ ì¤‘ ì·¨ì†Œ
        if (this.adWatching) {
            clearInterval(this.adTimer);
            this.adWatching = false;
            document.getElementById('adProgressContainer').style.display = 'none';
            document.getElementById('adButtons').style.display = 'flex';
        }
        document.getElementById('tlRechargeModal').style.display = 'none';
    },

    watchAd(seconds, reward) {
        if (this.adWatching) return;
        this.checkAdDailyReset();
        
        const remaining = this.adMaxPerDay - this.adWatchedToday;
        if (remaining <= 0) {
            this.toast('ì˜¤ëŠ˜ ê´‘ê³  ì‹œì²­ íšŸìˆ˜ë¥¼ ëª¨ë‘ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤');
            return;
        }

        this.adWatching = true;
        
        // ê´‘ê³  ì½˜í…ì¸  ëœë¤ ì„¤ì •
        const adContents = [
            { brand: 'TimeLink Premium', tagline: 'í”„ë¦¬ë¯¸ì—„ ìŒì•…ì˜ ì„¸ê³„ë¡œ' },
            { brand: 'Suno AI Studio', tagline: 'AIë¡œ ë§Œë“œëŠ” ë‚˜ë§Œì˜ ìŒì•…' },
            { brand: 'TLC Exchange', tagline: 'TLC ì½”ì¸ ì§€ê¸ˆ ë°”ë¡œ íˆ¬ì' },
            { brand: 'K-Music NFT', tagline: 'í•œêµ­ ìŒì•…ì˜ ë¯¸ë˜ë¥¼ ì†Œìœ í•˜ì„¸ìš”' },
            { brand: 'AudioVerse Pro', tagline: 'ë¬´í•œí•œ ì‚¬ìš´ë“œ ìœ ë‹ˆë²„ìŠ¤' }
        ];
        const ad = adContents[Math.floor(Math.random() * adContents.length)];
        document.getElementById('adBrand').textContent = ad.brand;
        document.getElementById('adTagline').textContent = ad.tagline;

        // UI ì „í™˜
        document.getElementById('adButtons').style.display = 'none';
        const progressContainer = document.getElementById('adProgressContainer');
        progressContainer.style.display = 'block';
        
        let elapsed = 0;
        document.getElementById('adProgressFill').style.width = '0%';
        document.getElementById('adCountdown').textContent = seconds + 'ì´ˆ';
        document.getElementById('adProgressText').textContent = 'ê´‘ê³  ì‹œì²­ ì¤‘...';
        
        this.adTimer = setInterval(async () => {
            elapsed++;
            const pct = (elapsed / seconds) * 100;
            document.getElementById('adProgressFill').style.width = pct + '%';
            document.getElementById('adCountdown').textContent = (seconds - elapsed) + 'ì´ˆ';
            
            if (elapsed >= seconds) {
                clearInterval(this.adTimer);
                this.adWatching = false;
                this.adWatchedToday++;
                
                // ë³´ìƒ ì§€ê¸‰
                this.wallet.tl += reward;
                await Auth.saveUserData();
                this.updateAll();
                
                // UI ì—…ë°ì´íŠ¸
                document.getElementById('adProgressText').textContent = 'âœ… ê´‘ê³  ì‹œì²­ ì™„ë£Œ!';
                document.getElementById('adCountdown').textContent = '+' + reward.toLocaleString() + ' TL';
                document.getElementById('adSkipNotice').textContent = 'ğŸ‰ TLì´ ì§€ê¸‰ë˜ì—ˆìŠµë‹ˆë‹¤!';
                document.getElementById('adSkipNotice').style.color = '#22c55e';
                document.getElementById('modalCurrentTL').textContent = this.wallet.tl.toLocaleString();
                
                const newRemaining = this.adMaxPerDay - this.adWatchedToday;
                document.getElementById('adRemaining').textContent = newRemaining + 'íšŒ';
                
                this.toast(`ğŸ‰ ê´‘ê³  ì‹œì²­ ì™„ë£Œ! +${reward.toLocaleString()} TL íšë“!`);
                
                // 2ì´ˆ í›„ ë²„íŠ¼ ë³µì›
                setTimeout(() => {
                    progressContainer.style.display = 'none';
                    document.getElementById('adSkipNotice').style.color = '#666';
                    document.getElementById('adSkipNotice').textContent = 'âš ï¸ ê´‘ê³ ê°€ ëë‚  ë•Œê¹Œì§€ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”';
                    
                    if (newRemaining <= 0) {
                        document.getElementById('adButtons').innerHTML = `<div style="width:100%; text-align:center; padding:14px; background:rgba(255,255,255,0.03); border-radius:12px; color:#666; font-size:14px;">ì˜¤ëŠ˜ ê´‘ê³  ì‹œì²­ íšŸìˆ˜ë¥¼ ëª¨ë‘ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤<br><span style="font-size:12px;">ë‚´ì¼ ë‹¤ì‹œ ì‹œì²­í•˜ì„¸ìš”</span></div>`;
                        document.getElementById('adButtons').style.display = 'block';
                    } else {
                        document.getElementById('adButtons').innerHTML = `
                            <button class="btn" onclick="App.watchAd(15, 500)" style="flex:1; background:rgba(59,130,246,0.2); color:#60a5fa; border:1px solid rgba(59,130,246,0.4); padding:12px; font-size:13px;">â–¶ï¸ 15ì´ˆ â†’ +500 TL</button>
                            <button class="btn" onclick="App.watchAd(30, 1500)" style="flex:1; background:rgba(59,130,246,0.4); color:#60a5fa; border:1px solid rgba(59,130,246,0.6); padding:12px; font-size:13px;">â–¶ï¸ 30ì´ˆ â†’ +1,500 TL â­</button>
                            <button class="btn" onclick="App.watchAd(60, 3000)" style="flex:1; background:rgba(59,130,246,0.2); color:#60a5fa; border:1px solid rgba(59,130,246,0.4); padding:12px; font-size:13px;">â–¶ï¸ 60ì´ˆ â†’ +3,000 TL</button>
                        `;
                        document.getElementById('adButtons').style.display = 'flex';
                    }
                }, 2000);
            }
        }, 1000);
    },

    async purchaseTL(tlAmount, price) {
        // ë°ëª¨: ì‹¤ì œ ê²°ì œ ì—†ì´ ì¦‰ì‹œ TL ì§€ê¸‰
        const confirmMsg = `${tlAmount.toLocaleString()} TLë¥¼ â‚©${price.toLocaleString()}ì— êµ¬ë§¤í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\n(ë°ëª¨ ëª¨ë“œ: ì¦‰ì‹œ ì§€ê¸‰ë©ë‹ˆë‹¤)`;
        if (!confirm(confirmMsg)) return;
        
        this.wallet.tl += tlAmount;
        await Auth.saveUserData();
        this.updateAll();
        
        document.getElementById('modalCurrentTL').textContent = this.wallet.tl.toLocaleString();
        
        this.toast(`âœ… ${tlAmount.toLocaleString()} TL êµ¬ë§¤ ì™„ë£Œ! (â‚©${price.toLocaleString()})`);
        
        // 3ì´ˆ í›„ ëª¨ë‹¬ ë‹«ê¸°
        setTimeout(() => this.closeRechargeModal(), 2500);
    },

    // TL ë¶€ì¡± ì‹œ ìë™ ëª¨ë‹¬ í‘œì‹œ
    checkTlAndPrompt(needed = 1) {
        if (this.wallet.tl < needed) {
            this.openRechargeModal('insufficient');
            return false;
        }
        return true;
    },

    // TL ì”ì•¡ ìƒíƒœ ì—…ë°ì´íŠ¸
    updateTlStatus() {
        const tlBalanceEl = document.getElementById('tlBalance');
        const lowBanner = document.getElementById('lowTlBanner');
        
        if (this.wallet.tl === 0) {
            tlBalanceEl.classList.add('low');
            lowBanner.style.display = 'flex';
        } else if (this.wallet.tl < 500) {
            tlBalanceEl.classList.add('low');
            lowBanner.style.display = 'flex';
        } else {
            tlBalanceEl.classList.remove('low');
            lowBanner.style.display = 'none';
        }
    },

    // ==================== ê¸°ì¡´ ê¸°ëŠ¥ ====================
    async loadUserData() {
        if (!Auth.currentUser) return;
        this.wallet = Auth.currentUser.wallet || { tl: 10000, tlc: 0 };
        this.gold = Auth.currentUser.gold || 0;
        this.adWatchedToday = Auth.currentUser.adWatchedToday || 0;
        this.adLastDate = Auth.currentUser.adLastDate || new Date().toDateString();
        this.checkAdDailyReset();
        this.files = [...(Auth.currentUser.files || [])];
        this.updateAll();
    },

    selectType(type) {
        this.type = type;
        document.getElementById('audioCard').classList.toggle('selected', type === 'audio');
        document.getElementById('videoCard').classList.toggle('selected', type === 'video');
        const icons = { audio: 'ğŸµ', video: 'ğŸ¬' };
        document.getElementById('uploadIcon').textContent = icons[type];
        document.getElementById('uploadTitle').textContent = type === 'audio' ? 'íŒŒì¼ ì„ íƒí•˜ê¸°' : 'ë¹„ë””ì˜¤ ì„ íƒí•˜ê¸°';
        document.getElementById('uploadDesc').textContent = type === 'audio' ? 'MP3, WAV, FLAC' : 'MP4, MOV, AVI';
        document.getElementById('fileInput').accept = type === 'audio' ? 'audio/*' : 'video/*';
    },

    async convert() {
        if (!this.selectedFile) return this.toast('íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”');
        const title = document.getElementById('fileTitle').value.trim();
        const creator = document.getElementById('fileCreator').value.trim();
        const tool = document.getElementById('creatorTool').value;
        const genre = document.getElementById('fileGenre').value;
        const mood = document.getElementById('fileMood').value;
        const desc = document.getElementById('fileDesc').value;
        const revenue = document.getElementById('revenue').value;
        if (!title) return this.toast('ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”');
        if (!creator) return this.toast('ì°½ì‘ì ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”');
        const isVideo = this.selectedFile.type.startsWith('video');
        const isAudio = this.selectedFile.type.startsWith('audio');
        if (!isVideo && !isAudio) return this.toast('ì˜¤ë””ì˜¤ ë˜ëŠ” ë¹„ë””ì˜¤ íŒŒì¼ë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤');
        const fileSizeMB = (this.selectedFile.size / 1024 / 1024).toFixed(1);
        const certified = tool === 'suno' || tool === 'udio';
        this.toast('â³ íŒŒì¼ ë³€í™˜ ì¤‘...');
        const reader = new FileReader();
        reader.onload = async (e) => {
            try {
                const arrayBuffer = e.target.result;
                const newFile = {
                    id: Date.now(), title, creator, tool, genre, mood, desc,
                    type: isVideo ? 'TL4' : 'TL3',
                    fileType: isVideo ? 'video' : 'audio',
                    mimeType: this.selectedFile.type,
                    certified, revenue, balance: 0,
                    duration: this.selectedFileDuration || 0,
                    fileSizeMB, shared: false,
                    createdAt: new Date().toISOString()
                };
                await DB.saveFile({ id: newFile.id, arrayBuffer, mimeType: this.selectedFile.type });
                this.files.push(newFile);
                await Auth.saveUserData();
                this.toast(`âœ… ${newFile.type} ë³€í™˜ ì™„ë£Œ!` + (certified ? ' (ìë™ ì¸ì¦)' : ''));
                document.getElementById('uploadForm').style.display = 'none';
                document.getElementById('fileInput').value = '';
                this.selectedFile = null;
                this.selectedFileDuration = 0;
                this.switchTab('myfiles');
                this.updateAll();
            } catch (error) {
                this.toast('íŒŒì¼ ë³€í™˜ ì¤‘ ì˜¤ë¥˜: ' + error.message);
            }
        };
        reader.onerror = () => this.toast('íŒŒì¼ ì½ê¸° ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤');
        reader.readAsArrayBuffer(this.selectedFile);
    },

    getCoverImage(file) {
        const byGenre = {
            pop: 'https://images.unsplash.com/photo-1501386761578-eac5c94b800a?auto=format&fit=crop&w=1200&q=80',
            rock: 'https://images.unsplash.com/photo-1498038432885-c6f3f1b912ee?auto=format&fit=crop&w=1200&q=80',
            hiphop: 'https://images.unsplash.com/photo-1571260899304-425eee4c7efc?auto=format&fit=crop&w=1200&q=80',
            jazz: 'https://images.unsplash.com/photo-1511192336575-5a79af67a629?auto=format&fit=crop&w=1200&q=80',
            classic: 'https://images.unsplash.com/photo-1465847899084-d164df4dedc6?auto=format&fit=crop&w=1200&q=80',
            edm: 'https://images.unsplash.com/photo-1574391884720-bbc7f31f3f8a?auto=format&fit=crop&w=1200&q=80',
            kpop: 'https://images.unsplash.com/photo-1619983081563-430f63602796?auto=format&fit=crop&w=1200&q=80',
            indie: 'https://images.unsplash.com/photo-1516280440614-37939bbacd81?auto=format&fit=crop&w=1200&q=80'
        };
        return byGenre[file.genre] || 'https://images.unsplash.com/photo-1493225457124-a3eb161ffa5f?auto=format&fit=crop&w=1200&q=80';
    },

    renderMyFiles() {
        const el = document.getElementById('myFilesList');
        if (this.files.length === 0) {
            el.innerHTML = '<div style="text-align:center;padding:60px;color:#666">ğŸ“ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤</div>';
            return;
        }
        const genreEmoji = {pop:'ğŸ¤',rock:'ğŸ¸',hiphop:'ğŸ§',jazz:'ğŸº',classic:'ğŸ»',edm:'ğŸ’¿',kpop:'ğŸ‡°ğŸ‡·',indie:'ğŸ¹'};
        const genreColor = {pop:'#ff6b6b',rock:'#4ecdc4',hiphop:'#ffd93d',jazz:'#a8e6cf',classic:'#b39eb5',edm:'#ff8a5c',kpop:'#ff1493',indie:'#9370db'};
        el.innerHTML = this.files.map(f => `
            <div class="file-card">
                <div class="thumb thumb-media ${f.fileType}" style="background-image:linear-gradient(130deg,rgba(0,0,0,0.2),rgba(0,0,0,0.65)),url('${this.getCoverImage(f)}');">
                    <div class="thumb-icon">${f.type==='TL4'?'ğŸ¬':'ğŸµ'}</div>
                    <span class="badge badge-type">${f.type}</span>
                    ${f.certified?'<span class="badge badge-cert">âœ“ ì¸ì¦</span>':''}
                    <span class="badge badge-genre" style="background:${genreColor[f.genre]||'#666'}">${genreEmoji[f.genre]||'ğŸµ'}</span>
                </div>
                <div class="info">
                    <div class="name">${f.title}</div>
                    <div class="creator">${f.creator} Â· ${f.tool}</div>
                    <div class="panel"><strong>â³ TL Balance</strong><br><span style="font-size:1.6rem;font-weight:800;">${f.balance.toLocaleString()}</span> TL</div>
                    <div class="actions">
                        ${f.balance > 0 ?
                            `<button class="btn btn-play" onclick="App.play(${f.id})">â–¶ï¸ ì¬ìƒ</button>` :
                            `<button class="btn btn-charge" onclick="App.openRechargeModal('noBalance')" style="background:#ef4444; color:white;">âš ï¸ TL ì¶©ì „ í•„ìš”</button>`
                        }
                        <button class="btn btn-charge" onclick="App.openCharge(${f.id})">ğŸ’° íŒŒì¼ ì¶©ì „</button>
                        ${!f.shared?
                            `<button class="btn btn-share" onclick="App.share(${f.id})">ğŸ”„ ê³µìœ </button>`:
                            `<button class="btn" style="background:#555;color:#999;" disabled>âœ“ ê³µìœ ë¨</button>`
                        }
                    </div>
                </div>
            </div>
        `).join('');
    },

    renderSharePlace() {
        const el = document.getElementById('sharePlaceContent');
        const sharedFiles = this.files.filter(f => f.shared);
        if (sharedFiles.length === 0) {
            el.innerHTML = '<div style="text-align:center;padding:60px;color:#666">ğŸ”„ ê³µìœ ëœ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤</div>';
            return;
        }
        let filtered = sharedFiles;
        if (this.currentGenre !== 'all') filtered = filtered.filter(f => f.genre === this.currentGenre);
        const moods = { energetic:'ğŸ”¥ Energetic', chill:'ğŸ˜Œ Chill', focus:'ğŸ¯ Focus', workout:'ğŸ’ª Workout', romantic:'ğŸ’• Romantic', sad:'ğŸ˜¢ Sad', happy:'ğŸ˜Š Happy', sleep:'ğŸ˜´ Sleep' };
        const genreEmoji = {pop:'ğŸ¤',rock:'ğŸ¸',hiphop:'ğŸ§',jazz:'ğŸº',classic:'ğŸ»',edm:'ğŸ’¿',kpop:'ğŸ‡°ğŸ‡·',indie:'ğŸ¹'};
        const genreColor = {pop:'#ff6b6b',rock:'#4ecdc4',hiphop:'#ffd93d',jazz:'#a8e6cf',classic:'#b39eb5',edm:'#ff8a5c',kpop:'#ff1493',indie:'#9370db'};
        let html = '';
        Object.keys(moods).forEach(mood => {
            const moodFiles = filtered.filter(f => f.mood === mood);
            if (moodFiles.length === 0) return;
            html += `<div style="margin-bottom:40px;"><h3 style="margin-bottom:20px;font-size:1.4rem;">${moods[mood]}</h3><div class="grid">${moodFiles.map(f => `
                <div class="file-card" onclick="App.listenShared(${f.id})">
                    <div class="thumb thumb-media ${f.fileType}" style="background-image:linear-gradient(130deg,rgba(0,0,0,0.2),rgba(0,0,0,0.65)),url('${this.getCoverImage(f)}');">
                        <div class="thumb-icon">${f.type==='TL4'?'ğŸ¬':'ğŸµ'}</div>
                        <span class="badge badge-type">${f.type}</span>
                        <span class="badge badge-genre" style="background:${genreColor[f.genre]||'#666'}">${genreEmoji[f.genre]||'ğŸµ'}</span>
                    </div>
                    <div class="info">
                        <div class="name">${f.title}</div>
                        <div class="creator">${f.creator}</div>
                        <div class="panel"><strong>ìˆ˜ìµ ê³„ì•½</strong><br>${f.revenue==='55'?'ì°½ì‘ì 50%':'ì°½ì‘ì 70%'}</div>
                        <button class="btn btn-play" onclick="event.stopPropagation();App.listenShared(${f.id})" style="width:100%;">ğŸ§ ì²­ì·¨ (1 TL/sec)</button>
                    </div>
                </div>
            `).join('')}</div></div>`;
        });
        el.innerHTML = html;
    },

    openCharge(id) {
        const file = this.files.find(f => f.id === id);
        if (!file) return this.toast('íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
        if (this.wallet.tl <= 0) {
            this.openRechargeModal('noTL');
            return;
        }
        this.chargeTarget = id;
        const chargeInput = document.getElementById('chargeAmount');
        chargeInput.value = Math.min(1000, this.wallet.tl);
        chargeInput.max = this.wallet.tl;
        document.getElementById('chargeModal').style.display = 'flex';
    },

    async executeCharge() {
        if (!this.chargeTarget) { this.closeModal(); return; }
        const file = this.files.find(f => f.id === this.chargeTarget);
        if (!file) { this.closeModal(); return; }
        let amt = parseInt(document.getElementById('chargeAmount').value);
        if (isNaN(amt) || amt <= 0) return this.toast('ì˜¬ë°”ë¥¸ ê¸ˆì•¡ì„ ì…ë ¥í•˜ì„¸ìš”');
        if (amt > this.wallet.tl) {
            this.toast(`TLì´ ë¶€ì¡±í•©ë‹ˆë‹¤. ì¶©ì „ì´ í•„ìš”í•©ë‹ˆë‹¤!`);
            this.closeModal();
            setTimeout(() => this.openRechargeModal('insufficient'), 300);
            return;
        }
        this.wallet.tl -= amt;
        file.balance += amt;
        await Auth.saveUserData();
        this.updateAll();
        this.closeModal();
        this.toast(`âœ… ${amt.toLocaleString()} TL ì¶©ì „ ì™„ë£Œ!`);
    },

    async play(id) {
        const file = this.files.find(f => f.id === id);
        if (!file) return this.toast('íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
        if (file.balance <= 0) return this.toast('TLì„ ì¶©ì „í•˜ì„¸ìš”');
        try {
            const fileData = await DB.getFile(file.id);
            if (!fileData || !fileData.arrayBuffer) throw new Error('íŒŒì¼ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.');
            const blobUrl = await DB.getBlobUrl(file.id, file.mimeType);
            this.currentFile = file;
            if (file.fileType === 'video') {
                const video = document.createElement('video');
                video.controls = true; video.autoplay = true;
                video.style.cssText = 'position:fixed;top:0;left:0;width:100%;height:100vh;z-index:10000;background:black;';
                video.src = blobUrl;
                const closeBtn = document.createElement('button');
                closeBtn.textContent = 'âœ• ë‹«ê¸°';
                closeBtn.style.cssText = 'position:fixed;top:20px;right:20px;z-index:10001;background:#f44;color:white;border:none;border-radius:8px;padding:12px 24px;font-size:16px;font-weight:700;cursor:pointer;';
                closeBtn.onclick = () => { this.stopPlay(); if(document.body.contains(video))document.body.removeChild(video); if(document.body.contains(closeBtn))document.body.removeChild(closeBtn); };
                document.body.appendChild(video); document.body.appendChild(closeBtn);
                if (this.playInterval) clearInterval(this.playInterval);
                this.playInterval = setInterval(async () => {
                    if (file.balance > 0) { file.balance -= 2; await Auth.saveUserData(); if (file.balance <= 0) { this.stopPlay(); if(document.body.contains(video))document.body.removeChild(video); if(document.body.contains(closeBtn))document.body.removeChild(closeBtn); this.toast('â¹ï¸ TL ì†Œì§„'); } }
                }, 1000);
            } else {
                const audio = document.getElementById('audioPlayer');
                const newAudio = audio.cloneNode(true); audio.parentNode.replaceChild(newAudio, audio);
                const freshAudio = document.getElementById('audioPlayer');
                freshAudio.src = blobUrl;
                document.getElementById('audioModal').style.display = 'flex';
                document.getElementById('playTitle').textContent = file.title;
                document.getElementById('playCreator').textContent = file.creator;
                document.getElementById('playTL').textContent = file.balance;
                let started = false;
                freshAudio.addEventListener('canplaythrough', function() { if(started)return; started=true; freshAudio.play().catch(e=>{ App.toast('ì¬ìƒ ì˜¤ë¥˜: '+e.message); App.stopPlay(); }); }, {once:true});
                freshAudio.addEventListener('error', function() { App.toast('ì˜¤ë””ì˜¤ ì˜¤ë¥˜'); App.stopPlay(); }, {once:true});
                freshAudio.load();
                if (this.playInterval) clearInterval(this.playInterval);
                this.playInterval = setInterval(async () => {
                    if (file.balance > 0 && !freshAudio.paused) {
                        file.balance -= 1;
                        document.getElementById('playTL').textContent = file.balance;
                        await Auth.saveUserData();
                        if (file.balance <= 0) { this.stopPlay(); this.toast('â¹ï¸ TL ì†Œì§„'); }
                    }
                }, 1000);
            }
        } catch (error) { this.toast('ì¬ìƒ ì¤€ë¹„ ì¤‘ ì˜¤ë¥˜: ' + error.message); }
    },

    async listenShared(id) {
        const file = this.files.find(f => f.id === id);
        if (!file) return this.toast('íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
        if (this.wallet.tl <= 0) {
            this.openRechargeModal('noTL');
            return;
        }
        try {
            const fileData = await DB.getFile(file.id);
            if (!fileData || !fileData.arrayBuffer) throw new Error('íŒŒì¼ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
            const blobUrl = await DB.getBlobUrl(file.id, file.mimeType);
            this.currentFile = file;
            const audio = document.getElementById('audioPlayer');
            const newAudio = audio.cloneNode(true); audio.parentNode.replaceChild(newAudio, audio);
            const freshAudio = document.getElementById('audioPlayer');
            freshAudio.src = blobUrl;
            document.getElementById('audioModal').style.display = 'flex';
            document.getElementById('playTitle').textContent = file.title;
            document.getElementById('playCreator').textContent = file.creator + ' (Share Place)';
            document.getElementById('playTL').textContent = this.wallet.tl;
            let started = false;
            freshAudio.addEventListener('canplaythrough', function() { if(started)return; started=true; freshAudio.play().catch(e=>{ App.toast('ì¬ìƒ ì˜¤ë¥˜: '+e.message); App.stopPlay(); }); }, {once:true});
            freshAudio.addEventListener('error', function() { App.toast('ì˜¤ë””ì˜¤ ë¡œë“œ ì˜¤ë¥˜'); App.stopPlay(); }, {once:true});
            freshAudio.load();
            if (this.playInterval) clearInterval(this.playInterval);
            this.playInterval = setInterval(async () => {
                if (this.wallet.tl > 0 && !freshAudio.paused) {
                    const cost = file.type === 'TL4' ? 2 : 1;
                    this.wallet.tl -= cost;
                    const creatorShare = file.revenue === '55' ? 0.5 : 0.7;
                    file.balance += cost * creatorShare;
                    this.gold += (cost * (1 - creatorShare) * 0.1) / 1000;
                    document.getElementById('playTL').textContent = this.wallet.tl;
                    await Auth.saveUserData();
                    this.updateTlStatus();
                    if (this.wallet.tl <= 0) {
                        this.stopPlay();
                        this.toast('â¹ï¸ TL ì†Œì§„!');
                        // ì†Œì§„ ì‹œ ìë™ìœ¼ë¡œ ì¶©ì „ ëª¨ë‹¬ í‘œì‹œ
                        setTimeout(() => this.openRechargeModal('depleted'), 500);
                    }
                }
            }, 1000);
        } catch (error) { this.toast('ì¬ìƒ ì¤€ë¹„ ì¤‘ ì˜¤ë¥˜: ' + error.message); }
    },

    stopPlay() {
        if (this.playInterval) clearInterval(this.playInterval);
        const audio = document.getElementById('audioPlayer');
        audio.pause(); audio.src = '';
        document.getElementById('audioModal').style.display = 'none';
        this.currentFile = null;
        Auth.saveUserData();
        this.updateAll();
    },

    async share(id) {
        const file = this.files.find(f => f.id === id);
        if (!file) return;
        if (!file.certified) return this.toast('ì¸ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤');
        file.shared = true;
        await Auth.saveUserData();
        this.toast(`ğŸ”„ ${file.title} Share Placeë¡œ ì´ë™!`);
        this.updateAll();
    },

    filterGenre(genre) {
        this.currentGenre = genre;
        document.querySelectorAll('.genre-btn').forEach(b => b.classList.remove('active'));
        event.target.classList.add('active');
        this.renderSharePlace();
    },

    searchShare() {},

    async mine() {
        const amt = parseInt(document.getElementById('miningAmount').value) || 100;
        const max = Math.floor(this.wallet.tl * 0.5);
        if (amt > max) return this.toast(`í•œë„ ì´ˆê³¼! ìµœëŒ€ ${max} TL`);
        if (this.wallet.tl < amt) { this.openRechargeModal('mine'); return; }
        const tlc = (amt * 0.01) * this.ci;
        this.wallet.tl -= amt;
        this.wallet.tlc += tlc;
        this.gold += (amt * 0.1 * 0.1) / 1000;
        await Auth.saveUserData();
        this.updateAll();
        this.toast(`â›ï¸ ${tlc.toFixed(2)} TLC ì±„êµ´!`);
    },

    async resetDatabase() {
        if (confirm('âš ï¸ ëª¨ë“  íŒŒì¼ ë°ì´í„°ê°€ ì‚­ì œë©ë‹ˆë‹¤. ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
            try {
                await DB.reset(); await DB.open();
                this.files = [];
                await Auth.saveUserData();
                this.updateAll();
                this.toast('âœ… ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™” ì™„ë£Œ!');
            } catch (error) { this.toast('ì˜¤ë¥˜: ' + error.message); }
        }
    },

    async startCafe() {
        const sharedFiles = this.files.filter(f => f.shared);
        if (sharedFiles.length === 0) return this.toast('ê³µìœ ëœ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤');
        if (this.wallet.tl <= 0) { this.openRechargeModal('cafe'); return; }
        this.cafeActive = true;
        this.cafeQueue = sharedFiles.sort(() => Math.random() - 0.5);
        this.cafeIndex = 0;
        this.toast('â˜• ì¹´í˜ ë°©ì†¡ ì‹œì‘!');
        await this.playNextCafe();
    },

    async playNextCafe() {
        if (!this.cafeActive || this.cafeQueue.length === 0) return;
        const file = this.cafeQueue[this.cafeIndex];
        document.getElementById('cafeNowPlaying').textContent = file.title;
        document.getElementById('cafeCreator').textContent = file.creator;
        await this.listenShared(file.id);
        const audio = document.getElementById('audioPlayer');
        audio.onended = () => {
            this.cafeIndex = (this.cafeIndex + 1) % this.cafeQueue.length;
            if (this.cafeActive) setTimeout(() => this.playNextCafe(), 1000);
        };
    },

    stopCafe() {
        this.cafeActive = false; this.stopPlay();
        document.getElementById('cafeNowPlaying').textContent = 'AI DJ ëŒ€ê¸° ì¤‘...';
        document.getElementById('cafeCreator').textContent = '-';
        this.toast('â˜• ì¹´í˜ ë°©ì†¡ ì •ì§€');
    },

    skipCafeSong() {
        if (!this.cafeActive) return;
        this.cafeIndex = (this.cafeIndex + 1) % this.cafeQueue.length;
        this.stopPlay();
        setTimeout(() => this.playNextCafe(), 500);
    },

    async startCarWalk() {
        const sharedFiles = this.files.filter(f => f.shared);
        if (sharedFiles.length === 0) return this.toast('ê³µìœ ëœ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤');
        if (this.wallet.tl <= 0) { this.openRechargeModal('car'); return; }
        this.carWalkActive = true;
        this.simulateMovement();
        this.toast('ğŸš— ì´ë™ ëª¨ë“œ ì‹œì‘!');
        await this.playCarWalkCycle();
    },

    simulateMovement() {
        setInterval(() => {
            if (!this.carWalkActive) return;
            const states = [
                { status: 'ğŸš¶ ê±·ëŠ” ì¤‘', multiplier: 1.5, type: 'ë„ë³´' },
                { status: 'ğŸƒ ë‹¬ë¦¬ëŠ” ì¤‘', multiplier: 1.7, type: 'ì¡°ê¹…' },
                { status: 'ğŸš— ì£¼í–‰ ì¤‘', multiplier: 2.0, type: 'ì°¨ëŸ‰' }
            ];
            const state = states[Math.floor(Math.random() * states.length)];
            this.movementMultiplier = state.multiplier;
            document.getElementById('movementStatus').textContent = state.status;
            document.getElementById('movementType').textContent = state.type;
            document.getElementById('rewardMultiplier').textContent = `Ã—${state.multiplier.toFixed(1)}`;
        }, 5000);
    },

    async playCarWalkCycle() {
        if (!this.carWalkActive) return;
        const sharedFiles = this.files.filter(f => f.shared);
        const file = sharedFiles[Math.floor(Math.random() * sharedFiles.length)];
        document.getElementById('carNowPlaying').textContent = file.title;
        document.getElementById('carCreator').textContent = file.creator;
        await this.listenShared(file.id);
        const audio = document.getElementById('audioPlayer');
        audio.onended = () => { if (this.carWalkActive) setTimeout(() => this.playCarWalkCycle(), 1000); };
    },

    stopCarWalk() {
        this.carWalkActive = false; this.stopPlay();
        document.getElementById('movementStatus').textContent = 'ì •ì§€ ì¤‘';
        document.getElementById('movementType').textContent = '-';
        document.getElementById('rewardMultiplier').textContent = 'Ã—1.0';
        document.getElementById('carNowPlaying').textContent = 'ëŒ€ê¸° ì¤‘...';
        document.getElementById('carCreator').textContent = '-';
        this.toast('ğŸš— ì´ë™ ëª¨ë“œ ì •ì§€');
    },

    async startLecture() {
        const sharedFiles = this.files.filter(f => f.shared);
        if (sharedFiles.length === 0) return this.toast('ê³µìœ ëœ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤');
        if (this.wallet.tl <= 0) { this.openRechargeModal('lecture'); return; }
        this.lectureActive = true;
        this.toast('ğŸ“š ê°•ì˜ ì‹œì‘!');
        await this.playLectureCycle();
    },

    async playLectureCycle() {
        if (!this.lectureActive) return;
        const sharedFiles = this.files.filter(f => f.shared);
        const file = sharedFiles[Math.floor(Math.random() * sharedFiles.length)];
        document.getElementById('lectureNowPlaying').textContent = file.title;
        document.getElementById('lectureCreator').textContent = file.creator;
        await this.listenShared(file.id);
        const audio = document.getElementById('audioPlayer');
        const pi = setInterval(() => {
            if (!audio.paused && audio.duration) {
                const pct = (audio.currentTime / audio.duration) * 100;
                document.getElementById('lectureProgress').style.width = pct + '%';
                document.getElementById('lectureProgressText').textContent = Math.floor(pct) + '%';
            }
        }, 1000);
        audio.onended = async () => {
            clearInterval(pi);
            this.wallet.tl += 100;
            await Auth.saveUserData();
            this.updateAll();
            this.toast('âœ… ê°•ì˜ ì™„ë£Œ! +100 TL ë³´ë„ˆìŠ¤');
            document.getElementById('lectureProgress').style.width = '0%';
            document.getElementById('lectureProgressText').textContent = '0%';
            if (this.lectureActive) setTimeout(() => this.playLectureCycle(), 2000);
        };
    },

    stopLecture() {
        this.lectureActive = false; this.stopPlay();
        document.getElementById('lectureProgress').style.width = '0%';
        document.getElementById('lectureProgressText').textContent = '0%';
        document.getElementById('lectureNowPlaying').textContent = 'ê°•ì˜ ì„ íƒ ëŒ€ê¸° ì¤‘...';
        document.getElementById('lectureCreator').textContent = '-';
        this.toast('ğŸ“š ê°•ì˜ ì •ì§€');
    },

    setGoldPeriod(period) {
        this.goldPeriod = period;
        document.querySelectorAll('#goldDay,#goldWeek,#goldMonth,#goldYear').forEach(b => b.classList.remove('active'));
        document.getElementById('gold' + period.charAt(0).toUpperCase() + period.slice(1)).classList.add('active');
        this.drawGoldChart();
    },

    drawGoldChart() {
        const canvas = document.getElementById('goldChart');
        if (!canvas) return;
        const ctx = canvas.getContext('2d');
        const width = canvas.width, height = canvas.height;
        ctx.clearRect(0, 0, width, height);
        let dataPoints = [], labels = [];
        const periods = { day: 24, week: 7, month: 30, year: 12 };
        const dayLabels = ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '];
        const n = periods[this.goldPeriod] || 7;
        for (let i = 0; i < n; i++) {
            dataPoints.push(this.gold * (0.5 + Math.random() * 0.5) * (i / n));
            if (this.goldPeriod === 'day') labels.push(i + ':00');
            else if (this.goldPeriod === 'week') labels.push(dayLabels[i]);
            else if (this.goldPeriod === 'month') labels.push(i+1 + 'ì¼');
            else labels.push(i+1 + 'ì›”');
        }
        const maxValue = Math.max(...dataPoints, 0.001);
        const padding = 50, chartWidth = width - padding*2, chartHeight = height - padding*2;
        ctx.strokeStyle = 'rgba(255,255,255,0.1)'; ctx.lineWidth = 1;
        for (let i = 0; i <= 5; i++) {
            const y = padding + (chartHeight/5) * i;
            ctx.beginPath(); ctx.moveTo(padding, y); ctx.lineTo(width-padding, y); ctx.stroke();
            ctx.fillStyle = '#999'; ctx.font = '12px sans-serif'; ctx.textAlign = 'right';
            ctx.fillText((maxValue*(1-i/5)).toFixed(4)+' g', padding-10, y+4);
        }
        ctx.strokeStyle = '#ffd700'; ctx.fillStyle = 'rgba(255,215,0,0.2)'; ctx.lineWidth = 3;
        ctx.beginPath();
        dataPoints.forEach((v, i) => {
            const x = padding + (chartWidth/(dataPoints.length-1)) * i;
            const y = height - padding - (v/maxValue) * chartHeight;
            i === 0 ? ctx.moveTo(x, y) : ctx.lineTo(x, y);
        });
        ctx.stroke();
        ctx.lineTo(width-padding, height-padding); ctx.lineTo(padding, height-padding); ctx.closePath(); ctx.fill();
        dataPoints.forEach((v, i) => {
            const x = padding + (chartWidth/(dataPoints.length-1)) * i;
            const y = height - padding - (v/maxValue) * chartHeight;
            ctx.fillStyle = '#ffd700'; ctx.beginPath(); ctx.arc(x, y, 5, 0, Math.PI*2); ctx.fill();
        });
        ctx.fillStyle = '#999'; ctx.font = '11px sans-serif'; ctx.textAlign = 'center';
        labels.forEach((l, i) => {
            if (i % Math.ceil(labels.length/8) === 0) {
                const x = padding + (chartWidth/(labels.length-1)) * i;
                ctx.fillText(l, x, height-padding+20);
            }
        });
    },

    async mineToWallet() {
        const amt = parseInt(document.getElementById('miningAmountWallet').value) || 100;
        const max = Math.floor(this.wallet.tl * 0.5);
        if (amt > max) return this.toast(`í•œë„ ì´ˆê³¼! ìµœëŒ€ ${max} TL`);
        if (this.wallet.tl < amt) { this.openRechargeModal('wallet'); return; }
        const tlc = (amt * 0.01) * this.ci;
        this.wallet.tl -= amt; this.wallet.tlc += tlc;
        this.gold += (amt * 0.1 * 0.1) / 1000;
        this.walletHistory.unshift({ type: 'mine', amount: tlc, timestamp: new Date().toISOString(), description: `TL â†’ TLC ì±„êµ´ (${amt} TL)` });
        await Auth.saveUserData();
        this.updateAll();
        this.updateWalletDisplay();
        this.toast(`â›ï¸ ${tlc.toFixed(2)} TLC ì±„êµ´ ì™„ë£Œ!`);
    },

    async transferToTon() {
        const address = document.getElementById('tonWalletAddress').value.trim();
        const amount = parseFloat(document.getElementById('tonTransferAmount').value) || 0;
        if (!address) return this.toast('TON ì§€ê°‘ ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”');
        if (amount <= 0) return this.toast('ì „ì†¡í•  ê¸ˆì•¡ì„ ì…ë ¥í•˜ì„¸ìš”');
        if (amount > this.wallet.tlc) return this.toast('TLC ì”ì•¡ì´ ë¶€ì¡±í•©ë‹ˆë‹¤');
        this.wallet.tlc -= amount;
        this.walletHistory.unshift({ type: 'transfer', amount: -amount, timestamp: new Date().toISOString(), description: `TON ì „ì†¡ (${address.substring(0,8)}...)` });
        await Auth.saveUserData();
        this.updateAll(); this.updateWalletDisplay();
        this.toast(`âœ… ${amount.toFixed(2)} TLCë¥¼ TONìœ¼ë¡œ ì „ì†¡í–ˆìŠµë‹ˆë‹¤`);
        document.getElementById('tonWalletAddress').value = '';
        document.getElementById('tonTransferAmount').value = '';
    },

    updateWalletDisplay() {
        document.getElementById('tlcWalletAmount').textContent = this.wallet.tlc.toFixed(2) + ' TLC';
        document.getElementById('tlcUsdValue').textContent = (this.wallet.tlc * this.tlcPrice).toFixed(2);
        document.getElementById('ciValueWallet').textContent = this.ci.toFixed(2) + 'x';
        document.getElementById('miningMaxWallet').textContent = Math.floor(this.wallet.tl * 0.5).toLocaleString();
        const historyEl = document.getElementById('walletHistory');
        if (this.walletHistory.length === 0) {
            historyEl.innerHTML = '<div style="text-align:center;padding:40px;color:#666;">ì•„ì§ ê±°ë˜ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤</div>';
        } else {
            historyEl.innerHTML = this.walletHistory.slice(0, 10).map(tx => {
                const date = new Date(tx.timestamp);
                const icon = tx.type === 'mine' ? 'â›ï¸' : 'â¬¡';
                const color = tx.amount > 0 ? '#22c55e' : '#ef4444';
                return `<div style="padding:12px;border-bottom:1px solid rgba(255,255,255,0.05);"><div style="display:flex;justify-content:space-between;align-items:center;"><div><div style="font-weight:600;">${icon} ${tx.description}</div><div style="font-size:11px;color:#999;">${date.toLocaleString()}</div></div><div style="font-weight:700;color:${color};">${tx.amount>0?'+':''}${tx.amount.toFixed(2)} TLC</div></div></div>`;
            }).join('');
        }
    },

    async requestAiDj() {
        const prompt = document.getElementById('aiDjRequest').value.trim();
        if (!prompt) return this.toast('AI DJì—ê²Œ ìš”ì²­í•  ë¶„ìœ„ê¸°ë¥¼ ì…ë ¥í•˜ì„¸ìš”');
        this.cafeActive = true;
        const playlist = this.analyzeAndCurate(prompt);
        if (playlist.length === 0) { this.cafeActive = false; return this.toast('ìš”ì²­í•˜ì‹  ë¶„ìœ„ê¸°ì— ë§ëŠ” ìŒì•…ì´ ì—†ìŠµë‹ˆë‹¤'); }
        this.cafeQueue = playlist; this.cafeIndex = 0;
        document.getElementById('aiDjTheme').textContent = this.extractTheme(prompt);
        this.toast(`ğŸ§ AI DJê°€ ${playlist.length}ê³¡ì„ ì„ ê³¡í–ˆìŠµë‹ˆë‹¤!`);
        await this.playNextCafe();
    },

    analyzeAndCurate(prompt) {
        const sharedFiles = this.files.filter(f => f.shared);
        const lower = prompt.toLowerCase();
        let filtered = [];
        if (lower.includes('ë¹„') || lower.includes('rain')) filtered = sharedFiles.filter(f => f.mood === 'chill' || f.mood === 'sad' || f.genre === 'jazz');
        else if (lower.includes('ì•„ì¹¨') || lower.includes('morning')) filtered = sharedFiles.filter(f => f.mood === 'energetic' || f.mood === 'happy');
        else if (lower.includes('ì €ë…') || lower.includes('ë°¤') || lower.includes('night')) filtered = sharedFiles.filter(f => f.mood === 'chill' || f.mood === 'sleep' || f.mood === 'romantic');
        else if (lower.includes('ìš´ë™') || lower.includes('workout')) filtered = sharedFiles.filter(f => f.mood === 'energetic' || f.mood === 'workout');
        else if (lower.includes('ê³µë¶€') || lower.includes('ì§‘ì¤‘')) filtered = sharedFiles.filter(f => f.mood === 'focus' || f.genre === 'classic');
        else if (lower.includes('ì¬ì¦ˆ') || lower.includes('jazz')) filtered = sharedFiles.filter(f => f.genre === 'jazz');
        else filtered = sharedFiles;
        if (filtered.length === 0) filtered = sharedFiles;
        return filtered.sort(() => Math.random() - 0.5);
    },

    extractTheme(prompt) {
        if (prompt.includes('ë¹„')) return 'ğŸŒ§ï¸ ë¹„ì˜¤ëŠ” ë‚ ';
        if (prompt.includes('ì•„ì¹¨')) return 'ğŸŒ… ìƒì¾Œí•œ ì•„ì¹¨';
        if (prompt.includes('ë°¤')) return 'ğŸŒ™ í¸ì•ˆí•œ ë°¤';
        if (prompt.includes('ìš´ë™')) return 'ğŸ’ª ìš´ë™ ëª¨ë“œ';
        if (prompt.includes('ê³µë¶€')) return 'ğŸ“š ì§‘ì¤‘ í•™ìŠµ';
        if (prompt.includes('ì¬ì¦ˆ')) return 'ğŸº ì¬ì¦ˆ ë¼ìš´ì§€';
        return 'ğŸµ AI íë ˆì´ì…˜';
    },

    renderCafeGallery() {
        const el = document.getElementById('cafeGallery');
        if (!el) return;
        let allUsers = [];
        try {
            const d = localStorage.getItem('timelink_users');
            if (d) { const p = JSON.parse(d); allUsers = typeof p === 'object' && !Array.isArray(p) ? Object.values(p) : (Array.isArray(p) ? p : []); }
        } catch(e) { allUsers = []; }
        const cafes = allUsers.filter(u => u.cafeInfo && u.cafeInfo.name);
        if (cafes.length === 0) {
            el.innerHTML = '<div style="text-align:center;padding:60px;color:#666;grid-column:1/-1;">ë“±ë¡ëœ ì¹´í˜ê°€ ì—†ìŠµë‹ˆë‹¤<br><div style="margin-top:12px;font-size:14px;">ì‚¬ì—…ì íšŒì›ìœ¼ë¡œ ê°€ì…í•˜ì—¬ ì¹´í˜ë¥¼ ë“±ë¡í•´ë³´ì„¸ìš”!</div></div>';
            return;
        }
        el.innerHTML = cafes.map(cafe => {
            const info = cafe.cafeInfo;
            const comments = info.comments || [];
            return `<div style="background:rgba(139,92,46,0.05);border:2px solid #8b5c2e;border-radius:16px;overflow:hidden;">
                <div style="position:relative;height:160px;background:linear-gradient(135deg,#8b5c2e,#654321);">
                    ${info.image ? `<img src="${info.image}" style="width:100%;height:100%;object-fit:cover;" onerror="this.style.display='none'">` : `<div style="display:flex;align-items:center;justify-content:center;height:100%;font-size:3rem;">â˜•</div>`}
                </div>
                <div style="padding:16px;">
                    <div style="font-size:1.2rem;font-weight:800;color:#8b5c2e;">${info.name}</div>
                    <div style="color:#999;font-size:13px;margin-bottom:8px;">ğŸ“ ${info.location || 'ìœ„ì¹˜ ë¯¸ë“±ë¡'}</div>
                    <button class="btn btn-play" onclick="App.listenCafe('${cafe.email}')" style="width:100%;padding:12px;font-size:13px;">ğŸ§ ë°©ì†¡ ë“£ê¸°</button>
                    <div style="margin-top:12px;">
                        <div style="font-weight:700;margin-bottom:8px;font-size:13px;">ğŸ’¬ ëŒ“ê¸€ (${comments.length})</div>
                        <div style="max-height:100px;overflow-y:auto;margin-bottom:8px;">${comments.length === 0 ? '<div style="text-align:center;color:#666;font-size:12px;padding:10px;">ì²« ëŒ“ê¸€ì„ ë‚¨ê²¨ë³´ì„¸ìš”!</div>' : comments.slice(-3).reverse().map(c=>`<div style="padding:6px;background:rgba(0,0,0,0.2);border-radius:6px;margin-bottom:4px;"><div style="font-size:11px;color:#8b5c2e;font-weight:600;">${c.user}</div><div style="font-size:12px;">${c.text}</div></div>`).join('')}</div>
                        <div style="display:flex;gap:6px;"><input type="text" id="comment_${cafe.email}" placeholder="ëŒ“ê¸€..." style="flex:1;background:rgba(0,0,0,0.3);border:1px solid rgba(255,255,255,0.1);border-radius:8px;padding:8px;color:white;font-size:12px;"><button class="btn" onclick="App.addCafeComment('${cafe.email}')" style="padding:8px 12px;font-size:12px;background:#8b5c2e;">ë“±ë¡</button></div>
                    </div>
                </div>
            </div>`;
        }).join('');
    },

    async addCafeComment(cafeEmail) {
        const inputEl = document.getElementById('comment_' + cafeEmail);
        if (!inputEl) return;
        const text = inputEl.value.trim();
        if (!text) return this.toast('ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”');
        let allUsers = {};
        try { const d = localStorage.getItem('timelink_users'); if (d) allUsers = JSON.parse(d); } catch(e) { return; }
        if (!allUsers[cafeEmail]) return;
        if (!allUsers[cafeEmail].cafeInfo) allUsers[cafeEmail].cafeInfo = {};
        if (!allUsers[cafeEmail].cafeInfo.comments) allUsers[cafeEmail].cafeInfo.comments = [];
        allUsers[cafeEmail].cafeInfo.comments.push({ user: Auth.currentUser.name, text, timestamp: new Date().toISOString() });
        localStorage.setItem('timelink_users', JSON.stringify(allUsers));
        inputEl.value = '';
        this.renderCafeGallery();
        this.toast('ğŸ’¬ ëŒ“ê¸€ ë“±ë¡ë¨');
    },

    async listenCafe(cafeEmail) {
        this.toast('â˜• ì¹´í˜ ë°©ì†¡ì„ ì‹œì‘í•©ë‹ˆë‹¤');
        const sharedFiles = this.files.filter(f => f.shared);
        if (sharedFiles.length > 0) await this.listenShared(sharedFiles[Math.floor(Math.random() * sharedFiles.length)].id);
    },

    switchTab(name, evt) {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        if (evt && evt.target) evt.target.classList.add('active');
        document.getElementById('tab' + name.charAt(0).toUpperCase() + name.slice(1)).classList.add('active');
        if (name === 'myfiles') this.renderMyFiles();
        if (name === 'share') this.renderSharePlace();
        if (name === 'mining') { const el = document.getElementById('miningMax'); if(el) el.textContent = Math.floor(this.wallet.tl * 0.5).toLocaleString(); }
    },

    closeModal() {
        document.getElementById('chargeModal').style.display = 'none';
        document.getElementById('audioModal').style.display = 'none';
        this.chargeTarget = null;
    },

    updateMvpDashboard() {
        const els = { mvpFileCount: this.files.length+'ê°œ', mvpSharedCount: this.files.filter(f=>f.shared).length+'ê°œ', mvpTotalBalance: this.files.reduce((s,f)=>s+(f.balance||0),0).toLocaleString()+' TL', mvpMinedTlc: this.wallet.tlc.toFixed(2)+' TLC' };
        Object.entries(els).forEach(([id, val]) => { const el = document.getElementById(id); if(el) el.textContent = val; });
    },

    updateAll() {
        document.getElementById('walletTL').textContent = this.wallet.tl.toLocaleString();
        document.getElementById('walletTLC').textContent = this.wallet.tlc.toFixed(2);
        const goldEl = document.getElementById('goldAmount');
        if (goldEl) goldEl.textContent = this.gold.toFixed(4) + ' g';
        this.renderMyFiles();
        this.renderSharePlace();
        this.renderCafeGallery();
        this.updateWalletDisplay();
        this.drawGoldChart();
        this.updateMvpDashboard();
        this.updateTlStatus();
    },

    toast(msg) {
        const t = document.getElementById('toast');
        t.textContent = msg;
        t.style.display = 'block';
        setTimeout(() => t.style.display = 'none', 3000);
    }
};

// ì´ˆê¸°í™”
(async () => {
    await Auth.init();
    App.init();
})();

window.addEventListener('click', (e) => {
    if (e.target.id === 'tlRechargeModal') App.closeRechargeModal();
    if (e.target.classList.contains('modal') && !e.target.id === 'tlRechargeModal') App.closeModal();
});

window.addEventListener('beforeunload', () => Auth.saveUserData());
</script>
</body>
</html>
