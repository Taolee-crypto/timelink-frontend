<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TimeLink â€” Time-Based Media Economy</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #0a0a0a; 
            color: #fff; 
            line-height: 1.6;
        }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        
        .header {
            background: linear-gradient(145deg, #1a0b2e, #1a1a1a);
            padding: 24px 32px;
            border-radius: 20px;
            margin-bottom: 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid rgba(138,43,226,0.3);
        }
        .header h1 {
            font-size: 2rem;
            background: linear-gradient(135deg, #b983ff, #8a2be2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .balances { display: flex; gap: 16px; }
        .balance {
            background: rgba(255,255,255,0.05);
            padding: 12px 20px;
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .balance .lbl { font-size: 10px; color: #999; text-transform: uppercase; }
        .balance .amt { font-size: 22px; font-weight: 800; }
        
        .tabs {
            background: rgba(17,17,17,0.8);
            border-radius: 999px;
            padding: 8px;
            display: flex;
            gap: 6px;
            margin-bottom: 28px;
            overflow-x: auto;
        }
        .tab {
            padding: 12px 24px;
            border-radius: 999px;
            border: none;
            background: transparent;
            color: #999;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.2s;
        }
        .tab:hover { background: rgba(255,255,255,0.05); color: white; }
        .tab.active { background: #8a2be2; color: white; }
        
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        
        .card {
            background: linear-gradient(145deg, #1a1a1a, #151515);
            border-radius: 20px;
            padding: 32px;
            margin-bottom: 28px;
            border: 1px solid rgba(255,255,255,0.08);
        }
        .card h2 { 
            font-size: 1.8rem; 
            margin-bottom: 24px;
            background: linear-gradient(135deg, #fff, #e0e0e0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(360px, 1fr)); gap: 24px; }
        
        .file-card {
            background: #1e1e1e;
            border-radius: 16px;
            overflow: hidden;
            border: 1px solid rgba(255,255,255,0.08);
            transition: all 0.3s;
        }
        .file-card:hover { transform: translateY(-6px); border-color: #8a2be2; }
        
        .thumb {
            height: 160px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3.5rem;
            background: linear-gradient(145deg, #2a1a3a, #1e1e1e);
            position: relative;
        }
        .thumb.video { background: linear-gradient(145deg, #ff7b00, #ff5500); }
        .thumb-media {
            background-size: cover;
            background-position: center;
            isolation: isolate;
        }
        .thumb-media::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(180deg, rgba(0,0,0,0.1), rgba(0,0,0,0.7));
            z-index: -1;
        }
        .thumb-icon {
            width: 66px;
            height: 66px;
            border-radius: 50%;
            background: rgba(0,0,0,0.55);
            backdrop-filter: blur(6px);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .badge {
            position: absolute;
            padding: 6px 14px;
            border-radius: 999px;
            font-size: 11px;
            font-weight: 700;
            color: white;
        }
        .badge-type { left: 12px; top: 12px; background: rgba(0,0,0,0.7); }
        .badge-cert { right: 12px; top: 12px; background: rgba(255,215,0,0.9); color: black; }
        .badge-genre { left: 12px; bottom: 12px; }
        
        .info { padding: 20px; }
        .name { font-size: 1.2rem; font-weight: 700; margin-bottom: 6px; }
        .creator { color: #999; font-size: 0.9rem; margin-bottom: 16px; }
        
        .panel {
            background: rgba(255,255,255,0.03);
            padding: 14px;
            border-radius: 12px;
            margin-bottom: 16px;
            font-size: 13px;
            border-left: 4px solid #8a2be2;
        }
        
        .actions { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .btn {
            padding: 12px;
            border: none;
            border-radius: 12px;
            font-weight: 700;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .btn:hover { transform: translateY(-2px); }
        .btn-play { background: #1db954; color: white; }
        .btn-charge { background: #f59e0b; color: black; }
        .btn-share { background: #8a2be2; color: white; grid-column: span 2; }
        .btn-disabled { background: #333; color: #666; cursor: not-allowed; }
        
        .form-group { margin-bottom: 20px; }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #999;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 14px 16px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            color: white;
            font-size: 14px;
            font-family: inherit;
        }
        
        .type-selector { display: flex; gap: 20px; margin-bottom: 28px; }
        .type-card {
            flex: 1;
            background: rgba(255,255,255,0.05);
            padding: 28px;
            border-radius: 20px;
            text-align: center;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s;
        }
        .type-card:hover { transform: translateY(-4px); }
        .type-card.selected { border-color: #1db954; background: rgba(29,185,84,0.1); }
        .type-card.video.selected { border-color: #ff5500; background: rgba(255,85,0,0.1); }
        
        .upload {
            border: 2px dashed #8a2be2;
            background: rgba(138,43,226,0.05);
            border-radius: 20px;
            padding: 50px;
            text-align: center;
            cursor: pointer;
            margin-bottom: 28px;
            transition: all 0.2s;
        }
        .upload:hover { background: rgba(138,43,226,0.1); transform: scale(1.01); }
        
        .modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.92);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        .modal-content {
            background: #1e1e1e;
            border-radius: 20px;
            padding: 36px;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .toast {
            position: fixed;
            top: 28px;
            right: 28px;
            background: #1e1e1e;
            padding: 16px 24px;
            border-radius: 999px;
            display: none;
            z-index: 3000;
            min-width: 320px;
            border-left: 6px solid #1db954;
            box-shadow: 0 4px 20px rgba(0,0,0,0.4);
        }
        
        .hero {
            background: linear-gradient(145deg, #2a1a3a, #1a1a1a);
            padding: 48px;
            border-radius: 24px;
            text-align: center;
            margin-bottom: 32px;
            border: 1px solid rgba(138,43,226,0.3);
        }
        .hero h1 {
            font-size: 3rem;
            margin-bottom: 16px;
            background: linear-gradient(135deg, #b983ff, #8a2be2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .media-showcase {
            display: grid;
            grid-template-columns: 1.2fr 1fr;
            gap: 18px;
            margin-top: 22px;
        }
        .featured-banner {
            min-height: 220px;
            border-radius: 18px;
            padding: 24px;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            background:
                linear-gradient(130deg, rgba(0,0,0,0.15), rgba(0,0,0,0.7)),
                url('https://images.unsplash.com/photo-1493225457124-a3eb161ffa5f?auto=format&fit=crop&w=1400&q=80') center/cover;
            border: 1px solid rgba(255,255,255,0.12);
        }
        .featured-banner .tag {
            display: inline-block;
            padding: 6px 12px;
            background: rgba(138,43,226,0.85);
            border-radius: 999px;
            font-size: 11px;
            font-weight: 700;
            margin-bottom: 10px;
            width: fit-content;
        }
        .playlist-stack {
            display: grid;
            gap: 12px;
        }
        .playlist-item {
            min-height: 67px;
            border-radius: 14px;
            padding: 14px;
            border: 1px solid rgba(255,255,255,0.12);
            background-size: cover;
            background-position: center;
            display: flex;
            align-items: end;
            font-weight: 700;
        }
        

        @media (max-width: 900px) {
            .media-showcase { grid-template-columns: 1fr; }
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
            margin-top: 32px;
        }
        .feature-card {
            background: rgba(255,255,255,0.03);
            padding: 24px;
            border-radius: 16px;
            border: 1px solid rgba(255,255,255,0.08);
        }
        .feature-card h3 { margin: 12px 0; font-size: 1.2rem; }
        .feature-card p { color: #999; font-size: 0.9rem; line-height: 1.6; }

        .mvp-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 14px;
            margin-top: 18px;
        }
        .mvp-kpi {
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.08);
            border-radius: 14px;
            padding: 14px;
        }
        .mvp-kpi .label { color: #999; font-size: 12px; margin-bottom: 8px; }
        .mvp-kpi .value { font-size: 1.5rem; font-weight: 800; }
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 12px;
            margin-top: 16px;
        }
        
        .search-box {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 999px;
            padding: 14px 24px;
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 24px;
        }
        .search-box input {
            flex: 1;
            background: transparent;
            border: none;
            color: white;
            font-size: 15px;
            outline: none;
        }
        
        .genre-filter {
            display: flex;
            gap: 10px;
            margin-bottom: 24px;
            flex-wrap: wrap;
        }
        .genre-btn {
            padding: 8px 18px;
            border-radius: 999px;
            border: 1px solid rgba(255,255,255,0.1);
            background: transparent;
            color: #999;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        .genre-btn:hover { border-color: #8a2be2; }
        .genre-btn.active { background: #8a2be2; color: white; border-color: #8a2be2; }
        
        /* Auth Screen */
        #authScreen {
            position: fixed;
            inset: 0;
            background: linear-gradient(145deg, #1a0b2e, #0a0a0a);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }
        .auth-container {
            background: linear-gradient(145deg, #1e1e1e, #151515);
            border-radius: 24px;
            padding: 48px;
            max-width: 480px;
            width: 90%;
            border: 1px solid rgba(138,43,226,0.3);
        }
        .auth-logo {
            text-align: center;
            margin-bottom: 40px;
        }
        .auth-logo h1 {
            font-size: 2.5rem;
            background: linear-gradient(135deg, #b983ff, #8a2be2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 8px;
        }
        .auth-form { margin-top: 32px; }
        .auth-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #8a2be2, #b983ff);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 12px;
        }
        .auth-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(138,43,226,0.4);
        }
        .auth-switch {
            text-align: center;
            margin-top: 24px;
            color: #999;
            font-size: 14px;
        }
        .auth-switch a {
            color: #8a2be2;
            text-decoration: none;
            font-weight: 600;
            cursor: pointer;
        }
        .auth-switch a:hover { text-decoration: underline; }
        .auth-message {
            display: none;
            padding: 14px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            font-size: 14px;
            font-weight: 600;
        }
        #mainApp { display: none; }
        .user-info {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        .user-name {
            background: rgba(255,255,255,0.05);
            padding: 10px 18px;
            border-radius: 999px;
            font-weight: 600;
        }
        .logout-btn {
            background: rgba(255,68,68,0.2);
            color: #ff4444;
            border: 1px solid rgba(255,68,68,0.3);
            padding: 10px 20px;
            border-radius: 999px;
            font-weight: 600;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s;
        }
        .logout-btn:hover { background: rgba(255,68,68,0.3); }
    </style>
</head>
<body>

<!-- Auth Screen -->
<div id="authScreen">
    <div class="auth-container">
        <div class="auth-logo">
            <h1>â° TimeLink</h1>
            <p style="color:#999;">Time-Based Media Economy</p>
        </div>
        
        <div class="auth-message" id="authMessage"></div>
        
        <!-- Login Form -->
        <div id="loginForm" class="auth-form">
            <div class="form-group">
                <label>ì´ë©”ì¼</label>
                <input type="email" id="loginEmail" placeholder="your@email.com">
            </div>
            <div class="form-group">
                <label>ë¹„ë°€ë²ˆí˜¸</label>
                <input type="password" id="loginPassword" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
            </div>
            <button class="auth-btn" onclick="Auth.login()">ë¡œê·¸ì¸</button>
            <div class="auth-switch">
                ê³„ì •ì´ ì—†ìœ¼ì‹ ê°€ìš”? <a onclick="Auth.switchAuthMode('register')">íšŒì›ê°€ì…</a>
            </div>
        </div>
        
        <!-- Register Form -->
        <div id="registerForm" class="auth-form" style="display:none;">
            <div class="form-group">
                <label>íšŒì› ìœ í˜•</label>
                <select id="accountType" style="margin-bottom:16px;">
                    <option value="personal">ğŸ‘¤ ì¼ë°˜ íšŒì›</option>
                    <option value="business">â˜• ì‚¬ì—…ì íšŒì› (ì¹´í˜ ìš´ì˜)</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>ì´ë¦„</label>
                <input type="text" id="regName" placeholder="í™ê¸¸ë™">
            </div>
            <div class="form-group">
                <label>ì´ë©”ì¼</label>
                <input type="email" id="regEmail" placeholder="your@email.com">
            </div>
            <div class="form-group">
                <label>ë¹„ë°€ë²ˆí˜¸</label>
                <input type="password" id="regPassword" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
            </div>
            
            <!-- ì‚¬ì—…ì ì¶”ê°€ ì •ë³´ -->
            <div id="businessInfo" style="display:none;">
                <div style="padding:16px; background:rgba(139,92,46,0.1); border:1px solid #8b5c2e; border-radius:12px; margin-bottom:16px;">
                    <div style="font-weight:700; margin-bottom:12px; color:#8b5c2e;">â˜• ì¹´í˜ ì •ë³´</div>
                    
                    <div class="form-group">
                        <label>ì¹´í˜ ì´ë¦„</label>
                        <input type="text" id="cafeName" placeholder="ì˜ˆ: ì»¤í”¼ì•¤ë®¤ì§ ê°•ë‚¨ì ">
                    </div>
                    <div class="form-group">
                        <label>ì¹´í˜ ì£¼ì†Œ</label>
                        <input type="text" id="cafeLocation" placeholder="ì„œìš¸ ê°•ë‚¨êµ¬ í…Œí—¤ë€ë¡œ 123">
                    </div>
                    <div class="form-group">
                        <label>ì¹´í˜ ì†Œê°œ</label>
                        <textarea id="cafeDescription" rows="3" placeholder="ì¹´í˜ì˜ íŠ¹ì§•ê³¼ ë¶„ìœ„ê¸°ë¥¼ ì†Œê°œí•´ì£¼ì„¸ìš”"></textarea>
                    </div>
                    <div class="form-group">
                        <label>ì¹´í˜ ì´ë¯¸ì§€ URL</label>
                        <input type="text" id="cafeImage" placeholder="https://example.com/cafe.jpg">
                        <div style="font-size:11px; color:#999; margin-top:4px;">â€» ì¹´í˜ ì™¸ê´€ ë˜ëŠ” ë‚´ë¶€ ì‚¬ì§„</div>
                    </div>
                    <div class="form-group" style="margin-bottom:0;">
                        <label>ì˜ì—… ì‹œê°„</label>
                        <input type="text" id="cafeHours" placeholder="í‰ì¼ 09:00-22:00, ì£¼ë§ 10:00-23:00">
                    </div>
                </div>
            </div>
            
            <button class="auth-btn" onclick="Auth.register()">íšŒì›ê°€ì…</button>
            <div class="auth-switch">
                ì´ë¯¸ ê³„ì •ì´ ìˆìœ¼ì‹ ê°€ìš”? <a onclick="Auth.switchAuthMode('login')">ë¡œê·¸ì¸</a>
            </div>
        </div>
    </div>
</div>

<!-- Main App -->
<div id="mainApp">

<div id="toast" class="toast"></div>
<input type="file" id="fileInput" style="display:none;" accept="audio/*,video/*">

<!-- Audio Player Modal -->
<div class="modal" id="audioModal">
    <div class="modal-content">
        <h2 id="playTitle">ì¬ìƒ ì¤‘</h2>
        <p style="color:#999; margin-bottom:20px;" id="playCreator">Creator</p>
        <div class="panel">
            <strong>â³ TL Balance</strong><br>
            <span style="font-size:2rem; font-weight:800;" id="playTL">0</span> TL
        </div>
        <audio id="audioPlayer" controls style="width:100%; margin:20px 0;"></audio>
        <button class="btn" onclick="App.stopPlay()" style="width:100%; background:#f44; color:white; padding:16px;">â¹ï¸ ì •ì§€</button>
    </div>
</div>

<!-- Charge Modal -->
<div class="modal" id="chargeModal">
    <div class="modal-content">
        <h2>ğŸ’° TL ì¶©ì „</h2>
        <div class="form-group" style="margin-top:24px;">
            <label>ì¶©ì „í•  TL</label>
            <input type="number" id="chargeAmount" value="1000" min="100" step="100">
        </div>
        <div style="display:flex; gap:12px;">
            <button class="btn btn-play" onclick="App.executeCharge()" style="flex:1; padding:16px;">ì¶©ì „</button>
            <button class="btn" onclick="App.closeModal()" style="flex:1; background:#333; color:white; padding:16px;">ì·¨ì†Œ</button>
        </div>
    </div>
</div>

<div class="container">
    <div class="header">
        <h1>â° TimeLink</h1>
        <div class="user-info">
            <div class="balances">
                <div class="balance">
                    <div class="lbl">ğŸ’° TL</div>
                    <div class="amt" id="walletTL">10,000</div>
                </div>
                <div class="balance">
                    <div class="lbl">ğŸª™ TLC</div>
                    <div class="amt" id="walletTLC">0.00</div>
                </div>
            </div>
            <div class="user-name">ğŸ‘¤ <span id="userName">User</span></div>
            <button class="logout-btn" onclick="App.resetDatabase()" style="background:rgba(255,165,0,0.2); color:#ffa500; border-color:rgba(255,165,0,0.3);">ğŸ”„ ë¦¬ì…‹</button>
            <button class="logout-btn" onclick="Auth.logout()">ë¡œê·¸ì•„ì›ƒ</button>
        </div>
    </div>

    <div class="tabs">
        <button class="tab active" onclick="App.switchTab('dashboard', event)">ğŸ“Š Dashboard</button>
        <button class="tab" onclick="App.switchTab('create', event)">ğŸ“¤ Create</button>
        <button class="tab" onclick="App.switchTab('myfiles', event)">ğŸµ My Files</button>
        <button class="tab" onclick="App.switchTab('share', event)">ğŸ”„ Share Place</button>
        <button class="tab" onclick="App.switchTab('cafe', event)">â˜• Cafe</button>
        <button class="tab" onclick="App.switchTab('car', event)">ğŸš—ğŸš¶ Car & Walk</button>
        <button class="tab" onclick="App.switchTab('mining', event)">â›ï¸ Mining</button>
        <button class="tab" onclick="App.switchTab('lecture', event)">ğŸ“š Lecture</button>
        <button class="tab" onclick="App.switchTab('gold', event)">ğŸ† Gold</button>
        <button class="tab" onclick="App.switchTab('ton', event)">â¬¡ TLC Wallet</button>
    </div>

    <!-- Dashboard -->
    <div id="tabDashboard" class="tab-content active">
        <div class="hero">
            <h1>â° TimeLink</h1>
            <p style="font-size:1.2rem; color:#999;">Time-Based Media Economy</p>
            <div class="media-showcase">
                <div class="featured-banner">
                    <span class="tag">LIVE FEATURED</span>
                    <div style="font-size:1.4rem; font-weight:800;">Tonight's Global Chill Session</div>
                    <div style="color:#d0d0d0; font-size:0.9rem; margin-top:4px;">Moonlight Synth Â· Coffee Lounge Â· Late Drive</div>
                </div>
                <div class="playlist-stack">
                    <div class="playlist-item" style="background-image:linear-gradient(120deg, rgba(0,0,0,.2), rgba(0,0,0,.65)), url('https://images.unsplash.com/photo-1511379938547-c1f69419868d?auto=format&fit=crop&w=1000&q=80');">AI DJ Picks Â· Rainy Cafe</div>
                    <div class="playlist-item" style="background-image:linear-gradient(120deg, rgba(0,0,0,.2), rgba(0,0,0,.65)), url('https://images.unsplash.com/photo-1459749411175-04bf5292ceea?auto=format&fit=crop&w=1000&q=80');">Creator Spotlight Â· Indie Seoul</div>
                    <div class="playlist-item" style="background-image:linear-gradient(120deg, rgba(0,0,0,.2), rgba(0,0,0,.65)), url('https://images.unsplash.com/photo-1470225620780-dba8ba36b745?auto=format&fit=crop&w=1000&q=80');">Drive Mode Â· Highway Energy</div>
                </div>
            </div>
        </div>

        <div class="card">
            <h2>ğŸš€ MVP ë¹ ë¥¸ ì‹¤í–‰</h2>
            <p style="color:#999; line-height:1.8;">
                ì§€ê¸ˆì€ í•µì‹¬ í”Œë¡œìš°(ì—…ë¡œë“œ â†’ ê³µìœ  â†’ ì²­ì·¨/ì±„êµ´) ê²€ì¦ì´ ìš°ì„ ì…ë‹ˆë‹¤.
                ì•„ë˜ 4ë‹¨ê³„ë§Œ ì™„ë£Œí•˜ë©´ TimeLink MVPì˜ í•µì‹¬ ê°€ì¹˜ê°€ ë°”ë¡œ í™•ì¸ë©ë‹ˆë‹¤.
            </p>
            <div class="mvp-grid">
                <div class="mvp-kpi">
                    <div class="label">ì—…ë¡œë“œ íŒŒì¼</div>
                    <div class="value" id="mvpFileCount">0ê°œ</div>
                </div>
                <div class="mvp-kpi">
                    <div class="label">ê³µìœ  íŒŒì¼</div>
                    <div class="value" id="mvpSharedCount">0ê°œ</div>
                </div>
                <div class="mvp-kpi">
                    <div class="label">ëˆ„ì  TL ìˆ˜ìµ</div>
                    <div class="value" id="mvpTotalBalance">0 TL</div>
                </div>
                <div class="mvp-kpi">
                    <div class="label">ì±„êµ´ëœ TLC</div>
                    <div class="value" id="mvpMinedTlc">0.00 TLC</div>
                </div>
            </div>
            <div class="quick-actions">
                <button class="btn btn-play" onclick="App.switchTab('create')">1) ì½˜í…ì¸  ì—…ë¡œë“œ</button>
                <button class="btn btn-share" onclick="App.switchTab('myfiles')">2) íŒŒì¼ ê³µìœ /ì¶©ì „</button>
                <button class="btn" style="background:#0ea5e9; color:white;" onclick="App.switchTab('share')">3) Share Place ì²­ì·¨</button>
                <button class="btn btn-charge" onclick="App.switchTab('mining')">4) TLC ì±„êµ´</button>
            </div>
        </div>

        <div class="card">
            <h2>ğŸ¯ TimeLinkë€?</h2>
            <p style="color:#999; line-height:1.8; margin-bottom:24px;">
                TimeLinkëŠ” ì‹œê°„ ê¸°ë°˜ ë¯¸ë””ì–´ ê²½ì œ í”Œë«í¼ì…ë‹ˆë‹¤. ëª¨ë“  ì½˜í…ì¸ ëŠ” ì‹œê°„ê³¼ í•¨ê»˜ íë¥´ë©°, 
                ì°½ì‘ìì™€ ì²­ì·¨ì ëª¨ë‘ê°€ ê³µì •í•˜ê²Œ ê°€ì¹˜ë¥¼ ë‚˜ëˆ•ë‹ˆë‹¤.
            </p>
            
            <div class="feature-grid">
                <div class="feature-card">
                    <div style="font-size:2.5rem;">ğŸ“¤</div>
                    <h3>Create</h3>
                    <p>MP3/MP4ë¥¼ TL3/TL4ë¡œ ë³€í™˜. Suno/Udio AI ìë™ ì¸ì¦.</p>
                </div>
                <div class="feature-card">
                    <div style="font-size:2.5rem;">ğŸµ</div>
                    <h3>My Files</h3>
                    <p>TL ì¶©ì „ í›„ ì¬ìƒ. ë³¸ì¸ íŒŒì¼ë„ ì²­ì·¨ ê°€ëŠ¥.</p>
                </div>
                <div class="feature-card">
                    <div style="font-size:2.5rem;">ğŸ”„</div>
                    <h3>Share Place</h3>
                    <p>AI DJ íë ˆì´ì…˜. ì²­ì·¨ì TL ì†Œë¹„ â†’ ì°½ì‘ì TL íšë“.</p>
                </div>
                <div class="feature-card">
                    <div style="font-size:2.5rem;">ğŸš—ğŸš¶</div>
                    <h3>Car & Walk</h3>
                    <p>ì´ë™ ì¤‘ ìŒì•… ì¬ìƒ = ìµœëŒ€ 2ë°° ë³´ìƒ (Movement AI).</p>
                </div>
                <div class="feature-card">
                    <div style="font-size:2.5rem;">â›ï¸</div>
                    <h3>Mining</h3>
                    <p>TLì˜ ìµœëŒ€ 50%ë¥¼ TLCë¡œ ì±„êµ´. ê¸°ì—¬ì§€ìˆ˜ ë³€ë™.</p>
                </div>
                <div class="feature-card">
                    <div style="font-size:2.5rem;">ğŸ†</div>
                    <h3>Gold Reserve</h3>
                    <p>í”Œë«í¼ ìˆ˜ìµ 10% â†’ ê¸ˆ êµ¬ë§¤ â†’ TLC ê°€ì¹˜ ìœ ì§€.</p>
                </div>
            </div>
        </div>

        <div class="card">
            <h2>â¬¡ TON Blockchain</h2>
            <p style="color:#999; line-height:1.8;">
                TimeLinkëŠ” TON ë¸”ë¡ì²´ì¸ê³¼ ì—°ë™ë©ë‹ˆë‹¤. TLC ì½”ì¸ì€ TON ë„¤íŠ¸ì›Œí¬ì—ì„œ ê±°ë˜ë˜ë©°,
                ì‹¤ì œ ì•”í˜¸í™”íë¡œì„œì˜ ê°€ì¹˜ë¥¼ ê°–ìŠµë‹ˆë‹¤. ì§€ê°‘ ì—°ë™ í›„ ììœ ë¡­ê²Œ ì…ì¶œê¸ˆì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.
            </p>
        </div>
    </div>

    <!-- Create -->
    <div id="tabCreate" class="tab-content">
        <div class="card">
            <h2>ğŸ“¤ Create TL3/TL4</h2>
            
            <div class="type-selector">
                <div class="type-card audio selected" id="audioCard" onclick="App.selectType('audio')">
                    <div style="font-size:3rem;">ğŸµ</div>
                    <h3>TL3 Audio</h3>
                    <div style="color:#1db954; font-weight:700; margin-top:10px;">1ì´ˆ = 1 TL</div>
                    <p style="color:#999; font-size:13px; margin-top:8px;">MP3, WAV, FLAC</p>
                </div>
                <div class="type-card video" id="videoCard" onclick="App.selectType('video')">
                    <div style="font-size:3rem;">ğŸ¬</div>
                    <h3>TL4 Video</h3>
                    <div style="color:#ff5500; font-weight:700; margin-top:10px;">1ì´ˆ = 2 TL</div>
                    <p style="color:#999; font-size:13px; margin-top:8px;">MP4, MOV, AVI</p>
                </div>
            </div>

            <div class="upload" onclick="document.getElementById('fileInput').click()">
                <div style="font-size:3.5rem; margin-bottom:16px;" id="uploadIcon">ğŸµ</div>
                <h3 id="uploadTitle">íŒŒì¼ ì„ íƒí•˜ê¸°</h3>
                <p style="color:#999; margin-top:8px;" id="uploadDesc">MP3, WAV, FLAC</p>
            </div>

            <div id="uploadForm" style="display:none;">
                <div class="file-info-panel" style="background:rgba(138,43,226,0.1); border:1px solid #8a2be2; border-radius:12px; padding:16px; margin-bottom:20px;">
                    <div style="display:flex; justify-content:space-between; margin-bottom:8px; color:#999;">
                        <span>íŒŒì¼ëª…</span>
                        <span style="color:#fff; font-weight:600;" id="infoFileName">-</span>
                    </div>
                    <div style="display:flex; justify-content:space-between; margin-bottom:8px; color:#999;">
                        <span>íŒŒì¼ í¬ê¸°</span>
                        <span style="color:#fff; font-weight:600;" id="infoFileSize">-</span>
                    </div>
                    <div style="display:flex; justify-content:space-between; margin-bottom:8px; color:#999;">
                        <span>ì¬ìƒ ì‹œê°„</span>
                        <span style="color:#fff; font-weight:600;" id="infoDuration">ê³„ì‚° ì¤‘...</span>
                    </div>
                    <div style="display:flex; justify-content:space-between; margin-bottom:8px; color:#999;">
                        <span>ë³€í™˜ ìœ í˜•</span>
                        <span style="color:#fff; font-weight:600;" id="infoType">TL3 (ì˜¤ë””ì˜¤)</span>
                    </div>
                    <div style="margin-top:12px; text-align:center;">
                        <span style="background:#8a2be2; color:white; padding:4px 12px; border-radius:999px; font-size:12px; font-weight:600;" id="durationBadge">-</span>
                    </div>
                </div>

                <div class="form-group">
                    <label>ğŸ“ ì œëª©</label>
                    <input type="text" id="fileTitle" placeholder="íŒŒì¼ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”">
                </div>

                <div class="form-group">
                    <label>ğŸ¤ ì°½ì‘ì ì´ë¦„</label>
                    <input type="text" id="fileCreator" value="Global Investor" placeholder="ì°½ì‘ì ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”">
                </div>
                
                <div class="form-group">
                    <label>ğŸ¤– AI ì°½ì‘ íˆ´ (ì¸ì¦)</label>
                    <select id="creatorTool">
                        <option value="suno">ğŸµ Suno AI (ìë™ ì¸ì¦)</option>
                        <option value="udio">ğŸµ Udio AI (ìë™ ì¸ì¦)</option>
                        <option value="custom">ğŸ¹ ì§ì ‘ ì‘ê³¡ (ìˆ˜ë™ ê²€í† )</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>ğŸ¼ ì¥ë¥´</label>
                    <select id="fileGenre">
                        <option value="pop">ğŸ¤ Pop</option>
                        <option value="rock">ğŸ¸ Rock</option>
                        <option value="hiphop">ğŸ§ Hip Hop</option>
                        <option value="jazz">ğŸº Jazz</option>
                        <option value="classic">ğŸ» Classic</option>
                        <option value="edm">ğŸ’¿ EDM</option>
                        <option value="kpop">ğŸ‡°ğŸ‡· K-Pop</option>
                        <option value="indie">ğŸ¹ Indie</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>ğŸ˜Œ ëŠë‚Œ (AI DJ íë ˆì´ì…˜)</label>
                    <select id="fileMood">
                        <option value="energetic">ğŸ”¥ Energetic - ì—ë„ˆì§€ ë„˜ì¹˜ëŠ”</option>
                        <option value="chill">ğŸ˜Œ Chill - í¸ì•ˆí•œ</option>
                        <option value="focus">ğŸ¯ Focus - ì§‘ì¤‘ë ¥</option>
                        <option value="workout">ğŸ’ª Workout - ìš´ë™</option>
                        <option value="romantic">ğŸ’• Romantic - ë¡œë§¨í‹±</option>
                        <option value="sad">ğŸ˜¢ Sad - ìŠ¬í”ˆ</option>
                        <option value="happy">ğŸ˜Š Happy - í–‰ë³µí•œ</option>
                        <option value="sleep">ğŸ˜´ Sleep - ìˆ˜ë©´</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>ğŸ“ ì„¤ëª…</label>
                    <textarea id="fileDesc" rows="3" placeholder="íŒŒì¼ì— ëŒ€í•œ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
                </div>
                
                <div class="form-group">
                    <label>ğŸ’° ìˆ˜ìµ ê³„ì•½</label>
                    <select id="revenue">
                        <option value="55">5:5 (ì°½ì‘ì 50% / í”Œë«í¼ 50%)</option>
                        <option value="73">7:3 (ì°½ì‘ì 70% / í”Œë«í¼ 30%)</option>
                    </select>
                </div>
                
                <button class="btn btn-play" onclick="App.convert()" style="width:100%; padding:18px; font-size:1.1rem;">
                    âœ¨ TL íŒŒì¼ë¡œ ë³€í™˜í•˜ê¸°
                </button>
            </div>
        </div>
    </div>

    <!-- My Files -->
    <div id="tabMyfiles" class="tab-content">
        <div class="card">
            <h2>ğŸµ My Files</h2>
            <div id="myFilesList" class="grid"></div>
        </div>
    </div>

    <!-- Share Place -->
    <div id="tabShare" class="tab-content">
        <div class="card">
            <h2>ğŸ”„ Share Place</h2>
            
            <div class="search-box">
                <span style="font-size:1.2rem;">ğŸ”</span>
                <input type="text" placeholder="ê²€ìƒ‰..." onkeyup="App.searchShare()">
            </div>
            
            <div class="genre-filter">
                <button class="genre-btn active" onclick="App.filterGenre('all')">ì „ì²´</button>
                <button class="genre-btn" onclick="App.filterGenre('pop')">ğŸ¤ Pop</button>
                <button class="genre-btn" onclick="App.filterGenre('rock')">ğŸ¸ Rock</button>
                <button class="genre-btn" onclick="App.filterGenre('hiphop')">ğŸ§ Hip Hop</button>
                <button class="genre-btn" onclick="App.filterGenre('jazz')">ğŸº Jazz</button>
                <button class="genre-btn" onclick="App.filterGenre('classic')">ğŸ» Classic</button>
                <button class="genre-btn" onclick="App.filterGenre('edm')">ğŸ’¿ EDM</button>
                <button class="genre-btn" onclick="App.filterGenre('kpop')">ğŸ‡°ğŸ‡· K-Pop</button>
                <button class="genre-btn" onclick="App.filterGenre('indie')">ğŸ¹ Indie</button>
            </div>
            
            <div id="sharePlaceContent"></div>
        </div>
    </div>

    <!-- Cafe Broadcasting -->
    <div id="tabCafe" class="tab-content">
        <!-- ì‚¬ì—…ì íšŒì›ìš© ì¹´í˜ ê´€ë¦¬ ì„¹ì…˜ -->
        <div id="cafeManagement" class="card" style="display:none;">
            <h2>â˜• ë‚´ ì¹´í˜ ê´€ë¦¬</h2>
            
            <div id="myCafeInfo" style="display:none;">
                <div class="panel" style="background:rgba(139,92,46,0.1); border-color:#8b5c2e;">
                    <strong>ì¹´í˜ ì •ë³´</strong><br>
                    <div style="margin-top:12px;">
                        <div style="font-size:1.3rem; font-weight:700; color:#8b5c2e;" id="myCafeName">-</div>
                        <div style="color:#999; margin-top:4px;" id="myCafeLocation">-</div>
                    </div>
                </div>
                
                <div style="margin-top:16px;">
                    <button class="btn" onclick="App.editCafe()" style="background:#8b5c2e; color:white; padding:14px; width:100%;">
                        âœï¸ ì¹´í˜ ì •ë³´ ìˆ˜ì •
                    </button>
                </div>
            </div>
            
            <div id="registerCafeForm" style="display:none;">
                <p style="color:#999; margin-bottom:16px;">ì¹´í˜ ì •ë³´ë¥¼ ë“±ë¡í•˜ì—¬ TimeLink ì¹´í˜ ë°©ì†¡ì„ ì‹œì‘í•˜ì„¸ìš”</p>
                
                <div class="form-group">
                    <label>â˜• ì¹´í˜ ì´ë¦„</label>
                    <input type="text" id="editCafeName" placeholder="ì˜ˆ: ìŠ¤íƒ€ë²…ìŠ¤ ê°•ë‚¨ì ">
                </div>
                <div class="form-group">
                    <label>ğŸ“ ìœ„ì¹˜</label>
                    <input type="text" id="editCafeLocation" placeholder="ì˜ˆ: ì„œìš¸ ê°•ë‚¨êµ¬ í…Œí—¤ë€ë¡œ 123">
                </div>
                <div class="form-group">
                    <label>ğŸ“ ì†Œê°œ</label>
                    <textarea id="editCafeDesc" rows="3" placeholder="ì¹´í˜ ì†Œê°œë¥¼ ì…ë ¥í•˜ì„¸ìš”"></textarea>
                </div>
                <div class="form-group">
                    <label>ğŸ·ï¸ ì¹´í…Œê³ ë¦¬</label>
                    <select id="editCafeCategory">
                        <option value="cafe">â˜• ì¹´í˜</option>
                        <option value="restaurant">ğŸ½ï¸ ë ˆìŠ¤í† ë‘</option>
                        <option value="bar">ğŸº ë°”/í</option>
                        <option value="lounge">ğŸµ ë¼ìš´ì§€</option>
                        <option value="bookstore">ğŸ“š ë¶ì¹´í˜</option>
                    </select>
                </div>
                
                <button class="btn btn-play" onclick="App.saveCafeInfo()" style="width:100%; padding:16px;">
                    âœ… ì¹´í˜ ì •ë³´ ì €ì¥
                </button>
            </div>
        </div>

        <!-- ëª¨ë“  íšŒì›ìš© ì¹´í˜ ë°©ì†¡ -->
        <div class="card">
            <h2>â˜• Cafe Broadcasting - AI DJ</h2>
            <p style="color:#999; margin-bottom:24px;">AI DJì—ê²Œ ì›í•˜ëŠ” ìŒì•… ë¶„ìœ„ê¸°ë¥¼ ë§í•´ë³´ì„¸ìš”</p>
            
            <!-- AI DJ ì…ë ¥ì°½ -->
            <div class="panel" style="background:rgba(138,43,226,0.1); border-color:#8a2be2;">
                <strong>ğŸ¤– AI DJì—ê²Œ ìš”ì²­í•˜ê¸°</strong><br>
                <div style="margin-top:12px;">
                    <textarea id="aiDjRequest" rows="3" placeholder="ì˜ˆì‹œ:&#10;- ì˜¤ëŠ˜ì€ ë¹„ ì˜¤ëŠ” ë‚  ë¶„ìœ„ê¸°ë¡œ ì¬ì¦ˆ ìŒì•… í‹€ì–´ì¤˜&#10;- í¬ë¦¬ìŠ¤ë§ˆìŠ¤ ëŠë‚Œì˜ ë”°ëœ»í•œ ìŒì•…&#10;- í™œê¸°ì°¬ ì•„ì¹¨ ìš´ë™í•  ë•Œ ë“£ê¸° ì¢‹ì€ ìŒì•…&#10;- ì”ì”í•œ ê¸°íƒ€ ì—°ì£¼ê³¡ìœ¼ë¡œ ì§‘ì¤‘ ê³µë¶€ìš©" style="width:100%; background:rgba(0,0,0,0.3); border:1px solid rgba(255,255,255,0.1); border-radius:8px; padding:12px; color:white; font-size:14px; resize:vertical;"></textarea>
                </div>
                <button class="btn btn-play" onclick="App.requestAiDj()" style="width:100%; margin-top:12px; padding:14px;">
                    ğŸµ AI DJ íë ˆì´ì…˜ ì‹œì‘
                </button>
            </div>
            
            <!-- í˜„ì¬ ì¬ìƒ ì¤‘ -->
            <div class="panel" style="margin-top:16px; background:rgba(101,67,33,0.1); border-color:#654321;">
                <strong>ğŸµ Now Playing</strong><br>
                <div style="font-size:1.3rem; font-weight:700; margin-top:8px; color:#8b5c2e;" id="cafeNowPlaying">AI DJ ëŒ€ê¸° ì¤‘...</div>
                <div style="color:#999; margin-top:4px; font-size:13px;" id="cafeCreator">-</div>
                <div style="margin-top:12px; padding-top:12px; border-top:1px solid rgba(255,255,255,0.05);">
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <span style="color:#999; font-size:13px;">AI íë ˆì´ì…˜</span>
                        <span style="font-weight:700; color:#8a2be2;" id="aiDjTheme">-</span>
                    </div>
                </div>
            </div>
            
            <!-- ì¬ìƒ ì»¨íŠ¸ë¡¤ -->
            <div style="display:flex; gap:12px; margin-top:20px;">
                <button class="btn btn-play" onclick="App.startCafe()" style="flex:1; padding:16px;">
                    â–¶ï¸ ì¬ìƒ
                </button>
                <button class="btn" onclick="App.skipCafeSong()" style="flex:1; background:#f59e0b; color:white; padding:16px;">
                    â­ï¸ ë‹¤ìŒ ê³¡
                </button>
                <button class="btn" onclick="App.stopCafe()" style="flex:1; background:#f44; color:white; padding:16px;">
                    â¹ï¸ ì •ì§€
                </button>
            </div>
        </div>

        <!-- ë“±ë¡ëœ ì¹´í˜ ê°¤ëŸ¬ë¦¬ -->
        <div class="card" style="margin-top:24px;">
            <h2>ğŸª ë“±ë¡ëœ ì¹´í˜ ê°¤ëŸ¬ë¦¬</h2>
            <p style="color:#999; margin-bottom:20px;">TimeLinkë¥¼ ì‚¬ìš©í•˜ëŠ” ì¹´í˜ë“¤ì˜ ë°©ì†¡ê³¼ ë¶„ìœ„ê¸°</p>
            
            <div id="cafeGallery" style="display:grid; grid-template-columns:repeat(auto-fill, minmax(320px, 1fr)); gap:20px;">
                <!-- ì¹´í˜ ì¹´ë“œê°€ ì—¬ê¸°ì— ë Œë”ë§ë©ë‹ˆë‹¤ -->
            </div>
        </div>
    </div>

    <!-- Car & Walk -->
    <div id="tabCar" class="tab-content">
        <div class="card">
            <h2>ğŸš—ğŸš¶ Car & Walk - ì´ë™ ì¤‘ AI DJ & 2ë°° ë³´ìƒ</h2>
            <p style="color:#999; margin-bottom:24px;">ì´ë™ ì¤‘ ìŒì•…ì„ ë“¤ìœ¼ë©´ ìµœëŒ€ 2ë°° TL ë³´ìƒ!</p>
            
            <!-- AI DJ ìš”ì²­ (Car & Walk ì „ìš©) -->
            <div class="panel" style="background:linear-gradient(135deg, rgba(59,130,246,0.2), rgba(37,99,235,0.1)); border-color:#3b82f6;">
                <strong>ğŸ§ ì´ë™ ì¤‘ AI DJ</strong><br>
                <div style="margin-top:12px;">
                    <textarea id="carAiDjPrompt" rows="2" placeholder="ì˜ˆ: ë“œë¼ì´ë¸Œí•˜ê¸° ì¢‹ì€ ì‹ ë‚˜ëŠ” íŒì†¡&#10;ì˜ˆ: ì¡°ê¹…í•  ë•Œ ë“£ê¸° ì¢‹ì€ ê²½ì¾Œí•œ ìŒì•…" style="width:100%; background:rgba(0,0,0,0.3); border:1px solid rgba(255,255,255,0.1); border-radius:8px; padding:12px; color:white; resize:vertical;"></textarea>
                    
                    <div style="display:flex; gap:8px; margin-top:12px; flex-wrap:wrap;">
                        <button class="genre-btn" onclick="App.setCarAiDjPrompt('ë“œë¼ì´ë¸Œí•˜ê¸° ì¢‹ì€ ì‹ ë‚˜ëŠ” íŒì†¡')">ğŸš— ë“œë¼ì´ë¸Œ</button>
                        <button class="genre-btn" onclick="App.setCarAiDjPrompt('ì¡°ê¹…í•  ë•Œ ë“£ê¸° ì¢‹ì€ ê²½ì¾Œí•œ ìŒì•…')">ğŸƒ ì¡°ê¹…</button>
                        <button class="genre-btn" onclick="App.setCarAiDjPrompt('ì¶œí‡´ê·¼ê¸¸ ì§€í•˜ì² ì—ì„œ ë“£ê¸° ì¢‹ì€ ìŒì•…')">ğŸš‡ ì¶œí‡´ê·¼</button>
                        <button class="genre-btn" onclick="App.setCarAiDjPrompt('ì‚°ì±…í•˜ë©° ë“£ê¸° ì¢‹ì€ ì”ì”í•œ ìŒì•…')">ğŸš¶ ì‚°ì±…</button>
                    </div>
                </div>
            </div>
            
            <div class="panel" style="margin-top:16px; background:rgba(59,130,246,0.1); border-color:#3b82f6;">
                <strong>ğŸƒ Movement AI ìƒíƒœ</strong><br>
                <div style="font-size:1.5rem; font-weight:800; margin-top:8px; color:#3b82f6;" id="movementStatus">ì •ì§€ ì¤‘</div>
                <div style="color:#999; font-size:13px; margin-top:4px;" id="movementType">-</div>
            </div>
            
            <div class="panel" style="margin-top:16px;">
                <strong>ğŸ’° í˜„ì¬ ë³´ìƒ ë°°ìœ¨</strong><br>
                <div style="font-size:2rem; font-weight:800; margin-top:8px;" id="rewardMultiplier">Ã—1.0</div>
                <div style="color:#999; font-size:13px; margin-top:4px;">ì´ë™ ì†ë„ì— ë”°ë¼ ìë™ ë³€ê²½</div>
            </div>
            
            <div class="panel" style="margin-top:16px;">
                <strong>ğŸµ í˜„ì¬ ì¬ìƒ ì¤‘</strong><br>
                <div style="font-size:1.2rem; font-weight:700; margin-top:8px;" id="carNowPlaying">ëŒ€ê¸° ì¤‘...</div>
                <div style="color:#999; margin-top:4px;" id="carCreator">-</div>
                <div style="margin-top:8px; font-size:12px; color:#3b82f6;" id="carAiReason">-</div>
            </div>
            
            <div style="display:flex; gap:12px; margin-top:20px;">
                <button class="btn btn-play" onclick="App.startCarWalk()" style="flex:1; padding:18px; font-size:1.1rem;">
                    ğŸš— ì´ë™ ëª¨ë“œ ì‹œì‘
                </button>
                <button class="btn" onclick="App.stopCarWalk()" style="flex:1; background:#f44; color:white; padding:18px; font-size:1.1rem;">
                    â¹ï¸ ì •ì§€
                </button>
            </div>
            
            <div style="margin-top:20px; color:#999; font-size:14px; line-height:1.6;">
                <p>â€¢ ê±·ê¸° (ë„ë³´): TL ì†Œë¹„ <span style="color:#3b82f6; font-weight:600;">Ã—1.5ë°°</span> ë³´ìƒ</p>
                <p>â€¢ ë‹¬ë¦¬ê¸°/ìì „ê±°: TL ì†Œë¹„ <span style="color:#3b82f6; font-weight:600;">Ã—1.7ë°°</span> ë³´ìƒ</p>
                <p>â€¢ ì°¨ëŸ‰/ëŒ€ì¤‘êµí†µ: TL ì†Œë¹„ <span style="color:#3b82f6; font-weight:600;">Ã—2.0ë°°</span> ë³´ìƒ</p>
                <p style="color:#f59e0b;">â€» Movement AIê°€ ì´ë™ ìƒíƒœë¥¼ ìë™ ê°ì§€í•˜ê³  AI DJê°€ ì í•©í•œ ìŒì•…ì„ ì„ ê³¡í•©ë‹ˆë‹¤</p>
            </div>
        </div>
    </div>

    <!-- Mining -->
    <div id="tabMining" class="tab-content">
        <div class="card">
            <h2>â›ï¸ Mining</h2>
            
            <div class="panel">
                <strong>ê¸°ì—¬ ì§€ìˆ˜ (CI)</strong><br>
                <span style="font-size:2rem; font-weight:800;" id="ciValue">1.00x</span>
            </div>
            
            <div class="form-group">
                <label>ì±„êµ´í•  TL (ìµœëŒ€: <span id="miningMax">5000</span> TL)</label>
                <input type="number" id="miningAmount" value="100" min="1">
            </div>
            
            <button class="btn btn-play" onclick="App.mine()" style="width:100%; padding:18px;">
                â›ï¸ TLC ì±„êµ´ ì‹œì‘
            </button>
            
            <div style="margin-top:20px; color:#999; font-size:14px; line-height:1.6;">
                <p>â€¢ TLì˜ ìµœëŒ€ 50%ë¥¼ TLCë¡œ ì±„êµ´ ê°€ëŠ¥</p>
                <p>â€¢ 100 TL = 1 TLC Ã— CI (ê¸°ì—¬ì§€ìˆ˜)</p>
                <p>â€¢ í”Œë«í¼ ìˆ˜ìˆ˜ë£Œ 10% (ê¸ˆ êµ¬ë§¤ì— ì‚¬ìš©)</p>
            </div>
        </div>
    </div>

    <!-- Lecture -->
    <div id="tabLecture" class="tab-content">
        <div class="card">
            <h2>ğŸ“š Lecture - êµìœ¡ ì½˜í…ì¸ </h2>
            <p style="color:#999; margin-bottom:24px;">í•™ìŠµí•˜ë©° TLì„ íšë“í•˜ì„¸ìš”</p>
            
            <div class="panel" style="background:rgba(168,85,247,0.1); border-color:#a855f7;">
                <strong>ğŸ“ í•™ìŠµ ì§„í–‰ë¥ </strong><br>
                <div style="margin-top:12px;">
                    <div style="background:rgba(255,255,255,0.1); height:24px; border-radius:12px; overflow:hidden;">
                        <div id="lectureProgress" style="background:linear-gradient(90deg, #a855f7, #ec4899); height:100%; width:0%; transition:width 0.3s;"></div>
                    </div>
                    <div style="text-align:center; margin-top:8px; font-weight:700;" id="lectureProgressText">0%</div>
                </div>
            </div>
            
            <div class="panel" style="margin-top:16px;">
                <strong>ğŸµ í˜„ì¬ ê°•ì˜</strong><br>
                <div style="font-size:1.2rem; font-weight:700; margin-top:8px;" id="lectureNowPlaying">ê°•ì˜ ì„ íƒ ëŒ€ê¸° ì¤‘...</div>
                <div style="color:#999; margin-top:4px;" id="lectureCreator">-</div>
            </div>
            
            <div class="panel" style="margin-top:16px; background:rgba(34,197,94,0.1); border-color:#22c55e;">
                <strong>ğŸ’¡ í•™ìŠµ ë³´ìƒ</strong><br>
                <div style="font-size:1.1rem; margin-top:8px;">ê°•ì˜ ì™„ë£Œ ì‹œ <span style="color:#22c55e; font-weight:800;">+100 TL</span> ë³´ë„ˆìŠ¤!</div>
            </div>
            
            <div style="display:flex; gap:12px; margin-top:20px;">
                <button class="btn btn-play" onclick="App.startLecture()" style="flex:1; padding:18px; font-size:1.1rem;">
                    ğŸ“š ê°•ì˜ ì‹œì‘
                </button>
                <button class="btn" onclick="App.stopLecture()" style="flex:1; background:#f44; color:white; padding:18px; font-size:1.1rem;">
                    â¹ï¸ ì •ì§€
                </button>
            </div>
            
            <div style="margin-top:20px; color:#999; font-size:14px; line-height:1.6;">
                <p>â€¢ Share Placeì˜ êµìœ¡/ê°•ì˜ ì½˜í…ì¸ ë§Œ ìë™ ì¬ìƒ</p>
                <p>â€¢ í•™ìŠµ ì§„í–‰ë¥ ì´ ì‹¤ì‹œê°„ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤</p>
                <p>â€¢ ê°•ì˜ ì™„ë£Œ ì‹œ <span style="color:#22c55e; font-weight:600;">+100 TL</span> ë³´ë„ˆìŠ¤ ì§€ê¸‰</p>
                <p>â€¢ ê±´ë„ˆë›°ê¸° ë°©ì§€: ì •ìƒ ì†ë„ë¡œë§Œ ì¬ìƒ ê°€ëŠ¥</p>
            </div>
        </div>
    </div>

    <!-- Gold -->
    <div id="tabGold" class="tab-content">
        <div class="card">
            <h2>ğŸ† Gold Reserve - TLC ê°€ì¹˜ ì•ˆì •í™”</h2>
            <p style="color:#999; margin-bottom:24px;">í”Œë«í¼ ìˆ˜ìµì˜ 10%ë¡œ ê¸ˆì„ êµ¬ë§¤í•˜ì—¬ TLC ê°€ì¹˜ë¥¼ ìœ ì§€í•©ë‹ˆë‹¤</p>
            
            <div class="panel" style="background:rgba(255,215,0,0.1); border-color:#ffd700;">
                <strong>ğŸ’° ë³´ìœ  ê¸ˆ</strong><br>
                <span style="font-size:2.5rem; font-weight:800; color:#ffd700;" id="goldAmount">0.0000 g</span>
            </div>
            
            <div style="margin-top:24px; display:flex; gap:12px; justify-content:center;">
                <button class="genre-btn" onclick="App.setGoldPeriod('day')" id="goldDay" style="font-size:14px;">ì¼ê°„</button>
                <button class="genre-btn active" onclick="App.setGoldPeriod('week')" id="goldWeek" style="font-size:14px;">ì£¼ê°„</button>
                <button class="genre-btn" onclick="App.setGoldPeriod('month')" id="goldMonth" style="font-size:14px;">ì›”ê°„</button>
                <button class="genre-btn" onclick="App.setGoldPeriod('year')" id="goldYear" style="font-size:14px;">ì—°ê°„</button>
            </div>
            
            <div style="margin-top:20px; background:rgba(0,0,0,0.3); padding:20px; border-radius:16px;">
                <canvas id="goldChart" width="600" height="300" style="max-width:100%;"></canvas>
            </div>
            
            <div style="margin-top:20px; color:#999; font-size:14px; line-height:1.6;">
                <p>â€¢ <span style="color:#ffd700; font-weight:600;">í”Œë«í¼ ìˆ˜ìµì˜ 10%</span>ë¥¼ ê¸ˆ êµ¬ë§¤ì— ì‚¬ìš©</p>
                <p>â€¢ ê¸ˆ ë³´ìœ ëŸ‰ì— ë”°ë¼ TLCì˜ ìµœì†Œ ê°€ì¹˜ ë³´ì¥</p>
                <p>â€¢ ì‹¤ë¬¼ ìì‚° ë‹´ë³´ë¡œ ì•”í˜¸í™”í ì•ˆì •ì„± í™•ë³´</p>
                <p>â€¢ ê·¸ë˜í”„ëŠ” ê¸ˆ ì¶•ì  ì¶”ì´ë¥¼ ì‹¤ì‹œê°„ í‘œì‹œ</p>
            </div>
        </div>
    </div>

    <!-- Mining & TLC -->
    <div id="tabTon" class="tab-content">
        <div class="card">
            <h2>â›ï¸ Mining & TLC Wallet</h2>
            <p style="color:#999; margin-bottom:24px;">TLì„ ì±„êµ´í•˜ì—¬ TLCë¥¼ íšë“í•˜ê³  ì§€ê°‘ìœ¼ë¡œ ì „ì†¡í•˜ì„¸ìš”</p>
            
            <!-- TLC ì§€ê°‘ ì •ë³´ -->
            <div class="panel" style="background:rgba(138,43,226,0.1); border-color:#8a2be2;">
                <strong>ğŸ’ TLC ì§€ê°‘</strong><br>
                <div style="font-size:2.5rem; font-weight:800; color:#8a2be2; margin-top:8px;" id="tlcWalletAmount">0.00 TLC</div>
                <div style="color:#999; font-size:13px; margin-top:8px;">â‰ˆ $<span id="tlcUsdValue">0.00</span> USD</div>
            </div>
            
            <!-- ì±„êµ´ ì„¹ì…˜ -->
            <div style="margin-top:24px;">
                <h3 style="font-size:1.2rem; margin-bottom:16px;">â›ï¸ TLC ì±„êµ´</h3>
                
                <div class="panel">
                    <strong>ê¸°ì—¬ ì§€ìˆ˜ (CI)</strong><br>
                    <span style="font-size:2rem; font-weight:800;" id="ciValueWallet">1.00x</span>
                </div>
                
                <div class="form-group" style="margin-top:16px;">
                    <label>ì±„êµ´í•  TL (ìµœëŒ€: <span id="miningMaxWallet">5000</span> TL)</label>
                    <input type="number" id="miningAmountWallet" value="100" min="1">
                </div>
                
                <button class="btn btn-play" onclick="App.mineToWallet()" style="width:100%; padding:18px;">
                    â›ï¸ TLC ì±„êµ´í•˜ê¸°
                </button>
                
                <div style="margin-top:12px; color:#999; font-size:13px; text-align:center;">
                    100 TL = 1 TLC Ã— CI (ê¸°ì—¬ì§€ìˆ˜)
                </div>
            </div>
            
            <!-- TON ì „ì†¡ ì„¹ì…˜ -->
            <div style="margin-top:32px; padding-top:24px; border-top:1px solid rgba(255,255,255,0.1);">
                <h3 style="font-size:1.2rem; margin-bottom:16px;">â¬¡ TON ë¸”ë¡ì²´ì¸ ì „ì†¡</h3>
                
                <div class="form-group">
                    <label>TON ì§€ê°‘ ì£¼ì†Œ</label>
                    <input type="text" id="tonWalletAddress" placeholder="UQxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx">
                </div>
                
                <div class="form-group">
                    <label>ì „ì†¡í•  TLC</label>
                    <input type="number" id="tonTransferAmount" placeholder="0.00" step="0.01" min="0.01">
                </div>
                
                <button class="btn" onclick="App.transferToTon()" style="width:100%; background:#0098ea; color:white; padding:18px;">
                    â¬¡ TONìœ¼ë¡œ ì „ì†¡
                </button>
            </div>
            
            <!-- ê±°ë˜ ë‚´ì—­ -->
            <div style="margin-top:32px; padding-top:24px; border-top:1px solid rgba(255,255,255,0.1);">
                <h3 style="font-size:1.2rem; margin-bottom:16px;">ğŸ“œ ê±°ë˜ ë‚´ì—­</h3>
                <div id="walletHistory" style="max-height:200px; overflow-y:auto;">
                    <div style="text-align:center; padding:40px; color:#666;">
                        ì•„ì§ ê±°ë˜ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤
                    </div>
                </div>
            </div>
            
            <div style="margin-top:20px; color:#999; font-size:14px; line-height:1.6;">
                <p>â€¢ TLì˜ ìµœëŒ€ 50%ë¥¼ TLCë¡œ ì±„êµ´ ê°€ëŠ¥</p>
                <p>â€¢ í”Œë«í¼ ìˆ˜ìˆ˜ë£Œ 10% (ê¸ˆ êµ¬ë§¤ì— ì‚¬ìš©)</p>
                <p>â€¢ TLCëŠ” TON ë¸”ë¡ì²´ì¸ ê¸°ë°˜ í† í°</p>
                <p>â€¢ ì‹¤ì‹œê°„ ë¸”ë¡ì²´ì¸ ì „ì†¡ ê°€ëŠ¥</p>
            </div>
        </div>
    </div>

</div>

</div>

<script>
// ==================== INDEXEDDB HELPER ====================
const DB = {
    dbName: 'TimeLinkDB',
    storeName: 'files',
    db: null,
    blobUrls: {}, // Blob URL ìºì‹œ

    // IndexedDB ì™„ì „ ì´ˆê¸°í™”
    async reset() {
        console.log('ğŸ”„ IndexedDB ì™„ì „ ì´ˆê¸°í™” ì¤‘...');
        
        // ê¸°ì¡´ DB ë‹«ê¸°
        if (this.db) {
            this.db.close();
            this.db = null;
        }
        
        // Blob URL ëª¨ë‘ í•´ì œ
        this.revokeAllBlobUrls();
        
        // DB ì‚­ì œ
        return new Promise((resolve, reject) => {
            const request = indexedDB.deleteDatabase(this.dbName);
            request.onsuccess = () => {
                console.log('âœ… IndexedDB ì‚­ì œ ì™„ë£Œ');
                resolve();
            };
            request.onerror = () => {
                console.error('âŒ IndexedDB ì‚­ì œ ì‹¤íŒ¨:', request.error);
                reject(request.error);
            };
            request.onblocked = () => {
                console.warn('âš ï¸ IndexedDB ì‚­ì œê°€ ì°¨ë‹¨ë¨ - ë‹¤ë¥¸ íƒ­ì„ ë‹«ì•„ì£¼ì„¸ìš”');
            };
        });
    },

    async open() {
        return new Promise((resolve, reject) => {
            const request = indexedDB.open(this.dbName, 4); // ë²„ì „ 4ë¡œ ìƒí–¥
            
            request.onerror = () => {
                console.error('âŒ IndexedDB ì—´ê¸° ì‹¤íŒ¨:', request.error);
                reject(request.error);
            };
            
            request.onsuccess = () => {
                this.db = request.result;
                console.log('âœ… IndexedDB ì—´ê¸° ì„±ê³µ (ë²„ì „ ' + this.db.version + ')');
                resolve();
            };
            
            request.onupgradeneeded = (event) => {
                console.log('ğŸ”„ IndexedDB ì—…ê·¸ë ˆì´ë“œ ì¤‘... (ë²„ì „ ' + event.oldVersion + ' â†’ ' + event.newVersion + ')');
                const db = event.target.result;
                
                // ê¸°ì¡´ ìŠ¤í† ì–´ ì‚­ì œ (ê¹¨ë—í•˜ê²Œ ì‹œì‘)
                if (db.objectStoreNames.contains(this.storeName)) {
                    db.deleteObjectStore(this.storeName);
                    console.log('ğŸ—‘ï¸ ê¸°ì¡´ ìŠ¤í† ì–´ ì‚­ì œ');
                }
                
                // ìƒˆ ìŠ¤í† ì–´ ìƒì„±
                db.createObjectStore(this.storeName, { keyPath: 'id' });
                console.log('âœ… ìƒˆ ìŠ¤í† ì–´ ìƒì„± ì™„ë£Œ');
            };
            
            request.onblocked = () => {
                console.warn('âš ï¸ IndexedDBê°€ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ë¥¸ íƒ­ì„ ë‹«ì•„ì£¼ì„¸ìš”.');
            };
        });
    },

    // ArrayBufferë¡œ ì €ì¥
    async saveFile(fileData) {
        if (!this.db) await this.open();
        return new Promise((resolve, reject) => {
            const transaction = this.db.transaction([this.storeName], 'readwrite');
            const store = transaction.objectStore(this.storeName);
            const request = store.put(fileData);
            request.onsuccess = () => resolve();
            request.onerror = () => reject(request.error);
        });
    },

    // ArrayBuffer ê°€ì ¸ì˜¤ê¸°
    async getFile(id) {
        if (!this.db) await this.open();
        return new Promise((resolve, reject) => {
            const transaction = this.db.transaction([this.storeName], 'readonly');
            const store = transaction.objectStore(this.storeName);
            const request = store.get(id);
            request.onsuccess = () => resolve(request.result);
            request.onerror = () => reject(request.error);
        });
    },

    async deleteFile(id) {
        if (!this.db) await this.open();
        
        // Blob URL í•´ì œ
        if (this.blobUrls[id]) {
            URL.revokeObjectURL(this.blobUrls[id]);
            delete this.blobUrls[id];
        }
        
        return new Promise((resolve, reject) => {
            const transaction = this.db.transaction([this.storeName], 'readwrite');
            const store = transaction.objectStore(this.storeName);
            const request = store.delete(id);
            request.onsuccess = () => resolve();
            request.onerror = () => reject(request.error);
        });
    },

    // ArrayBufferë¥¼ Blob URLë¡œ ë³€í™˜
    async getBlobUrl(id, mimeType) {
        // ìºì‹œëœ URLì´ ìˆìœ¼ë©´ ì¬ì‚¬ìš©
        if (this.blobUrls[id]) {
            console.log('âœ… ìºì‹œëœ Blob URL ì‚¬ìš©:', id);
            return this.blobUrls[id];
        }
        
        const fileData = await this.getFile(id);
        if (!fileData) {
            throw new Error('íŒŒì¼ ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. íŒŒì¼ì„ ë‹¤ì‹œ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.');
        }
        
        if (!fileData.arrayBuffer) {
            throw new Error('íŒŒì¼ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤. ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ë¦¬ì…‹í•˜ê³  íŒŒì¼ì„ ë‹¤ì‹œ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.');
        }
        
        console.log('âœ… ArrayBuffer í˜•ì‹ í™•ì¸:', {
            id: id,
            bufferSize: fileData.arrayBuffer.byteLength,
            mimeType: mimeType
        });
        
        const blob = new Blob([fileData.arrayBuffer], { type: mimeType });
        const blobUrl = URL.createObjectURL(blob);
        
        // ìºì‹œì— ì €ì¥
        this.blobUrls[id] = blobUrl;
        
        console.log('âœ… Blob URL ìƒì„± ì™„ë£Œ:', {
            id: id,
            blobUrl: blobUrl,
            blobSize: blob.size
        });
        
        return blobUrl;
    },

    // ëª¨ë“  Blob URL í•´ì œ
    revokeAllBlobUrls() {
        Object.values(this.blobUrls).forEach(url => URL.revokeObjectURL(url));
        this.blobUrls = {};
    }
};

// ==================== USER AUTHENTICATION SYSTEM ====================
const Auth = {
    currentUser: null,

    async init() {
        try {
            await DB.open();
        } catch (error) {
            console.error('âŒ IndexedDB ì—´ê¸° ì˜¤ë¥˜:', error);
            
            // ë²„ì „ ì˜¤ë¥˜ì¸ ê²½ìš° ì™„ì „ ì´ˆê¸°í™”
            if (error.name === 'VersionError') {
                console.log('ğŸ”„ ë²„ì „ ì¶©ëŒ ê°ì§€ - IndexedDB ì´ˆê¸°í™” ì¤‘...');
                await DB.reset();
                await DB.open();
                console.log('âœ… IndexedDB ì´ˆê¸°í™” ì™„ë£Œ');
            } else {
                throw error;
            }
        }
        
        console.log('ğŸ”„ TimeLink ì´ˆê¸°í™” ì¤‘...');
        
        const savedUser = localStorage.getItem('timelink_current_user');
        if (savedUser) {
            this.currentUser = JSON.parse(savedUser);
            await App.loadUserData();
            this.showMainApp();
        } else {
            this.showLoginScreen();
        }
    },

    showLoginScreen() {
        document.getElementById('authScreen').style.display = 'flex';
        document.getElementById('mainApp').style.display = 'none';
    },

    showMainApp() {
        document.getElementById('authScreen').style.display = 'none';
        document.getElementById('mainApp').style.display = 'block';
        document.getElementById('userName').textContent = this.currentUser.name;
        App.updateAll();
    },

    async register() {
        const name = document.getElementById('regName').value.trim();
        const email = document.getElementById('regEmail').value.trim().toLowerCase();
        const password = document.getElementById('regPassword').value;
        const accountType = document.getElementById('accountType').value;

        if (!name || !email || !password) {
            this.showAuthMessage('ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”', 'error');
            return;
        }

        if (password.length < 6) {
            this.showAuthMessage('ë¹„ë°€ë²ˆí˜¸ëŠ” ìµœì†Œ 6ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤', 'error');
            return;
        }

        const users = this.getAllUsers();
        if (users[email]) {
            this.showAuthMessage('ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì´ë©”ì¼ì…ë‹ˆë‹¤', 'error');
            return;
        }

        const newUser = {
            name,
            email,
            password,
            accountType: accountType || 'personal',
            createdAt: Date.now(),
            wallet: { tl: 10000, tlc: 0 },
            files: [],
            gold: 0
        };
        
        // ì‚¬ì—…ì íšŒì›ì¸ ê²½ìš° ì¹´í˜ ì •ë³´ ì¶”ê°€
        if (accountType === 'business') {
            const cafeName = document.getElementById('cafeName').value.trim();
            const cafeLocation = document.getElementById('cafeLocation').value.trim();
            const cafeDescription = document.getElementById('cafeDescription').value.trim();
            const cafeImage = document.getElementById('cafeImage').value.trim();
            const cafeHours = document.getElementById('cafeHours').value.trim();
            
            newUser.cafeInfo = {
                name: cafeName || '',
                location: cafeLocation || '',
                description: cafeDescription || '',
                image: cafeImage || '',
                hours: cafeHours || '',
                comments: []
            };
        }

        users[email] = newUser;
        localStorage.setItem('timelink_users', JSON.stringify(users));

        this.currentUser = newUser;
        localStorage.setItem('timelink_current_user', JSON.stringify(newUser));
        this.showMainApp();
        
        if (accountType === 'business') {
            App.toast('âœ… ì‚¬ì—…ì íšŒì›ê°€ì… ì™„ë£Œ! ì¹´í˜ê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
        } else {
            App.toast('âœ… íšŒì›ê°€ì… ì™„ë£Œ! ìë™ ë¡œê·¸ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }
    },

    async login() {
        const email = document.getElementById('loginEmail').value.trim().toLowerCase();
        const password = document.getElementById('loginPassword').value;

        if (!email || !password) {
            this.showAuthMessage('ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”', 'error');
            return;
        }

        const users = this.getAllUsers();
        const user = users[email];

        if (!user) {
            this.showAuthMessage('ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì´ë©”ì¼ì…ë‹ˆë‹¤', 'error');
            return;
        }

        if (user.password !== password) {
            this.showAuthMessage('ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤', 'error');
            return;
        }

        this.currentUser = user;
        localStorage.setItem('timelink_current_user', JSON.stringify(user));

        await App.loadUserData();
        this.showAuthMessage('âœ… ë¡œê·¸ì¸ ì„±ê³µ!', 'success');
        
        setTimeout(() => {
            this.showMainApp();
        }, 500);
    },

    async logout() {
        if (confirm('ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nëª¨ë“  ì—…ë¡œë“œëœ íŒŒì¼ ë°ì´í„°ë„ ì‚­ì œë©ë‹ˆë‹¤.')) {
            await this.saveUserData();
            
            // IndexedDB ì™„ì „ ì´ˆê¸°í™”
            try {
                await DB.reset();
                console.log('âœ… IndexedDB ì´ˆê¸°í™” ì™„ë£Œ');
            } catch (error) {
                console.error('âš ï¸ IndexedDB ì´ˆê¸°í™” ì˜¤ë¥˜:', error);
            }
            
            // ë‹¤ì‹œ ì—´ê¸°
            await DB.open();
            
            localStorage.removeItem('timelink_current_user');
            this.currentUser = null;
            
            App.wallet = { tl: 0, tlc: 0 };
            App.files = [];
            App.gold = 0;
            
            this.showLoginScreen();
            App.toast('ë¡œê·¸ì•„ì›ƒ ë˜ì—ˆìŠµë‹ˆë‹¤');
        }
    },

    getAllUsers() {
        const usersData = localStorage.getItem('timelink_users');
        return usersData ? JSON.parse(usersData) : {};
    },

    async saveUserData() {
        if (!this.currentUser) return;

        const users = this.getAllUsers();
        const userCopy = { ...this.currentUser };
        userCopy.files = App.files.map(f => {
            const { url, ...meta } = f;
            return meta;
        });
        userCopy.wallet = App.wallet;
        userCopy.gold = App.gold;
        users[this.currentUser.email] = userCopy;
        localStorage.setItem('timelink_users', JSON.stringify(users));
        localStorage.setItem('timelink_current_user', JSON.stringify(userCopy));
    },

    switchAuthMode(mode) {
        document.getElementById('loginForm').style.display = mode === 'login' ? 'block' : 'none';
        document.getElementById('registerForm').style.display = mode === 'register' ? 'block' : 'none';
    },

    showAuthMessage(msg, type) {
        const messageEl = document.getElementById('authMessage');
        messageEl.textContent = msg;
        messageEl.style.display = 'block';
        messageEl.style.background = type === 'success' ? 'rgba(29,185,84,0.2)' : 'rgba(255,68,68,0.2)';
        messageEl.style.color = type === 'success' ? '#1db954' : '#ff4444';
        messageEl.style.border = `1px solid ${type === 'success' ? '#1db954' : '#ff4444'}`;
        
        setTimeout(() => {
            messageEl.style.display = 'none';
        }, 3000);
    }
};

// ==================== MAIN APP ====================
const App = {
    wallet: { tl: 10000, tlc: 0 },
    files: [],
    gold: 0,
    goldHistory: [], // ê¸ˆ ì¶•ì  ë‚´ì—­
    goldPeriod: 'week', // ê·¸ë˜í”„ ê¸°ê°„
    walletHistory: [], // TLC ì§€ê°‘ ê±°ë˜ ë‚´ì—­
    tlcPrice: 1.00, // TLC ê°€ê²© (USD)
    type: 'audio',
    selectedFile: null,
    selectedFileDuration: 0,
    chargeTarget: null,
    playInterval: null,
    currentFile: null,
    currentGenre: 'all',
    ci: 1.0,
    // ê° ëª¨ë“œë³„ ìƒíƒœ
    cafeActive: false,
    cafeMood: 'chill',
    cafeQueue: [],
    cafeIndex: 0,
    cafeListeners: 0,
    cafeTotalPlays: 0,
    carWalkActive: false,
    movementMultiplier: 1.0,
    lectureActive: false,
    lectureProgress: 0,

    init() {
        const fileInput = document.getElementById('fileInput');
        fileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (!file) return;
            
            if (!file.type.startsWith('audio/') && !file.type.startsWith('video/')) {
                App.toast('ì˜¤ë””ì˜¤ ë˜ëŠ” ë¹„ë””ì˜¤ íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤');
                e.target.value = '';
                return;
            }
            
            App.selectedFile = file;
            
            document.getElementById('infoFileName').textContent = file.name;
            document.getElementById('infoFileSize').textContent = (file.size / 1024 / 1024).toFixed(2) + ' MB';
            document.getElementById('infoType').textContent = App.type === 'audio' ? 'TL3 (ì˜¤ë””ì˜¤)' : 'TL4 (ë¹„ë””ì˜¤)';
            document.getElementById('infoDuration').textContent = 'ê³„ì‚° ì¤‘...';
            document.getElementById('durationBadge').textContent = 'â±ï¸ ê³„ì‚° ì¤‘';
            
            if (file.type.startsWith('audio/')) {
                const audio = new Audio();
                audio.src = URL.createObjectURL(file);
                audio.onloadedmetadata = function() {
                    const duration = Math.floor(audio.duration);
                    App.selectedFileDuration = duration;
                    const minutes = Math.floor(duration / 60);
                    const seconds = duration % 60;
                    document.getElementById('infoDuration').textContent = `${minutes}:${seconds.toString().padStart(2, '0')} (${duration}ì´ˆ)`;
                    document.getElementById('durationBadge').textContent = `â±ï¸ ${minutes}:${seconds.toString().padStart(2, '0')}`;
                    URL.revokeObjectURL(audio.src);
                };
                audio.onerror = function() {
                    document.getElementById('infoDuration').textContent = 'ê¸¸ì´ë¥¼ í™•ì¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤';
                    document.getElementById('durationBadge').textContent = 'â±ï¸ --:--';
                    App.selectedFileDuration = 180;
                };
            } else if (file.type.startsWith('video/')) {
                const video = document.createElement('video');
                video.preload = 'metadata';
                video.src = URL.createObjectURL(file);
                video.onloadedmetadata = function() {
                    const duration = Math.floor(video.duration);
                    App.selectedFileDuration = duration;
                    const minutes = Math.floor(duration / 60);
                    const seconds = duration % 60;
                    document.getElementById('infoDuration').textContent = `${minutes}:${seconds.toString().padStart(2, '0')} (${duration}ì´ˆ)`;
                    document.getElementById('durationBadge').textContent = `â±ï¸ ${minutes}:${seconds.toString().padStart(2, '0')}`;
                    URL.revokeObjectURL(video.src);
                };
                video.onerror = function() {
                    document.getElementById('infoDuration').textContent = 'ê¸¸ì´ë¥¼ í™•ì¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤';
                    document.getElementById('durationBadge').textContent = 'â±ï¸ --:--';
                    App.selectedFileDuration = 180;
                };
            }
            
            document.getElementById('uploadForm').style.display = 'block';
            document.getElementById('fileTitle').value = file.name.replace(/\.[^/.]+$/, '');
            
            App.toast(`íŒŒì¼ ì„ íƒ ì™„ë£Œ: ${file.name}`);
        });

        setInterval(() => {
            App.ci = 1.0 + Math.random();
            const ciEl = document.getElementById('ciValue');
            if (ciEl) ciEl.textContent = App.ci.toFixed(2) + 'x';
            const ciWalletEl = document.getElementById('ciValueWallet');
            if (ciWalletEl) ciWalletEl.textContent = App.ci.toFixed(2) + 'x';
        }, 3000);

        // ì´ˆê¸° ê¸ˆ ì°¨íŠ¸ ê·¸ë¦¬ê¸°
        setTimeout(() => {
            App.drawGoldChart();
        }, 1000);

        App.updateAll();
    },

    async loadUserData() {
        if (!Auth.currentUser) return;
        
        this.wallet = Auth.currentUser.wallet || { tl: 10000, tlc: 0 };
        this.gold = Auth.currentUser.gold || 0;
        
        // ë©”íƒ€ë°ì´í„°ë§Œ ë¡œë“œ (ì¬ìƒ ì‹œ Blob URL ë™ì  ìƒì„±)
        const metaFiles = Auth.currentUser.files || [];
        this.files = [...metaFiles];
        
        console.log('âœ… ì‚¬ìš©ì ë°ì´í„° ë¡œë“œ ì™„ë£Œ:', {
            files: this.files.length,
            tl: this.wallet.tl,
            tlc: this.wallet.tlc
        });
        
        this.updateAll();
    },

    selectType(type) {
        this.type = type;
        document.getElementById('audioCard').classList.toggle('selected', type === 'audio');
        document.getElementById('videoCard').classList.toggle('selected', type === 'video');
        
        const icons = { audio: 'ğŸµ', video: 'ğŸ¬' };
        const titles = { audio: 'íŒŒì¼ ì„ íƒí•˜ê¸°', video: 'ë¹„ë””ì˜¤ ì„ íƒí•˜ê¸°' };
        const descs = { audio: 'MP3, WAV, FLAC', video: 'MP4, MOV, AVI' };
        
        document.getElementById('uploadIcon').textContent = icons[type];
        document.getElementById('uploadTitle').textContent = titles[type];
        document.getElementById('uploadDesc').textContent = descs[type];
        document.getElementById('fileInput').accept = type === 'audio' ? 'audio/*' : 'video/*';
    },

    async convert() {
        if (!this.selectedFile) return this.toast('íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”');
        
        const title = document.getElementById('fileTitle').value.trim();
        const creator = document.getElementById('fileCreator').value.trim();
        const tool = document.getElementById('creatorTool').value;
        const genre = document.getElementById('fileGenre').value;
        const mood = document.getElementById('fileMood').value;
        const desc = document.getElementById('fileDesc').value;
        const revenue = document.getElementById('revenue').value;
        
        if (!title) return this.toast('ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”');
        if (!creator) return this.toast('ì°½ì‘ì ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”');
        
        const isVideo = this.selectedFile.type.startsWith('video');
        const isAudio = this.selectedFile.type.startsWith('audio');
        
        if (!isVideo && !isAudio) {
            return this.toast('ì˜¤ë””ì˜¤ ë˜ëŠ” ë¹„ë””ì˜¤ íŒŒì¼ë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤');
        }
        
        const fileSizeMB = (this.selectedFile.size / 1024 / 1024).toFixed(1);
        
        const certified = tool === 'suno' || tool === 'udio';
        
        this.toast('â³ íŒŒì¼ ë³€í™˜ ì¤‘... ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš” (íŒŒì¼ í¬ê¸°: ' + fileSizeMB + 'MB)');
        
        const reader = new FileReader();
        
        reader.onload = async (e) => {
            try {
                const arrayBuffer = e.target.result;
                
                if (!arrayBuffer) {
                    throw new Error('íŒŒì¼ì„ ì½ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                }
                
                console.log('âœ… íŒŒì¼ ì½ê¸° ì„±ê³µ:', {
                    title,
                    type: this.selectedFile.type,
                    size: fileSizeMB + 'MB',
                    bufferSize: arrayBuffer.byteLength
                });
                
                const newFile = {
                    id: Date.now(),
                    title,
                    creator,
                    tool,
                    genre,
                    mood,
                    desc,
                    type: isVideo ? 'TL4' : 'TL3',
                    fileType: isVideo ? 'video' : 'audio',
                    mimeType: this.selectedFile.type,
                    certified,
                    revenue,
                    balance: 0,
                    duration: this.selectedFileDuration || 0,
                    fileSizeMB: fileSizeMB,
                    shared: false,
                    createdAt: new Date().toISOString()
                };
                
                // IndexedDBì— ArrayBufferë¡œ ì €ì¥
                await DB.saveFile({ 
                    id: newFile.id, 
                    arrayBuffer: arrayBuffer,
                    mimeType: this.selectedFile.type
                });
                console.log('âœ… IndexedDB ì €ì¥ ì™„ë£Œ');
                
                // ë©”ëª¨ë¦¬ì— ë©”íƒ€ë°ì´í„°ë§Œ ì¶”ê°€ (ArrayBufferëŠ” ì œì™¸)
                this.files.push(newFile);
                
                // localStorageì— ë©”íƒ€ë°ì´í„° ì €ì¥
                await Auth.saveUserData();
                console.log('âœ… ë©”íƒ€ë°ì´í„° ì €ì¥ ì™„ë£Œ');
                
                this.toast(`âœ… ${newFile.type} ë³€í™˜ ì™„ë£Œ! (${fileSizeMB}MB)` + (certified ? ' (ìë™ ì¸ì¦)' : ''));
                
                // í¼ ì´ˆê¸°í™”
                document.getElementById('uploadForm').style.display = 'none';
                document.getElementById('fileInput').value = '';
                this.selectedFile = null;
                this.selectedFileDuration = 0;
                
                // My Files íƒ­ìœ¼ë¡œ ì´ë™
                this.switchTab('myfiles');
                this.updateAll();
                
            } catch (error) {
                console.error('âŒ ë³€í™˜ ì¤‘ ì˜¤ë¥˜:', error);
                this.toast('íŒŒì¼ ë³€í™˜ ì¤‘ ì˜¤ë¥˜: ' + error.message);
            }
        };
        
        reader.onerror = (e) => {
            console.error('âŒ íŒŒì¼ ì½ê¸° ì˜¤ë¥˜:', e);
            this.toast('íŒŒì¼ ì½ê¸° ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤');
        };
        
        // ArrayBufferë¡œ ì½ê¸° (Data URL ëŒ€ì‹ )
        reader.readAsArrayBuffer(this.selectedFile);
    },

    getCoverImage(file) {
        const byGenre = {
            pop: 'https://images.unsplash.com/photo-1501386761578-eac5c94b800a?auto=format&fit=crop&w=1200&q=80',
            rock: 'https://images.unsplash.com/photo-1498038432885-c6f3f1b912ee?auto=format&fit=crop&w=1200&q=80',
            hiphop: 'https://images.unsplash.com/photo-1571260899304-425eee4c7efc?auto=format&fit=crop&w=1200&q=80',
            jazz: 'https://images.unsplash.com/photo-1511192336575-5a79af67a629?auto=format&fit=crop&w=1200&q=80',
            classic: 'https://images.unsplash.com/photo-1465847899084-d164df4dedc6?auto=format&fit=crop&w=1200&q=80',
            edm: 'https://images.unsplash.com/photo-1574391884720-bbc7f31f3f8a?auto=format&fit=crop&w=1200&q=80',
            kpop: 'https://images.unsplash.com/photo-1619983081563-430f63602796?auto=format&fit=crop&w=1200&q=80',
            indie: 'https://images.unsplash.com/photo-1516280440614-37939bbacd81?auto=format&fit=crop&w=1200&q=80'
        };
        return byGenre[file.genre] || 'https://images.unsplash.com/photo-1493225457124-a3eb161ffa5f?auto=format&fit=crop&w=1200&q=80';
    },

    renderMyFiles() {
        const el = document.getElementById('myFilesList');
        if (this.files.length === 0) {
            el.innerHTML = '<div style="text-align:center;padding:60px;color:#666">ğŸ“ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤</div>';
            return;
        }
        
        const genreEmoji = {pop:'ğŸ¤',rock:'ğŸ¸',hiphop:'ğŸ§',jazz:'ğŸº',classic:'ğŸ»',edm:'ğŸ’¿',kpop:'ğŸ‡°ğŸ‡·',indie:'ğŸ¹'};
        const genreColor = {pop:'#ff6b6b',rock:'#4ecdc4',hiphop:'#ffd93d',jazz:'#a8e6cf',classic:'#b39eb5',edm:'#ff8a5c',kpop:'#ff1493',indie:'#9370db'};
        
        el.innerHTML = this.files.map(f => `
            <div class="file-card">
                <div class="thumb thumb-media ${f.fileType}" style="background-image:linear-gradient(130deg, rgba(0,0,0,0.2), rgba(0,0,0,0.65)), url('${this.getCoverImage(f)}');">
                    <div class="thumb-icon">${f.type==='TL4'?'ğŸ¬':'ğŸµ'}</div>
                    <span class="badge badge-type">${f.type}</span>
                    ${f.certified?'<span class="badge badge-cert">âœ“ ì¸ì¦</span>':''}
                    <span class="badge badge-genre" style="background:${genreColor[f.genre]||'#666'}">${genreEmoji[f.genre]||'ğŸµ'}</span>
                </div>
                <div class="info">
                    <div class="name">${f.title}</div>
                    <div class="creator">${f.creator} Â· ${f.tool}</div>
                    <div class="panel">
                        <strong>â³ TL Balance</strong><br>
                        <span style="font-size:1.6rem;font-weight:800;">${f.balance.toLocaleString()}</span> TL
                    </div>
                    <div class="actions">
                        ${f.balance > 0 ?
                            `<button class="btn btn-play" onclick="App.play(${f.id})">â–¶ï¸ ì¬ìƒ</button>` :
                            `<button class="btn btn-disabled" disabled>âš ï¸ TL ì¶©ì „ í•„ìš”</button>`
                        }
                        <button class="btn btn-charge" onclick="App.openCharge(${f.id})">ğŸ’° ì¶©ì „</button>
                        ${!f.shared?
                            `<button class="btn btn-share" onclick="App.share(${f.id})">ğŸ”„ ê³µìœ </button>`:
                            `<button class="btn" style="background:#555;color:#999;" disabled>âœ“ ê³µìœ ë¨</button>`
                        }
                    </div>
                </div>
            </div>
        `).join('');
    },

    renderSharePlace() {
        const el = document.getElementById('sharePlaceContent');
        const sharedFiles = this.files.filter(f => f.shared);
        
        if (sharedFiles.length === 0) {
            el.innerHTML = '<div style="text-align:center;padding:60px;color:#666">ğŸ”„ ê³µìœ ëœ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤</div>';
            return;
        }
        
        let filtered = sharedFiles;
        if (this.currentGenre !== 'all') {
            filtered = filtered.filter(f => f.genre === this.currentGenre);
        }
        
        const moods = {
            energetic: 'ğŸ”¥ Energetic',
            chill: 'ğŸ˜Œ Chill',
            focus: 'ğŸ¯ Focus',
            workout: 'ğŸ’ª Workout',
            romantic: 'ğŸ’• Romantic',
            sad: 'ğŸ˜¢ Sad',
            happy: 'ğŸ˜Š Happy',
            sleep: 'ğŸ˜´ Sleep'
        };
        
        const genreEmoji = {pop:'ğŸ¤',rock:'ğŸ¸',hiphop:'ğŸ§',jazz:'ğŸº',classic:'ğŸ»',edm:'ğŸ’¿',kpop:'ğŸ‡°ğŸ‡·',indie:'ğŸ¹'};
        const genreColor = {pop:'#ff6b6b',rock:'#4ecdc4',hiphop:'#ffd93d',jazz:'#a8e6cf',classic:'#b39eb5',edm:'#ff8a5c',kpop:'#ff1493',indie:'#9370db'};
        
        let html = '';
        Object.keys(moods).forEach(mood => {
            const moodFiles = filtered.filter(f => f.mood === mood);
            if (moodFiles.length === 0) return;
            
            html += `
                <div style="margin-bottom:40px;">
                    <h3 style="margin-bottom:20px; font-size:1.4rem;">${moods[mood]}</h3>
                    <div class="grid">
                        ${moodFiles.map(f => `
                            <div class="file-card" onclick="App.listenShared(${f.id})">
                                <div class="thumb thumb-media ${f.fileType}" style="background-image:linear-gradient(130deg, rgba(0,0,0,0.2), rgba(0,0,0,0.65)), url('${this.getCoverImage(f)}');">
                                    <div class="thumb-icon">${f.type==='TL4'?'ğŸ¬':'ğŸµ'}</div>
                                    <span class="badge badge-type">${f.type}</span>
                                    <span class="badge badge-genre" style="background:${genreColor[f.genre]||'#666'}">${genreEmoji[f.genre]||'ğŸµ'}</span>
                                </div>
                                <div class="info">
                                    <div class="name">${f.title}</div>
                                    <div class="creator">${f.creator}</div>
                                    <div class="panel">
                                        <strong>ìˆ˜ìµ ê³„ì•½</strong><br>
                                        ${f.revenue==='55'?'ì°½ì‘ì 50% / í”Œë«í¼ 50%':'ì°½ì‘ì 70% / í”Œë«í¼ 30%'}
                                    </div>
                                    <button class="btn btn-play" onclick="event.stopPropagation(); App.listenShared(${f.id})" style="width:100%;">
                                        ğŸ§ ì²­ì·¨ (1 TL/sec)
                                    </button>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        });
        
        el.innerHTML = html;
    },

    openCharge(id) {
        const file = this.files.find(f => f.id === id);
        if (!file) return this.toast('íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
        if (this.wallet.tl <= 0) return this.toast('ë³´ìœ  TLì´ ì—†ìŠµë‹ˆë‹¤');
        
        this.chargeTarget = id;
        const chargeInput = document.getElementById('chargeAmount');
        chargeInput.value = Math.min(1000, this.wallet.tl);
        chargeInput.max = this.wallet.tl;
        document.getElementById('chargeModal').style.display = 'flex';
    },

    async executeCharge() {
        if (!this.chargeTarget) {
            this.toast('ì¶©ì „ ëŒ€ìƒì´ ì—†ìŠµë‹ˆë‹¤');
            this.closeModal();
            return;
        }

        const file = this.files.find(f => f.id === this.chargeTarget);
        if (!file) {
            this.toast('íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
            this.closeModal();
            return;
        }

        const amtInput = document.getElementById('chargeAmount');
        let amt = parseInt(amtInput.value);
        if (isNaN(amt) || amt <= 0) {
            this.toast('ì˜¬ë°”ë¥¸ ê¸ˆì•¡ì„ ì…ë ¥í•˜ì„¸ìš”');
            return;
        }

        if (amt > this.wallet.tl) {
            this.toast(`TLì´ ë¶€ì¡±í•©ë‹ˆë‹¤ (ë³´ìœ : ${this.wallet.tl.toLocaleString()} TL)`);
            return;
        }

        this.wallet.tl -= amt;
        file.balance += amt;

        await Auth.saveUserData();
        this.updateAll();
        this.closeModal();
        this.toast(`âœ… ${amt.toLocaleString()} TL ì¶©ì „ ì™„ë£Œ!`);
    },

    async play(id) {
        const file = this.files.find(f => f.id === id);
        if (!file) {
            console.error('âŒ íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ:', id);
            return this.toast('íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
        }
        if (file.balance <= 0) {
            console.warn('âš ï¸ TL ì”ì•¡ ë¶€ì¡±:', file.balance);
            return this.toast('TLì„ ì¶©ì „í•˜ì„¸ìš”');
        }
        
        try {
            console.log('ğŸµ ì¬ìƒ ì¤€ë¹„ ì‹œì‘:', {
                id: file.id,
                title: file.title,
                type: file.fileType,
                mimeType: file.mimeType
            });
            
            // IndexedDBì—ì„œ ë°ì´í„° í™•ì¸
            const fileData = await DB.getFile(file.id);
            console.log('ğŸ“¦ IndexedDB ë°ì´í„° í™•ì¸:', {
                found: !!fileData,
                hasArrayBuffer: !!(fileData && fileData.arrayBuffer),
                bufferSize: fileData && fileData.arrayBuffer ? fileData.arrayBuffer.byteLength : 0
            });
            
            if (!fileData || !fileData.arrayBuffer) {
                throw new Error('IndexedDBì— íŒŒì¼ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. íŒŒì¼ì„ ë‹¤ì‹œ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.');
            }
            
            // Blob URL ìƒì„±
            const blobUrl = await DB.getBlobUrl(file.id, file.mimeType);
            console.log('âœ… Blob URL ìƒì„± ì™„ë£Œ:', blobUrl);
            
            this.currentFile = file;
            
            if (file.fileType === 'video') {
                const video = document.createElement('video');
                video.controls = true;
                video.autoplay = true;
                video.style.cssText = 'position:fixed; top:0; left:0; width:100%; height:100vh; z-index:10000; background:black;';
                video.src = blobUrl;
                
                video.onerror = (e) => {
                    console.error('âŒ ë¹„ë””ì˜¤ ì¬ìƒ ì˜¤ë¥˜:', e, video.error);
                    this.toast('ë¹„ë””ì˜¤ ì¬ìƒ ì˜¤ë¥˜');
                    if (document.body.contains(video)) document.body.removeChild(video);
                    if (closeBtn && document.body.contains(closeBtn)) document.body.removeChild(closeBtn);
                };
                
                const closeBtn = document.createElement('button');
                closeBtn.textContent = 'âœ• ë‹«ê¸°';
                closeBtn.style.cssText = 'position:fixed; top:20px; right:20px; z-index:10001; background:#f44; color:white; border:none; border-radius:8px; padding:12px 24px; font-size:16px; font-weight:700; cursor:pointer;';
                closeBtn.onclick = () => {
                    this.stopPlay();
                    if (document.body.contains(video)) document.body.removeChild(video);
                    if (document.body.contains(closeBtn)) document.body.removeChild(closeBtn);
                };
                
                document.body.appendChild(video);
                document.body.appendChild(closeBtn);
                
                this.toast('ğŸ¬ ë¹„ë””ì˜¤ ì¬ìƒ ì¤‘');
                
                if (this.playInterval) clearInterval(this.playInterval);
                this.playInterval = setInterval(async () => {
                    if (file.balance > 0) {
                        file.balance -= 2;
                        await Auth.saveUserData();
                        if (file.balance <= 0) {
                            this.stopPlay();
                            if (document.body.contains(video)) document.body.removeChild(video);
                            if (document.body.contains(closeBtn)) document.body.removeChild(closeBtn);
                            this.toast('â¹ï¸ TL ì†Œì§„');
                        }
                    }
                }, 1000);
                
            } else {
                const audio = document.getElementById('audioPlayer');
                
                // ê¸°ì¡´ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±°
                const newAudio = audio.cloneNode(true);
                audio.parentNode.replaceChild(newAudio, audio);
                
                // ìƒˆë¡œìš´ ì°¸ì¡° ê°€ì ¸ì˜¤ê¸°
                const freshAudio = document.getElementById('audioPlayer');
                
                console.log('ğŸµ ì˜¤ë””ì˜¤ ì—˜ë¦¬ë¨¼íŠ¸ ì¤€ë¹„ ì™„ë£Œ');
                
                // Blob URL ì„¤ì •
                freshAudio.src = blobUrl;
                
                document.getElementById('audioModal').style.display = 'flex';
                document.getElementById('playTitle').textContent = file.title;
                document.getElementById('playCreator').textContent = file.creator;
                document.getElementById('playTL').textContent = file.balance;
                
                // í•œ ë²ˆë§Œ ì‹¤í–‰ë˜ëŠ” ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
                let hasStartedPlaying = false;
                
                freshAudio.addEventListener('canplaythrough', function playHandler() {
                    if (hasStartedPlaying) return;
                    hasStartedPlaying = true;
                    
                    console.log('âœ… ì˜¤ë””ì˜¤ ë¡œë“œ ì™„ë£Œ - ì¬ìƒ ì‹œì‘');
                    freshAudio.play()
                        .then(() => {
                            console.log('âœ… ì¬ìƒ ì„±ê³µ');
                            App.toast(`ğŸµ ${file.title} ì¬ìƒ ì¤‘`);
                        })
                        .catch(err => {
                            console.error('âŒ ì¬ìƒ ì‹œì‘ ì˜¤ë¥˜:', err);
                            App.toast('ì¬ìƒ ì˜¤ë¥˜: ' + err.message);
                            App.stopPlay();
                        });
                }, { once: true });
                
                freshAudio.addEventListener('error', function errorHandler(e) {
                    console.error('âŒ ì˜¤ë””ì˜¤ ì˜¤ë¥˜:', {
                        error: freshAudio.error,
                        code: freshAudio.error ? freshAudio.error.code : null,
                        message: freshAudio.error ? freshAudio.error.message : null,
                        src: freshAudio.src
                    });
                    
                    let errorMsg = 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜';
                    if (freshAudio.error) {
                        switch(freshAudio.error.code) {
                            case 1: errorMsg = 'MEDIA_ERR_ABORTED'; break;
                            case 2: errorMsg = 'MEDIA_ERR_NETWORK'; break;
                            case 3: errorMsg = 'MEDIA_ERR_DECODE'; break;
                            case 4: errorMsg = 'MEDIA_ERR_SRC_NOT_SUPPORTED'; break;
                        }
                    }
                    App.toast('ì˜¤ë””ì˜¤ ì˜¤ë¥˜: ' + errorMsg);
                    App.stopPlay();
                }, { once: true });
                
                console.log('ğŸµ ì˜¤ë””ì˜¤ ë¡œë“œ ì‹œì‘');
                freshAudio.load();
                
                if (this.playInterval) clearInterval(this.playInterval);
                this.playInterval = setInterval(async () => {
                    if (file.balance > 0 && !freshAudio.paused) {
                        file.balance -= 1;
                        document.getElementById('playTL').textContent = file.balance;
                        await Auth.saveUserData();
                        
                        if (file.balance <= 0) {
                            this.stopPlay();
                            this.toast('â¹ï¸ TL ì†Œì§„');
                        }
                    }
                }, 1000);
            }
        } catch (error) {
            console.error('âŒ ì¬ìƒ ì¤€ë¹„ ì˜¤ë¥˜:', error);
            this.toast('ì¬ìƒ ì¤€ë¹„ ì¤‘ ì˜¤ë¥˜: ' + error.message);
        }
    },

    async listenShared(id) {
        const file = this.files.find(f => f.id === id);
        if (!file) {
            console.error('âŒ íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ:', id);
            return this.toast('íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
        }
        if (this.wallet.tl <= 0) {
            console.warn('âš ï¸ TL ì”ì•¡ ë¶€ì¡±');
            return this.toast('TLì´ ë¶€ì¡±í•©ë‹ˆë‹¤');
        }
        
        try {
            console.log('ğŸ§ Share Place ì¬ìƒ ì¤€ë¹„:', {
                id: file.id,
                title: file.title,
                type: file.fileType,
                mimeType: file.mimeType
            });
            
            // IndexedDBì—ì„œ ë°ì´í„° í™•ì¸
            const fileData = await DB.getFile(file.id);
            if (!fileData || !fileData.arrayBuffer) {
                throw new Error('íŒŒì¼ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. íŒŒì¼ì„ ë‹¤ì‹œ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.');
            }
            
            // Blob URL ìƒì„±
            const blobUrl = await DB.getBlobUrl(file.id, file.mimeType);
            console.log('âœ… Blob URL ìƒì„± ì™„ë£Œ:', blobUrl);
            
            this.currentFile = file;
            
            const audio = document.getElementById('audioPlayer');
            
            // ê¸°ì¡´ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±°
            const newAudio = audio.cloneNode(true);
            audio.parentNode.replaceChild(newAudio, audio);
            
            // ìƒˆë¡œìš´ ì°¸ì¡° ê°€ì ¸ì˜¤ê¸°
            const freshAudio = document.getElementById('audioPlayer');
            
            // Blob URL ì„¤ì •
            freshAudio.src = blobUrl;
            
            document.getElementById('audioModal').style.display = 'flex';
            document.getElementById('playTitle').textContent = file.title;
            document.getElementById('playCreator').textContent = file.creator + ' (Share Place)';
            document.getElementById('playTL').textContent = this.wallet.tl;
            
            // í•œ ë²ˆë§Œ ì‹¤í–‰ë˜ëŠ” ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            let hasStartedPlaying = false;
            
            freshAudio.addEventListener('canplaythrough', function playHandler() {
                if (hasStartedPlaying) return;
                hasStartedPlaying = true;
                
                console.log('âœ… Share Place ì˜¤ë””ì˜¤ ë¡œë“œ ì™„ë£Œ');
                freshAudio.play()
                    .then(() => {
                        console.log('âœ… Share Place ì¬ìƒ ì‹œì‘');
                    })
                    .catch(err => {
                        console.error('âŒ Share Place ì¬ìƒ ì˜¤ë¥˜:', err);
                        App.toast('ì¬ìƒ ì˜¤ë¥˜: ' + err.message);
                        App.stopPlay();
                    });
            }, { once: true });
            
            freshAudio.addEventListener('error', function errorHandler(e) {
                console.error('âŒ Share Place ì˜¤ë””ì˜¤ ì˜¤ë¥˜:', freshAudio.error);
                App.toast('ì˜¤ë””ì˜¤ ë¡œë“œ ì˜¤ë¥˜');
                App.stopPlay();
            }, { once: true });
            
            freshAudio.load();
            
            if (this.playInterval) clearInterval(this.playInterval);
            this.playInterval = setInterval(async () => {
                if (this.wallet.tl > 0 && !freshAudio.paused) {
                    const cost = file.type === 'TL4' ? 2 : 1;
                    this.wallet.tl -= cost;
                    
                    const creatorShare = file.revenue === '55' ? 0.5 : 0.7;
                    const creatorEarn = cost * creatorShare;
                    file.balance += creatorEarn;
                    
                    const platformShare = cost * (1 - creatorShare);
                    const goldPurchase = platformShare * 0.1;
                    this.gold += goldPurchase / 1000;
                    
                    document.getElementById('playTL').textContent = this.wallet.tl;
                    await Auth.saveUserData();
                    this.updateAll();
                    
                    if (this.wallet.tl <= 0) {
                        this.stopPlay();
                        this.toast('â¹ï¸ TL ì†Œì§„');
                    }
                }
            }, 1000);
        } catch (error) {
            console.error('âŒ Share Place ì¬ìƒ ì¤€ë¹„ ì˜¤ë¥˜:', error);
            this.toast('ì¬ìƒ ì¤€ë¹„ ì¤‘ ì˜¤ë¥˜: ' + error.message);
        }
    },

    stopPlay() {
        if (this.playInterval) clearInterval(this.playInterval);
        
        const audio = document.getElementById('audioPlayer');
        audio.pause();
        audio.src = '';
        
        document.getElementById('audioModal').style.display = 'none';
        this.currentFile = null;
        Auth.saveUserData();
        this.updateAll();
    },

    async share(id) {
        const file = this.files.find(f => f.id === id);
        if (!file) return;
        if (!file.certified) return this.toast('ì¸ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤');
        
        file.shared = true;
        await Auth.saveUserData();
        this.toast(`ğŸ”„ ${file.title} Share Placeë¡œ ì´ë™!`);
        this.updateAll();
    },

    filterGenre(genre) {
        this.currentGenre = genre;
        document.querySelectorAll('.genre-btn').forEach(b => b.classList.remove('active'));
        event.target.classList.add('active');
        this.renderSharePlace();
    },

    searchShare() {
        // ê²€ìƒ‰ ê¸°ëŠ¥ (í–¥í›„ êµ¬í˜„)
    },

    async mine() {
        const amt = parseInt(document.getElementById('miningAmount').value) || 100;
        const max = Math.floor(this.wallet.tl * 0.5);
        
        if (amt > max) return this.toast(`í•œë„ ì´ˆê³¼! ìµœëŒ€ ${max} TL`);
        if (this.wallet.tl < amt) return this.toast('TL ë¶€ì¡±');
        
        const tlc = (amt * 0.01) * this.ci;
        this.wallet.tl -= amt;
        this.wallet.tlc += tlc;
        
        const platformFee = amt * 0.1;
        this.gold += (platformFee * 0.1) / 1000;
        
        await Auth.saveUserData();
        this.updateAll();
        this.toast(`â›ï¸ ${tlc.toFixed(2)} TLC ì±„êµ´!`);
    },

    async resetDatabase() {
        if (confirm('âš ï¸ ê²½ê³ !\n\nëª¨ë“  íŒŒì¼ ë°ì´í„°ê°€ ì‚­ì œë©ë‹ˆë‹¤.\nê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
            try {
                this.toast('ğŸ”„ ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™” ì¤‘...');
                
                // IndexedDB ì™„ì „ ì´ˆê¸°í™”
                await DB.reset();
                await DB.open();
                
                // ë©”íƒ€ë°ì´í„°ë„ ì´ˆê¸°í™”
                this.files = [];
                await Auth.saveUserData();
                
                this.updateAll();
                this.toast('âœ… ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™” ì™„ë£Œ!');
                
                console.log('âœ… ë°ì´í„°ë² ì´ìŠ¤ ë¦¬ì…‹ ì™„ë£Œ');
            } catch (error) {
                console.error('âŒ ë°ì´í„°ë² ì´ìŠ¤ ë¦¬ì…‹ ì˜¤ë¥˜:', error);
                this.toast('ì˜¤ë¥˜: ' + error.message);
            }
        }
    },

    // ==================== CAFE BROADCASTING ê¸°ëŠ¥ ====================
    setCafeMood(mood) {
        this.cafeMood = mood;
        
        // ë²„íŠ¼ í™œì„±í™” ìƒíƒœ ë³€ê²½
        const moods = ['chill', 'jazz', 'acoustic', 'study', 'morning', 'night'];
        moods.forEach(m => {
            const btn = document.getElementById('cafe' + m.charAt(0).toUpperCase() + m.slice(1));
            if (btn) {
                if (m === mood) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            }
        });
        
        // í˜„ì¬ ë¶„ìœ„ê¸° í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
        const moodTexts = {
            chill: 'ğŸ˜Œ Chill Cafe',
            jazz: 'ğŸº Jazz Lounge',
            acoustic: 'ğŸ¸ Acoustic',
            study: 'ğŸ“š Study Cafe',
            morning: 'ğŸŒ… Morning',
            night: 'ğŸŒ™ Night'
        };
        
        const currentMoodEl = document.getElementById('cafeCurrentMood');
        if (currentMoodEl) {
            currentMoodEl.textContent = moodTexts[mood] || 'ğŸ˜Œ Chill Cafe';
        }
        
        // ì¹´í˜ ì¬ìƒ ì¤‘ì´ë©´ í ì—…ë°ì´íŠ¸
        if (this.cafeActive) {
            this.updateCafeQueue();
            this.toast(`â˜• ë¶„ìœ„ê¸° ë³€ê²½: ${moodTexts[mood]}`);
        }
    },

    updateCafeQueue() {
        // ì„ íƒëœ ë¶„ìœ„ê¸°ì— ë§ëŠ” íŒŒì¼ í•„í„°ë§
        const sharedFiles = this.files.filter(f => f.shared);
        let filteredFiles = [];
        
        switch(this.cafeMood) {
            case 'chill':
                filteredFiles = sharedFiles.filter(f => f.mood === 'chill' || f.mood === 'happy');
                break;
            case 'jazz':
                filteredFiles = sharedFiles.filter(f => f.genre === 'jazz' || f.mood === 'romantic');
                break;
            case 'acoustic':
                filteredFiles = sharedFiles.filter(f => f.genre === 'indie' || f.genre === 'pop');
                break;
            case 'study':
                filteredFiles = sharedFiles.filter(f => f.mood === 'focus' || f.genre === 'classic');
                break;
            case 'morning':
                filteredFiles = sharedFiles.filter(f => f.mood === 'energetic' || f.mood === 'happy');
                break;
            case 'night':
                filteredFiles = sharedFiles.filter(f => f.mood === 'sleep' || f.mood === 'chill');
                break;
        }
        
        // í•„í„°ë§ëœ íŒŒì¼ì´ ì—†ìœ¼ë©´ ì „ì²´ íŒŒì¼ ì‚¬ìš©
        if (filteredFiles.length === 0) {
            filteredFiles = sharedFiles;
        }
        
        // ëœë¤ ì…”í”Œ
        this.cafeQueue = filteredFiles.sort(() => Math.random() - 0.5);
        this.cafeIndex = 0;
        
        this.renderCafePlaylist();
    },

    renderCafePlaylist() {
        const playlistEl = document.getElementById('cafePlaylist');
        if (!playlistEl) return;
        
        if (this.cafeQueue.length === 0) {
            playlistEl.innerHTML = '<div style="text-align:center; color:#666; padding:20px;">ì¬ìƒëª©ë¡ì´ ë¹„ì–´ìˆìŠµë‹ˆë‹¤</div>';
            return;
        }
        
        const upcoming = this.cafeQueue.slice(this.cafeIndex + 1, this.cafeIndex + 6);
        playlistEl.innerHTML = upcoming.map((f, i) => `
            <div style="padding:8px; border-bottom:1px solid rgba(255,255,255,0.05); display:flex; justify-content:space-between; align-items:center;">
                <div>
                    <div style="font-weight:600; font-size:13px;">${i + 1}. ${f.title}</div>
                    <div style="color:#999; font-size:11px;">${f.creator}</div>
                </div>
                <div style="color:#8b5c2e; font-size:11px;">${f.duration || 0}ì´ˆ</div>
            </div>
        `).join('') || '<div style="text-align:center; color:#666; padding:20px;">ë‹¤ìŒ ê³¡ì´ ì—†ìŠµë‹ˆë‹¤</div>';
    },

    async startCafe() {
        const sharedFiles = this.files.filter(f => f.shared);
        if (sharedFiles.length === 0) {
            return this.toast('ê³µìœ ëœ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤');
        }
        if (this.wallet.tl <= 0) {
            return this.toast('TLì´ ë¶€ì¡±í•©ë‹ˆë‹¤');
        }

        this.cafeActive = true;
        this.updateCafeQueue();
        
        // ì²­ì·¨ì ìˆ˜ ì‹œë®¬ë ˆì´ì…˜
        this.cafeListeners = Math.floor(Math.random() * 50) + 10;
        document.getElementById('cafeListeners').textContent = this.cafeListeners;
        
        this.toast('â˜• ì¹´í˜ ë°©ì†¡ ì‹œì‘!');
        await this.playNextCafe();
        
        // ì²­ì·¨ì ìˆ˜ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸
        setInterval(() => {
            if (this.cafeActive) {
                this.cafeListeners += Math.floor(Math.random() * 5) - 2;
                this.cafeListeners = Math.max(1, Math.min(100, this.cafeListeners));
                document.getElementById('cafeListeners').textContent = this.cafeListeners;
            }
        }, 5000);
    },

    async playNextCafe() {
        if (!this.cafeActive || this.cafeQueue.length === 0) return;
        
        const file = this.cafeQueue[this.cafeIndex];
        
        document.getElementById('cafeNowPlaying').textContent = file.title;
        document.getElementById('cafeCreator').textContent = file.creator;
        
        // ì´ ì¬ìƒ ìˆ˜ ì¦ê°€
        this.cafeTotalPlays++;
        document.getElementById('cafeTotalPlays').textContent = this.cafeTotalPlays;
        
        this.renderCafePlaylist();
        
        await this.listenShared(file.id);
        
        // ê³¡ì´ ëë‚˜ë©´ ë‹¤ìŒ ê³¡ìœ¼ë¡œ
        const audio = document.getElementById('audioPlayer');
        audio.onended = () => {
            this.cafeIndex = (this.cafeIndex + 1) % this.cafeQueue.length;
            
            // íê°€ í•œ ë°”í€´ ëŒë©´ ë‹¤ì‹œ ì…”í”Œ
            if (this.cafeIndex === 0) {
                this.updateCafeQueue();
            }
            
            if (this.cafeActive) {
                setTimeout(() => this.playNextCafe(), 1000);
            }
        };
    },

    stopCafe() {
        this.cafeActive = false;
        this.stopPlay();
        
        document.getElementById('cafeNowPlaying').textContent = 'ì¹´í˜ ë°©ì†¡ ì‹œì‘ ëŒ€ê¸° ì¤‘...';
        document.getElementById('cafeCreator').textContent = '-';
        document.getElementById('cafePlaylist').innerHTML = '<div style="text-align:center; color:#666; padding:20px;">ì¹´í˜ ë°©ì†¡ ì‹œì‘ í›„ ì¬ìƒëª©ë¡ì´ í‘œì‹œë©ë‹ˆë‹¤</div>';
        
        this.toast('â˜• ì¹´í˜ ë°©ì†¡ ì •ì§€');
    },

    // ==================== CAR & WALK ê¸°ëŠ¥ ====================
    async startCarWalk() {
        const sharedFiles = this.files.filter(f => f.shared);
        if (sharedFiles.length === 0) {
            return this.toast('ê³µìœ ëœ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤');
        }
        if (this.wallet.tl <= 0) {
            return this.toast('TLì´ ë¶€ì¡±í•©ë‹ˆë‹¤');
        }

        this.carWalkActive = true;
        
        // Movement AI ì‹œë®¬ë ˆì´ì…˜
        this.simulateMovement();
        
        this.toast('ğŸš— ì´ë™ ëª¨ë“œ ì‹œì‘!');
        await this.playCarWalkCycle();
    },

    simulateMovement() {
        setInterval(() => {
            if (!this.carWalkActive) return;
            
            // ëœë¤ ì´ë™ ìƒíƒœ ì‹œë®¬ë ˆì´ì…˜
            const states = [
                { status: 'ğŸš¶ ê±·ëŠ” ì¤‘', multiplier: 1.5, type: 'ë„ë³´' },
                { status: 'ğŸƒ ë‹¬ë¦¬ëŠ” ì¤‘', multiplier: 1.7, type: 'ì¡°ê¹…' },
                { status: 'ğŸš— ì£¼í–‰ ì¤‘', multiplier: 2.0, type: 'ì°¨ëŸ‰' },
                { status: 'ğŸš‡ ì´ë™ ì¤‘', multiplier: 1.8, type: 'ëŒ€ì¤‘êµí†µ' }
            ];
            
            const state = states[Math.floor(Math.random() * states.length)];
            this.movementMultiplier = state.multiplier;
            
            document.getElementById('movementStatus').textContent = state.status;
            document.getElementById('movementType').textContent = state.type;
            document.getElementById('rewardMultiplier').textContent = `Ã—${state.multiplier.toFixed(1)}`;
        }, 5000);
    },

    async playCarWalkCycle() {
        if (!this.carWalkActive) return;
        
        const sharedFiles = this.files.filter(f => f.shared);
        const file = sharedFiles[Math.floor(Math.random() * sharedFiles.length)];
        
        document.getElementById('carNowPlaying').textContent = file.title;
        document.getElementById('carCreator').textContent = file.creator;
        
        // ì´ë™ ë³´ë„ˆìŠ¤ ì ìš©
        const originalShare = file.revenue === '55' ? 0.5 : 0.7;
        file.tempShare = originalShare * this.movementMultiplier;
        
        await this.listenShared(file.id);
        
        const audio = document.getElementById('audioPlayer');
        audio.onended = () => {
            if (this.carWalkActive) {
                setTimeout(() => this.playCarWalkCycle(), 1000);
            }
        };
    },

    stopCarWalk() {
        this.carWalkActive = false;
        this.stopPlay();
        document.getElementById('movementStatus').textContent = 'ì •ì§€ ì¤‘';
        document.getElementById('movementType').textContent = '-';
        document.getElementById('rewardMultiplier').textContent = 'Ã—1.0';
        document.getElementById('carNowPlaying').textContent = 'ëŒ€ê¸° ì¤‘...';
        document.getElementById('carCreator').textContent = '-';
        this.toast('ğŸš— ì´ë™ ëª¨ë“œ ì •ì§€');
    },

    // ==================== LECTURE ê¸°ëŠ¥ ====================
    async startLecture() {
        const sharedFiles = this.files.filter(f => f.shared);
        if (sharedFiles.length === 0) {
            return this.toast('ê³µìœ ëœ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤');
        }
        if (this.wallet.tl <= 0) {
            return this.toast('TLì´ ë¶€ì¡±í•©ë‹ˆë‹¤');
        }

        this.lectureActive = true;
        this.lectureProgress = 0;
        
        this.toast('ğŸ“š ê°•ì˜ ì‹œì‘!');
        await this.playLectureCycle();
    },

    async playLectureCycle() {
        if (!this.lectureActive) return;
        
        const sharedFiles = this.files.filter(f => f.shared);
        const file = sharedFiles[Math.floor(Math.random() * sharedFiles.length)];
        
        document.getElementById('lectureNowPlaying').textContent = file.title;
        document.getElementById('lectureCreator').textContent = file.creator;
        
        await this.listenShared(file.id);
        
        // ì§„í–‰ë¥  ì—…ë°ì´íŠ¸
        const audio = document.getElementById('audioPlayer');
        const progressInterval = setInterval(() => {
            if (!audio.paused && audio.duration) {
                this.lectureProgress = (audio.currentTime / audio.duration) * 100;
                document.getElementById('lectureProgress').style.width = this.lectureProgress + '%';
                document.getElementById('lectureProgressText').textContent = Math.floor(this.lectureProgress) + '%';
            }
        }, 1000);
        
        audio.onended = async () => {
            clearInterval(progressInterval);
            
            // ê°•ì˜ ì™„ë£Œ ë³´ë„ˆìŠ¤
            this.wallet.tl += 100;
            await Auth.saveUserData();
            this.updateAll();
            this.toast('âœ… ê°•ì˜ ì™„ë£Œ! +100 TL ë³´ë„ˆìŠ¤');
            
            this.lectureProgress = 0;
            document.getElementById('lectureProgress').style.width = '0%';
            document.getElementById('lectureProgressText').textContent = '0%';
            
            if (this.lectureActive) {
                setTimeout(() => this.playLectureCycle(), 2000);
            }
        };
    },

    stopLecture() {
        this.lectureActive = false;
        this.stopPlay();
        this.lectureProgress = 0;
        document.getElementById('lectureProgress').style.width = '0%';
        document.getElementById('lectureProgressText').textContent = '0%';
        document.getElementById('lectureNowPlaying').textContent = 'ê°•ì˜ ì„ íƒ ëŒ€ê¸° ì¤‘...';
        document.getElementById('lectureCreator').textContent = '-';
        this.toast('ğŸ“š ê°•ì˜ ì •ì§€');
    },

    // ==================== GOLD CHART ê¸°ëŠ¥ ====================
    setGoldPeriod(period) {
        this.goldPeriod = period;
        document.querySelectorAll('#goldDay, #goldWeek, #goldMonth, #goldYear').forEach(btn => {
            btn.classList.remove('active');
        });
        document.getElementById('gold' + period.charAt(0).toUpperCase() + period.slice(1)).classList.add('active');
        this.drawGoldChart();
    },

    drawGoldChart() {
        const canvas = document.getElementById('goldChart');
        if (!canvas) return;
        
        const ctx = canvas.getContext('2d');
        const width = canvas.width;
        const height = canvas.height;
        
        // ìº”ë²„ìŠ¤ ì´ˆê¸°í™”
        ctx.clearRect(0, 0, width, height);
        
        // ê°€ìƒ ë°ì´í„° ìƒì„±
        let dataPoints = [];
        let labels = [];
        
        switch(this.goldPeriod) {
            case 'day':
                // 24ì‹œê°„ ë°ì´í„°
                for (let i = 0; i < 24; i++) {
                    dataPoints.push(this.gold * (0.5 + Math.random() * 0.5) * (i / 24));
                    labels.push(i + ':00');
                }
                break;
            case 'week':
                // 7ì¼ ë°ì´í„°
                for (let i = 0; i < 7; i++) {
                    dataPoints.push(this.gold * (0.5 + Math.random() * 0.5) * (i / 7));
                    labels.push(['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '][i]);
                }
                break;
            case 'month':
                // 30ì¼ ë°ì´í„°
                for (let i = 1; i <= 30; i++) {
                    dataPoints.push(this.gold * (0.5 + Math.random() * 0.5) * (i / 30));
                    labels.push(i + 'ì¼');
                }
                break;
            case 'year':
                // 12ê°œì›” ë°ì´í„°
                for (let i = 1; i <= 12; i++) {
                    dataPoints.push(this.gold * (0.5 + Math.random() * 0.5) * (i / 12));
                    labels.push(i + 'ì›”');
                }
                break;
        }
        
        const maxValue = Math.max(...dataPoints, 0.001);
        const padding = 50;
        const chartWidth = width - padding * 2;
        const chartHeight = height - padding * 2;
        
        // ê·¸ë¦¬ë“œ ê·¸ë¦¬ê¸°
        ctx.strokeStyle = 'rgba(255, 255, 255, 0.1)';
        ctx.lineWidth = 1;
        for (let i = 0; i <= 5; i++) {
            const y = padding + (chartHeight / 5) * i;
            ctx.beginPath();
            ctx.moveTo(padding, y);
            ctx.lineTo(width - padding, y);
            ctx.stroke();
            
            // Yì¶• ë¼ë²¨
            ctx.fillStyle = '#999';
            ctx.font = '12px sans-serif';
            ctx.textAlign = 'right';
            ctx.fillText((maxValue * (1 - i / 5)).toFixed(4) + ' g', padding - 10, y + 4);
        }
        
        // ì„  ê·¸ë˜í”„ ê·¸ë¦¬ê¸°
        ctx.strokeStyle = '#ffd700';
        ctx.fillStyle = 'rgba(255, 215, 0, 0.2)';
        ctx.lineWidth = 3;
        
        ctx.beginPath();
        ctx.moveTo(padding, height - padding);
        
        dataPoints.forEach((value, index) => {
            const x = padding + (chartWidth / (dataPoints.length - 1)) * index;
            const y = height - padding - (value / maxValue) * chartHeight;
            
            if (index === 0) {
                ctx.lineTo(x, y);
            } else {
                ctx.lineTo(x, y);
            }
        });
        
        ctx.stroke();
        
        // ì˜ì—­ ì±„ìš°ê¸°
        ctx.lineTo(width - padding, height - padding);
        ctx.lineTo(padding, height - padding);
        ctx.closePath();
        ctx.fill();
        
        // ì  ê·¸ë¦¬ê¸°
        dataPoints.forEach((value, index) => {
            const x = padding + (chartWidth / (dataPoints.length - 1)) * index;
            const y = height - padding - (value / maxValue) * chartHeight;
            
            ctx.fillStyle = '#ffd700';
            ctx.beginPath();
            ctx.arc(x, y, 5, 0, Math.PI * 2);
            ctx.fill();
        });
        
        // Xì¶• ë¼ë²¨
        ctx.fillStyle = '#999';
        ctx.font = '11px sans-serif';
        ctx.textAlign = 'center';
        labels.forEach((label, index) => {
            if (index % Math.ceil(labels.length / 8) === 0) {
                const x = padding + (chartWidth / (labels.length - 1)) * index;
                ctx.fillText(label, x, height - padding + 20);
            }
        });
    },

    // ==================== TLC WALLET ê¸°ëŠ¥ ====================
    async mineToWallet() {
        const amt = parseInt(document.getElementById('miningAmountWallet').value) || 100;
        const max = Math.floor(this.wallet.tl * 0.5);
        
        if (amt > max) return this.toast(`í•œë„ ì´ˆê³¼! ìµœëŒ€ ${max} TL`);
        if (this.wallet.tl < amt) return this.toast('TL ë¶€ì¡±');
        
        const tlc = (amt * 0.01) * this.ci;
        this.wallet.tl -= amt;
        this.wallet.tlc += tlc;
        
        const platformFee = amt * 0.1;
        this.gold += (platformFee * 0.1) / 1000;
        
        // ê±°ë˜ ë‚´ì—­ ì¶”ê°€
        this.walletHistory.unshift({
            type: 'mine',
            amount: tlc,
            timestamp: new Date().toISOString(),
            description: `TL â†’ TLC ì±„êµ´ (${amt} TL)`
        });
        
        await Auth.saveUserData();
        this.updateAll();
        this.updateWalletDisplay();
        this.toast(`â›ï¸ ${tlc.toFixed(2)} TLC ì±„êµ´ ì™„ë£Œ!`);
    },

    async transferToTon() {
        const address = document.getElementById('tonWalletAddress').value.trim();
        const amount = parseFloat(document.getElementById('tonTransferAmount').value) || 0;
        
        if (!address) return this.toast('TON ì§€ê°‘ ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”');
        if (amount <= 0) return this.toast('ì „ì†¡í•  ê¸ˆì•¡ì„ ì…ë ¥í•˜ì„¸ìš”');
        if (amount > this.wallet.tlc) return this.toast('TLC ì”ì•¡ì´ ë¶€ì¡±í•©ë‹ˆë‹¤');
        
        this.wallet.tlc -= amount;
        
        // ê±°ë˜ ë‚´ì—­ ì¶”ê°€
        this.walletHistory.unshift({
            type: 'transfer',
            amount: -amount,
            timestamp: new Date().toISOString(),
            description: `TON ì „ì†¡ (${address.substring(0, 8)}...)`
        });
        
        await Auth.saveUserData();
        this.updateAll();
        this.updateWalletDisplay();
        this.toast(`âœ… ${amount.toFixed(2)} TLCë¥¼ TONìœ¼ë¡œ ì „ì†¡í–ˆìŠµë‹ˆë‹¤`);
        
        // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
        document.getElementById('tonWalletAddress').value = '';
        document.getElementById('tonTransferAmount').value = '';
    },

    updateWalletDisplay() {
        document.getElementById('tlcWalletAmount').textContent = this.wallet.tlc.toFixed(2) + ' TLC';
        document.getElementById('tlcUsdValue').textContent = (this.wallet.tlc * this.tlcPrice).toFixed(2);
        document.getElementById('ciValueWallet').textContent = this.ci.toFixed(2) + 'x';
        document.getElementById('miningMaxWallet').textContent = Math.floor(this.wallet.tl * 0.5).toLocaleString();
        
        // ê±°ë˜ ë‚´ì—­ í‘œì‹œ
        const historyEl = document.getElementById('walletHistory');
        if (this.walletHistory.length === 0) {
            historyEl.innerHTML = '<div style="text-align:center; padding:40px; color:#666;">ì•„ì§ ê±°ë˜ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤</div>';
        } else {
            historyEl.innerHTML = this.walletHistory.slice(0, 10).map(tx => {
                const date = new Date(tx.timestamp);
                const icon = tx.type === 'mine' ? 'â›ï¸' : 'â¬¡';
                const color = tx.amount > 0 ? '#22c55e' : '#ef4444';
                return `
                    <div style="padding:12px; border-bottom:1px solid rgba(255,255,255,0.05);">
                        <div style="display:flex; justify-content:space-between; align-items:center;">
                            <div>
                                <div style="font-weight:600;">${icon} ${tx.description}</div>
                                <div style="font-size:11px; color:#999;">${date.toLocaleString()}</div>
                            </div>
                            <div style="font-weight:700; color:${color};">${tx.amount > 0 ? '+' : ''}${tx.amount.toFixed(2)} TLC</div>
                        </div>
                    </div>
                `;
            }).join('');
        }
    },

    switchTab(name, evt) {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        
        // ì´ë²¤íŠ¸ê°€ ìˆìœ¼ë©´ í•´ë‹¹ ë²„íŠ¼ì„, ì—†ìœ¼ë©´ nameìœ¼ë¡œ ì°¾ì•„ì„œ í™œì„±í™”
        if (evt && evt.target) {
            evt.target.classList.add('active');
        } else {
            // í”„ë¡œê·¸ë˜ë°ì ìœ¼ë¡œ í˜¸ì¶œëœ ê²½ìš° í•´ë‹¹ íƒ­ ë²„íŠ¼ì„ ì°¾ì•„ì„œ í™œì„±í™”
            const tabButtons = document.querySelectorAll('.tab');
            tabButtons.forEach(btn => {
                const btnText = btn.textContent.toLowerCase();
                if (btnText.includes(name.toLowerCase()) || 
                    (name === 'myfiles' && btnText.includes('my files')) ||
                    (name === 'share' && btnText.includes('share'))) {
                    btn.classList.add('active');
                }
            });
        }
        
        document.getElementById('tab' + name.charAt(0).toUpperCase() + name.slice(1)).classList.add('active');
        
        if (name === 'myfiles') this.renderMyFiles();
        if (name === 'share') this.renderSharePlace();
        if (name === 'mining') {
            const maxEl = document.getElementById('miningMax');
            if (maxEl) maxEl.textContent = Math.floor(this.wallet.tl * 0.5).toLocaleString();
        }
    },

    closeModal() {
        document.getElementById('chargeModal').style.display = 'none';
        document.getElementById('audioModal').style.display = 'none';
        this.chargeTarget = null;
    },

    // ==================== CAFE GALLERY & COMMENTS ====================
    renderCafeGallery() {
        const galleryEl = document.getElementById('cafeGallery');
        if (!galleryEl) return;
        
        // ì•ˆì „í•˜ê²Œ ì‚¬ìš©ì ëª©ë¡ ê°€ì ¸ì˜¤ê¸° (ê°ì²´ â†’ ë°°ì—´ ë³€í™˜)
        let allUsers = [];
        try {
            const usersData = localStorage.getItem('timelink_users');
            if (usersData) {
                const parsed = JSON.parse(usersData);
                // ê°ì²´ì¸ ê²½ìš° ë°°ì—´ë¡œ ë³€í™˜
                allUsers = typeof parsed === 'object' && !Array.isArray(parsed) 
                    ? Object.values(parsed) 
                    : (Array.isArray(parsed) ? parsed : []);
            }
        } catch (error) {
            console.error('ì‚¬ìš©ì ë°ì´í„° ë¡œë”© ì˜¤ë¥˜:', error);
            allUsers = [];
        }
        
        const cafes = allUsers.filter(u => u.cafeInfo && u.cafeInfo.name);
        
        if (cafes.length === 0) {
            galleryEl.innerHTML = '<div style="text-align:center; padding:60px; color:#666; grid-column:1/-1;">ë“±ë¡ëœ ì¹´í˜ê°€ ì—†ìŠµë‹ˆë‹¤<br><div style="margin-top:12px; font-size:14px;">ì‚¬ì—…ì íšŒì›ìœ¼ë¡œ ê°€ì…í•˜ì—¬ ì¹´í˜ë¥¼ ë“±ë¡í•´ë³´ì„¸ìš”!</div></div>';
            return;
        }
        
        galleryEl.innerHTML = cafes.map(cafe => {
            const info = cafe.cafeInfo;
            const comments = info.comments || [];
            
            return `
                <div style="background:rgba(139,92,46,0.05); border:2px solid #8b5c2e; border-radius:16px; overflow:hidden; transition:transform 0.2s;" onmouseover="this.style.transform='translateY(-4px)'" onmouseout="this.style.transform='translateY(0)'">
                    <!-- ì¹´í˜ ì´ë¯¸ì§€ (ì•¡ì ìŠ¤íƒ€ì¼) -->
                    <div style="position:relative; height:200px; background:linear-gradient(135deg, #8b5c2e, #654321); overflow:hidden;">
                        ${info.image ? 
                            `<img src="${info.image}" style="width:100%; height:100%; object-fit:cover;" onerror="this.style.display='none'">` :
                            `<div style="display:flex; align-items:center; justify-content:center; height:100%; font-size:4rem;">â˜•</div>`
                        }
                        <div style="position:absolute; top:12px; right:12px; background:rgba(0,0,0,0.7); padding:6px 12px; border-radius:20px; font-size:12px; font-weight:700;">
                            ğŸµ LIVE
                        </div>
                    </div>
                    
                    <!-- ì¹´í˜ ì •ë³´ -->
                    <div style="padding:16px;">
                        <div style="font-size:1.3rem; font-weight:800; color:#8b5c2e; margin-bottom:4px;">${info.name}</div>
                        <div style="color:#999; font-size:13px; margin-bottom:8px;">ğŸ“ ${info.location || 'ìœ„ì¹˜ ë¯¸ë“±ë¡'}</div>
                        <div style="color:#ccc; font-size:14px; line-height:1.5; margin-bottom:12px;">${info.description || 'ì†Œê°œê¸€ì´ ì—†ìŠµë‹ˆë‹¤'}</div>
                        
                        <!-- ë°©ì†¡ ë²„íŠ¼ -->
                        <button class="btn btn-play" onclick="App.listenCafe('${cafe.email}')" style="width:100%; padding:12px; font-size:13px;">
                            ğŸ§ ì´ ì¹´í˜ ë°©ì†¡ ë“£ê¸°
                        </button>
                        
                        <!-- ëŒ“ê¸€ ì„¹ì…˜ -->
                        <div style="margin-top:16px; padding-top:16px; border-top:1px solid rgba(255,255,255,0.05);">
                            <div style="font-weight:700; margin-bottom:12px; font-size:14px;">ğŸ’¬ ëŒ“ê¸€ (${comments.length})</div>
                            
                            <!-- ëŒ“ê¸€ ëª©ë¡ -->
                            <div style="max-height:150px; overflow-y:auto; margin-bottom:12px;">
                                ${comments.length === 0 ? 
                                    '<div style="text-align:center; padding:20px; color:#666; font-size:12px;">ì²« ëŒ“ê¸€ì„ ë‚¨ê²¨ë³´ì„¸ìš”!</div>' :
                                    comments.slice(-5).reverse().map(comment => `
                                        <div style="padding:8px; background:rgba(0,0,0,0.2); border-radius:8px; margin-bottom:8px;">
                                            <div style="font-weight:600; font-size:12px; color:#8b5c2e;">${comment.user}</div>
                                            <div style="font-size:13px; color:#ddd; margin-top:4px;">${comment.text}</div>
                                            <div style="font-size:10px; color:#666; margin-top:4px;">${new Date(comment.timestamp).toLocaleString()}</div>
                                        </div>
                                    `).join('')
                                }
                            </div>
                            
                            <!-- ëŒ“ê¸€ ì…ë ¥ -->
                            <div style="display:flex; gap:8px;">
                                <input type="text" id="comment_${cafe.email}" placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”..." style="flex:1; background:rgba(0,0,0,0.3); border:1px solid rgba(255,255,255,0.1); border-radius:8px; padding:8px; color:white; font-size:12px;">
                                <button class="btn" onclick="App.addCafeComment('${cafe.email}')" style="padding:8px 16px; font-size:12px; background:#8b5c2e;">
                                    ë“±ë¡
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }).join('');
    },

    async addCafeComment(cafeEmail) {
        const inputEl = document.getElementById('comment_' + cafeEmail);
        if (!inputEl) return;
        
        const text = inputEl.value.trim();
        
        if (!text) return this.toast('ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”');
        
        // ì•ˆì „í•˜ê²Œ ì‚¬ìš©ì ëª©ë¡ ê°€ì ¸ì˜¤ê¸° (ê°ì²´ í˜•íƒœ)
        let allUsers = {};
        try {
            const usersData = localStorage.getItem('timelink_users');
            if (usersData) {
                allUsers = JSON.parse(usersData);
            }
        } catch (error) {
            console.error('ì‚¬ìš©ì ë°ì´í„° ë¡œë”© ì˜¤ë¥˜:', error);
            return this.toast('ëŒ“ê¸€ ë“±ë¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤');
        }
        
        if (!allUsers[cafeEmail]) {
            return this.toast('ì¹´í˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
        }
        
        if (!allUsers[cafeEmail].cafeInfo) {
            allUsers[cafeEmail].cafeInfo = {};
        }
        
        if (!allUsers[cafeEmail].cafeInfo.comments) {
            allUsers[cafeEmail].cafeInfo.comments = [];
        }
        
        allUsers[cafeEmail].cafeInfo.comments.push({
            user: Auth.currentUser.name,
            text: text,
            timestamp: new Date().toISOString()
        });
        
        try {
            localStorage.setItem('timelink_users', JSON.stringify(allUsers));
            inputEl.value = '';
            this.renderCafeGallery();
            this.toast('ğŸ’¬ ëŒ“ê¸€ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤');
        } catch (error) {
            console.error('ëŒ“ê¸€ ì €ì¥ ì˜¤ë¥˜:', error);
            this.toast('ëŒ“ê¸€ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤');
        }
    },

    async listenCafe(cafeEmail) {
        // í•´ë‹¹ ì¹´í˜ì˜ AI DJ ì„¤ì • ë˜ëŠ” ê¸°ë³¸ ìŒì•… ì¬ìƒ
        this.toast(`â˜• ${cafeEmail} ì¹´í˜ ë°©ì†¡ì„ ì‹œì‘í•©ë‹ˆë‹¤`);
        
        // Share Placeì—ì„œ ëœë¤ ìŒì•… ì¬ìƒ
        const sharedFiles = this.files.filter(f => f.shared);
        if (sharedFiles.length > 0) {
            const randomFile = sharedFiles[Math.floor(Math.random() * sharedFiles.length)];
            await this.listenShared(randomFile.id);
        }
    },

    // AI DJ í”„ë¡¬í”„íŠ¸ ì„¤ì •
    setAiDjPrompt(prompt) {
        document.getElementById('aiDjRequest').value = prompt;
    },

    setCarAiDjPrompt(prompt) {
        document.getElementById('carAiDjPrompt').value = prompt;
    },

    // AI DJ íë ˆì´ì…˜ ë¡œì§
    async requestAiDj() {
        const prompt = document.getElementById('aiDjRequest').value.trim();
        
        if (!prompt) {
            return this.toast('AI DJì—ê²Œ ìš”ì²­í•  ìŒì•… ë¶„ìœ„ê¸°ë¥¼ ì…ë ¥í•˜ì„¸ìš”');
        }
        
        this.cafeActive = true;
        this.aiDjPrompt = prompt;
        
        // í”„ë¡¬í”„íŠ¸ ë¶„ì„ (í‚¤ì›Œë“œ ê¸°ë°˜)
        const playlist = this.analyzeAndCurate(prompt);
        
        if (playlist.length === 0) {
            this.cafeActive = false;
            return this.toast('ìš”ì²­í•˜ì‹  ë¶„ìœ„ê¸°ì— ë§ëŠ” ìŒì•…ì´ ì—†ìŠµë‹ˆë‹¤');
        }
        
        this.cafeQueue = playlist;
        this.cafeIndex = 0;
        
        document.getElementById('aiDjTheme').textContent = this.extractTheme(prompt);
        
        this.toast(`ğŸ§ AI DJê°€ ${playlist.length}ê³¡ì„ ì„ ê³¡í–ˆìŠµë‹ˆë‹¤!`);
        await this.playNextCafe();
    },

    analyzeAndCurate(prompt) {
        const sharedFiles = this.files.filter(f => f.shared);
        let filtered = [];
        
        const lower = prompt.toLowerCase();
        
        // ë‚ ì”¨ ê´€ë ¨
        if (lower.includes('ë¹„') || lower.includes('rain')) {
            filtered = sharedFiles.filter(f => 
                f.mood === 'chill' || f.mood === 'sad' || f.genre === 'jazz'
            );
        }
        // ì‹œê°„ëŒ€
        else if (lower.includes('ì•„ì¹¨') || lower.includes('morning')) {
            filtered = sharedFiles.filter(f =>
                f.mood === 'energetic' || f.mood === 'happy'
            );
        }
        else if (lower.includes('ì €ë…') || lower.includes('ë°¤') || lower.includes('night')) {
            filtered = sharedFiles.filter(f =>
                f.mood === 'chill' || f.mood === 'sleep' || f.mood === 'romantic'
            );
        }
        // í™œë™
        else if (lower.includes('ìš´ë™') || lower.includes('workout') || lower.includes('ì¡°ê¹…')) {
            filtered = sharedFiles.filter(f =>
                f.mood === 'energetic' || f.mood === 'workout'
            );
        }
        else if (lower.includes('ê³µë¶€') || lower.includes('study') || lower.includes('ì§‘ì¤‘')) {
            filtered = sharedFiles.filter(f =>
                f.mood === 'focus' || f.genre === 'classic'
            );
        }
        else if (lower.includes('ë“œë¼ì´ë¸Œ') || lower.includes('drive')) {
            filtered = sharedFiles.filter(f =>
                f.genre === 'pop' || f.genre === 'rock'
            );
        }
        // ë¶„ìœ„ê¸°
        else if (lower.includes('ì”ì”') || lower.includes('chill')) {
            filtered = sharedFiles.filter(f => f.mood === 'chill');
        }
        else if (lower.includes('ì‹ ë‚˜') || lower.includes('ê²½ì¾Œ')) {
            filtered = sharedFiles.filter(f => 
                f.mood === 'energetic' || f.mood === 'happy'
            );
        }
        else if (lower.includes('ë¡œë§¨í‹±') || lower.includes('ë°ì´íŠ¸')) {
            filtered = sharedFiles.filter(f => f.mood === 'romantic');
        }
        // ì¥ë¥´
        else if (lower.includes('ì¬ì¦ˆ') || lower.includes('jazz')) {
            filtered = sharedFiles.filter(f => f.genre === 'jazz');
        }
        else if (lower.includes('íŒ') || lower.includes('pop')) {
            filtered = sharedFiles.filter(f => f.genre === 'pop');
        }
        else if (lower.includes('í´ë˜ì‹') || lower.includes('classic')) {
            filtered = sharedFiles.filter(f => f.genre === 'classic');
        }
        // ê¸°ë…ì¼
        else if (lower.includes('í¬ë¦¬ìŠ¤ë§ˆìŠ¤') || lower.includes('christmas')) {
            filtered = sharedFiles.filter(f =>
                f.mood === 'happy' || f.genre === 'pop'
            );
        }
        
        // í•„í„°ë§ëœ ê²°ê³¼ê°€ ì—†ìœ¼ë©´ ì „ì²´ ì‚¬ìš©
        if (filtered.length === 0) {
            filtered = sharedFiles;
        }
        
        // ëœë¤ ì…”í”Œ
        return filtered.sort(() => Math.random() - 0.5);
    },

    extractTheme(prompt) {
        if (prompt.includes('ë¹„')) return 'ğŸŒ§ï¸ ë¹„ì˜¤ëŠ” ë‚ ';
        if (prompt.includes('ì•„ì¹¨')) return 'ğŸŒ… ìƒì¾Œí•œ ì•„ì¹¨';
        if (prompt.includes('ë°¤')) return 'ğŸŒ™ í¸ì•ˆí•œ ë°¤';
        if (prompt.includes('ìš´ë™')) return 'ğŸ’ª ìš´ë™ ëª¨ë“œ';
        if (prompt.includes('ê³µë¶€')) return 'ğŸ“š ì§‘ì¤‘ í•™ìŠµ';
        if (prompt.includes('ë“œë¼ì´ë¸Œ')) return 'ğŸš— ë“œë¼ì´ë¸Œ';
        if (prompt.includes('ì¬ì¦ˆ')) return 'ğŸº ì¬ì¦ˆ ë¼ìš´ì§€';
        if (prompt.includes('í¬ë¦¬ìŠ¤ë§ˆìŠ¤')) return 'ğŸ„ í¬ë¦¬ìŠ¤ë§ˆìŠ¤';
        return 'ğŸµ AI íë ˆì´ì…˜';
    },

    updateMvpDashboard() {
        const fileCountEl = document.getElementById('mvpFileCount');
        const sharedCountEl = document.getElementById('mvpSharedCount');
        const totalBalanceEl = document.getElementById('mvpTotalBalance');
        const minedTlcEl = document.getElementById('mvpMinedTlc');

        if (!fileCountEl || !sharedCountEl || !totalBalanceEl || !minedTlcEl) return;

        const fileCount = this.files.length;
        const sharedCount = this.files.filter(file => file.shared).length;
        const totalBalance = this.files.reduce((sum, file) => sum + (file.balance || 0), 0);

        fileCountEl.textContent = `${fileCount}ê°œ`;
        sharedCountEl.textContent = `${sharedCount}ê°œ`;
        totalBalanceEl.textContent = `${totalBalance.toLocaleString()} TL`;
        minedTlcEl.textContent = `${this.wallet.tlc.toFixed(2)} TLC`;
    },

    updateAll() {
        document.getElementById('walletTL').textContent = this.wallet.tl.toLocaleString();
        document.getElementById('walletTLC').textContent = this.wallet.tlc.toFixed(2);
        const goldEl = document.getElementById('goldAmount');
        if (goldEl) goldEl.textContent = this.gold.toFixed(4) + ' g';
        
        this.renderMyFiles();
        this.renderSharePlace();
        this.renderCafeGallery();
        this.updateWalletDisplay();
        this.drawGoldChart();
        this.updateMvpDashboard();
    },

    toast(msg) {
        const t = document.getElementById('toast');
        t.textContent = msg;
        t.style.display = 'block';
        setTimeout(() => t.style.display = 'none', 3000);
    }
};

// ì´ˆê¸°í™”
(async () => {
    await Auth.init();
    App.init();
})();

window.addEventListener('click', (e) => {
    if (e.target.classList.contains('modal')) App.closeModal();
});

window.addEventListener('beforeunload', () => Auth.saveUserData());
</script>

</body>
</html>
