<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TimeLink Global — 완전체 (플레이어 완벽 구현)</title>
    
    <!-- Google Fonts & Font Awesome -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        /* ===== 모든 기존 CSS 유지 (그대로) ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #0a0a0a;
            --bg-secondary: #111111;
            --bg-card: #1a1a1a;
            --bg-card-hover: #222222;
            --bg-nav: rgba(17, 17, 17, 0.95);
            --bg-modal: #1e1e1e;
            
            --text-primary: #ffffff;
            --text-secondary: #b3b3b3;
            --text-tertiary: #6a6a6a;
            
            --accent: #8a2be2;
            --accent-glow: rgba(138, 43, 226, 0.3);
            --accent-light: #9d4edd;
            --success: #1db954;
            --warning: #f59e0b;
            --danger: #ef4444;
            --info: #3b82f6;
            --lecture: #ff7b00;
            --video: #ff5500;
            --radio: #1db954;
            --commercial: #f093fb;
            --ad: #ffd700;
            --share: #ff9900;
            --car: #00a8ff;
            --car-detected: #4ecdc4;
            --mining-peak: #ff6b6b;
            --mining-offpeak: #4ecdc4;
            --zero-tl: #ff4444;
            --cafe: #ff9f4b;
            
            --genre-pop: #ff6b6b;
            --genre-rock: #4ecdc4;
            --genre-hiphop: #ffd93d;
            --genre-jazz: #a8e6cf;
            --genre-classic: #b39eb5;
            --genre-edm: #ff8a5c;
            --genre-rnb: #ffb347;
            --genre-country: #c06c84;
            
            --border-color: rgba(255, 255, 255, 0.08);
            --border-hover: rgba(255, 255, 255, 0.15);
            
            --shadow-sm: 0 4px 12px rgba(0, 0, 0, 0.4);
            --shadow-md: 0 8px 24px rgba(0, 0, 0, 0.5);
            --shadow-lg: 0 16px 48px rgba(0, 0, 0, 0.6);
            
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 20px;
            --radius-xl: 28px;
            --radius-full: 9999px;
            
            --font-sans: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            
            --transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        body {
            font-family: var(--font-sans);
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            overflow-x: hidden;
        }

        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }
        ::-webkit-scrollbar-track {
            background: var(--bg-secondary);
        }
        ::-webkit-scrollbar-thumb {
            background: #333;
            border-radius: 20px;
            border: 2px solid var(--bg-secondary);
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #444;
        }

        /* Auth Container */
        .auth-container {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
            background: radial-gradient(circle at 20% 30%, #1a0b2e, #0a0a0a 80%);
            position: relative;
            overflow: hidden;
        }

        .auth-container::before {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" opacity="0.05"><path d="M20 20 L80 20 L80 80 L20 80 Z" fill="none" stroke="%238a2be2" stroke-width="1"/><circle cx="50" cy="50" r="10" fill="%238a2be2"/></svg>');
            background-size: 60px 60px;
            pointer-events: none;
        }

        .auth-box {
            background: rgba(26, 26, 26, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            padding: 48px 40px;
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-lg);
            max-width: 480px;
            width: 100%;
            border: 1px solid var(--border-color);
            animation: fadeUp 0.6s ease;
        }

        @keyframes fadeUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .logo {
            text-align: center;
            margin-bottom: 32px;
        }

        .logo h1 {
            font-size: 3.2rem;
            font-weight: 800;
            background: linear-gradient(135deg, #b983ff, #8a2be2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: -1px;
            margin-bottom: 8px;
        }

        .logo p {
            color: var(--text-secondary);
            font-size: 1rem;
            font-weight: 400;
        }

        .version-badge {
            background: rgba(138, 43, 226, 0.2);
            color: #c084fc;
            padding: 10px 24px;
            border-radius: var(--radius-full);
            font-size: 13px;
            font-weight: 600;
            text-align: center;
            margin-bottom: 32px;
            border: 1px solid rgba(138, 43, 226, 0.3);
            backdrop-filter: blur(4px);
            letter-spacing: 0.3px;
        }

        .google-login-btn {
            background: #4285F4;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            padding: 18px 24px;
            border-radius: var(--radius-full);
            margin: 30px 0;
            border: none;
            cursor: pointer;
            width: 100%;
            transition: var(--transition);
            box-shadow: 0 8px 20px rgba(66, 133, 244, 0.3);
        }

        .google-login-btn:hover {
            background: #3367D6;
            transform: translateY(-2px);
            box-shadow: 0 12px 28px rgba(66, 133, 244, 0.5);
        }

        /* Main App Container */
        .app-container {
            display: none;
            max-width: 1600px;
            margin: 0 auto;
            padding: 24px 32px;
            animation: fadeIn 0.4s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Header */
        .app-header {
            background: rgba(17, 17, 17, 0.85);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            padding: 20px 32px;
            border-radius: var(--radius-xl);
            margin-bottom: 32px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-sm);
            position: sticky;
            top: 20px;
            z-index: 100;
        }

        .header-left h1 {
            font-size: 1.8rem;
            font-weight: 800;
            background: linear-gradient(135deg, #b983ff, #8a2be2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: -0.5px;
        }

        .header-left .demo-badge {
            background: var(--warning);
            color: black;
            padding: 4px 12px;
            border-radius: var(--radius-full);
            font-size: 11px;
            font-weight: 700;
            display: inline-block;
            margin-left: 12px;
            text-transform: uppercase;
        }

        .header-right {
            display: flex;
            gap: 24px;
            align-items: center;
        }

        .balance-cards {
            display: flex;
            gap: 16px;
        }

        .balance-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 12px 20px;
            border-radius: var(--radius-lg);
            border: 1px solid var(--border-color);
            backdrop-filter: blur(8px);
            transition: var(--transition);
            min-width: 130px;
            cursor: pointer;
        }

        .balance-card:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: var(--accent);
        }

        .balance-card .label {
            font-size: 11px;
            color: var(--text-tertiary);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 6px;
        }

        .balance-card .amount {
            font-size: 22px;
            font-weight: 800;
            color: white;
            line-height: 1.2;
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 16px 8px 12px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius-full);
            border: 1px solid var(--border-color);
            transition: var(--transition);
            cursor: pointer;
        }

        .user-profile:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: var(--accent);
        }

        .avatar-circle {
            width: 38px;
            height: 38px;
            border-radius: 50%;
            background: linear-gradient(135deg, #8a2be2, #6b21a5);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 18px;
            box-shadow: 0 2px 8px rgba(138, 43, 226, 0.3);
        }

        .user-info {
            display: flex;
            flex-direction: column;
        }

        .user-name {
            font-weight: 700;
            color: white;
            font-size: 14px;
        }

        .user-status {
            font-size: 11px;
            color: var(--text-secondary);
        }

        .btn-logout {
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-secondary);
            padding: 10px 20px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-full);
            font-weight: 600;
            font-size: 13px;
            cursor: pointer;
            transition: var(--transition);
        }

        .btn-logout:hover {
            background: rgba(239, 68, 68, 0.2);
            color: #f87171;
            border-color: #ef4444;
            transform: translateY(-2px);
        }

        /* Tab Navigation */
        .tabs-container {
            position: sticky;
            top: 100px;
            z-index: 90;
            margin-bottom: 32px;
            background: rgba(17, 17, 17, 0.7);
            backdrop-filter: blur(20px);
            border-radius: var(--radius-full);
            padding: 6px;
            border: 1px solid var(--border-color);
            overflow-x: auto;
            white-space: nowrap;
            display: flex;
        }

        .tabs {
            display: flex;
            gap: 4px;
            width: 100%;
        }

        .tab {
            padding: 12px 24px;
            border-radius: var(--radius-full);
            font-weight: 600;
            font-size: 14px;
            color: var(--text-secondary);
            transition: var(--transition);
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: transparent;
            border: none;
            white-space: nowrap;
        }

        .tab:hover {
            color: white;
            background: rgba(255, 255, 255, 0.05);
        }

        .tab.active {
            background: var(--accent);
            color: white;
            box-shadow: 0 4px 12px rgba(138, 43, 226, 0.4);
        }

        /* Tab Content */
        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .tab-content.active {
            display: block;
        }

        /* Cards */
        .card {
            background: var(--bg-card);
            border-radius: var(--radius-xl);
            padding: 32px;
            margin-bottom: 32px;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-sm);
            transition: var(--transition);
        }

        .card:hover {
            border-color: var(--accent);
            box-shadow: var(--shadow-md);
        }

        .card h2 {
            font-size: 1.6rem;
            font-weight: 700;
            margin-bottom: 24px;
            background: linear-gradient(135deg, #fff, #e0e0e0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: -0.02em;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
        }

        .stat-card {
            background: var(--bg-card);
            padding: 28px;
            border-radius: var(--radius-lg);
            border: 1px solid var(--border-color);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .stat-card::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 6px;
            height: 100%;
            background: var(--accent);
            opacity: 0.7;
        }

        .stat-card:hover {
            background: var(--bg-card-hover);
            transform: translateY(-4px);
            border-color: var(--accent);
        }

        .stat-card .icon {
            font-size: 2.2rem;
            margin-bottom: 16px;
        }

        .stat-card .label {
            font-size: 12px;
            color: var(--text-tertiary);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
        }

        .stat-card .value {
            font-size: 2.2rem;
            font-weight: 800;
            color: white;
            line-height: 1.1;
        }

        /* Upload Zone */
        .upload-zone {
            border: 2px dashed var(--accent);
            background: rgba(138, 43, 226, 0.05);
            border-radius: var(--radius-lg);
            padding: 60px 40px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            margin-bottom: 30px;
        }

        .upload-zone:hover {
            border-color: var(--accent-light);
            background: rgba(138, 43, 226, 0.1);
            transform: scale(1.02);
        }

        .upload-zone .icon {
            font-size: 4rem;
            margin-bottom: 20px;
            color: rgba(255, 255, 255, 0.7);
        }

        .upload-zone h3 {
            font-size: 1.5rem;
            margin-bottom: 10px;
            color: white;
        }

        .upload-zone p {
            color: var(--text-secondary);
            font-size: 14px;
        }

        /* File Type Selector */
        .file-type-selector {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
        }

        .file-type-card {
            flex: 1;
            background: rgba(255, 255, 255, 0.05);
            padding: 24px;
            border-radius: var(--radius-lg);
            text-align: center;
            cursor: pointer;
            border: 2px solid transparent;
            transition: var(--transition);
        }

        .file-type-card.selected {
            border-color: var(--success);
            background: rgba(29, 185, 84, 0.1);
        }

        .file-type-card.video.selected {
            border-color: var(--video);
            background: rgba(255, 85, 0, 0.1);
        }

        .file-type-card .icon {
            font-size: 3rem;
            margin-bottom: 12px;
        }

        .file-type-card h3 {
            color: white;
            margin-bottom: 8px;
        }

        .file-type-card .rate {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .file-type-card.audio .rate {
            color: var(--success);
        }

        .file-type-card.video .rate {
            color: var(--video);
        }

        .file-type-card .desc {
            color: var(--text-secondary);
            font-size: 12px;
        }

        /* TL3/TL4 File Card */
        .file-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
            gap: 28px;
        }

        .file-card {
            background: var(--bg-card);
            border-radius: var(--radius-xl);
            overflow: hidden;
            border: 1px solid var(--border-color);
            transition: var(--transition);
            display: flex;
            flex-direction: column;
        }

        .file-card:hover {
            transform: translateY(-6px);
            border-color: var(--accent);
            box-shadow: var(--shadow-md);
        }

        .file-thumbnail {
            height: 180px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4rem;
            color: rgba(255, 255, 255, 0.8);
            position: relative;
        }

        .file-thumbnail.audio {
            background: linear-gradient(145deg, #2a1a3a, #1e1e1e);
        }

        .file-thumbnail.video {
            background: linear-gradient(145deg, #ff7b00, #ff5500);
        }

        .badge {
            position: absolute;
            top: 16px;
            right: 16px;
            padding: 6px 16px;
            border-radius: var(--radius-full);
            font-size: 12px;
            font-weight: 700;
            color: white;
            backdrop-filter: blur(4px);
        }

        .badge-mining { background: rgba(79, 172, 254, 0.9); }
        .badge-no-tl { background: rgba(239, 68, 68, 0.9); }
        .badge-shared { background: rgba(245, 158, 11, 0.9); }
        .badge-copyright { 
            background: rgba(139, 92, 246, 0.9); 
            left: 16px;
            right: auto;
        }
        .badge-type {
            left: 16px;
            top: 60px;
            background: rgba(0,0,0,0.7);
        }
        .badge-zero {
            background: var(--zero-tl);
            left: 16px;
            top: 100px;
        }
        .badge-genre {
            left: 16px;
            top: 140px;
            background: rgba(0,0,0,0.7);
        }

        .file-info {
            padding: 24px;
        }

        .file-name {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 6px;
            color: white;
        }

        .file-artist {
            color: var(--text-secondary);
            font-size: 0.95rem;
            margin-bottom: 20px;
        }

        .info-panel {
            background: rgba(255, 255, 255, 0.03);
            padding: 16px;
            border-radius: var(--radius-md);
            margin-bottom: 20px;
            font-size: 13px;
            color: var(--text-secondary);
            border-left: 4px solid;
            line-height: 1.6;
        }

        .info-panel strong {
            color: white;
        }

        .copyright-panel { border-left-color: #8b5cf6; }
        .contract-panel { border-left-color: var(--accent); }
        .tl-panel { border-left-color: var(--warning); }
        .video-panel { border-left-color: var(--video); }
        .zero-panel { border-left-color: var(--zero-tl); }
        .genre-panel { border-left-color: var(--genre-pop); }

        .file-stats {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            font-size: 14px;
            color: var(--text-secondary);
        }

        .tl-progress {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-full);
            overflow: hidden;
            margin: 16px 0;
        }

        .tl-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent), var(--accent-light));
            transition: width 0.3s ease;
        }

        .tl-progress-empty {
            height: 100%;
            background: var(--danger);
            width: 100%;
        }

        .file-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-top: 20px;
        }

        .btn-play, .btn-charge, .btn-share, .btn-lecture, .btn-play-disabled, .btn-radio, .btn-commercial, .btn-ad, .btn-download, .btn-car, .btn-car-manual, .btn-cafe {
            padding: 14px 10px;
            border: none;
            border-radius: var(--radius-md);
            font-weight: 700;
            font-size: 14px;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            color: white;
        }

        .btn-play {
            background: var(--success);
        }

        .btn-play:hover {
            background: #1ed760;
            transform: translateY(-2px);
        }

        .btn-play-disabled {
            background: #333;
            color: #999;
            cursor: not-allowed;
            opacity: 0.7;
        }

        .btn-charge {
            background: var(--warning);
            color: black;
        }

        .btn-charge:hover {
            background: #fbbf24;
            transform: translateY(-2px);
        }

        .btn-share {
            background: var(--share);
        }

        .btn-share:hover {
            background: #ffaa00;
            transform: translateY(-2px);
        }
        
        .btn-lecture {
            background: var(--lecture);
            grid-column: span 2;
        }

        .btn-lecture:hover {
            background: #ff9500;
            transform: translateY(-2px);
        }

        .btn-radio {
            background: var(--radio);
        }

        .btn-radio:hover {
            background: #1ed760;
            transform: translateY(-2px);
        }

        .btn-commercial {
            background: var(--commercial);
            color: black;
        }

        .btn-commercial:hover {
            background: #f8b4d9;
            transform: translateY(-2px);
        }

        .btn-ad {
            background: var(--ad);
            color: black;
        }

        .btn-ad:hover {
            background: #ffed4a;
            transform: translateY(-2px);
        }

        .btn-download {
            background: var(--info);
            grid-column: span 2;
        }

        .btn-download:hover {
            background: #5a9cff;
            transform: translateY(-2px);
        }

        .btn-car {
            background: var(--car);
        }

        .btn-car:hover {
            background: #4dc3ff;
            transform: translateY(-2px);
        }

        .btn-car-manual {
            background: var(--car-detected);
            color: black;
        }

        .btn-car-manual:hover {
            background: #6fd9d0;
            transform: translateY(-2px);
        }

        .btn-cafe {
            background: var(--cafe);
            color: black;
        }

        .btn-cafe:hover {
            background: #ffb366;
            transform: translateY(-2px);
        }

        /* Share Place */
        .share-header {
            background: linear-gradient(145deg, #1e1e2a, #15151f);
            border-radius: var(--radius-xl);
            padding: 32px;
            margin-bottom: 32px;
            border: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        .share-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 32px;
        }

        .share-stat-card {
            background: var(--bg-card);
            padding: 24px;
            border-radius: var(--radius-lg);
            border: 1px solid var(--border-color);
            text-align: center;
        }

        .share-stat-value {
            font-size: 2rem;
            font-weight: 800;
            color: white;
            margin-top: 8px;
        }

        .share-filter {
            display: flex;
            gap: 12px;
            margin-bottom: 32px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 10px 24px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-full);
            background: transparent;
            color: var(--text-secondary);
            font-weight: 600;
            font-size: 14px;
            transition: var(--transition);
            cursor: pointer;
        }

        .filter-btn:hover {
            border-color: var(--accent);
            color: white;
        }

        .filter-btn.active {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }

        /* Radio / Commercial / Car Sections */
        .radio-header {
            background: linear-gradient(145deg, #1db954, #169c46);
            border-radius: var(--radius-xl);
            padding: 32px;
            margin-bottom: 32px;
        }

        .commercial-header {
            background: linear-gradient(145deg, #f093fb, #f5576c);
            border-radius: var(--radius-xl);
            padding: 32px;
            margin-bottom: 32px;
        }

        .car-header {
            background: linear-gradient(145deg, #00a8ff, #0097e6);
            border-radius: var(--radius-xl);
            padding: 32px;
            margin-bottom: 32px;
        }

        .cafe-badge {
            display: inline-block;
            background: var(--cafe);
            color: black;
            padding: 4px 12px;
            border-radius: var(--radius-full);
            font-size: 11px;
            font-weight: 700;
            margin-left: 12px;
        }

        .radio-channel-card,
        .commercial-channel-card {
            background: var(--bg-card);
            border-radius: var(--radius-xl);
            overflow: hidden;
            border: 1px solid var(--border-color);
            transition: var(--transition);
        }

        .radio-channel-card:hover,
        .commercial-channel-card:hover {
            border-color: var(--accent);
            transform: translateY(-4px);
        }

        .channel-header {
            padding: 20px;
            color: white;
        }

        .channel-header.radio { background: linear-gradient(145deg, #1db954, #169c46); }
        .channel-header.commercial { background: linear-gradient(145deg, #f093fb, #f5576c); }
        .channel-header.car { background: linear-gradient(145deg, #00a8ff, #0097e6); }

        .radio-channels {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 24px;
        }

        .channel-playlist {
            padding: 24px;
        }

        .now-playing {
            background: rgba(255, 255, 255, 0.03);
            padding: 16px;
            border-radius: var(--radius-md);
            margin-bottom: 16px;
            border-left: 4px solid var(--success);
        }

        /* Genre Selector */
        .genre-selector {
            display: flex;
            gap: 12px;
            overflow-x: auto;
            padding: 16px 0;
            margin-bottom: 24px;
            scrollbar-width: thin;
        }

        .genre-btn {
            padding: 10px 24px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-full);
            background: transparent;
            color: var(--text-secondary);
            font-weight: 600;
            font-size: 14px;
            transition: var(--transition);
            cursor: pointer;
            white-space: nowrap;
        }

        .genre-btn:hover {
            border-color: var(--accent);
            color: white;
        }

        .genre-btn.active {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }

        .genre-btn.pop.active { background: var(--genre-pop); }
        .genre-btn.rock.active { background: var(--genre-rock); }
        .genre-btn.hiphop.active { background: var(--genre-hiphop); color: black; }
        .genre-btn.jazz.active { background: var(--genre-jazz); color: black; }
        .genre-btn.classic.active { background: var(--genre-classic); }
        .genre-btn.edm.active { background: var(--genre-edm); }
        .genre-btn.rnb.active { background: var(--genre-rnb); }
        .genre-btn.country.active { background: var(--genre-country); }

        /* Now Playing Card */
        .now-playing-card {
            background: rgba(255,255,255,0.03);
            border-radius: var(--radius-xl);
            padding: 24px;
            margin-bottom: 24px;
            border-left: 6px solid;
        }

        .now-playing-card.radio { border-left-color: var(--radio); }
        .now-playing-card.commercial { border-left-color: var(--commercial); }
        .now-playing-card.car { border-left-color: var(--car); }

        .genre-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: var(--radius-full);
            font-size: 11px;
            font-weight: 700;
            margin-right: 8px;
        }

        .genre-badge.pop { background: var(--genre-pop); }
        .genre-badge.rock { background: var(--genre-rock); }
        .genre-badge.hiphop { background: var(--genre-hiphop); color: black; }
        .genre-badge.jazz { background: var(--genre-jazz); color: black; }
        .genre-badge.classic { background: var(--genre-classic); }
        .genre-badge.edm { background: var(--genre-edm); }
        .genre-badge.rnb { background: var(--genre-rnb); }
        .genre-badge.country { background: var(--genre-country); }

        /* Queue Container */
        .queue-container {
            background: rgba(255,255,255,0.02);
            border-radius: var(--radius-lg);
            padding: 20px;
            margin-top: 20px;
            margin-bottom: 30px;
        }

        .queue-title {
            color: var(--text-secondary);
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 16px;
        }

        .queue-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border-bottom: 1px solid var(--border-color);
            animation: fadeIn 0.3s ease;
        }

        .queue-item:last-child {
            border-bottom: none;
        }

        .queue-item.now-playing {
            background: rgba(29, 185, 84, 0.1);
            border-radius: var(--radius-md);
        }

        .queue-genre {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .queue-genre.pop { background: var(--genre-pop); }
        .queue-genre.rock { background: var(--genre-rock); }
        .queue-genre.hiphop { background: var(--genre-hiphop); }
        .queue-genre.jazz { background: var(--genre-jazz); }
        .queue-genre.classic { background: var(--genre-classic); }
        .queue-genre.edm { background: var(--genre-edm); }
        .queue-genre.rnb { background: var(--genre-rnb); }
        .queue-genre.country { background: var(--genre-country); }

        /* Car Section */
        .car-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 32px;
        }

        .car-stat-card {
            background: var(--bg-card);
            padding: 24px;
            border-radius: var(--radius-lg);
            border: 1px solid var(--border-color);
            text-align: center;
        }

        .car-stat-value {
            font-size: 2rem;
            font-weight: 800;
            color: var(--car);
            margin-top: 8px;
        }

        .car-detection-status {
            background: rgba(0, 168, 255, 0.1);
            border-radius: var(--radius-lg);
            padding: 20px;
            margin-bottom: 24px;
            border: 1px solid var(--car);
        }

        .car-register-box {
            background: rgba(0, 168, 255, 0.1);
            border-radius: var(--radius-lg);
            padding: 24px;
            margin-bottom: 24px;
            border: 1px solid rgba(0, 168, 255, 0.3);
        }

        /* Player Queue */
        .player-queue {
            background: rgba(255,255,255,0.03);
            border-radius: var(--radius-lg);
            padding: 16px;
            margin-top: 20px;
        }

        /* Video Player Container */
        .video-player-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: black;
            z-index: 10000;
            display: none;
        }

        .video-player-container video {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .video-close-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: var(--danger);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-size: 20px;
            cursor: pointer;
            z-index: 10001;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .video-close-btn:hover {
            transform: scale(1.1);
            background: #ff4444;
        }

        .video-info-bar {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0,0,0,0.7);
            backdrop-filter: blur(10px);
            padding: 16px 24px;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 10001;
        }

        /* Car Mode Badge */
        .car-mode-badge {
            position: fixed;
            top: 20px;
            left: 20px;
            background: var(--car);
            color: white;
            padding: 12px 24px;
            border-radius: var(--radius-full);
            font-weight: 700;
            z-index: 10002;
            display: flex;
            align-items: center;
            gap: 12px;
            animation: slideDown 0.3s ease;
            box-shadow: 0 4px 20px rgba(0, 168, 255, 0.3);
            border: 1px solid rgba(255,255,255,0.2);
        }

        @keyframes slideDown {
            from { transform: translateY(-100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* Onboarding Popup - 완전 복구 */
        .onboarding-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(20px);
            z-index: 100000;
            display: none;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.5s ease;
        }

        .onboarding-popup {
            background: var(--bg-modal);
            border-radius: var(--radius-xl);
            max-width: 900px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-lg);
            animation: slideUp 0.5s ease;
        }

        .onboarding-header {
            padding: 40px 40px 20px;
            text-align: center;
            border-bottom: 1px solid var(--border-color);
        }

        .onboarding-logo {
            font-size: 5rem;
            margin-bottom: 20px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .onboarding-title {
            font-size: 2.8rem;
            font-weight: 800;
            background: linear-gradient(135deg, #b983ff, #8a2be2, #1db954, #00a8ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 16px;
        }

        .onboarding-subtitle {
            font-size: 1.3rem;
            color: var(--text-secondary);
            max-width: 700px;
            margin: 0 auto;
        }

        .onboarding-content {
            padding: 40px;
        }

        .onboarding-section {
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            gap: 12px;
            background: linear-gradient(135deg, #fff, #e0e0e0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 24px;
            margin-bottom: 30px;
        }

        .feature-card {
            background: rgba(255, 255, 255, 0.03);
            border-radius: var(--radius-lg);
            padding: 28px;
            border: 1px solid var(--border-color);
            transition: var(--transition);
        }

        .feature-card:hover {
            transform: translateY(-4px);
            border-color: var(--accent);
            background: rgba(138, 43, 226, 0.1);
        }

        .feature-icon {
            font-size: 3rem;
            margin-bottom: 20px;
        }

        .feature-title {
            font-size: 1.4rem;
            font-weight: 700;
            margin-bottom: 12px;
            color: white;
        }

        .feature-desc {
            color: var(--text-secondary);
            font-size: 1rem;
            line-height: 1.6;
        }

        .economy-table {
            background: rgba(255, 255, 255, 0.03);
            border-radius: var(--radius-lg);
            overflow: hidden;
            margin: 30px 0;
        }

        .economy-row {
            display: flex;
            justify-content: space-between;
            padding: 18px 28px;
            border-bottom: 1px solid var(--border-color);
        }

        .economy-row:last-child {
            border-bottom: none;
        }

        .economy-label {
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.1rem;
        }

        .economy-value {
            font-weight: 700;
            color: var(--success);
            font-size: 1.2rem;
        }

        .economy-value.highlight {
            color: var(--car);
            font-size: 1.4rem;
        }

        .comparison-box {
            display: flex;
            gap: 24px;
            margin: 30px 0;
        }

        .comparison-item {
            flex: 1;
            background: rgba(255,255,255,0.03);
            padding: 28px;
            border-radius: var(--radius-lg);
            text-align: center;
        }

        .comparison-value {
            font-size: 2.5rem;
            font-weight: 800;
            margin: 15px 0;
        }

        .spotify-badge {
            background: var(--success);
            color: white;
            padding: 6px 16px;
            border-radius: var(--radius-full);
            display: inline-block;
            font-size: 0.9rem;
        }

        .functions-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin: 30px 0;
        }

        .function-item {
            background: rgba(255,255,255,0.03);
            padding: 24px;
            border-radius: var(--radius-lg);
            text-align: center;
            border: 1px solid var(--border-color);
        }

        .function-icon {
            font-size: 2.5rem;
            margin-bottom: 12px;
        }

        .function-name {
            font-weight: 700;
            margin-bottom: 8px;
        }

        .function-desc {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .genre-badge-container {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            margin: 20px 0;
        }

        .genre-badge {
            padding: 8px 20px;
            border-radius: var(--radius-full);
            font-size: 0.95rem;
            background: rgba(255,255,255,0.05);
        }

        .genre-badge.pop { background: var(--genre-pop); color: white; }
        .genre-badge.rock { background: var(--genre-rock); color: white; }
        .genre-badge.hiphop { background: var(--genre-hiphop); color: black; }
        .genre-badge.jazz { background: var(--genre-jazz); color: black; }
        .genre-badge.classic { background: var(--genre-classic); color: white; }
        .genre-badge.edm { background: var(--genre-edm); color: white; }
        .genre-badge.rnb { background: var(--genre-rnb); color: white; }
        .genre-badge.country { background: var(--genre-country); color: white; }

        .quote-box {
            background: linear-gradient(145deg, #1e1e2a, #15151f);
            border-radius: var(--radius-lg);
            padding: 40px;
            margin: 30px 0;
            border-left: 6px solid var(--accent);
            text-align: center;
        }

        .quote-text {
            font-size: 2rem;
            font-style: italic;
            color: white;
            margin-bottom: 20px;
            line-height: 1.4;
        }

        .quote-sub {
            font-size: 1.3rem;
            color: var(--text-secondary);
        }

        .step-indicator {
            display: flex;
            justify-content: center;
            gap: 16px;
            margin: 30px 0 20px;
        }

        .step-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--text-tertiary);
            cursor: pointer;
            transition: var(--transition);
        }

        .step-dot.active {
            background: var(--accent);
            transform: scale(1.3);
            box-shadow: 0 0 20px var(--accent-glow);
        }

        .onboarding-footer {
            padding: 20px 40px 40px;
            text-align: center;
            border-top: 1px solid var(--border-color);
        }

        .btn-start {
            background: linear-gradient(135deg, var(--accent), var(--success));
            color: white;
            border: none;
            padding: 18px 60px;
            border-radius: var(--radius-full);
            font-weight: 700;
            font-size: 1.3rem;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: 0 8px 20px rgba(138, 43, 226, 0.3);
        }

        .btn-start:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 28px rgba(138, 43, 226, 0.5);
        }

        .btn-skip {
            background: transparent;
            color: var(--text-secondary);
            border: 1px solid var(--border-color);
            padding: 14px 40px;
            border-radius: var(--radius-full);
            font-weight: 600;
            margin-top: 20px;
            cursor: pointer;
            transition: var(--transition);
            font-size: 1.1rem;
        }

        .btn-skip:hover {
            border-color: var(--accent);
            color: white;
        }

        /* Mining Index Display */
        .mining-index-card {
            background: linear-gradient(145deg, #1e1e2a, #15151f);
            border-radius: var(--radius-xl);
            padding: 32px;
            margin-bottom: 32px;
            border: 1px solid var(--border-color);
        }

        .index-value {
            font-size: 4rem;
            font-weight: 800;
            text-align: center;
            margin: 20px 0;
        }

        .index-peak { color: var(--mining-peak); }
        .index-offpeak { color: var(--mining-offpeak); }

        .index-graph {
            height: 100px;
            background: rgba(255,255,255,0.03);
            border-radius: var(--radius-lg);
            margin: 20px 0;
            position: relative;
            overflow: hidden;
        }

        .index-bar {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, var(--mining-peak), var(--mining-offpeak));
            transition: width 1s ease;
        }

        /* Ad Progress */
        .ad-progress {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-full);
            overflow: hidden;
            margin: 16px 0;
        }

        .ad-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--ad), #ffaa00);
            transition: width 0.2s linear;
        }

        .ad-timer {
            font-size: 2rem;
            font-weight: 800;
            color: var(--ad);
            text-align: center;
            margin: 16px 0;
        }

        /* Modals */
        .modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(12px);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .modal-content {
            background: var(--bg-modal);
            border-radius: var(--radius-xl);
            padding: 40px;
            max-width: 600px;
            width: 100%;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-lg);
            animation: slideUp 0.4s ease;
            max-height: 90vh;
            overflow-y: auto;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .player-content {
            max-width: 700px;
        }

        .player-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: white;
            margin-bottom: 8px;
        }

        .player-artist {
            color: var(--text-secondary);
            font-size: 1.1rem;
            margin-bottom: 24px;
        }

        .player-panel {
            background: rgba(255, 255, 255, 0.03);
            padding: 20px;
            border-radius: var(--radius-md);
            margin-bottom: 20px;
            border-left: 6px solid;
        }

        .player-tl-amount {
            font-size: 2.8rem;
            font-weight: 800;
            color: white;
            line-height: 1.2;
        }

        .player-progress {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-full);
            overflow: hidden;
            margin: 24px 0;
        }

        .player-progress-fill {
            height: 100%;
            background: var(--success);
            transition: width 0.2s linear;
        }

        .player-time {
            display: flex;
            justify-content: space-between;
            color: var(--text-tertiary);
            font-size: 13px;
            margin-bottom: 24px;
        }

        .player-controls {
            display: flex;
            gap: 16px;
            justify-content: center;
        }

        /* Auto-Recharge Switch */
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 2px;
            bottom: 2px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--success);
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        /* Form Elements */
        .form-group {
            margin-bottom: 24px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-secondary);
            font-weight: 600;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 14px 18px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            font-size: 15px;
            color: white;
            transition: var(--transition);
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--accent);
            background: rgba(138, 43, 226, 0.1);
        }

        /* Toast */
        .toast {
            position: fixed;
            top: 30px;
            right: 30px;
            background: var(--bg-modal);
            backdrop-filter: blur(10px);
            padding: 16px 24px;
            border-radius: var(--radius-full);
            border-left: 6px solid var(--success);
            box-shadow: var(--shadow-lg);
            display: none;
            z-index: 3000;
            min-width: 320px;
            color: white;
            font-weight: 500;
            border: 1px solid var(--border-color);
            animation: slideInRight 0.3s ease;
        }

        @keyframes slideInRight {
            from { transform: translateX(400px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .toast.success { border-left-color: var(--success); }
        .toast.error { border-left-color: var(--danger); }
        .toast.warning { border-left-color: var(--warning); }
        .toast.info { border-left-color: var(--info); }

        .demo-badge {
            background: var(--warning);
            color: black;
            padding: 4px 12px;
            border-radius: var(--radius-full);
            font-size: 11px;
            font-weight: 700;
            display: inline-block;
            margin-left: 12px;
            text-transform: uppercase;
        }

        .zero-tl-badge {
            background: var(--zero-tl);
            color: white;
            padding: 2px 8px;
            border-radius: var(--radius-full);
            font-size: 10px;
            margin-left: 8px;
        }

        .charge-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-top: 20px;
        }

        .charge-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .charge-card:hover {
            border-color: var(--accent);
            transform: translateY(-2px);
        }

        .charge-card .amount {
            font-size: 1.8rem;
            font-weight: 800;
            color: var(--success);
            margin: 10px 0;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .app-container { padding: 20px; }
            .header-right { gap: 16px; }
            .balance-cards { flex-direction: column; gap: 8px; }
        }

        @media (max-width: 768px) {
            .app-header { flex-direction: column; align-items: stretch; }
            .header-right { flex-direction: column; width: 100%; }
            .tabs-container { top: auto; }
            .stats-grid { grid-template-columns: 1fr; }
            .share-stats { grid-template-columns: 1fr; }
            .car-stats { grid-template-columns: 1fr; }
            .file-list { grid-template-columns: 1fr; }
            .radio-channels { grid-template-columns: 1fr; }
            .file-type-selector { flex-direction: column; }
            .feature-grid { grid-template-columns: 1fr; }
            .functions-grid { grid-template-columns: repeat(2, 1fr); }
        }
    </style>
</head>
<body>

<!-- Toast Notification -->
<div id="toast" class="toast"></div>

<!-- Onboarding Popup - 완전 복구 -->
<div id="onboardingOverlay" class="onboarding-overlay">
    <div class="onboarding-popup">
        <div class="onboarding-header">
            <div class="onboarding-logo">⏰🎵</div>
            <h1 class="onboarding-title">TimeLink Global</h1>
            <p class="onboarding-subtitle">시간을 저축하고 소비하는 음악 경제 플랫폼</p>
        </div>
        
        <div class="onboarding-content" id="onboardingContent">
            <!-- 슬라이드 1: 핵심 가치 -->
            <div class="onboarding-section" data-slide="1">
                <div class="section-title">🎯 한 마디로 정의하면?</div>
                
                <div class="quote-box">
                    <div class="quote-text">"1초 듣기 = 1TL 소모, 창작자에게 공정한 수익, 운전하면 2배 보상"</div>
                    <div class="quote-sub">- TimeLink 핵심 가치</div>
                </div>
                
                <div class="feature-grid">
                    <div class="feature-card">
                        <div class="feature-icon">⏰</div>
                        <div class="feature-title">시간 기반 경제</div>
                        <div class="feature-desc">1초 = 1TL (Time Token). 듣는 만큼 TL 소모, 창작자는 듣는 만큼 수익을 얻습니다.</div>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">💰</div>
                        <div class="feature-title">공정한 수익 분배</div>
                        <div class="feature-desc">5:5 계약: Spotify의 1.8배, 7:3 계약: Spotify의 2.5배 높은 수익을 창작자에게 돌려드립니다.</div>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">🚗</div>
                        <div class="feature-title">스마트 보상 시스템</div>
                        <div class="feature-desc">운전 시 2배 보상 (자동 감지), 광고 시청으로 TL 벌기, 차량 등록 시 추가 혜택</div>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">🤖</div>
                        <div class="feature-title">AI 기반 최적화</div>
                        <div class="feature-desc">실시간 기여도 지수로 채굴 최대 5배, 장르별 연속 재생, 피크/오프피크 자동 분석</div>
                    </div>
                </div>
            </div>
            
            <!-- 슬라이드 2: 경제 시스템 -->
            <div class="onboarding-section" data-slide="2" style="display: none;">
                <div class="section-title">💹 TimeLink 경제 시스템</div>
                
                <div class="economy-table">
                    <div class="economy-row">
                        <div class="economy-label"><span style="font-size:1.5rem;">🎵</span> 1초 재생 (TL3)</div>
                        <div class="economy-value">1 TL 소모</div>
                    </div>
                    <div class="economy-row">
                        <div class="economy-label"><span style="font-size:1.5rem;">🎬</span> 1초 재생 (TL4)</div>
                        <div class="economy-value">2 TL 소모</div>
                    </div>
                    <div class="economy-row">
                        <div class="economy-label"><span style="font-size:1.5rem;">💰</span> 1 TL 가격</div>
                        <div class="economy-value">0.1원 (10 TL = 1원)</div>
                    </div>
                    <div class="economy-row">
                        <div class="economy-label"><span style="font-size:1.5rem;">⏱️</span> 1시간 청취</div>
                        <div class="economy-value">3,600 TL = 360원</div>
                    </div>
                    <div class="economy-row">
                        <div class="economy-label"><span style="font-size:1.5rem;">📺</span> 30초 광고 시청</div>
                        <div class="economy-value highlight">+30~60 TL</div>
                    </div>
                    <div class="economy-row">
                        <div class="economy-label"><span style="font-size:1.5rem;">🚗</span> 운전 시 1분 청취</div>
                        <div class="economy-value highlight">+6 TL (2배 보상)</div>
                    </div>
                </div>
                
                <div class="comparison-box">
                    <div class="comparison-item">
                        <div style="font-size:2rem;">🎵 5:5 계약</div>
                        <div class="comparison-value">9.00 TL</div>
                        <div class="spotify-badge">Spotify의 1.8배</div>
                        <div style="margin-top:15px; color:var(--text-secondary);">3분 곡 기준</div>
                    </div>
                    <div class="comparison-item">
                        <div style="font-size:2rem;">🎵 7:3 계약</div>
                        <div class="comparison-value">12.60 TL</div>
                        <div class="spotify-badge">Spotify의 2.5배</div>
                        <div style="margin-top:15px; color:var(--text-secondary);">3분 곡 기준</div>
                    </div>
                </div>
            </div>
            
            <!-- 슬라이드 3: 주요 기능 -->
            <div class="onboarding-section" data-slide="3" style="display: none;">
                <div class="section-title">⚡ TimeLink 주요 기능</div>
                
                <div class="functions-grid">
                    <div class="function-item">
                        <div class="function-icon">🎵</div>
                        <div class="function-name">TL3 Audio</div>
                        <div class="function-desc">MP3, WAV, FLAC<br>1초 = 1TL</div>
                    </div>
                    <div class="function-item">
                        <div class="function-icon">🎬</div>
                        <div class="function-name">TL4 Video</div>
                        <div class="function-desc">MP4, MOV, AVI<br>1초 = 2TL</div>
                    </div>
                    <div class="function-item">
                        <div class="function-icon">🔄</div>
                        <div class="function-name">Share Place</div>
                        <div class="function-desc">모든 공유 곡 모음<br>다운로드 가능</div>
                    </div>
                    <div class="function-item">
                        <div class="function-icon">📻</div>
                        <div class="function-name">Radio</div>
                        <div class="function-desc">24/7 스트리밍<br>0.5TL/초 평균</div>
                    </div>
                    <div class="function-item">
                        <div class="function-icon">📺</div>
                        <div class="function-name">Commercial</div>
                        <div class="function-desc">소상공인 혜택<br>0.3TL/초</div>
                    </div>
                    <div class="function-item">
                        <div class="function-icon">🚗</div>
                        <div class="function-name">Car</div>
                        <div class="function-desc">2배 보상<br>자동 감지 시스템</div>
                    </div>
                    <div class="function-item">
                        <div class="function-icon">⛏️</div>
                        <div class="function-name">Mining</div>
                        <div class="function-desc">TLC 채굴<br>AI 지수 적용</div>
                    </div>
                    <div class="function-item">
                        <div class="function-icon">📚</div>
                        <div class="function-name">Lecture</div>
                        <div class="function-desc">강의 마켓<br>창작자 70%</div>
                    </div>
                </div>
                
                <div class="section-title" style="font-size:1.5rem; margin-top:40px;">🎤 장르별 음악 분류</div>
                <div class="genre-badge-container">
                    <span class="genre-badge pop">🎤 Pop</span>
                    <span class="genre-badge rock">🎸 Rock</span>
                    <span class="genre-badge hiphop">🎧 Hip-Hop</span>
                    <span class="genre-badge jazz">🎺 Jazz</span>
                    <span class="genre-badge classic">🎻 Classic</span>
                    <span class="genre-badge edm">💿 EDM</span>
                    <span class="genre-badge rnb">🎹 R&B</span>
                    <span class="genre-badge country">🤠 Country</span>
                </div>
            </div>
            
            <!-- 슬라이드 4: 슬로건 및 비전 -->
            <div class="onboarding-section" data-slide="4" style="display: none;">
                <div class="section-title">🌟 TimeLink의 약속</div>
                
                <div class="quote-box" style="border-left-color: var(--car);">
                    <div class="quote-text">"TimeLink - 당신의 청취가 자산이 되는 순간"</div>
                    <div class="quote-text" style="font-size:1.5rem; margin-top:20px;">"Listen, Earn, and Own Your Time"</div>
                </div>
                
                <div style="text-align: center; margin: 50px 0;">
                    <div style="font-size: 6rem; margin-bottom: 30px;">⏰ → 🎵 → 💰</div>
                    <p style="color: var(--text-secondary); font-size:1.2rem;">시간을 음악으로, 음악을 자산으로</p>
                </div>
                
                <div class="feature-grid">
                    <div class="feature-card">
                        <div class="feature-icon">🎯</div>
                        <div class="feature-title">비전</div>
                        <div class="feature-desc">음악 스트리밍의 패러다임 전환. 단순한 소비가 아닌 경제 활동으로의 진화.</div>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">💎</div>
                        <div class="feature-title">핵심 가치</div>
                        <div class="feature-desc">1초의 가치를 창출하다. 모든 청취가 크리에이터와 플랫폼에 공정한 수익으로.</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="step-indicator" id="stepIndicator">
            <span class="step-dot active" onclick="TimeLinkSystem.onboarding.goToSlide(1)"></span>
            <span class="step-dot" onclick="TimeLinkSystem.onboarding.goToSlide(2)"></span>
            <span class="step-dot" onclick="TimeLinkSystem.onboarding.goToSlide(3)"></span>
            <span class="step-dot" onclick="TimeLinkSystem.onboarding.goToSlide(4)"></span>
        </div>
        
        <div class="onboarding-footer">
            <button class="btn-start" onclick="TimeLinkSystem.onboarding.complete()">
                🚀 TimeLink 시작하기
            </button>
            <button class="btn-skip" onclick="TimeLinkSystem.onboarding.skip()">
                나중에 둘러보기
            </button>
        </div>
    </div>
</div>

<!-- Video Player Container -->
<div class="video-player-container" id="videoPlayerContainer">
    <video id="videoPlayer" controls autoplay></video>
    <button class="video-close-btn" onclick="TimeLinkSystem.player.stop()">✕</button>
    <div class="video-info-bar" id="videoInfoBar">
        <span id="videoTitle">Now Playing</span>
        <span id="videoTimeRemaining">TL: 0</span>
    </div>
</div>

<!-- Audio Players -->
<audio id="audioPlayer" style="display: none;"></audio>
<audio id="radioPlayer" style="display: none;"></audio>
<audio id="adAudioPlayer" style="display: none;"></audio>

<!-- 파일 업로드를 위한 input -->
<input type="file" id="fileInput" style="display: none;" accept="audio/*,video/*">
<input type="file" id="lectureFileInput" style="display: none;" accept="video/*,audio/*">

<!-- Charge Modal -->
<div id="chargeModal" class="modal">
    <div class="modal-content">
        <h2 style="font-size: 1.8rem; font-weight: 700; margin-bottom: 24px; background: linear-gradient(135deg, #b983ff, #8a2be2); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
            💰 Charge TL
        </h2>
        <div class="form-group">
            <label>TL Amount</label>
            <input type="number" id="chargeAmount" placeholder="1000" min="100" step="100" value="1000">
            <p style="color: var(--text-secondary); font-size: 14px; margin-top: 12px;">
                Your balance: <strong id="currentTLBalance" style="color: white;">25,000</strong> TL
            </p>
        </div>
        <div style="display: flex; gap: 16px;">
            <button class="btn-play" id="btnChargeConfirm" style="flex: 1; background: var(--accent);">⚡ Charge</button>
            <button class="btn-play" onclick="TimeLinkSystem.ui.closeChargeModal()" style="flex: 1; background: transparent; border: 1px solid var(--border-color);">Cancel</button>
        </div>
    </div>
</div>

<!-- Purchase TL Modal -->
<div id="purchaseModal" class="modal">
    <div class="modal-content">
        <h2 style="font-size: 1.8rem; font-weight: 700; margin-bottom: 24px; background: linear-gradient(135deg, #b983ff, #8a2be2); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
            💵 Purchase TL
        </h2>
        <p style="color: var(--text-secondary); margin-bottom: 24px;">
            1 TL = 0.1원 · 보너스: 최대 20% 추가
        </p>
        <div id="purchasePackages" class="charge-options"></div>
        <div style="display: flex; gap: 16px; margin-top: 24px;">
            <button class="btn-play" onclick="TimeLinkSystem.ui.closePurchaseModal()" style="flex: 1; background: transparent; border: 1px solid var(--border-color);">Close</button>
        </div>
    </div>
</div>

<!-- Lecture Purchase Modal -->
<div id="lecturePurchaseModal" class="modal">
    <div class="modal-content">
        <h2 style="font-size: 1.8rem; font-weight: 700; margin-bottom: 24px; background: linear-gradient(135deg, #ff7b00, #ff5500); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
            📚 Purchase Lecture
        </h2>
        <div id="lecturePurchaseInfo">
            <div style="font-size: 1.3rem; color: white; margin-bottom: 12px;" id="lecturePurchaseTitle">Lecture Title</div>
            <div style="color: var(--text-secondary); margin-bottom: 20px;" id="lecturePurchaseCreator">Creator</div>
            <div style="background: rgba(255, 123, 0, 0.1); padding: 20px; border-radius: var(--radius-lg); margin-bottom: 20px;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 12px;">
                    <span style="color: var(--text-secondary);">Price:</span>
                    <strong style="color: white; font-size: 1.5rem;" id="lecturePurchasePrice">0 TL</strong>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 12px;">
                    <span style="color: var(--text-secondary);">Your balance:</span>
                    <strong style="color: var(--success);" id="lecturePurchaseBalance">0 TL</strong>
                </div>
                <div style="display: flex; justify-content: space-between;">
                    <span style="color: var(--text-secondary);">After purchase:</span>
                    <strong style="color: white;" id="lecturePurchaseAfter">0 TL</strong>
                </div>
            </div>
        </div>
        <div style="display: flex; gap: 16px;">
            <button class="btn-play" onclick="TimeLinkSystem.lecture.confirmPurchase()" style="flex: 1; background: var(--lecture);">📚 Purchase</button>
            <button class="btn-play" onclick="TimeLinkSystem.ui.closeLecturePurchaseModal()" style="flex: 1; background: transparent; border: 1px solid var(--border-color);">Cancel</button>
        </div>
    </div>
</div>

<!-- Lecture Create Modal -->
<div id="lectureCreateModal" class="modal">
    <div class="modal-content" style="max-width: 600px;">
        <h2 style="font-size: 1.8rem; font-weight: 700; margin-bottom: 24px; background: linear-gradient(135deg, #ff7b00, #ff5500); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
            📚 Create Lecture
        </h2>
        <div class="form-group">
            <label>Title</label>
            <input type="text" id="lectureTitle" placeholder="Lecture title">
        </div>
        <div class="form-group">
            <label>Instructor</label>
            <input type="text" id="lectureInstructor" placeholder="Instructor name">
        </div>
        <div class="form-group">
            <label>Description</label>
            <textarea id="lectureDescription" rows="3" placeholder="Lecture description"></textarea>
        </div>
        <div class="form-group">
            <label>Category</label>
            <select id="lectureCategory">
                <option value="programming">💻 Programming</option>
                <option value="business">📊 Business</option>
                <option value="design">🎨 Design</option>
                <option value="language">🌐 Language</option>
                <option value="finance">💰 Finance</option>
            </select>
        </div>
        <div class="form-group">
            <label>Price (TL)</label>
            <input type="number" id="lecturePrice" placeholder="5000" min="100" step="100" value="5000">
            <p style="color: var(--text-secondary); font-size: 12px; margin-top: 4px;">
                ≈ <span id="lecturePriceKRW">500</span>원
            </p>
        </div>
        <div class="upload-zone" onclick="document.getElementById('lectureFileInput').click()" style="padding: 30px; margin-bottom: 20px;">
            <div class="icon">📹</div>
            <h3>Select lecture video/audio</h3>
            <p>MP4, MP3, WAV (max 500MB)</p>
        </div>
        <button class="btn-play" onclick="TimeLinkSystem.lecture.create()" style="width: 100%; padding: 18px; background: var(--lecture);">
            📚 Create Lecture
        </button>
    </div>
</div>

<!-- Car Register Modal -->
<div id="carRegisterModal" class="modal">
    <div class="modal-content">
        <h2 style="font-size: 1.8rem; font-weight: 700; margin-bottom: 24px; background: linear-gradient(135deg, #00a8ff, #0097e6); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
            🚗 Register Car
        </h2>
        <div class="form-group">
            <label>Car Model</label>
            <input type="text" id="carModel" placeholder="Tesla Model 3">
        </div>
        <div class="form-group">
            <label>License Plate</label>
            <input type="text" id="carPlate" placeholder="ABC123">
        </div>
        <p style="color: var(--text-secondary); margin-bottom: 20px;">
            Registration fee: <strong>10,000 TL</strong> (one-time)
        </p>
        <div style="display: flex; gap: 16px;">
            <button class="btn-play" onclick="TimeLinkSystem.car.register()" style="flex: 1; background: var(--car);">🚗 Register</button>
            <button class="btn-play" onclick="TimeLinkSystem.ui.closeCarRegisterModal()" style="flex: 1; background: transparent; border: 1px solid var(--border-color);">Cancel</button>
        </div>
    </div>
</div>

<!-- Permission Request Modal -->
<div id="permissionModal" class="modal">
    <div class="modal-content">
        <h2 style="font-size: 1.8rem; font-weight: 700; margin-bottom: 24px; background: linear-gradient(135deg, #00a8ff, #0097e6); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
            🚗 차량 감지 권한
        </h2>
        <p style="color: var(--text-secondary); margin-bottom: 20px;">
            차량 내 청취 감지를 위해 다음 권한이 필요합니다:
        </p>
        <div style="background: rgba(0,168,255,0.1); padding: 20px; border-radius: var(--radius-lg); margin-bottom: 24px;">
            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                <span style="font-size: 1.5rem;">📍</span>
                <div>
                    <strong>위치 권한</strong>
                    <p style="font-size: 12px;">이동 속도 감지 (GPS)</p>
                </div>
            </div>
            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                <span style="font-size: 1.5rem;">📶</span>
                <div>
                    <strong>Bluetooth 권한</strong>
                    <p style="font-size: 12px;">차량 Bluetooth 연결 감지</p>
                </div>
            </div>
            <div style="display: flex; align-items: center; gap: 12px;">
                <span style="font-size: 1.5rem;">📳</span>
                <div>
                    <strong>가속도계 권한</strong>
                    <p style="font-size: 12px;">차량 진동 패턴 감지</p>
                </div>
            </div>
        </div>
        <div style="display: flex; gap: 16px;">
            <button class="btn-play" onclick="TimeLinkSystem.carDetection.requestAllPermissions()" style="flex: 1; background: var(--car);">✅ 권한 허용</button>
            <button class="btn-play" onclick="TimeLinkSystem.ui.closePermissionModal()" style="flex: 1; background: transparent; border: 1px solid var(--border-color);">나중에</button>
        </div>
    </div>
</div>

<!-- Player Modal -->
<div id="playerModal" class="modal">
    <div class="modal-content player-content">
        <div class="player-title" id="playerTitle">Now Playing</div>
        <div class="player-artist" id="playerArtist">Artist</div>
        
        <div style="margin-bottom: 16px;">
            <span id="playerTypeBadge" style="background: var(--success); padding: 4px 12px; border-radius: var(--radius-full); font-size: 12px;">TL3 Audio</span>
            <span id="playerRateBadge" style="background: var(--warning); padding: 4px 12px; border-radius: var(--radius-full); font-size: 12px; margin-left: 8px;">1TL/초</span>
        </div>
        
        <div class="player-panel" style="border-left-color: #8b5cf6;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                <span style="font-weight: 700; color: #8b5cf6;">📋 Copyright</span>
                <span style="background: #8b5cf6; color: white; padding: 4px 12px; border-radius: var(--radius-full); font-size: 11px;">Blockchain</span>
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                <div><span style="color: var(--text-secondary);">Owner</span><br><strong id="playerCopyrightOwner">Global Investor</strong></div>
                <div><span style="color: var(--text-secondary);">Reg. No.</span><br><strong id="playerCopyrightNumber">CR-2024-001234</strong></div>
            </div>
        </div>
        
        <div class="player-panel" style="border-left-color: var(--accent);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                <span style="font-weight: 700; color: var(--accent);">📊 Revenue Share</span>
                <span style="background: var(--accent); color: white; padding: 4px 12px; border-radius: var(--radius-full); font-size: 11px;" id="playerContractType">5:5 Contract</span>
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                <div><span style="color: var(--text-secondary);">Creator</span><br><strong id="playerCreatorShare">50%</strong></div>
                <div><span style="color: var(--text-secondary);">Platform</span><br><strong id="playerPlatformShare">50%</strong></div>
            </div>
        </div>
        
        <div class="player-panel" style="border-left-color: var(--warning);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                <span style="font-weight: 700; color: var(--warning);">⏳ TL Balance</span>
                <span style="background: var(--warning); color: black; padding: 4px 12px; border-radius: var(--radius-full); font-size: 11px;" id="playerRateLabel">1s = 1TL</span>
            </div>
            <div class="player-tl-amount" id="playerTL">5,000 TL</div>
            <div style="color: var(--text-secondary); font-size: 14px;" id="playerTimeRemaining">≈ 83 min left</div>
        </div>
        
        <div class="player-panel" style="border-left-color: var(--info);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                <span style="font-weight: 700; color: var(--info);">💰 Live Revenue</span>
                <span style="background: var(--info); color: white; padding: 4px 12px; border-radius: var(--radius-full); font-size: 11px;" id="playerRevenueLabel">0.1TL/초</span>
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                <div><span style="color: var(--text-secondary);">Creator</span><br><strong style="font-size: 1.3rem; color: var(--info);" id="playerCreatorRevenue">0.00 TL</strong></div>
                <div><span style="color: var(--text-secondary);">Platform</span><br><strong style="font-size: 1.3rem; color: var(--info);" id="playerPlatformRevenue">0.00 TL</strong></div>
            </div>
            <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid rgba(59,130,246,0.2);">
                <span style="color: var(--text-secondary);">Session Total</span>
                <br><strong id="playerTotalRevenue" style="color: white;">0.00 TL</strong>
            </div>
        </div>
        
        <div class="player-progress">
            <div id="playerProgress" class="player-progress-fill" style="width: 0%;"></div>
        </div>
        
        <div class="player-time">
            <span id="playerCurrentTime">0:00</span>
            <span id="playerTotalTime">83:20</span>
        </div>
        
        <div class="player-queue" id="playerQueue">
            <h4 style="margin-bottom: 12px; color: var(--text-secondary);">⏭️ Next in Queue</h4>
            <div id="queueList"></div>
        </div>
        
        <div class="player-panel" style="border-left-color: var(--success); margin-top: 16px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                <span style="font-weight: 700; color: var(--success);">⚡ Auto-Recharge</span>
                <label class="switch">
                    <input type="checkbox" id="autoRechargeToggle">
                    <span class="slider"></span>
                </label>
            </div>
            
            <div id="autoRechargeSettings" style="opacity: 0.5;">
                <div style="display: flex; gap: 12px; margin-bottom: 12px;">
                    <div style="flex: 1;">
                        <label style="color: var(--text-secondary); font-size: 11px;">Threshold (TL)</label>
                        <select id="autoRechargeThreshold" style="width: 100%; padding: 8px; background: rgba(255,255,255,0.1); border: 1px solid var(--border-color); border-radius: var(--radius-md); color: white;">
                            <option value="60">60 TL (1 min)</option>
                            <option value="300" selected>300 TL (5 min)</option>
                            <option value="600">600 TL (10 min)</option>
                            <option value="1800">1,800 TL (30 min)</option>
                        </select>
                    </div>
                    <div style="flex: 1;">
                        <label style="color: var(--text-secondary); font-size: 11px;">Amount (TL)</label>
                        <select id="autoRechargeAmount" style="width: 100%; padding: 8px; background: rgba(255,255,255,0.1); border: 1px solid var(--border-color); border-radius: var(--radius-md); color: white;">
                            <option value="600">600 TL (10 min)</option>
                            <option value="1800">1,800 TL (30 min)</option>
                            <option value="3600" selected>3,600 TL (1 hour)</option>
                            <option value="10800">10,800 TL (3 hours)</option>
                        </select>
                    </div>
                </div>
                
                <div style="margin-top: 12px; background: rgba(255,255,255,0.03); padding: 8px 12px; border-radius: var(--radius-md);">
                    <span style="color: var(--text-secondary);">Wallet: </span>
                    <strong style="color: white;" id="autoRechargeWalletBalance">25,000 TL</strong>
                    <span style="color: var(--text-secondary); margin-left: 12px;">Debt: </span>
                    <strong style="color: var(--warning);" id="autoRechargeDebt">0 TL</strong>
                </div>
            </div>
        </div>
        
        <div class="player-controls" style="margin-top: 16px;">
            <button class="btn-play" onclick="TimeLinkSystem.player.togglePlayPause()" id="playPauseBtn" style="flex: 1;">⏸️ Pause</button>
            <button class="btn-play" onclick="TimeLinkSystem.player.stop()" style="flex: 1; background: transparent; border: 1px solid var(--border-color);">⏹️ Stop</button>
            <button class="btn-play" onclick="TimeLinkSystem.player.openChargeModal()" style="flex: 1; background: var(--warning); color: black;">💰 Charge</button>
        </div>
    </div>
</div>

<!-- Ad Watch Modal -->
<div id="adWatchModal" class="modal">
    <div class="modal-content" style="text-align: center;">
        <h2 style="font-size: 2rem; font-weight: 700; margin-bottom: 24px; background: linear-gradient(135deg, #ffd700, #ffaa00); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
            📺 Watch Ad & Earn TL
        </h2>
        
        <div id="adTypeSelector" style="display: flex; gap: 20px; margin-bottom: 30px;">
            <div class="file-type-card" style="flex:1;" onclick="TimeLinkSystem.ad.selectType('video')">
                <div class="icon">📹</div>
                <h3>Video Ad</h3>
                <div class="rate" style="color: var(--ad);">30초 = 60 TL</div>
            </div>
            <div class="file-type-card" style="flex:1;" onclick="TimeLinkSystem.ad.selectType('audio')">
                <div class="icon">🎵</div>
                <h3>Audio Ad</h3>
                <div class="rate" style="color: var(--ad);">30초 = 30 TL</div>
            </div>
        </div>
        
        <div id="adPlayerSection" style="display: none;">
            <div id="videoAdContainer" style="display: none;">
                <video id="videoAdPlayer" style="width: 100%; border-radius: var(--radius-lg);" controls></video>
            </div>
            
            <div id="audioAdContainer" style="display: none;">
                <div style="background: linear-gradient(145deg, #ffd700, #ffaa00); padding: 40px; border-radius: var(--radius-lg); margin: 20px 0;">
                    <div style="font-size: 4rem; margin-bottom: 20px;">🎵</div>
                    <div class="ad-timer" id="adTimer">30</div>
                    <div class="ad-progress">
                        <div class="ad-progress-fill" id="adProgress" style="width: 0%;"></div>
                    </div>
                </div>
            </div>
            
            <div style="margin: 20px 0; padding: 16px; background: rgba(255,215,0,0.1); border-radius: var(--radius-lg);">
                <div style="display: flex; justify-content: space-between;">
                    <span>💰 예상 보상:</span>
                    <strong id="adRewardAmount" style="color: var(--ad);">60 TL</strong>
                </div>
                <div style="display: flex; justify-content: space-between; margin-top: 8px;">
                    <span>📊 오늘 남은 보상:</span>
                    <strong id="adDailyRemaining">540 TL</strong>
                </div>
            </div>
            
            <div style="display: flex; gap: 16px; margin-top: 24px;">
                <button class="btn-play" onclick="TimeLinkSystem.ad.startWatching()" id="adStartBtn" style="flex: 1; background: var(--ad); color: black;">▶️ Start Watching</button>
                <button class="btn-play" onclick="TimeLinkSystem.ui.closeAdModal()" style="flex: 1; background: transparent; border: 1px solid var(--border-color);">Cancel</button>
            </div>
        </div>
        
        <div id="adInitialSection">
            <div style="background: rgba(255,215,0,0.1); padding: 24px; border-radius: var(--radius-lg); margin-bottom: 24px;">
                <p>🎯 광고를 시청하고 TL을 받으세요!</p>
                <p style="font-size: 14px; margin-top: 12px;">• 비디오 광고: 30초 시청 = 60 TL</p>
                <p style="font-size: 14px;">• 오디오 광고: 30초 청취 = 30 TL</p>
                <p style="font-size: 14px;">• 일일 최대: 600 TL</p>
            </div>
            <button class="btn-play" onclick="TimeLinkSystem.ad.showSelector()" style="width: 100%; background: var(--ad); color: black;">📺 Select Ad Type</button>
        </div>
    </div>
</div>

<!-- Login Page -->
<div id="authContainer" class="auth-container">
    <div class="auth-box">
        <div class="logo">
            <h1>⏰ TimeLink</h1>
            <p>TL3/TL4 — Time-Based Economy</p>
        </div>
        <div class="version-badge">
            🚀 v22.15 · 온보딩 + 모든 기능 완전 복구 <span class="demo-badge">FIXED</span>
        </div>
        
        <button class="google-login-btn" onclick="TimeLinkSystem.demo.login()">
            <i class="fab fa-google"></i> Continue with Google
        </button>
        
        <div style="background: rgba(255,255,255,0.03); border-radius: var(--radius-lg); padding: 20px; margin-top: 20px;">
            <h3 style="color: white; margin-bottom: 16px;">🎵 TimeLink 소개</h3>
            <p style="color: var(--text-secondary);">1초 듣기 = 1TL · 창작자 수익 최대 2.5배 · 운전 시 2배 보상</p>
        </div>
    </div>
</div>

<!-- Main Application -->
<div id="appContainer" class="app-container" style="display: none;">
    
    <!-- Header -->
    <div class="app-header">
        <div class="header-left">
            <h1>⏰ TimeLink Global</h1>
            <span class="demo-badge">완전체</span>
        </div>
        <div class="header-right">
            <div class="balance-cards">
                <div class="balance-card" onclick="TimeLinkSystem.ui.openPurchaseModal()">
                    <div class="label">💰 TL Wallet</div>
                    <div class="amount" id="walletBalance">25,000</div>
                </div>
                <div class="balance-card">
                    <div class="label">🪙 TLC</div>
                    <div class="amount" id="tlcBalance">1,250.75</div>
                </div>
                <div class="balance-card" style="background: rgba(255,215,0,0.1);" onclick="TimeLinkSystem.ui.openAdModal()">
                    <div class="label">📺 광고보기</div>
                    <div class="amount" id="adRewardIndicator">+60 TL</div>
                </div>
            </div>
            <div class="user-profile">
                <div class="avatar-circle" id="userAvatar">G</div>
                <div class="user-info">
                    <div class="user-name" id="currentUsername">Global Investor</div>
                    <div class="user-status" id="userStatus">🏢 Business</div>
                </div>
            </div>
            <button class="btn-logout" onclick="TimeLinkSystem.demo.logout()">Logout</button>
        </div>
    </div>

    <!-- Tab Navigation (data-tab 속성 추가) -->
    <div class="tabs-container">
        <div class="tabs">
            <button class="tab active" data-tab="dashboard" onclick="TimeLinkSystem.ui.switchTab('dashboard')">📊 Dashboard</button>
            <button class="tab" data-tab="upload" onclick="TimeLinkSystem.ui.switchTab('upload')">📤 Create</button>
            <button class="tab" data-tab="library" onclick="TimeLinkSystem.ui.switchTab('library')">🎵 My Files</button>
            <button class="tab" data-tab="shareplace" onclick="TimeLinkSystem.ui.switchTab('shareplace')">🔄 Share Place</button>
            <button class="tab" data-tab="radio" onclick="TimeLinkSystem.ui.switchTab('radio')">📻 Radio</button>
            <button class="tab" data-tab="commercial" onclick="TimeLinkSystem.ui.switchTab('commercial')">📺 Commercial</button>
            <button class="tab" data-tab="car" onclick="TimeLinkSystem.ui.switchTab('car')">🚗 Car</button>
            <button class="tab" data-tab="mining" onclick="TimeLinkSystem.ui.switchTab('mining')">⛏️ Mining</button>
            <button class="tab" data-tab="lecture" onclick="TimeLinkSystem.ui.switchTab('lecture')">📚 Lecture</button>
            <button class="tab" data-tab="gold" onclick="TimeLinkSystem.ui.switchTab('gold')">🏆 Gold</button>
            <button class="tab" data-tab="ton" onclick="TimeLinkSystem.ui.switchTab('ton')">⬡ TON</button>
        </div>
    </div>

    <!-- Dashboard -->
    <div id="tabDashboard" class="tab-content active">
        <div class="stats-grid">
            <div class="stat-card">
                <div class="icon">💰</div>
                <div class="label">TL Wallet</div>
                <div class="value" id="dashWallet">25,000</div>
            </div>
            <div class="stat-card">
                <div class="icon">🪙</div>
                <div class="label">TLC</div>
                <div class="value" id="dashTLC">1,250.75</div>
            </div>
            <div class="stat-card">
                <div class="icon">🎵</div>
                <div class="label">TL3 Files</div>
                <div class="value" id="dashTL3">8</div>
            </div>
            <div class="stat-card">
                <div class="icon">🎬</div>
                <div class="label">TL4 Files</div>
                <div class="value" id="dashTL4">1</div>
            </div>
        </div>
        
        <!-- 장르별 음악 분포 -->
        <div class="card">
            <h3 style="color: white; margin-bottom: 20px;">🎵 장르별 음악 분포</h3>
            <div style="display: flex; gap: 16px; flex-wrap: wrap;" id="genreDistribution">
                <span class="genre-badge pop">Pop 2곡</span>
                <span class="genre-badge rock">Rock 2곡</span>
                <span class="genre-badge hiphop">Hip-Hop 1곡</span>
                <span class="genre-badge jazz">Jazz 1곡</span>
                <span class="genre-badge classic">Classic 1곡</span>
                <span class="genre-badge edm">EDM 1곡</span>
                <span class="genre-badge rnb">R&B 1곡</span>
                <span class="genre-badge country">Country 1곡</span>
            </div>
        </div>
        
        <!-- AI 기여도 지수 -->
        <div class="mining-index-card">
            <h2 style="color: white; margin-bottom: 16px;">🤖 AI 실시간 기여도 지수</h2>
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <div>
                    <span style="color: var(--text-secondary);">현재 시간:</span>
                    <strong style="color: white; font-size: 1.5rem; margin-left: 10px;" id="currentTimeDisplay">14:30</strong>
                </div>
                <div>
                    <span style="color: var(--text-secondary);">현재 지수:</span>
                    <strong style="color: var(--mining-offpeak); font-size: 2.5rem; margin-left: 10px;" id="currentIndexDisplay">2.5x</strong>
                </div>
            </div>
            <div class="index-graph">
                <div class="index-bar" id="indexBar" style="width: 50%;"></div>
            </div>
        </div>
        
        <!-- 차량 감지 상태 -->
        <div style="background: rgba(0,168,255,0.1); border-radius: var(--radius-lg); padding: 20px; margin-bottom: 20px;">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <h3 style="color: white;">🚗 차량 감지 상태</h3>
                    <p style="color: var(--text-secondary);" id="carDetectionStatus">감지 대기중...</p>
                </div>
                <span class="badge" style="background: var(--car); position: static;" id="carModeBadgeHeader">일반 모드</span>
            </div>
        </div>
    </div>

    <!-- Create 탭 - 파일 업로드 완전 복구 -->
    <div id="tabUpload" class="tab-content">
        <div class="card">
            <h2>📤 Create TL3 (Audio) / TL4 (Video)</h2>
            <div style="background: rgba(255,68,68,0.1); border-left: 6px solid var(--zero-tl); padding: 20px; border-radius: var(--radius-lg); margin-bottom: 28px;">
                <p style="color: white; font-weight: 700;">⚠️ 생성된 파일의 초기 TL = 0</p>
                <p style="color: var(--text-secondary); font-size: 14px; margin-top: 8px;">파일을 선택하면 업로드 폼이 나타납니다.</p>
            </div>
            
            <div class="file-type-selector">
                <div class="file-type-card audio selected" id="audioTypeCard" onclick="TimeLinkSystem.file.selectType('audio')">
                    <div class="icon">🎵</div>
                    <h3>TL3 Audio</h3>
                    <div class="rate">1초 = 1TL</div>
                    <div class="desc">MP3, WAV, FLAC</div>
                    <div class="zero-tl-badge">초기 TL 0</div>
                </div>
                <div class="file-type-card video" id="videoTypeCard" onclick="TimeLinkSystem.file.selectType('video')">
                    <div class="icon">🎬</div>
                    <h3>TL4 Video</h3>
                    <div class="rate">1초 = 2TL</div>
                    <div class="desc">MP4, MOV, AVI</div>
                    <div class="zero-tl-badge">초기 TL 0</div>
                </div>
            </div>
            
            <div class="upload-zone" onclick="document.getElementById('fileInput').click()">
                <div class="icon" id="uploadIcon">🎵</div>
                <h3 id="uploadText">Click to select file</h3>
                <p id="uploadDesc">MP3, WAV, FLAC (max 100MB)</p>
            </div>
            
            <div id="uploadForm" style="display: none; margin-top: 32px;">
                <div class="form-group">
                    <label>Title</label>
                    <input type="text" id="songTitle" placeholder="Enter song title">
                </div>
                <div class="form-group">
                    <label>Artist</label>
                    <input type="text" id="songArtist" placeholder="Artist name">
                </div>
                <div class="form-group">
                    <label>Genre</label>
                    <select id="songGenre">
                        <option value="pop">🎤 Pop</option>
                        <option value="rock">🎸 Rock</option>
                        <option value="hiphop">🎧 Hip-Hop</option>
                        <option value="jazz">🎺 Jazz</option>
                        <option value="classic">🎻 Classic</option>
                        <option value="edm">💿 EDM</option>
                        <option value="rnb">🎹 R&B</option>
                        <option value="country">🤠 Country</option>
                    </select>
                </div>
                
                <div style="background: rgba(139, 92, 246, 0.1); padding: 24px; border-radius: var(--radius-lg); margin-bottom: 24px;">
                    <h3 style="margin-bottom: 20px; color: #8b5cf6;">📋 Copyright</h3>
                    <div class="form-group">
                        <label>Owner</label>
                        <input type="text" id="copyrightOwner" value="Global Investor">
                    </div>
                    <div class="form-group">
                        <label>Reg. Number</label>
                        <input type="text" id="copyrightNumber" readonly style="background: rgba(0,0,0,0.2);">
                    </div>
                </div>
                
                <div style="background: rgba(138, 43, 226, 0.1); padding: 24px; border-radius: var(--radius-lg); margin-bottom: 24px;">
                    <h3 style="margin-bottom: 20px; color: var(--accent);">📊 Contract</h3>
                    <select id="revenueShare">
                        <option value="55">5:5 Contract — Mining Allowed (Creator 50%)</option>
                        <option value="73">7:3 Contract — No Mining (Creator 70%)</option>
                    </select>
                </div>
                
                <div style="background: rgba(255,68,68,0.1); padding: 16px; border-radius: var(--radius-lg); margin-bottom: 24px;">
                    <p style="color: white; text-align: center;">
                        ⚠️ 생성된 파일의 TL 잔액: <strong style="color: var(--zero-tl);">0 TL</strong>
                    </p>
                </div>
                
                <button class="btn-play" onclick="TimeLinkSystem.file.create()" style="width: 100%; padding: 18px; background: var(--accent);">
                    ✨ Create File (TL 0)
                </button>
            </div>
        </div>
    </div>

    <!-- My Files 탭 - 변환된 파일이 여기에 표시됨 -->
    <div id="tabLibrary" class="tab-content">
        <div class="card">
            <h2>🎵 My TL3/TL4 Files</h2>
            <div id="fileList" class="file-list">
                <!-- 파일 목록이 여기에 동적으로 표시됨 -->
            </div>
        </div>
    </div>

    <!-- Share Place 탭 -->
    <div id="tabShareplace" class="tab-content">
        <div class="share-header">
            <div>
                <h2 style="color: white;">🔄 Share Place</h2>
                <p style="color: rgba(255,255,255,0.9);">모든 공유 곡 모음 · 장르별 필터링</p>
            </div>
            <div style="background: rgba(255,255,255,0.1); padding: 12px 28px; border-radius: var(--radius-full);">
                <span style="font-weight: 700; color: white;" id="sharedCount2">0</span> 곡
            </div>
        </div>
        <div class="share-stats">
            <div class="share-stat-card"><div>전체 곡</div><div class="share-stat-value" id="totalSharedCount">0</div></div>
            <div class="share-stat-card"><div>5:5 계약</div><div class="share-stat-value" id="shared55Count">0</div></div>
            <div class="share-stat-card"><div>7:3 계약</div><div class="share-stat-value" id="shared73Count">0</div></div>
        </div>
        <div class="genre-selector">
            <button class="genre-btn active" onclick="TimeLinkSystem.share.filterGenre('all', event)">🎵 전체</button>
            <button class="genre-btn pop" onclick="TimeLinkSystem.share.filterGenre('pop', event)">🎤 Pop</button>
            <button class="genre-btn rock" onclick="TimeLinkSystem.share.filterGenre('rock', event)">🎸 Rock</button>
            <button class="genre-btn hiphop" onclick="TimeLinkSystem.share.filterGenre('hiphop', event)">🎧 Hip-Hop</button>
            <button class="genre-btn jazz" onclick="TimeLinkSystem.share.filterGenre('jazz', event)">🎺 Jazz</button>
            <button class="genre-btn classic" onclick="TimeLinkSystem.share.filterGenre('classic', event)">🎻 Classic</button>
            <button class="genre-btn edm" onclick="TimeLinkSystem.share.filterGenre('edm', event)">💿 EDM</button>
            <button class="genre-btn rnb" onclick="TimeLinkSystem.share.filterGenre('rnb', event)">🎹 R&B</button>
            <button class="genre-btn country" onclick="TimeLinkSystem.share.filterGenre('country', event)">🤠 Country</button>
        </div>
        <div class="share-filter">
            <button class="filter-btn active" onclick="TimeLinkSystem.share.filter('all', event)">전체</button>
            <button class="filter-btn" onclick="TimeLinkSystem.share.filter('55', event)">5:5 계약</button>
            <button class="filter-btn" onclick="TimeLinkSystem.share.filter('73', event)">7:3 계약</button>
            <button class="filter-btn" onclick="TimeLinkSystem.share.filter('mining', event)">채굴 가능</button>
        </div>
        <div id="sharedMusicList" class="file-list"></div>
    </div>

    <!-- Radio 탭 -->
    <div id="tabRadio" class="tab-content">
        <div class="radio-header">
            <h2 style="color: white;">📻 TimeLink Radio</h2>
            <p style="color: white;">개인 청취용 · 장르 선택 후 랜덤 연속 재생</p>
        </div>
        <div class="genre-selector">
            <button class="genre-btn active" onclick="TimeLinkSystem.radio.selectGenre('all', event)">🎵 전체</button>
            <button class="genre-btn pop" onclick="TimeLinkSystem.radio.selectGenre('pop', event)">🎤 Pop</button>
            <button class="genre-btn rock" onclick="TimeLinkSystem.radio.selectGenre('rock', event)">🎸 Rock</button>
            <button class="genre-btn hiphop" onclick="TimeLinkSystem.radio.selectGenre('hiphop', event)">🎧 Hip-Hop</button>
            <button class="genre-btn jazz" onclick="TimeLinkSystem.radio.selectGenre('jazz', event)">🎺 Jazz</button>
            <button class="genre-btn classic" onclick="TimeLinkSystem.radio.selectGenre('classic', event)">🎻 Classic</button>
            <button class="genre-btn edm" onclick="TimeLinkSystem.radio.selectGenre('edm', event)">💿 EDM</button>
            <button class="genre-btn rnb" onclick="TimeLinkSystem.radio.selectGenre('rnb', event)">🎹 R&B</button>
            <button class="genre-btn country" onclick="TimeLinkSystem.radio.selectGenre('country', event)">🤠 Country</button>
        </div>
        <div id="radioChannels" class="radio-channels"></div>
    </div>

    <!-- Commercial 탭 -->
    <div id="tabCommercial" class="tab-content">
        <div class="commercial-header">
            <h2 style="color: white;">📺 Commercial Broadcast</h2>
            <p style="color: white;">카페 · 매장용 음악 라디오</p>
        </div>
        <div id="commercialChannels" class="radio-channels"></div>
    </div>

    <!-- Car 탭 -->
    <div id="tabCar" class="tab-content">
        <div class="car-header">
            <h2 style="color: white;">🚗 Car Listening</h2>
            <p style="color: white;">2배 보상</p>
        </div>
        <div id="carChannels" class="radio-channels"></div>
    </div>

    <!-- Mining 탭 -->
    <div id="tabMining" class="tab-content">
        <div class="card">
            <h2>⛏️ TLC Mining</h2>
            <button class="btn-play" onclick="TimeLinkSystem.mining.execute()">채굴하기</button>
        </div>
    </div>

    <!-- Lecture 탭 -->
    <div id="tabLecture" class="tab-content">
        <div class="card">
            <h2>📚 Lecture Share</h2>
            <div id="lectureList" class="file-list"></div>
        </div>
    </div>

    <!-- Gold 탭 -->
    <div id="tabGold" class="tab-content">
        <div class="card">
            <h2>🏆 Gold Reserve</h2>
            <div id="goldAmount">10.24 g</div>
        </div>
    </div>

    <!-- TON 탭 -->
    <div id="tabTon" class="tab-content">
        <div class="card">
            <h2>⬡ TON Blockchain</h2>
            <p>TLC on TON</p>
        </div>
    </div>
</div>

<!-- Car Mode Badge -->
<div id="carModeBadge" class="car-mode-badge" style="display: none;">
    <span>🚗</span>
    <span>CAR MODE · 2x 보상</span>
</div>

<!-- Status Badge -->
<div style="position: fixed; bottom: 20px; right: 20px; background: rgba(26,26,26,0.95); padding: 12px 24px; border-radius: var(--radius-full); border: 1px solid var(--border-color); z-index: 999; display: flex; gap: 12px;">
    <span style="color:var(--success);">🎵 TL3</span>
    <span style="color:var(--video);">🎬 TL4</span>
    <span style="color:var(--car);">🚗 2x</span>
    <span style="color:var(--accent);">📋 온보딩</span>
</div>

<script>
// ============================================================================
// TimeLink Global v22.15 - 완전 복구 (플레이어 완벽 구현)
// ============================================================================

const GENRES = ['pop', 'rock', 'hiphop', 'jazz', 'classic', 'edm', 'rnb', 'country'];
const GENRE_NAMES = {
    pop: 'Pop', rock: 'Rock', hiphop: 'Hip-Hop', jazz: 'Jazz',
    classic: 'Classic', edm: 'EDM', rnb: 'R&B', country: 'Country'
};
const GENRE_EMOJI = {
    pop: '🎤', rock: '🎸', hiphop: '🎧', jazz: '🎺',
    classic: '🎻', edm: '💿', rnb: '🎹', country: '🤠'
};

// 샘플 음악 데이터 (실제 재생 가능한 URL)
const MUSIC_DB = [
    { title: 'Dynamite', artist: 'BTS', genre: 'pop', duration: 210, url: 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3' },
    { title: 'Butter', artist: 'BTS', genre: 'pop', duration: 200, url: 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3' },
    { title: 'Bohemian Rhapsody', artist: 'Queen', genre: 'rock', duration: 355, url: 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-3.mp3' },
    { title: 'Stairway to Heaven', artist: 'Led Zeppelin', genre: 'rock', duration: 480, url: 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-4.mp3' },
    { title: 'Savage', artist: 'aespa', genre: 'hiphop', duration: 210, url: 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-5.mp3' },
    { title: 'Fly Me To The Moon', artist: 'Frank Sinatra', genre: 'jazz', duration: 150, url: 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-6.mp3' },
    { title: 'Fur Elise', artist: 'Beethoven', genre: 'classic', duration: 180, url: 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-7.mp3' },
    { title: 'Strobe', artist: 'deadmau5', genre: 'edm', duration: 600, url: 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-8.mp3' },
    { title: 'Blame It', artist: 'Jamie Foxx', genre: 'rnb', duration: 240, url: 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-9.mp3' },
    { title: 'Jolene', artist: 'Dolly Parton', genre: 'country', duration: 150, url: 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-10.mp3' }
];

// TL3/TL4 File Class
class TL3File {
    constructor(data) {
        this.id = 'tl3_' + Date.now() + '_' + Math.random().toString(36).substr(2, 8);
        this.type = 'TL3';
        this.fileType = 'audio';
        this.tlPerSecond = 1;
        this.metadata = {
            title: data.title,
            artist: data.artist,
            genre: data.genre || 'pop',
            copyright: data.copyright,
            contract: data.contract
        };
        this.token = {
            balance: data.initialBalance || 0,
            total_charged: data.initialBalance || 0,
            total_consumed: 0
        };
        this.audio = { url: data.audioUrl };
        this.creatorId = data.creatorId;
        this.creatorName = data.creatorName;
        this.isShared = false;
        this.sharedAt = null;
        this.createdAt = new Date().toISOString();
    }
}

class TL4File extends TL3File {
    constructor(data) {
        super(data);
        this.type = 'TL4';
        this.fileType = 'video';
        this.tlPerSecond = 2;
    }
}

// 메인 시스템
const TimeLinkSystem = {
    onboarding: {
        currentSlide: 1,
        totalSlides: 4,
        show() { document.getElementById('onboardingOverlay').style.display = 'flex'; this.goToSlide(1); },
        hide() { document.getElementById('onboardingOverlay').style.display = 'none'; },
        goToSlide(slide) {
            this.currentSlide = slide;
            document.querySelectorAll('[data-slide]').forEach(s => s.style.display = 'none');
            document.querySelector(`[data-slide="${slide}"]`).style.display = 'block';
            document.querySelectorAll('.step-dot').forEach((dot, i) => dot.classList.toggle('active', i + 1 === slide));
        },
        next() { if (this.currentSlide < this.totalSlides) this.goToSlide(this.currentSlide + 1); else this.complete(); },
        prev() { if (this.currentSlide > 1) this.goToSlide(this.currentSlide - 1); },
        complete() { this.hide(); localStorage.setItem('timelink_onboarding', 'done'); },
        skip() { this.hide(); localStorage.setItem('timelink_onboarding', 'done'); },
        checkFirstTime() { if (!localStorage.getItem('timelink_onboarding')) setTimeout(() => this.show(), 1000); }
    },

    files: [],
    wallet: {
        tl: 25000,
        tlc: 1250.75,
        charge(amount) { this.tl += amount; TimeLinkSystem.ui.updateBalances(); },
        pay(amount) { if (this.tl >= amount) { this.tl -= amount; return true; } return false; }
    },
    user: { name: 'Global Investor', avatar: 'G', status: '🏢 Business' },
    carMode: false,
    autoRecharge: { enabled: false, threshold: 300, amount: 3600 },
    adDailyRemaining: 600,
    currentPlayer: null,
    playingFile: null,
    playInterval: null,

    initSampleFiles() {
        if (this.files.length === 0) {
            MUSIC_DB.forEach((song, index) => {
                const file = new TL3File({
                    title: song.title,
                    artist: song.artist,
                    genre: song.genre,
                    audioUrl: song.url,
                    creatorId: 'user_1',
                    creatorName: 'Global Investor',
                    copyright: { owner_name: song.artist, registration_number: `CR-${1234+index}` },
                    contract: { type: index % 2 === 0 ? '55' : '73', mining_allowed: index % 2 === 0 },
                    initialBalance: index === 0 ? 5000 : 0
                });
                this.files.push(file);
            });
            // 비디오 샘플
            const videoFile = new TL4File({
                title: 'Big Buck Bunny',
                artist: 'Blender Foundation',
                genre: 'animation',
                audioUrl: 'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4',
                creatorId: 'user_1',
                creatorName: 'Global Investor',
                copyright: { owner_name: 'Blender', registration_number: 'CR-1236' },
                contract: { type: '55', mining_allowed: true },
                initialBalance: 10000
            });
            this.files.push(videoFile);
        }
    },

    ui: {
        switchTab(tab) {
            // data-tab 속성으로 활성 탭 찾기
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelector(`.tab[data-tab="${tab}"]`).classList.add('active');
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.getElementById('tab' + tab.charAt(0).toUpperCase() + tab.slice(1)).classList.add('active');
            if (tab === 'library') this.updateLibrary();
            if (tab === 'shareplace') this.updateSharePlace();
            if (tab === 'radio') this.updateRadioChannels();
            if (tab === 'commercial') this.updateCommercialChannels();
            if (tab === 'car') this.updateCarChannels();
        },

        showToast(msg, type = 'info') {
            const toast = document.getElementById('toast');
            toast.textContent = msg;
            toast.className = `toast ${type}`;
            toast.style.display = 'block';
            setTimeout(() => toast.style.display = 'none', 3000);
        },

        updateBalances() {
            document.getElementById('walletBalance').textContent = TimeLinkSystem.wallet.tl.toLocaleString();
            document.getElementById('dashWallet').textContent = TimeLinkSystem.wallet.tl.toLocaleString();
            document.getElementById('tlcBalance').textContent = TimeLinkSystem.wallet.tlc.toFixed(2);
            document.getElementById('dashTLC').textContent = TimeLinkSystem.wallet.tlc.toFixed(2);
            document.getElementById('dashTL3').textContent = TimeLinkSystem.files.filter(f => f.type === 'TL3').length;
            document.getElementById('dashTL4').textContent = TimeLinkSystem.files.filter(f => f.type === 'TL4').length;
        },

        updateLibrary() {
            const container = document.getElementById('fileList');
            if (!container) return;
            if (TimeLinkSystem.files.length === 0) {
                container.innerHTML = '<div style="text-align:center; padding:60px;">📁 파일이 없습니다</div>';
                return;
            }
            container.innerHTML = TimeLinkSystem.files.map(file => {
                const hasTL = file.token.balance > 0;
                return `
                <div class="file-card">
                    <div class="file-thumbnail ${file.fileType}">
                        ${file.type === 'TL4' ? '🎬' : '🎵'}
                        <span class="badge badge-type">${file.type}</span>
                        ${!hasTL ? '<span class="badge badge-zero">⚠️ TL 0</span>' : ''}
                    </div>
                    <div class="file-info">
                        <div class="file-name">${file.metadata.title}</div>
                        <div class="file-artist">${file.metadata.artist}</div>
                        <div class="info-panel ${!hasTL ? 'zero-panel' : 'tl-panel'}">
                            <strong>⏳ TL 잔액</strong><br>
                            <span style="font-size:1.4rem;">${file.token.balance.toLocaleString()}</span> TL
                        </div>
                        <div class="file-actions">
                            ${hasTL ? 
                                `<button class="btn-play" onclick="TimeLinkSystem.player.play('${file.id}')">▶️ 재생</button>` : 
                                `<button class="btn-play-disabled" disabled>⛔ TL 없음</button>`
                            }
                            <button class="btn-charge" onclick="TimeLinkSystem.player.openChargeModal('${file.id}')">💰 충전</button>
                        </div>
                    </div>
                </div>
            `}).join('');
        },

        updateSharePlace() {
            // 공유된 곡 (여기서는 모든 파일을 공유로 가정)
            const shared = TimeLinkSystem.files;
            document.getElementById('sharedCount2').textContent = shared.length;
            document.getElementById('totalSharedCount').textContent = shared.length;
            document.getElementById('shared55Count').textContent = shared.filter(f => f.metadata.contract.type === '55').length;
            document.getElementById('shared73Count').textContent = shared.filter(f => f.metadata.contract.type === '73').length;

            const container = document.getElementById('sharedMusicList');
            container.innerHTML = shared.map(file => `
                <div class="file-card">
                    <div class="file-info">
                        <div class="file-name">${file.metadata.title}</div>
                        <div class="file-artist">${file.metadata.artist} · ${GENRE_EMOJI[file.metadata.genre]} ${GENRE_NAMES[file.metadata.genre]}</div>
                        <div class="info-panel">
                            계약: ${file.metadata.contract.type === '55' ? '5:5' : '7:3'} · 채굴 ${file.metadata.contract.mining_allowed ? '가능' : '불가'}
                        </div>
                        <button class="btn-download" onclick="alert('다운로드는 데모입니다.')">📥 다운로드</button>
                    </div>
                </div>
            `).join('');
        },

        updateRadioChannels() {
            const container = document.getElementById('radioChannels');
            container.innerHTML = `
                <div class="radio-channel-card">
                    <div class="channel-header radio">🎵 POP 24/7</div>
                    <div class="channel-playlist">
                        <button class="btn-radio" onclick="TimeLinkSystem.radio.play('pop')">🎤 Pop 스트리밍 시작</button>
                    </div>
                </div>
                <div class="radio-channel-card">
                    <div class="channel-header radio">🎸 Rock Classics</div>
                    <div class="channel-playlist">
                        <button class="btn-radio" onclick="TimeLinkSystem.radio.play('rock')">🎸 Rock 스트리밍 시작</button>
                    </div>
                </div>
            `;
        },

        updateCommercialChannels() {
            document.getElementById('commercialChannels').innerHTML = `
                <div class="commercial-channel-card">
                    <div class="channel-header commercial">☕ 카페 음악</div>
                    <div class="channel-playlist">
                        <button class="btn-cafe" onclick="TimeLinkSystem.commercial.play()">🎵 카페 모드 시작</button>
                    </div>
                </div>
            `;
        },

        updateCarChannels() {
            document.getElementById('carChannels').innerHTML = `
                <div class="radio-channel-card">
                    <div class="channel-header car">🚗 운전 중 2배 보상</div>
                    <div class="channel-playlist">
                        <button class="btn-car" onclick="TimeLinkSystem.car.startDriving()">🚗 운전 시작 (2x 보상)</button>
                    </div>
                </div>
            `;
        },

        openPurchaseModal() { document.getElementById('purchaseModal').style.display = 'flex'; },
        closePurchaseModal() { document.getElementById('purchaseModal').style.display = 'none'; },
        openAdModal() { document.getElementById('adWatchModal').style.display = 'flex'; },
        closeAdModal() { document.getElementById('adWatchModal').style.display = 'none'; },
        openCarRegisterModal() { document.getElementById('carRegisterModal').style.display = 'flex'; },
        closeCarRegisterModal() { document.getElementById('carRegisterModal').style.display = 'none'; },
        closeChargeModal() { document.getElementById('chargeModal').style.display = 'none'; },
        closeLecturePurchaseModal() { document.getElementById('lecturePurchaseModal').style.display = 'none'; },
        closePermissionModal() { document.getElementById('permissionModal').style.display = 'none'; }
    },

    demo: {
        login() {
            document.getElementById('authContainer').style.display = 'none';
            document.getElementById('appContainer').style.display = 'block';
            TimeLinkSystem.initSampleFiles();
            TimeLinkSystem.onboarding.checkFirstTime();
            TimeLinkSystem.ui.updateBalances();
            TimeLinkSystem.ui.updateLibrary();
            TimeLinkSystem.ui.showToast('✅ TimeLink에 오신 것을 환영합니다!', 'success');
        },
        logout() {
            document.getElementById('authContainer').style.display = 'flex';
            document.getElementById('appContainer').style.display = 'none';
            if (TimeLinkSystem.playInterval) clearInterval(TimeLinkSystem.playInterval);
            if (TimeLinkSystem.currentPlayer) {
                TimeLinkSystem.currentPlayer.pause();
                TimeLinkSystem.currentPlayer = null;
            }
        }
    },

    file: {
        selectedFile: null,
        selectedFileData: null,
        currentType: 'audio',

        selectType(type) {
            this.currentType = type;
            document.getElementById('audioTypeCard').classList.toggle('selected', type === 'audio');
            document.getElementById('videoTypeCard').classList.toggle('selected', type === 'video');
            document.getElementById('uploadIcon').innerHTML = type === 'audio' ? '🎵' : '🎬';
            document.getElementById('uploadText').innerHTML = type === 'audio' ? 'Select audio file' : 'Select video file';
            document.getElementById('uploadDesc').innerHTML = type === 'audio' ? 'MP3, WAV, FLAC (max 100MB)' : 'MP4, MOV, AVI (max 500MB)';
            document.getElementById('fileInput').accept = type === 'audio' ? 'audio/*' : 'video/*';
        },

        handleSelect(event) {
            const file = event.target.files[0];
            if (!file) return;
            this.selectedFile = file;
            const reader = new FileReader();
            reader.onload = (e) => {
                this.selectedFileData = e.target.result;
                document.getElementById('uploadForm').style.display = 'block';
                document.getElementById('songTitle').value = file.name.replace(/\.[^/.]+$/, "");
                document.getElementById('songArtist').value = 'Global Investor';
                document.getElementById('copyrightOwner').value = 'Global Investor';
                document.getElementById('copyrightNumber').value = (this.currentType === 'audio' ? 'TL3-' : 'TL4-') + Date.now();
                TimeLinkSystem.ui.showToast(`✅ 파일 선택됨: ${file.name}`, 'success');
            };
            reader.readAsDataURL(file);
        },

        create() {
            if (!this.selectedFile) {
                TimeLinkSystem.ui.showToast('먼저 파일을 선택하세요', 'error');
                return;
            }
            const title = document.getElementById('songTitle').value;
            if (!title) { TimeLinkSystem.ui.showToast('제목을 입력하세요', 'error'); return; }
            const genre = document.getElementById('songGenre').value;
            const revenueShare = document.getElementById('revenueShare').value;

            const fileData = {
                title,
                artist: document.getElementById('songArtist').value,
                genre,
                audioUrl: this.selectedFileData,
                creatorId: 'user_1',
                creatorName: 'Global Investor',
                copyright: { 
                    owner_name: document.getElementById('copyrightOwner').value,
                    registration_number: document.getElementById('copyrightNumber').value
                },
                contract: { 
                    type: revenueShare,
                    mining_allowed: revenueShare === '55'
                },
                initialBalance: 0
            };
            const file = this.currentType === 'audio' ? new TL3File(fileData) : new TL4File(fileData);
            TimeLinkSystem.files.push(file);
            TimeLinkSystem.ui.updateBalances();
            TimeLinkSystem.ui.updateLibrary();
            TimeLinkSystem.ui.showToast(`✅ ${title} 파일이 생성되었습니다 (초기 TL: 0)`, 'success');
            document.getElementById('uploadForm').style.display = 'none';
            document.getElementById('fileInput').value = '';
            this.selectedFile = null;
            TimeLinkSystem.ui.switchTab('library');
        }
    },

    player: {
        play(fileId) {
            const file = TimeLinkSystem.files.find(f => f.id === fileId);
            if (!file || file.token.balance <= 0) {
                TimeLinkSystem.ui.showToast('TL 잔액이 부족합니다', 'error');
                return;
            }
            if (TimeLinkSystem.playingFile) TimeLinkSystem.player.stop();

            TimeLinkSystem.playingFile = file;
            const rate = file.tlPerSecond * (TimeLinkSystem.carMode ? 2 : 1);
            const player = file.type === 'TL4' ? document.getElementById('videoPlayer') : document.getElementById('audioPlayer');
            player.src = file.audio.url;
            if (file.type === 'TL4') {
                document.getElementById('videoPlayerContainer').style.display = 'block';
                document.getElementById('videoTitle').textContent = `${file.metadata.title} - ${file.metadata.artist}`;
                document.getElementById('videoTimeRemaining').textContent = `TL: ${file.token.balance}`;
                TimeLinkSystem.currentPlayer = player;
                player.play().catch(e => TimeLinkSystem.ui.showToast('재생 오류: ' + e.message, 'error'));
            } else {
                TimeLinkSystem.currentPlayer = player;
                player.play().catch(e => TimeLinkSystem.ui.showToast('재생 오류: ' + e.message, 'error'));
            }

            player.onended = () => TimeLinkSystem.player.stop();

            // TL 차감 인터벌 (일시정지 시 멈춤)
            if (TimeLinkSystem.playInterval) clearInterval(TimeLinkSystem.playInterval);
            TimeLinkSystem.playInterval = setInterval(() => {
                if (!TimeLinkSystem.playingFile || !TimeLinkSystem.currentPlayer) return;
                // 플레이어가 일시정지 상태면 차감하지 않음
                if (TimeLinkSystem.currentPlayer.paused) return;
                
                const nowFile = TimeLinkSystem.playingFile;
                nowFile.token.balance -= rate;
                nowFile.token.total_consumed += rate;
                TimeLinkSystem.ui.updateLibrary();
                if (nowFile.type === 'TL4') {
                    document.getElementById('videoTimeRemaining').textContent = `TL: ${Math.floor(nowFile.token.balance)}`;
                }
                if (nowFile.token.balance <= 0) {
                    TimeLinkSystem.player.stop();
                    TimeLinkSystem.ui.showToast(`${nowFile.metadata.title} TL 소진`, 'warning');
                }
                // 자동 충전 체크
                TimeLinkSystem.autoRecharge.check();
            }, 1000);

            TimeLinkSystem.ui.showToast(`▶️ ${file.metadata.title} 재생 중... (${rate}TL/초)`, 'success');
        },

        stop() {
            if (TimeLinkSystem.currentPlayer) {
                TimeLinkSystem.currentPlayer.pause();
                TimeLinkSystem.currentPlayer.currentTime = 0;
                TimeLinkSystem.currentPlayer = null;
            }
            document.getElementById('videoPlayerContainer').style.display = 'none';
            clearInterval(TimeLinkSystem.playInterval);
            TimeLinkSystem.playingFile = null;
        },

        togglePlayPause() {
            if (!TimeLinkSystem.currentPlayer) return;
            if (TimeLinkSystem.currentPlayer.paused) {
                TimeLinkSystem.currentPlayer.play().catch(e => TimeLinkSystem.ui.showToast('재생 오류', 'error'));
            } else {
                TimeLinkSystem.currentPlayer.pause();
            }
        },

        openChargeModal(fileId) {
            document.getElementById('chargeModal').style.display = 'flex';
            document.getElementById('chargeModal').dataset.targetFile = fileId || '';
            document.getElementById('currentTLBalance').textContent = TimeLinkSystem.wallet.tl.toLocaleString();
        }
    },

    autoRecharge: {
        check() {
            if (!TimeLinkSystem.autoRecharge.enabled) return;
            if (TimeLinkSystem.playingFile && TimeLinkSystem.playingFile.token.balance < TimeLinkSystem.autoRecharge.threshold) {
                // 파일에 TL 충전 (지갑에서 차감)
                const needed = TimeLinkSystem.autoRecharge.amount;
                if (TimeLinkSystem.wallet.tl >= needed) {
                    TimeLinkSystem.wallet.tl -= needed;
                    TimeLinkSystem.playingFile.token.balance += needed;
                    TimeLinkSystem.ui.updateBalances();
                    TimeLinkSystem.ui.updateLibrary();
                    TimeLinkSystem.ui.showToast(`⚡ 자동 충전: +${needed} TL`, 'success');
                } else {
                    TimeLinkSystem.ui.showToast('지갑 잔액 부족으로 자동 충전 실패', 'error');
                }
            }
        },
        toggle() {
            const toggle = document.getElementById('autoRechargeToggle');
            TimeLinkSystem.autoRecharge.enabled = toggle.checked;
            document.getElementById('autoRechargeSettings').style.opacity = toggle.checked ? '1' : '0.5';
        },
        updateSettings() {
            TimeLinkSystem.autoRecharge.threshold = parseInt(document.getElementById('autoRechargeThreshold').value);
            TimeLinkSystem.autoRecharge.amount = parseInt(document.getElementById('autoRechargeAmount').value);
        }
    },

    ad: {
        selectedType: 'video',
        timer: null,
        selectType(type) {
            this.selectedType = type;
            document.getElementById('adRewardAmount').textContent = type === 'video' ? '60 TL' : '30 TL';
        },
        showSelector() {
            document.getElementById('adInitialSection').style.display = 'none';
            document.getElementById('adTypeSelector').style.display = 'flex';
            document.getElementById('adPlayerSection').style.display = 'block';
        },
        startWatching() {
            if (TimeLinkSystem.adDailyRemaining <= 0) {
                TimeLinkSystem.ui.showToast('오늘의 광고 한도를 모두 사용했습니다', 'error');
                return;
            }
            const duration = 30;
            let remaining = duration;
            const reward = this.selectedType === 'video' ? 60 : 30;
            document.getElementById('adTimer').textContent = remaining;
            document.getElementById('adProgress').style.width = '0%';

            this.timer = setInterval(() => {
                remaining--;
                document.getElementById('adTimer').textContent = remaining;
                document.getElementById('adProgress').style.width = `${(duration - remaining) / duration * 100}%`;
                if (remaining <= 0) {
                    clearInterval(this.timer);
                    TimeLinkSystem.wallet.tl += reward;
                    TimeLinkSystem.adDailyRemaining -= reward;
                    TimeLinkSystem.ui.updateBalances();
                    TimeLinkSystem.ui.showToast(`📺 광고 완료! +${reward} TL`, 'success');
                    TimeLinkSystem.ui.closeAdModal();
                }
            }, 1000);
        }
    },

    radio: {
        selectGenre(genre, event) {
            document.querySelectorAll('#tabRadio .genre-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
        },
        play(genre) {
            const songs = MUSIC_DB.filter(s => s.genre === genre);
            if (songs.length === 0) return;
            const randomSong = songs[Math.floor(Math.random() * songs.length)];
            const radioPlayer = document.getElementById('radioPlayer');
            radioPlayer.src = randomSong.url;
            radioPlayer.play().catch(e => TimeLinkSystem.ui.showToast('라디오 재생 오류', 'error'));
            TimeLinkSystem.ui.showToast(`📻 ${GENRE_NAMES[genre]} 라디오 시작`, 'success');
        }
    },

    commercial: {
        selectGenre(genre, event) {
            document.querySelectorAll('#tabCommercial .genre-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
        },
        play() {
            const player = document.getElementById('audioPlayer');
            player.src = MUSIC_DB[0].url;
            player.play().catch(e => TimeLinkSystem.ui.showToast('재생 오류', 'error'));
            TimeLinkSystem.ui.showToast('☕ 커머셜 음악 시작 (TL 차감 없음)', 'success');
        }
    },

    car: {
        selectGenre(genre, event) {
            document.querySelectorAll('#tabCar .genre-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
        },
        startDriving() {
            TimeLinkSystem.carMode = true;
            document.getElementById('carModeBadge').style.display = 'flex';
            document.getElementById('carModeBadgeHeader').textContent = '🚗 CAR MODE (2x)';
            document.getElementById('carDetectionStatus').textContent = '운전 중 감지됨 · 2배 보상';
            TimeLinkSystem.ui.showToast('🚗 차량 모드 활성화! 모든 재생 2배 보상', 'success');
        },
        register() {
            if (TimeLinkSystem.wallet.tl >= 10000) {
                TimeLinkSystem.wallet.tl -= 10000;
                TimeLinkSystem.ui.updateBalances();
                TimeLinkSystem.ui.showToast('🚗 차량 등록 완료!', 'success');
                TimeLinkSystem.ui.closeCarRegisterModal();
            } else {
                TimeLinkSystem.ui.showToast('TL이 부족합니다 (10,000 TL 필요)', 'error');
            }
        }
    },

    mining: {
        execute() {
            const index = Math.random() * 5; // 0~5배
            const reward = index * 10;
            TimeLinkSystem.wallet.tlc += reward;
            TimeLinkSystem.ui.updateBalances();
            TimeLinkSystem.ui.showToast(`⛏️ 채굴 완료! +${reward.toFixed(2)} TLC (지수 ${index.toFixed(1)}x)`, 'success');
        }
    },

    lecture: {
        openCreateModal() { document.getElementById('lectureCreateModal').style.display = 'flex'; },
        handleFileSelect(e) {
            const file = e.target.files[0];
            if (file) TimeLinkSystem.ui.showToast(`📚 ${file.name} 선택됨`, 'success');
        },
        create() {
            TimeLinkSystem.ui.showToast('강의가 생성되었습니다', 'success');
            document.getElementById('lectureCreateModal').style.display = 'none';
        },
        openPurchaseModal() { document.getElementById('lecturePurchaseModal').style.display = 'flex'; },
        confirmPurchase() {
            if (TimeLinkSystem.wallet.tl >= 5000) {
                TimeLinkSystem.wallet.tl -= 5000;
                TimeLinkSystem.ui.updateBalances();
                TimeLinkSystem.ui.showToast('📚 강의를 구매했습니다', 'success');
                TimeLinkSystem.ui.closeLecturePurchaseModal();
            } else {
                TimeLinkSystem.ui.showToast('TL이 부족합니다', 'error');
            }
        },
        updatePriceKRW() {
            const price = document.getElementById('lecturePrice').value;
            document.getElementById('lecturePriceKRW').textContent = Math.floor(price * 0.1);
        }
    },

    carDetection: {
        requestAllPermissions() {
            TimeLinkSystem.ui.showToast('✅ 권한이 설정되었습니다 (시뮬레이션)', 'success');
            TimeLinkSystem.ui.closePermissionModal();
        }
    },

    share: {
        filter(type, event) {
            document.querySelectorAll('#tabShareplace .filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            // 실제 필터링은 생략 (데모)
        },
        filterGenre(genre, event) {
            document.querySelectorAll('#tabShareplace .genre-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
        }
    }
};

// 이벤트 연결
document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('fileInput').addEventListener('change', e => TimeLinkSystem.file.handleSelect(e));
    document.getElementById('lectureFileInput').addEventListener('change', e => TimeLinkSystem.lecture.handleFileSelect(e));
    document.getElementById('lecturePrice').addEventListener('input', () => TimeLinkSystem.lecture.updatePriceKRW());

    // 충전 모달 확인 버튼
    document.getElementById('btnChargeConfirm').addEventListener('click', function() {
        const amount = parseInt(document.getElementById('chargeAmount').value) || 1000;
        const targetFileId = document.getElementById('chargeModal').dataset.targetFile;
        if (targetFileId) {
            const file = TimeLinkSystem.files.find(f => f.id === targetFileId);
            if (file && TimeLinkSystem.wallet.tl >= amount) {
                TimeLinkSystem.wallet.tl -= amount;
                file.token.balance += amount;
                file.token.total_charged += amount;
                TimeLinkSystem.ui.updateBalances();
                TimeLinkSystem.ui.updateLibrary();
                TimeLinkSystem.ui.showToast(`💰 파일에 ${amount} TL 충전됨`, 'success');
            } else {
                TimeLinkSystem.ui.showToast('잔액 부족 또는 파일 없음', 'error');
            }
        } else {
            // 일반 지갑 충전
            TimeLinkSystem.wallet.tl += amount;
            TimeLinkSystem.ui.updateBalances();
            TimeLinkSystem.ui.showToast(`💰 지갑에 ${amount} TL 충전됨`, 'success');
        }
        TimeLinkSystem.ui.closeChargeModal();
    });

    // 자동충전 토글
    document.getElementById('autoRechargeToggle').addEventListener('change', () => TimeLinkSystem.autoRecharge.toggle());
    document.getElementById('autoRechargeThreshold').addEventListener('change', () => TimeLinkSystem.autoRecharge.updateSettings());
    document.getElementById('autoRechargeAmount').addEventListener('change', () => TimeLinkSystem.autoRecharge.updateSettings());

    // 모달 외부 클릭 닫기
    window.addEventListener('click', e => {
        if (e.target.classList.contains('modal')) e.target.style.display = 'none';
    });

    // 온보딩 키보드 네비게이션
    document.addEventListener('keydown', function(e) {
        const overlay = document.getElementById('onboardingOverlay');
        if (overlay && overlay.style.display === 'flex') {
            if (e.key === 'ArrowRight') TimeLinkSystem.onboarding.next();
            else if (e.key === 'ArrowLeft') TimeLinkSystem.onboarding.prev();
            else if (e.key === 'Escape') TimeLinkSystem.onboarding.skip();
        }
    });
});
</script>

</body>
</html>
