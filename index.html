<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TimeLink â€” Time-Based Media Economy</title>
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='75' font-size='75'>ğŸµ</text></svg>" type="image/svg+xml">
    
    <!-- TL3 Core Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/crypto-js@4.1.1/crypto-js.js"></script>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #0a0a0a; 
            color: #fff; 
            line-height: 1.6;
        }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        
        .header {
            background: linear-gradient(145deg, #1a0b2e, #1a1a1a);
            padding: 24px 32px;
            border-radius: 20px;
            margin-bottom: 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid rgba(138,43,226,0.3);
        }
        .header h1 {
            font-size: 2rem;
            background: linear-gradient(135deg, #b983ff, #8a2be2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .balances { display: flex; gap: 16px; }
        .balance {
            background: rgba(255,255,255,0.05);
            padding: 12px 20px;
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.1);
            cursor: pointer;
            transition: all 0.2s;
        }
        .balance:hover { border-color: #f59e0b; background: rgba(245,158,11,0.1); }
        .balance .lbl { font-size: 10px; color: #999; text-transform: uppercase; }
        .balance .amt { font-size: 22px; font-weight: 800; }
        .balance.low .amt { color: #ef4444; animation: pulse 1s infinite; }
        @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.5} }
        
        /* ì¶©ì „ ë²„íŠ¼ */
        .recharge-btn {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: black;
            border: none;
            padding: 12px 20px;
            border-radius: 12px;
            font-weight: 800;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .recharge-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(245,158,11,0.4); }
        
        .tabs {
            background: rgba(17,17,17,0.8);
            border-radius: 999px;
            padding: 8px;
            display: flex;
            gap: 6px;
            margin-bottom: 28px;
            overflow-x: auto;
        }
        .tab {
            padding: 12px 24px;
            border-radius: 999px;
            border: none;
            background: transparent;
            color: #999;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.2s;
        }
        .tab:hover { background: rgba(255,255,255,0.05); color: white; }
        .tab.active { background: #8a2be2; color: white; }
        
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        
        .card {
            background: linear-gradient(145deg, #1a1a1a, #151515);
            border-radius: 20px;
            padding: 32px;
            margin-bottom: 28px;
            border: 1px solid rgba(255,255,255,0.08);
        }
        .card h2 { 
            font-size: 1.8rem; 
            margin-bottom: 24px;
            background: linear-gradient(135deg, #fff, #e0e0e0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(360px, 1fr)); gap: 24px; }
        
        .file-card {
            background: #1e1e1e;
            border-radius: 16px;
            overflow: hidden;
            border: 1px solid rgba(255,255,255,0.08);
            transition: all 0.3s;
        }
        .file-card:hover { transform: translateY(-6px); border-color: #8a2be2; }
        
        .thumb {
            height: 160px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3.5rem;
            background: linear-gradient(145deg, #2a1a3a, #1e1e1e);
            position: relative;
        }
        .thumb.video { background: linear-gradient(145deg, #ff7b00, #ff5500); }
        .thumb-media {
            background-size: cover;
            background-position: center;
            isolation: isolate;
        }
        .thumb-media::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(180deg, rgba(0,0,0,0.1), rgba(0,0,0,0.7));
            z-index: -1;
        }
        .thumb-icon {
            width: 66px;
            height: 66px;
            border-radius: 50%;
            background: rgba(0,0,0,0.55);
            backdrop-filter: blur(6px);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .badge {
            position: absolute;
            padding: 6px 14px;
            border-radius: 999px;
            font-size: 11px;
            font-weight: 700;
            color: white;
        }
        .badge-type { left: 12px; top: 12px; background: rgba(0,0,0,0.7); }
        .badge-cert { right: 12px; top: 12px; background: rgba(255,215,0,0.9); color: black; }
        .badge-genre { left: 12px; bottom: 12px; }
        
        .info { padding: 20px; }
        .name { font-size: 1.2rem; font-weight: 700; margin-bottom: 6px; }
        .creator { color: #999; font-size: 0.9rem; margin-bottom: 16px; }
        
        .panel {
            background: rgba(255,255,255,0.03);
            padding: 14px;
            border-radius: 12px;
            margin-bottom: 16px;
            font-size: 13px;
            border-left: 4px solid #8a2be2;
        }
        
        .actions { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .btn {
            padding: 12px;
            border: none;
            border-radius: 12px;
            font-weight: 700;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .btn:hover { transform: translateY(-2px); }
        .btn-play { background: #1db954; color: white; }
        .btn-charge { background: #f59e0b; color: black; }
        .btn-share { background: #8a2be2; color: white; grid-column: span 2; }
        .btn-disabled { background: #333; color: #666; cursor: not-allowed; }
        
        .form-group { margin-bottom: 20px; }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #999;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 14px 16px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            color: white;
            font-size: 14px;
            font-family: inherit;
        }
        
        .type-selector { display: flex; gap: 20px; margin-bottom: 28px; }
        .type-card {
            flex: 1;
            background: rgba(255,255,255,0.05);
            padding: 28px;
            border-radius: 20px;
            text-align: center;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s;
        }
        .type-card:hover { transform: translateY(-4px); }
        .type-card.selected { border-color: #1db954; background: rgba(29,185,84,0.1); }
        .type-card.video.selected { border-color: #ff5500; background: rgba(255,85,0,0.1); }
        
        .upload {
            border: 2px dashed #8a2be2;
            background: rgba(138,43,226,0.05);
            border-radius: 20px;
            padding: 50px;
            text-align: center;
            cursor: pointer;
            margin-bottom: 28px;
            transition: all 0.2s;
        }
        .upload:hover { background: rgba(138,43,226,0.1); transform: scale(1.01); }
        
        .modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.92);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        .modal-content {
            background: #1e1e1e;
            border-radius: 20px;
            padding: 36px;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .toast {
            position: fixed;
            top: 28px;
            right: 28px;
            background: #1e1e1e;
            padding: 16px 24px;
            border-radius: 999px;
            display: none;
            z-index: 3000;
            min-width: 320px;
            border-left: 6px solid #1db954;
            box-shadow: 0 4px 20px rgba(0,0,0,0.4);
        }
        
        .hero {
            background: linear-gradient(145deg, #2a1a3a, #1a1a1a);
            padding: 48px;
            border-radius: 24px;
            text-align: center;
            margin-bottom: 32px;
            border: 1px solid rgba(138,43,226,0.3);
        }
        .hero h1 {
            font-size: 3rem;
            margin-bottom: 16px;
            background: linear-gradient(135deg, #b983ff, #8a2be2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .media-showcase {
            display: grid;
            grid-template-columns: 1.2fr 1fr;
            gap: 18px;
            margin-top: 22px;
        }
        .featured-banner {
            min-height: 220px;
            border-radius: 18px;
            padding: 24px;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            background:
                linear-gradient(130deg, rgba(0,0,0,0.15), rgba(0,0,0,0.7)),
                url('https://images.unsplash.com/photo-1493225457124-a3eb161ffa5f?auto=format&fit=crop&w=1400&q=80') center/cover;
            border: 1px solid rgba(255,255,255,0.12);
        }
        .featured-banner .tag {
            display: inline-block;
            padding: 6px 12px;
            background: rgba(138,43,226,0.85);
            border-radius: 999px;
            font-size: 11px;
            font-weight: 700;
            margin-bottom: 10px;
            width: fit-content;
        }
        .playlist-stack { display: grid; gap: 12px; }
        .playlist-item {
            min-height: 67px;
            border-radius: 14px;
            padding: 14px;
            border: 1px solid rgba(255,255,255,0.12);
            background-size: cover;
            background-position: center;
            display: flex;
            align-items: end;
            font-weight: 700;
        }

        @media (max-width: 900px) {
            .media-showcase { grid-template-columns: 1fr; }
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
            margin-top: 32px;
        }
        .feature-card {
            background: rgba(255,255,255,0.03);
            padding: 24px;
            border-radius: 16px;
            border: 1px solid rgba(255,255,255,0.08);
        }
        .feature-card h3 { margin: 12px 0; font-size: 1.2rem; }
        .feature-card p { color: #999; font-size: 0.9rem; line-height: 1.6; }

        .mvp-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 14px;
            margin-top: 18px;
        }
        .mvp-kpi {
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.08);
            border-radius: 14px;
            padding: 14px;
        }
        .mvp-kpi .label { color: #999; font-size: 12px; margin-bottom: 8px; }
        .mvp-kpi .value { font-size: 1.5rem; font-weight: 800; }
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 12px;
            margin-top: 16px;
        }
        
        .search-box {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 999px;
            padding: 14px 24px;
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 24px;
        }
        .search-box input {
            flex: 1;
            background: transparent;
            border: none;
            color: white;
            font-size: 15px;
            outline: none;
        }
        
        .genre-filter {
            display: flex;
            gap: 10px;
            margin-bottom: 24px;
            flex-wrap: wrap;
        }
        .genre-btn {
            padding: 8px 18px;
            border-radius: 999px;
            border: 1px solid rgba(255,255,255,0.1);
            background: transparent;
            color: #999;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        .genre-btn:hover { border-color: #8a2be2; }
        .genre-btn.active { background: #8a2be2; color: white; border-color: #8a2be2; }
        
        /* ===== TL ì¶©ì „ ëª¨ë‹¬ ìŠ¤íƒ€ì¼ ===== */
        #tlRechargeModal .modal-content {
            max-width: 560px;
            border: 1px solid rgba(245,158,11,0.4);
        }
        .recharge-header {
            text-align: center;
            margin-bottom: 28px;
        }
        .recharge-header .icon { font-size: 3rem; margin-bottom: 12px; }
        .recharge-header h2 {
            font-size: 1.8rem;
            background: linear-gradient(135deg, #f59e0b, #fbbf24);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .recharge-header p { color: #999; font-size: 14px; margin-top: 8px; }

        /* ê´‘ê³  ì„¹ì…˜ */
        .ad-section {
            background: linear-gradient(135deg, rgba(59,130,246,0.15), rgba(37,99,235,0.08));
            border: 1px solid rgba(59,130,246,0.4);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 20px;
        }
        .ad-section h3 { font-size: 1.1rem; margin-bottom: 8px; color: #60a5fa; }
        .ad-section p { color: #999; font-size: 13px; margin-bottom: 16px; }
        .ad-rewards { display: flex; gap: 12px; margin-bottom: 16px; flex-wrap: wrap; }
        .ad-reward-item {
            flex: 1;
            min-width: 120px;
            background: rgba(0,0,0,0.3);
            border-radius: 12px;
            padding: 12px;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.08);
        }
        .ad-reward-item .reward-tl { font-size: 1.4rem; font-weight: 800; color: #f59e0b; }
        .ad-reward-item .reward-label { font-size: 11px; color: #999; margin-top: 4px; }
        .ad-reward-item .reward-time { font-size: 10px; color: #60a5fa; margin-top: 2px; }

        /* ê´‘ê³  ì‹œì²­ ì§„í–‰ë°” */
        .ad-progress-container { display: none; margin-bottom: 16px; }
        .ad-progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 13px;
            color: #999;
        }
        .ad-progress-bar {
            height: 8px;
            background: rgba(255,255,255,0.1);
            border-radius: 999px;
            overflow: hidden;
        }
        .ad-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3b82f6, #60a5fa);
            border-radius: 999px;
            width: 0%;
            transition: width 0.5s linear;
        }
        .ad-visual {
            height: 120px;
            border-radius: 12px;
            background: linear-gradient(135deg, #1e3a5f, #0f2847);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 12px;
            border: 1px solid rgba(59,130,246,0.3);
            position: relative;
            overflow: hidden;
        }
        .ad-visual::before {
            content: '';
            position: absolute;
            inset: 0;
            background: repeating-linear-gradient(
                45deg,
                transparent,
                transparent 10px,
                rgba(59,130,246,0.03) 10px,
                rgba(59,130,246,0.03) 20px
            );
        }
        .ad-visual-content { text-align: center; z-index: 1; }
        .ad-visual-content .ad-brand { font-size: 1.4rem; font-weight: 800; color: #60a5fa; }
        .ad-visual-content .ad-tagline { font-size: 12px; color: #999; margin-top: 4px; }
        .ad-skip-notice {
            font-size: 11px;
            color: #666;
            text-align: center;
            margin-top: 8px;
        }

        /* êµ¬ë§¤ íŒ¨í‚¤ì§€ */
        .purchase-section {
            background: linear-gradient(135deg, rgba(245,158,11,0.1), rgba(217,119,6,0.05));
            border: 1px solid rgba(245,158,11,0.3);
            border-radius: 16px;
            padding: 24px;
        }
        .purchase-section h3 { font-size: 1.1rem; margin-bottom: 16px; color: #f59e0b; }
        .packages-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }
        .package-card {
            background: rgba(0,0,0,0.4);
            border: 2px solid rgba(245,158,11,0.2);
            border-radius: 14px;
            padding: 16px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
            position: relative;
        }
        .package-card:hover { border-color: #f59e0b; background: rgba(245,158,11,0.1); transform: translateY(-2px); }
        .package-card.popular {
            border-color: #f59e0b;
            background: linear-gradient(135deg, rgba(245,158,11,0.15), rgba(0,0,0,0.4));
        }
        .package-card .popular-badge {
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            background: #f59e0b;
            color: black;
            font-size: 10px;
            font-weight: 800;
            padding: 3px 10px;
            border-radius: 999px;
        }
        .package-card .pkg-tl { font-size: 1.5rem; font-weight: 800; color: #fbbf24; }
        .package-card .pkg-bonus { font-size: 11px; color: #22c55e; font-weight: 600; margin-top: 2px; }
        .package-card .pkg-price { font-size: 1.1rem; font-weight: 700; margin-top: 8px; color: #fff; }
        .package-card .pkg-per { font-size: 10px; color: #999; margin-top: 2px; }

        .recharge-divider {
            display: flex;
            align-items: center;
            gap: 12px;
            margin: 20px 0;
            color: #555;
            font-size: 13px;
        }
        .recharge-divider::before, .recharge-divider::after {
            content: '';
            flex: 1;
            height: 1px;
            background: rgba(255,255,255,0.08);
        }

        /* Auth Screen */
        #authScreen {
            position: fixed;
            inset: 0;
            background: linear-gradient(145deg, #1a0b2e, #0a0a0a);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }
        .auth-container {
            background: linear-gradient(145deg, #1e1e1e, #151515);
            border-radius: 24px;
            padding: 48px;
            max-width: 480px;
            width: 90%;
            border: 1px solid rgba(138,43,226,0.3);
        }
        .auth-logo { text-align: center; margin-bottom: 40px; }
        .auth-logo h1 {
            font-size: 2.5rem;
            background: linear-gradient(135deg, #b983ff, #8a2be2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 8px;
        }
        .auth-form { margin-top: 32px; }
        .auth-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #8a2be2, #b983ff);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 12px;
        }
        .auth-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 24px rgba(138,43,226,0.4); }
        .auth-switch { text-align: center; margin-top: 24px; color: #999; font-size: 14px; }
        .auth-switch a { color: #8a2be2; text-decoration: none; font-weight: 600; cursor: pointer; }
        .auth-switch a:hover { text-decoration: underline; }
        .auth-message {
            display: none;
            padding: 14px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            font-size: 14px;
            font-weight: 600;
        }

        /* íšŒì›ê°€ì… ë³´ë„ˆìŠ¤ ë°°ë„ˆ */
        .signup-bonus-banner {
            background: linear-gradient(135deg, rgba(245,158,11,0.2), rgba(34,197,94,0.1));
            border: 1px solid rgba(245,158,11,0.4);
            border-radius: 12px;
            padding: 14px 18px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .signup-bonus-banner .bonus-icon { font-size: 1.8rem; }
        .signup-bonus-banner .bonus-text { flex: 1; }
        .signup-bonus-banner .bonus-text strong { display: block; color: #f59e0b; font-size: 1rem; }
        .signup-bonus-banner .bonus-text span { font-size: 12px; color: #999; }

        #mainApp { display: none; }
        .user-info { display: flex; align-items: center; gap: 12px; flex-wrap: wrap; }
        .user-name {
            background: rgba(255,255,255,0.05);
            padding: 10px 18px;
            border-radius: 999px;
            font-weight: 600;
        }
        .logout-btn {
            background: rgba(255,68,68,0.2);
            color: #ff4444;
            border: 1px solid rgba(255,68,68,0.3);
            padding: 10px 20px;
            border-radius: 999px;
            font-weight: 600;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s;
        }
        .logout-btn:hover { background: rgba(255,68,68,0.3); }

        /* ì €TL ê²½ê³  ë°°ë„ˆ */
        #lowTlBanner {
            display: none;
            background: linear-gradient(135deg, rgba(245,158,11,0.2), rgba(239,68,68,0.1));
            border: 1px solid rgba(245,158,11,0.5);
            border-radius: 16px;
            padding: 16px 24px;
            margin-bottom: 20px;
            display: none;
            align-items: center;
            gap: 16px;
        }
        #lowTlBanner .warn-icon { font-size: 1.5rem; }
        #lowTlBanner .warn-text { flex: 1; }
        #lowTlBanner .warn-text strong { display: block; color: #f59e0b; }
        #lowTlBanner .warn-text span { font-size: 13px; color: #999; }
        
        /* TL3 Player Styles */
        #tl3DropZone:hover {
            border-color: #8a2be2;
            background: linear-gradient(135deg, rgba(138,43,226,0.15), rgba(29,185,84,0.08));
            transform: translateY(-2px);
        }
        
        #tl3DropZone.dragging {
            border-color: #1db954;
            background: linear-gradient(135deg, rgba(29,185,84,0.2), rgba(138,43,226,0.1));
            transform: scale(1.02);
        }

        /* Contribution Styles */
        .stat-card {
            background: rgba(255,255,255,0.05);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.1);
            text-align: center;
        }
        
        .stat-label {
            font-size: 0.85rem;
            color: #999;
            margin-bottom: 8px;
        }
        
        .stat-value {
            font-size: 1.8rem;
            font-weight: 800;
            color: #1db954;
        }

        .contribution-item {
            background: rgba(255,255,255,0.03);
            padding: 16px;
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.1);
            display: flex;
            align-items: center;
            gap: 16px;
            transition: all 0.2s;
        }
        
        .contribution-item:hover {
            background: rgba(255,255,255,0.06);
            border-color: rgba(138,43,226,0.4);
        }

        .contribution-icon {
            font-size: 2rem;
            width: 60px;
            text-align: center;
        }

        .contribution-info {
            flex: 1;
        }

        .contribution-title {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .contribution-reward {
            color: #1db954;
            font-size: 0.9rem;
        }

        .btn-simulate {
            background: rgba(138,43,226,0.2);
            color: #b983ff;
            border: 1px solid #8a2be2;
            padding: 8px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }

        .btn-simulate:hover {
            background: rgba(138,43,226,0.4);
            transform: translateY(-2px);
        }

        /* Payment Animation */
        @keyframes paymentFlow {
            0% { transform: translateX(-100%); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: translateX(100%); opacity: 0; }
        }

        .payment-particle {
            position: absolute;
            font-size: 1.5rem;
            animation: paymentFlow 2s ease-in-out;
        }

        /* Hero Section Styles */
        .hero-fullscreen {
            min-height: 100vh;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a0b2e 50%, #0a0a0a 100%);
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 40px 20px;
        }

        .hero-bg {
            position: absolute;
            inset: 0;
            background-image: 
                linear-gradient(135deg, rgba(138,43,226,0.4), rgba(10,10,10,0.8)),
                url('https://images.unsplash.com/photo-1470225620780-dba8ba36b745?auto=format&fit=crop&w=2000&q=80');
            background-size: cover;
            background-position: center;
            opacity: 0.3;
            animation: kenburns 30s ease-in-out infinite alternate;
        }

        @keyframes kenburns {
            0% { transform: scale(1) translateY(0); }
            100% { transform: scale(1.1) translateY(-20px); }
        }

        .hero-content {
            position: relative;
            z-index: 10;
            text-align: center;
            max-width: 900px;
        }

        .hero-badge {
            display: inline-block;
            background: rgba(138,43,226,0.2);
            border: 1px solid rgba(138,43,226,0.5);
            color: #b983ff;
            padding: 8px 20px;
            border-radius: 50px;
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 24px;
            animation: fadeInDown 0.8s ease-out;
        }

        .hero-title {
            font-size: 4.5rem;
            font-weight: 900;
            background: linear-gradient(135deg, #fff, #b983ff, #1db954);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 24px;
            line-height: 1.1;
            animation: fadeInUp 1s ease-out;
        }

        .hero-subtitle {
            font-size: 1.5rem;
            color: #d0d0d0;
            margin-bottom: 40px;
            font-weight: 300;
            animation: fadeInUp 1.2s ease-out;
        }

        .hero-cta {
            display: flex;
            gap: 16px;
            justify-content: center;
            flex-wrap: wrap;
            animation: fadeInUp 1.4s ease-out;
        }

        .hero-btn {
            padding: 18px 40px;
            font-size: 1.1rem;
            font-weight: 700;
            border-radius: 12px;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-block;
        }

        .hero-btn-primary {
            background: linear-gradient(135deg, #8a2be2, #b983ff);
            color: white;
            box-shadow: 0 8px 32px rgba(138,43,226,0.4);
        }

        .hero-btn-primary:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 48px rgba(138,43,226,0.6);
        }

        .hero-btn-secondary {
            background: rgba(255,255,255,0.1);
            color: white;
            border: 2px solid rgba(255,255,255,0.2);
            backdrop-filter: blur(10px);
        }

        .hero-btn-secondary:hover {
            background: rgba(255,255,255,0.2);
            border-color: rgba(255,255,255,0.4);
            transform: translateY(-4px);
        }

        .hero-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 32px;
            margin-top: 80px;
            animation: fadeInUp 1.6s ease-out;
        }

        .hero-stat {
            text-align: center;
        }

        .hero-stat-value {
            font-size: 3rem;
            font-weight: 900;
            background: linear-gradient(135deg, #1db954, #8a2be2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 8px;
        }

        .hero-stat-label {
            color: #999;
            font-size: 0.95rem;
        }

        .scroll-indicator {
            position: absolute;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateX(-50%) translateY(0); }
            40% { transform: translateX(-50%) translateY(-10px); }
            60% { transform: translateX(-50%) translateY(-5px); }
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Tab Hero Banners */
        .tab-hero {
            background-size: cover;
            background-position: center;
            padding: 60px 40px;
            border-radius: 20px;
            margin-bottom: 32px;
            position: relative;
            overflow: hidden;
        }

        .tab-hero::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, rgba(10,10,10,0.8), rgba(26,11,46,0.6));
        }

        .tab-hero-content {
            position: relative;
            z-index: 10;
        }

        .tab-hero h2 {
            font-size: 2.5rem;
            margin-bottom: 16px;
            font-weight: 900;
        }

        .tab-hero p {
            font-size: 1.2rem;
            color: #d0d0d0;
            max-width: 600px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .hero-title {
                font-size: 2.5rem;
            }
            .hero-subtitle {
                font-size: 1.1rem;
            }
            .hero-stats {
                grid-template-columns: 1fr;
                gap: 24px;
            }
        }
    </style>
</head>
<body>

<!-- Auth Screen -->
<div id="authScreen">
    <div class="auth-container">
        <div class="auth-logo">
            <h1>â° TimeLink</h1>
            <p style="color:#999;">Time-Based Media Economy</p>
        </div>
        
        <div class="auth-message" id="authMessage"></div>
        
        <!-- Login Form -->
        <div id="loginForm" class="auth-form">
            <div class="form-group">
                <label>ì´ë©”ì¼</label>
                <input type="email" id="loginEmail" placeholder="your@email.com">
            </div>
            <div class="form-group">
                <label>ë¹„ë°€ë²ˆí˜¸</label>
                <input type="password" id="loginPassword" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
            </div>
            <button class="auth-btn" id="loginBtn">ë¡œê·¸ì¸</button>
            <div class="auth-switch">
                ê³„ì •ì´ ì—†ìœ¼ì‹ ê°€ìš”? <a id="switchToRegister" style="cursor:pointer">íšŒì›ê°€ì…</a>
            </div>
        </div>
        
        <!-- Register Form -->
        <div id="registerForm" class="auth-form" style="display:none;">
            <!-- ê°€ì… ë³´ë„ˆìŠ¤ ì•ˆë‚´ -->
            <div class="signup-bonus-banner">
                <div class="bonus-icon">ğŸ</div>
                <div class="bonus-text">
                    <strong>ì‹ ê·œ ê°€ì… ë³´ë„ˆìŠ¤ 10,000 TL!</strong>
                    <span>ì§€ê¸ˆ ê°€ì…í•˜ë©´ ì¦‰ì‹œ 10,000 TLì„ ë“œë¦½ë‹ˆë‹¤</span>
                </div>
            </div>

            <div class="form-group">
                <label>íšŒì› ìœ í˜•</label>
                <select id="accountType" style="margin-bottom:16px;" onchange="Auth.toggleBusinessInfo()">
                    <option value="personal">ğŸ‘¤ ì¼ë°˜ íšŒì›</option>
                    <option value="business">â˜• ì‚¬ì—…ì íšŒì› (ì¹´í˜ ìš´ì˜)</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>ì´ë¦„</label>
                <input type="text" id="regName" placeholder="í™ê¸¸ë™">
            </div>
            <div class="form-group">
                <label>ì´ë©”ì¼</label>
                <input type="email" id="regEmail" placeholder="your@email.com">
            </div>
            <div class="form-group">
                <label>ë¹„ë°€ë²ˆí˜¸</label>
                <input type="password" id="regPassword" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
            </div>
            
            <!-- ì‚¬ì—…ì ì¶”ê°€ ì •ë³´ -->
            <div id="businessInfo" style="display:none;">
                <div style="padding:16px; background:rgba(139,92,46,0.1); border:1px solid #8b5c2e; border-radius:12px; margin-bottom:16px;">
                    <div style="font-weight:700; margin-bottom:12px; color:#8b5c2e;">â˜• ì¹´í˜ ì •ë³´</div>
                    <div class="form-group">
                        <label>ì¹´í˜ ì´ë¦„</label>
                        <input type="text" id="cafeName" placeholder="ì˜ˆ: ì»¤í”¼ì•¤ë®¤ì§ ê°•ë‚¨ì ">
                    </div>
                    <div class="form-group">
                        <label>ì¹´í˜ ì£¼ì†Œ</label>
                        <input type="text" id="cafeLocation" placeholder="ì„œìš¸ ê°•ë‚¨êµ¬ í…Œí—¤ë€ë¡œ 123">
                    </div>
                    <div class="form-group">
                        <label>ì¹´í˜ ì†Œê°œ</label>
                        <textarea id="cafeDescription" rows="3" placeholder="ì¹´í˜ì˜ íŠ¹ì§•ê³¼ ë¶„ìœ„ê¸°ë¥¼ ì†Œê°œí•´ì£¼ì„¸ìš”"></textarea>
                    </div>
                    <div class="form-group">
                        <label>ì¹´í˜ ì´ë¯¸ì§€ URL</label>
                        <input type="text" id="cafeImage" placeholder="https://example.com/cafe.jpg">
                    </div>
                    <div class="form-group" style="margin-bottom:0;">
                        <label>ì˜ì—… ì‹œê°„</label>
                        <input type="text" id="cafeHours" placeholder="í‰ì¼ 09:00-22:00, ì£¼ë§ 10:00-23:00">
                    </div>
                </div>
            </div>
            
            <button class="auth-btn" id="registerBtn">ğŸ ê°€ì…í•˜ê³  10,000 TL ë°›ê¸°</button>
            <div class="auth-switch">
                ì´ë¯¸ ê³„ì •ì´ ìˆìœ¼ì‹ ê°€ìš”? <a id="switchToLogin" style="cursor:pointer">ë¡œê·¸ì¸</a>
            </div>
        </div>
    </div>
</div>

<!-- Main App -->
<div id="mainApp">

<div id="toast" class="toast"></div>
<input type="file" id="fileInput" style="display:none;" accept="audio/*,video/*">

<!-- Audio Player Modal -->
<div class="modal" id="audioModal">
    <div class="modal-content">
        <h2 id="playTitle">ì¬ìƒ ì¤‘</h2>
        <p style="color:#999; margin-bottom:20px;" id="playCreator">Creator</p>
        <div class="panel">
            <strong>â³ TL Balance</strong><br>
            <span style="font-size:2rem; font-weight:800;" id="playTL">0</span> TL
        </div>
        <audio id="audioPlayer" controls style="width:100%; margin:20px 0;"></audio>
        <button class="btn" onclick="App.stopPlay()" style="width:100%; background:#f44; color:white; padding:16px;">â¹ï¸ ì •ì§€</button>
    </div>
</div>

<!-- Charge Modal -->
<div class="modal" id="chargeModal">
    <div class="modal-content">
        <h2>ğŸ’° TL ì¶©ì „</h2>
        <div class="form-group" style="margin-top:24px;">
            <label>ì¶©ì „í•  TL</label>
            <input type="number" id="chargeAmount" value="1000" min="100" step="100">
        </div>
        <div style="display:flex; gap:12px;">
            <button class="btn btn-play" onclick="App.executeCharge()" style="flex:1; padding:16px;">ì¶©ì „</button>
            <button class="btn" onclick="App.closeModal()" style="flex:1; background:#333; color:white; padding:16px;">ì·¨ì†Œ</button>
        </div>
    </div>
</div>

<!-- ===== TL ì¶©ì „ ëª¨ë‹¬ (ê´‘ê³  + êµ¬ë§¤) ===== -->
<div class="modal" id="tlRechargeModal">
    <div class="modal-content">
        <div class="recharge-header">
            <div class="icon">ğŸ’°</div>
            <h2>TL ì¶©ì „í•˜ê¸°</h2>
            <p>ê´‘ê³  ì‹œì²­ìœ¼ë¡œ ë¬´ë£Œ TLì„ ë°›ê±°ë‚˜, ë°”ë¡œ êµ¬ë§¤í•˜ì„¸ìš”</p>
        </div>

        <!-- í˜„ì¬ ì”ì•¡ í‘œì‹œ -->
        <div style="background:rgba(255,255,255,0.03); border-radius:12px; padding:16px; margin-bottom:20px; text-align:center; border:1px solid rgba(255,255,255,0.08);">
            <div style="font-size:12px; color:#999; margin-bottom:4px;">í˜„ì¬ TL ì”ì•¡</div>
            <div style="font-size:2rem; font-weight:800;" id="modalCurrentTL">0</div>
            <div style="font-size:11px; color:#666; margin-top:4px;">TL</div>
        </div>

        <!-- ê´‘ê³  ì‹œì²­ ì„¹ì…˜ -->
        <div class="ad-section">
            <h3>ğŸ“º ê´‘ê³  ì‹œì²­ìœ¼ë¡œ ë¬´ë£Œ TL íšë“</h3>
            <p>ê´‘ê³ ë¥¼ ì‹œì²­í•˜ë©´ ë¬´ë£Œë¡œ TLì„ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤ (í•˜ë£¨ ìµœëŒ€ 5íšŒ)</p>
            
            <div class="ad-rewards">
                <div class="ad-reward-item">
                    <div class="reward-tl">+500 TL</div>
                    <div class="reward-label">15ì´ˆ ê´‘ê³ </div>
                    <div class="reward-time">ë¹ ë¥¸ íšë“</div>
                </div>
                <div class="ad-reward-item">
                    <div class="reward-tl">+1,500 TL</div>
                    <div class="reward-label">30ì´ˆ ê´‘ê³ </div>
                    <div class="reward-time">ì¶”ì²œ</div>
                </div>
                <div class="ad-reward-item">
                    <div class="reward-tl">+3,000 TL</div>
                    <div class="reward-label">60ì´ˆ ê´‘ê³ </div>
                    <div class="reward-time">ìµœëŒ€ ë³´ìƒ</div>
                </div>
            </div>

            <!-- ê´‘ê³  ì§„í–‰ ì¤‘ í‘œì‹œ -->
            <div class="ad-progress-container" id="adProgressContainer">
                <div class="ad-visual" id="adVisual">
                    <div class="ad-visual-content">
                        <div class="ad-brand" id="adBrand">TimeLink Premium</div>
                        <div class="ad-tagline" id="adTagline">ìŒì•…ìœ¼ë¡œ ì—°ê²°ë˜ëŠ” ì„¸ìƒ</div>
                    </div>
                </div>
                <div class="ad-progress-label">
                    <span id="adProgressText">ê´‘ê³  ì‹œì²­ ì¤‘...</span>
                    <span id="adCountdown">30ì´ˆ</span>
                </div>
                <div class="ad-progress-bar">
                    <div class="ad-progress-fill" id="adProgressFill"></div>
                </div>
                <div class="ad-skip-notice" id="adSkipNotice">âš ï¸ ê´‘ê³ ê°€ ëë‚  ë•Œê¹Œì§€ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”</div>
            </div>

            <!-- ê´‘ê³  ì„ íƒ ë²„íŠ¼ -->
            <div id="adButtons" style="display:flex; gap:10px; flex-wrap:wrap;">
                <button class="btn" onclick="App.watchAd(15, 500)" style="flex:1; background:rgba(59,130,246,0.2); color:#60a5fa; border:1px solid rgba(59,130,246,0.4); padding:12px; font-size:13px;">
                    â–¶ï¸ 15ì´ˆ â†’ +500 TL
                </button>
                <button class="btn" onclick="App.watchAd(30, 1500)" style="flex:1; background:rgba(59,130,246,0.4); color:#60a5fa; border:1px solid rgba(59,130,246,0.6); padding:12px; font-size:13px;">
                    â–¶ï¸ 30ì´ˆ â†’ +1,500 TL â­
                </button>
                <button class="btn" onclick="App.watchAd(60, 3000)" style="flex:1; background:rgba(59,130,246,0.2); color:#60a5fa; border:1px solid rgba(59,130,246,0.4); padding:12px; font-size:13px;">
                    â–¶ï¸ 60ì´ˆ â†’ +3,000 TL
                </button>
            </div>
            <div style="margin-top:10px; text-align:center; font-size:12px; color:#666;">
                ì˜¤ëŠ˜ ë‚¨ì€ ê´‘ê³  íšŸìˆ˜: <span id="adRemaining" style="color:#f59e0b; font-weight:700;">5íšŒ</span>
            </div>
        </div>

        <div class="recharge-divider">ë˜ëŠ” ë°”ë¡œ êµ¬ë§¤</div>

        <!-- êµ¬ë§¤ íŒ¨í‚¤ì§€ ì„¹ì…˜ -->
        <div class="purchase-section">
            <h3>ğŸ›’ TL êµ¬ë§¤ íŒ¨í‚¤ì§€</h3>
            <div class="packages-grid">
                <div class="package-card" onclick="App.purchaseTL(1000, 1000)">
                    <div class="pkg-tl">1,000 TL</div>
                    <div class="pkg-price">â‚©1,000</div>
                    <div class="pkg-per">1 TL = â‚©1</div>
                </div>
                <div class="package-card popular" onclick="App.purchaseTL(5500, 5000)">
                    <div class="popular-badge">ğŸ”¥ ì¸ê¸°</div>
                    <div class="pkg-tl">5,500 TL</div>
                    <div class="pkg-bonus">+500 TL ë³´ë„ˆìŠ¤!</div>
                    <div class="pkg-price">â‚©5,000</div>
                    <div class="pkg-per">10% ì¶”ê°€ ì¦ì •</div>
                </div>
                <div class="package-card" onclick="App.purchaseTL(12000, 10000)">
                    <div class="pkg-tl">12,000 TL</div>
                    <div class="pkg-bonus">+2,000 TL ë³´ë„ˆìŠ¤!</div>
                    <div class="pkg-price">â‚©10,000</div>
                    <div class="pkg-per">20% ì¶”ê°€ ì¦ì •</div>
                </div>
                <div class="package-card" onclick="App.purchaseTL(30000, 20000)">
                    <div class="pkg-tl">30,000 TL</div>
                    <div class="pkg-bonus">+10,000 TL ë³´ë„ˆìŠ¤!</div>
                    <div class="pkg-price">â‚©20,000</div>
                    <div class="pkg-per">50% ì¶”ê°€ ì¦ì •</div>
                </div>
                <div class="package-card" onclick="App.purchaseTL(60000, 30000)" style="grid-column:span 2;">
                    <div class="pkg-tl" style="font-size:2rem;">60,000 TL</div>
                    <div class="pkg-bonus">+30,000 TL ë³´ë„ˆìŠ¤! ğŸ</div>
                    <div class="pkg-price">â‚©30,000</div>
                    <div class="pkg-per">100% ì¶”ê°€ ì¦ì • â€” ìµœê³  í˜œíƒ</div>
                </div>
            </div>
            <div style="margin-top:12px; font-size:11px; color:#666; text-align:center; line-height:1.6;">
                ğŸ’³ ì¹´ë“œ/ê³„ì¢Œì´ì²´/ì¹´ì¹´ì˜¤í˜ì´ ê²°ì œ ì§€ì› (ë°ëª¨: ì¦‰ì‹œ ì§€ê¸‰)<br>
                êµ¬ë§¤í•œ TLì€ ë§Œë£Œ ì—†ì´ ì˜êµ¬ ë³´ê´€ë©ë‹ˆë‹¤
            </div>
        </div>

        <button onclick="App.closeRechargeModal()" style="width:100%; margin-top:20px; padding:14px; background:rgba(255,255,255,0.05); border:1px solid rgba(255,255,255,0.1); border-radius:12px; color:#999; font-weight:600; cursor:pointer; font-size:14px;">
            ë‹«ê¸°
        </button>
    </div>
</div>

<div class="container">

    <!-- ì €TL ê²½ê³  ë°°ë„ˆ -->
    <div id="lowTlBanner" style="display:none; background:linear-gradient(135deg,rgba(245,158,11,0.15),rgba(239,68,68,0.08)); border:1px solid rgba(245,158,11,0.4); border-radius:16px; padding:16px 24px; margin-bottom:20px; align-items:center; gap:16px;">
        <div style="font-size:1.5rem;">âš ï¸</div>
        <div style="flex:1;">
            <strong style="color:#f59e0b; display:block;">TL ì”ì•¡ì´ ë¶€ì¡±í•©ë‹ˆë‹¤!</strong>
            <span style="font-size:13px; color:#999;">ê´‘ê³  ì‹œì²­ì´ë‚˜ TL êµ¬ë§¤ë¥¼ í†µí•´ ì¶©ì „í•˜ì„¸ìš”</span>
        </div>
        <button class="recharge-btn" onclick="App.openRechargeModal('low')">
            ğŸ’° ì§€ê¸ˆ ì¶©ì „
        </button>
    </div>

    <div class="header">
        <h1>â° TimeLink</h1>
        <div class="user-info">
            <div class="balances">
                <div class="balance" id="tlBalance" onclick="App.openRechargeModal('header')" title="í´ë¦­í•˜ì—¬ TL ì¶©ì „">
                    <div class="lbl">ğŸ’° TL <span style="font-size:9px; opacity:0.6;">ì¶©ì „ â–²</span></div>
                    <div class="amt" id="walletTL">10,000</div>
                </div>
                <div class="balance">
                    <div class="lbl">ğŸª™ TLC</div>
                    <div class="amt" id="walletTLC">0.00</div>
                </div>
            </div>
            <button class="recharge-btn" onclick="App.openRechargeModal('header')">
                ğŸ’° TL ì¶©ì „
            </button>
            <div class="user-name">ğŸ‘¤ <span id="userName">User</span></div>
            <button class="logout-btn" id="resetBtn" style="background:rgba(255,165,0,0.2); color:#ffa500; border-color:rgba(255,165,0,0.3);">ğŸ”„ ë¦¬ì…‹</button>
            <button class="logout-btn" id="logoutBtn">ë¡œê·¸ì•„ì›ƒ</button>
        </div>
    </div>

    <div class="tabs">
        <button class="tab active" onclick="App.switchTab('discover', event)">ğŸ”¥ Discover</button>
        <button class="tab" onclick="App.switchTab('player', event)">ğŸ§ Player</button>
        <button class="tab" onclick="App.switchTab('create', event)">ğŸ“¤ Create</button>
        <button class="tab" onclick="App.switchTab('myfiles', event)">ğŸµ My Files</button>
        <button class="tab" onclick="App.switchTab('contribution', event)">ğŸ† Rewards</button>
        <button class="tab" onclick="App.switchTab('mining', event)">â›ï¸ Mining</button>
        <button class="tab" onclick="App.switchTab('gold', event)">ğŸ’° Gold</button>
        <button class="tab" onclick="App.switchTab('about', event)">â„¹ï¸ About</button>
    </div>

    <!-- Dashboard -->
    <div id="tabAbout" class="tab-content">
        <!-- Hero Fullscreen -->
        <div class="hero-fullscreen">
            <div class="hero-bg"></div>
            
            <div class="hero-content">
                <div class="hero-badge">
                    ğŸš€ The Future of Music Economy
                </div>
                
                <h1 class="hero-title">TimeLink</h1>
                
                <p class="hero-subtitle">
                    AI ì‹œëŒ€ì˜ ì €ì‘ê¶Œ ì¸í”„ë¼ â€¢ ë¸”ë¡ì²´ì¸ ê¸°ë°˜ ìë™ ì •ì‚° â€¢ ê¸ˆ ë‹´ë³´ ì•”í˜¸í™”í
                </p>
                
                <div class="hero-cta">
                    <button class="hero-btn hero-btn-primary" onclick="App.switchTab('create')">
                        ğŸµ TL3 íŒŒì¼ ìƒì„±í•˜ê¸°
                    </button>
                    <button class="hero-btn hero-btn-secondary" onclick="App.switchTab('player')">
                        ğŸ§ í”Œë ˆì´ì–´ ë°ëª¨ ë³´ê¸°
                    </button>
                </div>
                
                <div class="hero-stats">
                    <div class="hero-stat">
                        <div class="hero-stat-value" id="heroFileCount">0</div>
                        <div class="hero-stat-label">ìƒì„±ëœ TL3 íŒŒì¼</div>
                    </div>
                    <div class="hero-stat">
                        <div class="hero-stat-value" id="heroTlEarned">0</div>
                        <div class="hero-stat-label">ëˆ„ì  TL ìˆ˜ìµ</div>
                    </div>
                    <div class="hero-stat">
                        <div class="hero-stat-value" id="heroTlcMined">0.00</div>
                        <div class="hero-stat-label">ì±„êµ´ëœ TLC</div>
                    </div>
                </div>
            </div>
            
            <div class="scroll-indicator">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 5v14M19 12l-7 7-7-7"/>
                </svg>
            </div>
        </div>

        <div class="card">
            <h2>ğŸ¯ TimeLinkë€?</h2>
            <p style="color:#999; line-height:1.8; margin-bottom:24px;">TimeLinkëŠ” ì‹œê°„ ê¸°ë°˜ ë¯¸ë””ì–´ ê²½ì œ í”Œë«í¼ì…ë‹ˆë‹¤.</p>
            <div class="feature-grid">
                <div class="feature-card"><div style="font-size:2.5rem;">ğŸ“¤</div><h3>Create</h3><p>MP3/MP4ë¥¼ TL3/TL4ë¡œ ë³€í™˜. Suno/Udio AI ìë™ ì¸ì¦.</p></div>
                <div class="feature-card"><div style="font-size:2.5rem;">ğŸ§</div><h3>TL3 Player</h3><p>ì‹¤ì‹œê°„ ìë™ ì •ì‚°. ì¬ìƒí• ìˆ˜ë¡ ì°½ì‘ì ìˆ˜ìµ ì¦ê°€.</p></div>
                <div class="feature-card"><div style="font-size:2.5rem;">ğŸ†</div><h3>Contribution</h3><p>ìŒì•…ì„ ë“£ê³  ê³µìœ í•˜ë©´ AIê°€ ê¸°ì—¬ë„ ë¶„ì„í•˜ì—¬ TL ë³´ìƒ.</p></div>
                <div class="feature-card"><div style="font-size:2.5rem;">â›ï¸</div><h3>Mining</h3><p>TLì˜ ìµœëŒ€ 50%ë¥¼ TLCë¡œ ì±„êµ´. ê¸°ì—¬ì§€ìˆ˜ ë³€ë™.</p></div>
                <div class="feature-card"><div style="font-size:2.5rem;">ğŸ’°</div><h3>Gold Reserve</h3><p>í”Œë«í¼ ìˆ˜ìµ 10% â†’ ê¸ˆ êµ¬ë§¤ â†’ TLC ê°€ì¹˜ ìœ ì§€.</p></div>
                <div class="feature-card"><div style="font-size:2.5rem;">ğŸ”—</div><h3>Blockchain</h3><p>TON ë„¤íŠ¸ì›Œí¬ ê¸°ë°˜ íˆ¬ëª…í•œ ê±°ë˜ ê¸°ë¡.</p></div>
            </div>
        </div>

        <!-- Legal Footer -->
        <div style="margin-top: 60px; padding: 40px; background: rgba(0,0,0,0.3); border-radius: 16px; border: 1px solid rgba(138,43,226,0.2);">
            <div style="text-align: center; max-width: 900px; margin: 0 auto;">
                <!-- Patent Notice -->
                <div style="background: linear-gradient(135deg, rgba(138,43,226,0.1), rgba(29,185,84,0.05)); padding: 24px; border-radius: 12px; border-left: 4px solid #8a2be2; margin-bottom: 24px;">
                    <div style="font-size: 1.1rem; font-weight: 700; color: #b983ff; margin-bottom: 8px;">
                        ğŸ”’ Patent Protected Technology
                    </div>
                    <div style="color: #d0d0d0; font-size: 0.95rem; line-height: 1.6;">
                        íŠ¹í—ˆì¶œì›ì¤‘ | Patent Pending
                    </div>
                </div>

                <!-- Copyright Notice -->
                <div style="color: #999; font-size: 0.85rem; line-height: 1.8; margin-bottom: 16px;">
                    <p style="margin-bottom: 12px;">
                        <strong style="color: #b983ff;">Â© 2025-2026 TimeLink. All Rights Reserved.</strong>
                    </p>
                    <p style="margin-bottom: 12px;">
                        ë³¸ í”Œë«í¼ì˜ TL3/TL4 íŒŒì¼ í¬ë§·, ë¸”ë¡ì²´ì¸ ê¸°ë°˜ ìë™ ì •ì‚° ì‹œìŠ¤í…œ, ê¸°ì—¬ë„ ë¶„ì„ ì•Œê³ ë¦¬ì¦˜, 
                        ê¸ˆ ë‹´ë³´ ì•”í˜¸í™”í ë©”ì»¤ë‹ˆì¦˜ì„ í¬í•¨í•œ ëª¨ë“  ê¸°ìˆ ì  êµ¬í˜„ ë° ë¹„ì¦ˆë‹ˆìŠ¤ ë°©ë²•ì€ 
                        ëŒ€í•œë¯¼êµ­ ë° êµ­ì œ íŠ¹í—ˆë²•ì— ì˜í•´ ë³´í˜¸ë©ë‹ˆë‹¤.
                    </p>
                </div>

                <!-- Legal Warning -->
                <div style="background: rgba(239,68,68,0.05); padding: 20px; border-radius: 8px; border: 1px solid rgba(239,68,68,0.2); margin-bottom: 20px;">
                    <div style="color: #ef4444; font-size: 0.8rem; line-height: 1.6; text-align: left;">
                        <strong>âš ï¸ ë²•ì  ê³ ì§€ | Legal Notice</strong><br><br>
                        
                        <strong>ì§€ì ì¬ì‚°ê¶Œ ë³´í˜¸:</strong> TimeLinkì˜ ëª¨ë“  ì†Œí”„íŠ¸ì›¨ì–´, ì•Œê³ ë¦¬ì¦˜, ë°ì´í„°ë² ì´ìŠ¤, ì‚¬ìš©ì ì¸í„°í˜ì´ìŠ¤, 
                        ê·¸ë˜í”½ ë””ìì¸, ìƒí‘œ ë° ì„œë¹„ìŠ¤ ë§ˆí¬ëŠ” ì €ì‘ê¶Œ, ìƒí‘œê¶Œ, íŠ¹í—ˆê¶Œ ë° ê¸°íƒ€ ì§€ì ì¬ì‚°ê¶Œë²•ì˜ ë³´í˜¸ë¥¼ ë°›ìŠµë‹ˆë‹¤.<br><br>
                        
                        <strong>ë¬´ë‹¨ ì‚¬ìš© ê¸ˆì§€:</strong> ë³¸ í”Œë«í¼ì˜ ê¸°ìˆ ì„ ë¬´ë‹¨ìœ¼ë¡œ ë³µì œ, ìˆ˜ì •, ë°°í¬, ì—­ì„¤ê³„(reverse engineering), 
                        ì—­ì»´íŒŒì¼(decompile) ë˜ëŠ” ì—­ì–´ì…ˆë¸”(disassemble)í•˜ëŠ” í–‰ìœ„ëŠ” ë²•ë¥ ì— ì˜í•´ ì—„ê²©íˆ ê¸ˆì§€ë˜ë©°, 
                        ë¯¼í˜•ì‚¬ìƒ ì±…ì„ì„ ë¬¼ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br><br>
                        
                        <strong>Intellectual Property Protection:</strong> All software, algorithms, databases, user interfaces, 
                        graphic designs, trademarks, and service marks of TimeLink are protected by copyright, trademark, 
                        patent, and other intellectual property laws.<br><br>
                        
                        <strong>Prohibition of Unauthorized Use:</strong> Unauthorized reproduction, modification, distribution, 
                        reverse engineering, decompilation, or disassembly of the technology of this platform is strictly 
                        prohibited by law and may result in civil and criminal liability.
                    </div>
                </div>

                <!-- Patent Details -->
                <div style="background: rgba(255,255,255,0.02); padding: 16px; border-radius: 8px; margin-bottom: 20px;">
                    <div style="color: #666; font-size: 0.75rem; line-height: 1.6; text-align: left;">
                        <strong style="color: #888;">ë³´í˜¸ë°›ëŠ” í•µì‹¬ ê¸°ìˆ  | Protected Core Technologies:</strong><br>
                        â€¢ TL3/TL4 File Format with Embedded Smart Contracts<br>
                        â€¢ Blockchain-based Automatic Royalty Distribution System<br>
                        â€¢ AI-powered Contribution Analysis & Reward Algorithm<br>
                        â€¢ Gold-backed Cryptocurrency Stabilization Mechanism<br>
                        â€¢ Decentralized Content Monetization Protocol<br>
                        â€¢ Time-based Media Economy Infrastructure
                    </div>
                </div>

                <!-- Contact -->
                <div style="color: #666; font-size: 0.75rem;">
                    <p>
                        For licensing inquiries or partnership opportunities:<br>
                        ğŸ“§ <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="a9c5cccec8c5e9ddc0c4ccc5c0c7c287c0c6">[email&#160;protected]</a> | ğŸŒ www.timelink.io
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- TL3 Player -->
    <div id="tabPlayer" class="tab-content">
        <!-- Hero Banner -->
        <div class="tab-hero" style="background-image: url('https://images.unsplash.com/photo-1598488035139-bdbb2231ce04?auto=format&fit=crop&w=2000&q=80');">
            <div class="tab-hero-content">
                <h2>ğŸ§ TL3 Player</h2>
                <p>ì‹¤ì‹œê°„ ìë™ ì •ì‚° ì‹œìŠ¤í…œ â€¢ ì–´ë””ì„œ ì¬ìƒë˜ë“  ì°½ì‘ìì—ê²Œ ìë™ ì†¡ê¸ˆ</p>
            </div>
        </div>

        <div class="card">
            <h2>ğŸ§ TL3 Player - ë‹¤ì¤‘ íŒŒì¼ ì—…ë¡œë“œ & ì°½ì‘ê¶Œ ì¦ëª…</h2>
            <p style="color:#999; margin-bottom:20px;">ì—¬ëŸ¬ TL3/TL4 íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì—¬ My Filesì— ì¶”ê°€í•˜ê³  ê³µìœ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</p>
            
            <!-- Drop Zone -->
            <div id="tl3DropZone" style="
                border: 3px dashed rgba(138,43,226,0.5);
                border-radius: 20px;
                padding: 60px 40px;
                text-align: center;
                background: linear-gradient(135deg, rgba(138,43,226,0.1), rgba(29,185,84,0.05));
                cursor: pointer;
                transition: all 0.3s;
                margin-bottom: 24px;
            ">
                <div style="font-size: 4rem; margin-bottom: 16px;">ğŸ“</div>
                <h3 style="margin-bottom: 12px;">TL3/TL4 íŒŒì¼ì„ ì—¬ê¸°ì— ë“œë¡­í•˜ì„¸ìš”</h3>
                <p style="color: #999; margin-bottom: 8px;">ë˜ëŠ” í´ë¦­í•˜ì—¬ íŒŒì¼ ì„ íƒ (ë‹¤ì¤‘ ì„ íƒ ê°€ëŠ¥)</p>
                <p style="color: #666; font-size: 13px;">ğŸ’¡ ë¸”ë¡ì²´ì¸ í•´ì‹œë¡œ ìµœì´ˆ ì—…ë¡œë”ë§Œ ê³µìœ  ê¶Œí•œì„ ë°›ìŠµë‹ˆë‹¤</p>
                <input type="file" id="tl3FileInput" accept=".tl3,.mp4,.mp3" multiple style="display:none;">
            </div>

            <!-- Upload Queue -->
            <div id="uploadQueue" style="display:none; margin-bottom: 24px;">
                <h3 style="margin-bottom: 16px; color: #8a2be2;">ğŸ“‹ ì—…ë¡œë“œ ëŒ€ê¸°ì—´</h3>
                <div id="uploadQueueList" style="display: grid; gap: 12px;"></div>
                <div style="display: flex; gap: 12px; margin-top: 16px;">
                    <button id="processUploadsBtn" class="btn btn-play" style="flex: 1; padding: 16px;">
                        âœ¨ My Filesì— ì¶”ê°€í•˜ê¸°
                    </button>
                    <button id="clearQueueBtn" class="btn" style="background: #333; color: white; padding: 16px;">
                        ğŸ—‘ï¸ ëŒ€ê¸°ì—´ ì§€ìš°ê¸°
                    </button>
                </div>
            </div>

            <!-- Player UI (ì´ˆê¸° ìˆ¨ê¹€) -->
            <div id="playerUI" style="display:none;">
                <!-- í˜„ì¬ ì¬ìƒ ì¤‘ì¸ ê³¡ ì •ë³´ -->
                <div style="background: linear-gradient(135deg, rgba(138,43,226,0.2), rgba(29,185,84,0.1)); padding: 24px; border-radius: 16px; margin-bottom: 24px; border: 2px solid #8a2be2;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                        <div>
                            <h3 id="playerTrackTitle" style="font-size: 1.6rem; margin-bottom: 8px;">-</h3>
                            <div id="playerCreator" style="color: #999; font-size: 0.95rem;">-</div>
                        </div>
                        <div id="playerCertified" style="display:none; background: rgba(29,185,84,0.2); padding: 8px 16px; border-radius: 8px; border: 1px solid #1db954;">
                            <span style="color: #1db954;">âœ“ AI ì¸ì¦</span>
                        </div>
                    </div>

                    <!-- Audio Player -->
                    <audio id="tl3Audio" controls style="width: 100%; margin-bottom: 16px;"></audio>

                    <!-- ì¬ìƒ ì‹œê°„ í‘œì‹œ -->
                    <div style="display: flex; justify-content: space-between; font-size: 0.9rem; color: #999; margin-bottom: 8px;">
                        <span id="playerCurrentTime">0:00</span>
                        <span id="playerDuration">0:00</span>
                    </div>
                </div>

                <!-- ì‹¤ì‹œê°„ ì •ì‚° í˜„í™© -->
                <div style="background: rgba(0,0,0,0.4); padding: 24px; border-radius: 16px; border: 1px solid rgba(255,255,255,0.1);">
                    <h3 style="margin-bottom: 20px; color: #f59e0b;">ğŸ’¸ ì‹¤ì‹œê°„ ì •ì‚°</h3>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 20px;">
                        <!-- ì¬ìƒ ì‹œê°„ -->
                        <div style="background: rgba(138,43,226,0.1); padding: 16px; border-radius: 12px; border-left: 4px solid #8a2be2;">
                            <div style="font-size: 0.85rem; color: #999; margin-bottom: 4px;">ì¬ìƒ ì‹œê°„</div>
                            <div style="font-size: 2rem; font-weight: 800; color: #b983ff;"><span id="playerPlayedSeconds">0</span>ì´ˆ</div>
                        </div>

                        <!-- ì†Œë¹„í•œ TL -->
                        <div style="background: rgba(239,68,68,0.1); padding: 16px; border-radius: 12px; border-left: 4px solid #ef4444;">
                            <div style="font-size: 0.85rem; color: #999; margin-bottom: 4px;">ì†Œë¹„í•œ TL</div>
                            <div style="font-size: 2rem; font-weight: 800; color: #ef4444;"><span id="playerConsumedTL">0</span> TL</div>
                        </div>

                        <!-- ì°½ì‘ì ìˆ˜ìµ -->
                        <div style="background: rgba(29,185,84,0.1); padding: 16px; border-radius: 12px; border-left: 4px solid #1db954;">
                            <div style="font-size: 0.85rem; color: #999; margin-bottom: 4px;">ì°½ì‘ì ìˆ˜ìµ (<span id="playerCreatorSharePercent">70</span>%)</div>
                            <div style="font-size: 2rem; font-weight: 800; color: #1db954;"><span id="playerCreatorEarned">0</span> TL</div>
                        </div>

                        <!-- í”Œë«í¼ ìˆ˜ìµ -->
                        <div style="background: rgba(245,158,11,0.1); padding: 16px; border-radius: 12px; border-left: 4px solid #f59e0b;">
                            <div style="font-size: 0.85rem; color: #999; margin-bottom: 4px;">í”Œë«í¼ ìˆ˜ìµ (<span id="playerPlatformSharePercent">30</span>%)</div>
                            <div style="font-size: 2rem; font-weight: 800; color: #f59e0b;"><span id="playerPlatformEarned">0</span> TL</div>
                        </div>
                    </div>

                    <!-- ì •ì‚° ì• ë‹ˆë©”ì´ì…˜ -->
                    <div id="paymentAnimation" style="background: rgba(138,43,226,0.05); padding: 16px; border-radius: 12px; border: 1px dashed rgba(138,43,226,0.3); text-align: center; min-height: 60px; display: flex; align-items: center; justify-content: center;">
                        <span style="color: #999; font-size: 0.9rem;">â–¶ï¸ ì¬ìƒ ì‹œì‘ ì‹œ 1ì´ˆë§ˆë‹¤ ìë™ ì •ì‚°ë©ë‹ˆë‹¤</span>
                    </div>
                </div>

                <!-- ë¸”ë¡ì²´ì¸ ê²€ì¦ ì •ë³´ -->
                <div id="blockchainInfo" style="background: rgba(138,43,226,0.05); padding: 16px; border-radius: 12px; margin-top: 16px; border-left: 3px solid #8a2be2;">
                    <div style="font-size: 0.85rem; color: #999; margin-bottom: 8px;">ğŸ”— ë¸”ë¡ì²´ì¸ ê²€ì¦</div>
                    <div id="blockchainHash" style="font-family: monospace; font-size: 0.8rem; word-break: break-all; color: #b983ff;">-</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Contribution System -->
    <div id="tabContribution" class="tab-content">
        <!-- Hero Banner -->
        <div class="tab-hero" style="background-image: url('https://images.unsplash.com/photo-1511379938547-c1f69419868d?auto=format&fit=crop&w=2000&q=80');">
            <div class="tab-hero-content">
                <h2>ğŸ† ê¸°ì—¬ë„ ì‹œìŠ¤í…œ</h2>
                <p>AI ë¶„ì„ ê¸°ë°˜ ë³´ìƒ â€¢ ë“£ê³  ê³µìœ í•˜ë©´ ëˆì„ ë²Œì–´ê°€ëŠ” í˜ì‹ ì  ê²½ì œ</p>
            </div>
        </div>

        <div class="card">
            <h2>ğŸ† ê¸°ì—¬ë„ ì‹œìŠ¤í…œ</h2>
            <p style="color:#999; margin-bottom:24px;">ìŒì•…ì„ ì ê·¹ì ìœ¼ë¡œ ì¦ê¸°ë©´ AIê°€ ê¸°ì—¬ë„ë¥¼ ë¶„ì„í•˜ì—¬ TLë¡œ ë³´ìƒí•©ë‹ˆë‹¤</p>

            <!-- ë‚´ ê¸°ì—¬ë„ í˜„í™© -->
            <div style="background: linear-gradient(135deg, rgba(29,185,84,0.15), rgba(34,197,94,0.05)); padding: 32px; border-radius: 20px; margin-bottom: 24px; border: 2px solid #1db954; text-align: center;">
                <div style="font-size: 0.9rem; color: #999; margin-bottom: 8px;">ì˜¤ëŠ˜ì˜ ê¸°ì—¬ë„</div>
                <div style="font-size: 4rem; font-weight: 900; color: #1db954; margin-bottom: 16px;" id="todayContribution">0<span style="font-size: 2rem;">ì </span></div>
                <div style="font-size: 1.2rem; color: #fff; margin-bottom: 24px;">ğŸ’° íšë“ ê°€ëŠ¥: <strong id="todayReward">0</strong> TL</div>
                <button id="claimRewardBtn" onclick="App.claimContributionReward()" style="background: linear-gradient(135deg, #1db954, #22c55e); color: white; border: none; padding: 16px 48px; border-radius: 12px; font-size: 1.1rem; font-weight: 700; cursor: pointer;" disabled>
                    ğŸ ë³´ìƒ ë°›ê¸°
                </button>
            </div>

            <!-- ê¸°ì—¬ë„ í†µê³„ -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 24px;">
                <div class="stat-card">
                    <div class="stat-label">ì´ ê¸°ì—¬ë„</div>
                    <div class="stat-value" id="totalContribution">0ì </div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">ì´ ë³´ìƒ</div>
                    <div class="stat-value" id="totalRewards">0 TL</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">ì´ë²ˆ ë‹¬</div>
                    <div class="stat-value" id="monthlyContribution">0ì </div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">ë“±ê¸‰</div>
                    <div class="stat-value" id="userRank">ìƒˆì‹¹ ğŸŒ±</div>
                </div>
            </div>

            <!-- ê¸°ì—¬ë„ íšë“ ë°©ë²• -->
            <div style="background: rgba(0,0,0,0.3); padding: 24px; border-radius: 16px; border: 1px solid rgba(255,255,255,0.1);">
                <h3 style="margin-bottom: 16px; color: #f59e0b;">ğŸ’¡ ê¸°ì—¬ë„ íšë“ ë°©ë²•</h3>
                
                <div style="display: grid; gap: 12px;">
                    <div class="contribution-item">
                        <div class="contribution-icon">ğŸµ</div>
                        <div class="contribution-info">
                            <div class="contribution-title">ì™„ê³¡ ì²­ì·¨ (80% ì´ìƒ)</div>
                            <div class="contribution-reward">+10ì  â†’ +50 TL</div>
                        </div>
                        <button onclick="App.simulateContribution('complete_listen')" class="btn-simulate">ì‹œë®¬ë ˆì´ì…˜</button>
                    </div>

                    <div class="contribution-item">
                        <div class="contribution-icon">ğŸ”</div>
                        <div class="contribution-info">
                            <div class="contribution-title">ë°˜ë³µ ì¬ìƒ (3íšŒ ì´ìƒ)</div>
                            <div class="contribution-reward">+20ì  â†’ +100 TL</div>
                        </div>
                        <button onclick="App.simulateContribution('repeat_3x')" class="btn-simulate">ì‹œë®¬ë ˆì´ì…˜</button>
                    </div>

                    <div class="contribution-item">
                        <div class="contribution-icon">ğŸ“</div>
                        <div class="contribution-info">
                            <div class="contribution-title">í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ì¶”ê°€</div>
                            <div class="contribution-reward">+30ì  â†’ +150 TL</div>
                        </div>
                        <button onclick="App.simulateContribution('add_playlist')" class="btn-simulate">ì‹œë®¬ë ˆì´ì…˜</button>
                    </div>

                    <div class="contribution-item">
                        <div class="contribution-icon">ğŸ“¢</div>
                        <div class="contribution-info">
                            <div class="contribution-title">SNS ê³µìœ  (í´ë¦­ ë°œìƒ)</div>
                            <div class="contribution-reward">+100ì  â†’ +500 TL</div>
                        </div>
                        <button onclick="App.simulateContribution('share_sns')" class="btn-simulate">ì‹œë®¬ë ˆì´ì…˜</button>
                    </div>

                    <div class="contribution-item">
                        <div class="contribution-icon">ğŸ”</div>
                        <div class="contribution-info">
                            <div class="contribution-title">ì‹ ê³¡ ë°œê²¬ (ì²« 100ëª…)</div>
                            <div class="contribution-reward">+200ì  â†’ +1,000 TL</div>
                        </div>
                        <button onclick="App.simulateContribution('early_discover')" class="btn-simulate">ì‹œë®¬ë ˆì´ì…˜</button>
                    </div>
                </div>
            </div>

            <!-- AI ë¶„ì„ ì•Œê³ ë¦¬ì¦˜ ì„¤ëª… -->
            <div style="background: rgba(138,43,226,0.05); padding: 20px; border-radius: 12px; margin-top: 24px; border-left: 4px solid #8a2be2;">
                <h4 style="margin-bottom: 12px; color: #b983ff;">ğŸ¤– AI ê¸°ì—¬ë„ ë¶„ì„</h4>
                <ul style="color: #999; line-height: 2; padding-left: 20px;">
                    <li>ì²­ì·¨ í’ˆì§ˆ ë¶„ì„: ì™„ê³¡ ì—¬ë¶€, ìŠ¤í‚µ íšŸìˆ˜, ë°˜ë³µ ì¬ìƒ</li>
                    <li>ë°œê²¬ ê°€ì¹˜ í‰ê°€: ì–¸ë”ê·¸ë¼ìš´ë“œ ì•„í‹°ìŠ¤íŠ¸ ì¡°ê¸° ë°œêµ´</li>
                    <li>í™•ì‚° ê¸°ì—¬ë„: ê³µìœ , í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ì¶”ê°€, ëŒ“ê¸€/ë¦¬ë·°</li>
                    <li>ì»¤ë®¤ë‹ˆí‹° í™œë™: ë„ì›€ë˜ëŠ” ë¦¬ë·°, ì¶”ì²œ ì •í™•ë„</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Create -->
    <div id="tabCreate" class="tab-content">
        <!-- Hero Banner -->
        <div class="tab-hero" style="background-image: url('https://images.unsplash.com/photo-1571330735066-03aaa9429d89?auto=format&fit=crop&w=2000&q=80');">
            <div class="tab-hero-content">
                <h2>ğŸ“¤ Create TL3/TL4</h2>
                <p>ë¸”ë¡ì²´ì¸ ê¸°ë°˜ íŒŒì¼ ìƒì„± â€¢ AI ìë™ ì¸ì¦ â€¢ IPFS íƒˆì¤‘ì•™í™” ìŠ¤í† ë¦¬ì§€</p>
            </div>
        </div>

        <div class="card">
            <h2>ğŸ“¤ Create TL3/TL4</h2>
            <div class="type-selector">
                <div class="type-card audio selected" id="audioCard" onclick="App.selectType('audio')">
                    <div style="font-size:3rem;">ğŸµ</div>
                    <h3>TL3 Audio</h3>
                    <div style="color:#1db954; font-weight:700; margin-top:10px;">1ì´ˆ = 1 TL</div>
                    <p style="color:#999; font-size:13px; margin-top:8px;">MP3, WAV, FLAC</p>
                </div>
                <div class="type-card video" id="videoCard" onclick="App.selectType('video')">
                    <div style="font-size:3rem;">ğŸ¬</div>
                    <h3>TL4 Video</h3>
                    <div style="color:#ff5500; font-weight:700; margin-top:10px;">1ì´ˆ = 2 TL</div>
                    <p style="color:#999; font-size:13px; margin-top:8px;">MP4, MOV, AVI</p>
                </div>
            </div>

            <div class="upload" onclick="document.getElementById('fileInput').click()">
                <div style="font-size:3.5rem; margin-bottom:16px;" id="uploadIcon">ğŸµ</div>
                <h3 id="uploadTitle">íŒŒì¼ ì„ íƒí•˜ê¸°</h3>
                <p style="color:#999; margin-top:8px;" id="uploadDesc">MP3, WAV, FLAC</p>
            </div>

            <div id="uploadForm" style="display:none;">
                <div class="file-info-panel" style="background:rgba(138,43,226,0.1); border:1px solid #8a2be2; border-radius:12px; padding:16px; margin-bottom:20px;">
                    <div style="display:flex; justify-content:space-between; margin-bottom:8px; color:#999;"><span>íŒŒì¼ëª…</span><span style="color:#fff; font-weight:600;" id="infoFileName">-</span></div>
                    <div style="display:flex; justify-content:space-between; margin-bottom:8px; color:#999;"><span>íŒŒì¼ í¬ê¸°</span><span style="color:#fff; font-weight:600;" id="infoFileSize">-</span></div>
                    <div style="display:flex; justify-content:space-between; margin-bottom:8px; color:#999;"><span>ì¬ìƒ ì‹œê°„</span><span style="color:#fff; font-weight:600;" id="infoDuration">ê³„ì‚° ì¤‘...</span></div>
                    <div style="display:flex; justify-content:space-between; margin-bottom:8px; color:#999;"><span>ë³€í™˜ ìœ í˜•</span><span style="color:#fff; font-weight:600;" id="infoType">TL3 (ì˜¤ë””ì˜¤)</span></div>
                    <div style="margin-top:12px; text-align:center;"><span style="background:#8a2be2; color:white; padding:4px 12px; border-radius:999px; font-size:12px; font-weight:600;" id="durationBadge">-</span></div>
                </div>

                <div class="form-group"><label>ğŸ“ ì œëª©</label><input type="text" id="fileTitle" placeholder="íŒŒì¼ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”"></div>
                <div class="form-group"><label>ğŸ¤ ì°½ì‘ì ì´ë¦„</label><input type="text" id="fileCreator" placeholder="ì°½ì‘ì ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”"></div>
                <div class="form-group">
                    <label>ğŸ¤– AI ì°½ì‘ íˆ´ (ì¸ì¦)</label>
                    <select id="creatorTool">
                        <option value="suno">ğŸµ Suno AI (ìë™ ì¸ì¦)</option>
                        <option value="udio">ğŸµ Udio AI (ìë™ ì¸ì¦)</option>
                        <option value="custom">ğŸ¹ ì§ì ‘ ì‘ê³¡ (ìˆ˜ë™ ê²€í† )</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>ğŸ¼ ì¥ë¥´</label>
                    <select id="fileGenre">
                        <option value="pop">ğŸ¤ Pop</option><option value="rock">ğŸ¸ Rock</option>
                        <option value="hiphop">ğŸ§ Hip Hop</option><option value="jazz">ğŸº Jazz</option>
                        <option value="classic">ğŸ» Classic</option><option value="edm">ğŸ’¿ EDM</option>
                        <option value="kpop">ğŸ‡°ğŸ‡· K-Pop</option><option value="indie">ğŸ¹ Indie</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>ğŸ˜Œ ëŠë‚Œ (AI DJ íë ˆì´ì…˜)</label>
                    <select id="fileMood">
                        <option value="energetic">ğŸ”¥ Energetic</option><option value="chill">ğŸ˜Œ Chill</option>
                        <option value="focus">ğŸ¯ Focus</option><option value="workout">ğŸ’ª Workout</option>
                        <option value="romantic">ğŸ’• Romantic</option><option value="sad">ğŸ˜¢ Sad</option>
                        <option value="happy">ğŸ˜Š Happy</option><option value="sleep">ğŸ˜´ Sleep</option>
                    </select>
                </div>
                <div class="form-group"><label>ğŸ“ ì„¤ëª…</label><textarea id="fileDesc" rows="3" placeholder="íŒŒì¼ì— ëŒ€í•œ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea></div>
                <div class="form-group">
                    <label>ğŸ’° ìˆ˜ìµ ê³„ì•½</label>
                    <select id="revenue">
                        <option value="73" selected>7:3 (ì°½ì‘ì 70% / í”Œë«í¼ 30%)</option>
                        <option value="55">5:5 (ì°½ì‘ì 50% / í”Œë«í¼ 50%)</option>
                    </select>
                </div>
                <button class="btn btn-play" onclick="App.convert()" style="width:100%; padding:18px; font-size:1.1rem;">âœ¨ TL íŒŒì¼ë¡œ ë³€í™˜í•˜ê¸°</button>
            </div>
        </div>
    </div>

    <!-- My Files -->
    <div id="tabMyfiles" class="tab-content">
        <!-- Hero Banner -->
        <div class="tab-hero" style="background-image: url('https://images.unsplash.com/photo-1514320291840-2e0a9bf2a9ae?auto=format&fit=crop&w=2000&q=80');">
            <div class="tab-hero-content">
                <h2>ğŸµ My Files</h2>
                <p>ë‚´ TL3/TL4 íŒŒì¼ ê´€ë¦¬ â€¢ ì‹¤ì‹œê°„ ìˆ˜ìµ ì¶”ì  â€¢ ë¸”ë¡ì²´ì¸ ê²€ì¦</p>
            </div>
        </div>

        <div class="card">
            <div id="myFilesList" class="grid"></div>
        </div>
    </div>

    <!-- Share Place -->
    <div id="tabDiscover" class="tab-content active">
        <!-- Hero Banner -->
        <div class="tab-hero" style="background-image: url('https://images.unsplash.com/photo-1459749411175-04bf5292ceea?auto=format&fit=crop&w=2000&q=80');">
            <div class="tab-hero-content">
                <h2>ğŸ”„ Share Place</h2>
                <p>ê¸€ë¡œë²Œ ìŒì•… ë§ˆì¼“í”Œë ˆì´ìŠ¤ â€¢ TL3 ë‹¤ìš´ë¡œë“œ â€¢ ì°½ì‘ì ì§ì ‘ ì§€ì›</p>
            </div>
        </div>

        <div class="card">
            <div class="search-box">
                <span style="font-size:1.2rem;">ğŸ”</span>
                <input type="text" placeholder="ê²€ìƒ‰..." onkeyup="App.searchShare()">
            </div>
            <div class="genre-filter">
                <button class="genre-btn active" onclick="App.filterGenre('all')">ì „ì²´</button>
                <button class="genre-btn" onclick="App.filterGenre('pop')">ğŸ¤ Pop</button>
                <button class="genre-btn" onclick="App.filterGenre('rock')">ğŸ¸ Rock</button>
                <button class="genre-btn" onclick="App.filterGenre('hiphop')">ğŸ§ Hip Hop</button>
                <button class="genre-btn" onclick="App.filterGenre('jazz')">ğŸº Jazz</button>
                <button class="genre-btn" onclick="App.filterGenre('classic')">ğŸ» Classic</button>
                <button class="genre-btn" onclick="App.filterGenre('edm')">ğŸ’¿ EDM</button>
                <button class="genre-btn" onclick="App.filterGenre('kpop')">ğŸ‡°ğŸ‡· K-Pop</button>
                <button class="genre-btn" onclick="App.filterGenre('indie')">ğŸ¹ Indie</button>
            </div>
            <div id="sharePlaceContent"></div>
        </div>
    </div>

    <!-- Cafe Broadcasting -->
    <div id="tabCafe" class="tab-content">
        <div class="card">
            <h2>â˜• Cafe Broadcasting - AI DJ</h2>
            <p style="color:#999; margin-bottom:24px;">AI DJì—ê²Œ ì›í•˜ëŠ” ìŒì•… ë¶„ìœ„ê¸°ë¥¼ ë§í•´ë³´ì„¸ìš”</p>
            <div class="panel" style="background:rgba(138,43,226,0.1); border-color:#8a2be2;">
                <strong>ğŸ¤– AI DJì—ê²Œ ìš”ì²­í•˜ê¸°</strong><br>
                <div style="margin-top:12px;">
                    <textarea id="aiDjRequest" rows="3" placeholder="ì˜ˆì‹œ:&#10;- ì˜¤ëŠ˜ì€ ë¹„ ì˜¤ëŠ” ë‚  ë¶„ìœ„ê¸°ë¡œ ì¬ì¦ˆ ìŒì•… í‹€ì–´ì¤˜&#10;- í¬ë¦¬ìŠ¤ë§ˆìŠ¤ ëŠë‚Œì˜ ë”°ëœ»í•œ ìŒì•…&#10;- í™œê¸°ì°¬ ì•„ì¹¨ ìš´ë™í•  ë•Œ ë“£ê¸° ì¢‹ì€ ìŒì•…" style="width:100%; background:rgba(0,0,0,0.3); border:1px solid rgba(255,255,255,0.1); border-radius:8px; padding:12px; color:white; font-size:14px; resize:vertical;"></textarea>
                </div>
                <button class="btn btn-play" onclick="App.requestAiDj()" style="width:100%; margin-top:12px; padding:14px;">ğŸµ AI DJ íë ˆì´ì…˜ ì‹œì‘</button>
            </div>
            <div class="panel" style="margin-top:16px; background:rgba(101,67,33,0.1); border-color:#654321;">
                <strong>ğŸµ Now Playing</strong><br>
                <div style="font-size:1.3rem; font-weight:700; margin-top:8px; color:#8b5c2e;" id="cafeNowPlaying">AI DJ ëŒ€ê¸° ì¤‘...</div>
                <div style="color:#999; margin-top:4px; font-size:13px;" id="cafeCreator">-</div>
                <div style="margin-top:12px; padding-top:12px; border-top:1px solid rgba(255,255,255,0.05);">
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <span style="color:#999; font-size:13px;">AI íë ˆì´ì…˜</span>
                        <span style="font-weight:700; color:#8a2be2;" id="aiDjTheme">-</span>
                    </div>
                </div>
            </div>
            <div style="display:flex; gap:12px; margin-top:20px;">
                <button class="btn btn-play" onclick="App.startCafe()" style="flex:1; padding:16px;">â–¶ï¸ ì¬ìƒ</button>
                <button class="btn" onclick="App.skipCafeSong()" style="flex:1; background:#f59e0b; color:black; padding:16px;">â­ï¸ ë‹¤ìŒ ê³¡</button>
                <button class="btn" onclick="App.stopCafe()" style="flex:1; background:#f44; color:white; padding:16px;">â¹ï¸ ì •ì§€</button>
            </div>
        </div>
        <div class="card" style="margin-top:24px;">
            <h2>ğŸª ë“±ë¡ëœ ì¹´í˜ ê°¤ëŸ¬ë¦¬</h2>
            <div id="cafeGallery" style="display:grid; grid-template-columns:repeat(auto-fill,minmax(320px,1fr)); gap:20px;"></div>
        </div>
    </div>

    <!-- Car & Walk -->
    <div id="tabCar" class="tab-content">
        <div class="card">
            <h2>ğŸš—ğŸš¶ Car & Walk - ì´ë™ ì¤‘ AI DJ & 2ë°° ë³´ìƒ</h2>
            <div class="panel" style="background:rgba(59,130,246,0.1); border-color:#3b82f6;">
                <strong>ğŸƒ Movement AI ìƒíƒœ</strong><br>
                <div style="font-size:1.5rem; font-weight:800; margin-top:8px; color:#3b82f6;" id="movementStatus">ì •ì§€ ì¤‘</div>
                <div style="color:#999; font-size:13px; margin-top:4px;" id="movementType">-</div>
            </div>
            <div class="panel" style="margin-top:16px;">
                <strong>ğŸ’° í˜„ì¬ ë³´ìƒ ë°°ìœ¨</strong><br>
                <div style="font-size:2rem; font-weight:800; margin-top:8px;" id="rewardMultiplier">Ã—1.0</div>
            </div>
            <div class="panel" style="margin-top:16px;">
                <strong>ğŸµ í˜„ì¬ ì¬ìƒ ì¤‘</strong><br>
                <div style="font-size:1.2rem; font-weight:700; margin-top:8px;" id="carNowPlaying">ëŒ€ê¸° ì¤‘...</div>
                <div style="color:#999; margin-top:4px;" id="carCreator">-</div>
            </div>
            <div style="display:flex; gap:12px; margin-top:20px;">
                <button class="btn btn-play" onclick="App.startCarWalk()" style="flex:1; padding:18px;">ğŸš— ì´ë™ ëª¨ë“œ ì‹œì‘</button>
                <button class="btn" onclick="App.stopCarWalk()" style="flex:1; background:#f44; color:white; padding:18px;">â¹ï¸ ì •ì§€</button>
            </div>
        </div>
    </div>

    <!-- Mining -->
    <div id="tabMining" class="tab-content">
        <!-- Hero Banner -->
        <div class="tab-hero" style="background-image: url('https://images.unsplash.com/photo-1639762681485-074b7f938ba0?auto=format&fit=crop&w=2000&q=80');">
            <div class="tab-hero-content">
                <h2>â›ï¸ TLC Mining</h2>
                <p>TLì„ ì•”í˜¸í™”íë¡œ ë³€í™˜ â€¢ ê¸°ì—¬ë„ ê¸°ë°˜ ì±„êµ´ê¶Œ â€¢ TON ë¸”ë¡ì²´ì¸ í†µí•©</p>
            </div>
        </div>

        <div class="card">
            <h2>â›ï¸ TLC ì±„êµ´ - TLì„ ì•”í˜¸í™”íë¡œ ì „í™˜</h2>
            <p style="color:#999; margin-bottom:24px;">ê¸°ì—¬ë„ 10,000ì  ì´ìƒì¼ ë•Œ TLì„ TLC ì•”í˜¸í™”íë¡œ ë³€í™˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</p>

            <!-- ì±„êµ´ ìê²© í™•ì¸ -->
            <div id="miningEligibility" style="background: linear-gradient(135deg, rgba(138,43,226,0.15), rgba(29,185,84,0.05)); padding: 24px; border-radius: 16px; margin-bottom: 24px; border: 2px solid #8a2be2; text-align: center;">
                <div style="font-size: 0.9rem; color: #999; margin-bottom: 8px;">ë‚´ ê¸°ì—¬ë„ ì ìˆ˜</div>
                <div style="font-size: 3rem; font-weight: 900; margin-bottom: 16px;" id="miningContributionScore">
                    <span id="miningScoreValue">0</span><span style="font-size: 1.5rem; color: #999;">ì </span>
                </div>
                <div id="miningStatus" style="font-size: 1.1rem; padding: 12px; border-radius: 8px; background: rgba(239,68,68,0.1); color: #ef4444; border: 1px solid #ef4444;">
                    âŒ ê¸°ì—¬ë„ 10,000ì  ì´ìƒ í•„ìš” (í˜„ì¬: <span id="miningScoreStatus">0</span>ì )
                </div>
            </div>

            <!-- ì±„êµ´ ì„¤ì • -->
            <div style="background: rgba(0,0,0,0.3); padding: 24px; border-radius: 16px; border: 1px solid rgba(255,255,255,0.1); margin-bottom: 24px;">
                <h3 style="margin-bottom: 20px; color: #f59e0b;">âš™ï¸ ì±„êµ´ ì„¤ì •</h3>

                <!-- ê¸°ì—¬ ì§€ìˆ˜ -->
                <div class="panel" style="margin-bottom: 16px;">
                    <strong>ğŸ“Š ê¸°ì—¬ ì§€ìˆ˜ (CI)</strong><br>
                    <span style="font-size:2.5rem; font-weight:800; color:#1db954;" id="ciValue">1.00x</span>
                    <div style="color:#999; font-size:0.85rem; margin-top:8px;">ê¸°ì—¬ë„ê°€ ë†’ì„ìˆ˜ë¡ CIê°€ ì¦ê°€í•©ë‹ˆë‹¤</div>
                </div>

                <!-- ë³€í™˜ ë¹„ìœ¨ -->
                <div style="background: rgba(138,43,226,0.1); padding: 16px; border-radius: 12px; margin-bottom: 16px; border-left: 4px solid #8a2be2;">
                    <div style="font-size: 0.85rem; color: #999; margin-bottom: 8px;">ë³€í™˜ ë¹„ìœ¨</div>
                    <div style="font-size: 1.3rem; font-weight: 700; color: #b983ff;">
                        1,000 TL = 1 TLC Ã— <span id="ciValueDisplay">1.00</span>x
                    </div>
                    <div style="color: #999; font-size: 0.85rem; margin-top: 8px;">
                        í”Œë«í¼ ìˆ˜ìˆ˜ë£Œ 10% (ê¸ˆ êµ¬ë§¤ì— ì‚¬ìš©)
                    </div>
                </div>

                <!-- TL ì…ë ¥ -->
                <div class="form-group">
                    <label>ì±„êµ´í•  TL (ìµœëŒ€: <span id="miningMax" style="color:#1db954; font-weight:700;">5000</span> TL)</label>
                    <input type="number" id="miningAmount" value="1000" min="1000" step="1000" style="font-size: 1.2rem; padding: 16px;">
                </div>

                <!-- ë³€í™˜ ê²°ê³¼ ë¯¸ë¦¬ë³´ê¸° -->
                <div style="background: rgba(29,185,84,0.1); padding: 16px; border-radius: 12px; border-left: 4px solid #1db954; margin-bottom: 16px;">
                    <div style="font-size: 0.85rem; color: #999; margin-bottom: 8px;">ì±„êµ´ ì˜ˆìƒ ê²°ê³¼</div>
                    <div style="display: grid; grid-template-columns: 1fr auto 1fr; gap: 16px; align-items: center;">
                        <div style="text-align: center;">
                            <div style="color: #999; font-size: 0.85rem;">ì†Œë¹„ TL</div>
                            <div style="font-size: 1.8rem; font-weight: 800; color: #ef4444;" id="miningInputTL">1000</div>
                        </div>
                        <div style="font-size: 2rem; color: #1db954;">â†’</div>
                        <div style="text-align: center;">
                            <div style="color: #999; font-size: 0.85rem;">íšë“ TLC</div>
                            <div style="font-size: 1.8rem; font-weight: 800; color: #1db954;" id="miningOutputTLC">1.00</div>
                        </div>
                    </div>
                    <div style="text-align: center; margin-top: 12px; color: #999; font-size: 0.9rem;">
                        ì˜ˆìƒ ê°€ì¹˜: $<span id="miningUsdValue">2.50</span> (1 TLC = $2.50)
                    </div>
                </div>

                <!-- ì±„êµ´ ë²„íŠ¼ -->
                <button id="miningButton" class="btn btn-play" onclick="App.mine()" style="width:100%; padding:20px; font-size:1.1rem; font-weight:700;" disabled>
                    â›ï¸ TLC ì±„êµ´ ì‹œì‘
                </button>
            </div>

            <!-- ì±„êµ´ í†µê³„ -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
                <div class="stat-card">
                    <div class="stat-label">ì´ ì±„êµ´ëŸ‰</div>
                    <div class="stat-value" id="totalMinedTLC">0.00 TLC</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">í˜„ì¬ TLC ê°€ì¹˜</div>
                    <div class="stat-value" style="color: #f59e0b;">$2.50</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">ê¸ˆ ë‹´ë³´ ê°€ì¹˜</div>
                    <div class="stat-value" id="goldBackedPrice">$1.50</div>
                </div>
            </div>

            <!-- ì±„êµ´ ì„¤ëª… -->
            <div style="background: rgba(138,43,226,0.05); padding: 20px; border-radius: 12px; margin-top: 24px; border-left: 4px solid #8a2be2;">
                <h4 style="margin-bottom: 12px; color: #b983ff;">ğŸ’¡ TLC ì±„êµ´ì´ë€?</h4>
                <ul style="color: #999; line-height: 2; padding-left: 20px;">
                    <li>TLì€ í”Œë«í¼ ë‚´ ìœ í‹¸ë¦¬í‹° í† í° (ì†Œëª¨í’ˆ)</li>
                    <li>TLCëŠ” TON ë¸”ë¡ì²´ì¸ ì•”í˜¸í™”í (ìì‚°)</li>
                    <li>ê¸°ì—¬ë„ 10,000ì  ì´ìƒì¼ ë•Œ ì±„êµ´ ê°€ëŠ¥</li>
                    <li>í”Œë«í¼ ìˆ˜ìµì˜ 10%ë¡œ ê¸ˆ êµ¬ë§¤ â†’ TLC ê°€ì¹˜ ì•ˆì •</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Lecture -->
    <div id="tabLecture" class="tab-content">
        <div class="card">
            <h2>ğŸ“š Lecture - êµìœ¡ ì½˜í…ì¸ </h2>
            <div class="panel" style="background:rgba(168,85,247,0.1); border-color:#a855f7;">
                <strong>ğŸ“ í•™ìŠµ ì§„í–‰ë¥ </strong><br>
                <div style="margin-top:12px;">
                    <div style="background:rgba(255,255,255,0.1); height:24px; border-radius:12px; overflow:hidden;">
                        <div id="lectureProgress" style="background:linear-gradient(90deg,#a855f7,#ec4899); height:100%; width:0%; transition:width 0.3s;"></div>
                    </div>
                    <div style="text-align:center; margin-top:8px; font-weight:700;" id="lectureProgressText">0%</div>
                </div>
            </div>
            <div class="panel" style="margin-top:16px;"><strong>ğŸµ í˜„ì¬ ê°•ì˜</strong><br><div style="font-size:1.2rem; font-weight:700; margin-top:8px;" id="lectureNowPlaying">ê°•ì˜ ì„ íƒ ëŒ€ê¸° ì¤‘...</div><div style="color:#999; margin-top:4px;" id="lectureCreator">-</div></div>
            <div style="display:flex; gap:12px; margin-top:20px;">
                <button class="btn btn-play" onclick="App.startLecture()" style="flex:1; padding:18px;">ğŸ“š ê°•ì˜ ì‹œì‘</button>
                <button class="btn" onclick="App.stopLecture()" style="flex:1; background:#f44; color:white; padding:18px;">â¹ï¸ ì •ì§€</button>
            </div>
        </div>
    </div>

    <!-- Gold Reserve -->
    <div id="tabGold" class="tab-content">
        <!-- Hero Banner -->
        <div class="tab-hero" style="background-image: url('https://images.unsplash.com/photo-1610375461246-83df859d849d?auto=format&fit=crop&w=2000&q=80');">
            <div class="tab-hero-content">
                <h2>ğŸ’° Gold Reserve</h2>
                <p>ì‹¤ë¬¼ ê¸ˆ ë°±ì—… ì‹œìŠ¤í…œ â€¢ TLC ê°€ê²© ì•ˆì •í™” â€¢ í”Œë«í¼ ìˆ˜ìµ 10% ìë™ ë§¤ì…</p>
            </div>
        </div>

        <div class="card">
            <h2>ğŸ’° Gold Reserve - TLC ê°€ì¹˜ ì•ˆì • ì‹œìŠ¤í…œ</h2>
            <p style="color:#999; margin-bottom:24px;">í”Œë«í¼ ìˆ˜ìµì˜ 10%ë¥¼ ê¸ˆìœ¼ë¡œ ë§¤ì…í•˜ì—¬ TLC ê°€ì¹˜ë¥¼ ì•ˆì •ì ìœ¼ë¡œ ìœ ì§€í•©ë‹ˆë‹¤</p>

            <!-- ê¸ˆ ë³´ìœ  í˜„í™© -->
            <div style="background: linear-gradient(135deg, rgba(255,215,0,0.15), rgba(245,158,11,0.05)); padding: 32px; border-radius: 20px; margin-bottom: 24px; border: 2px solid #ffd700; text-align: center;">
                <div style="font-size: 0.9rem; color: #999; margin-bottom: 8px;">ì´ ê¸ˆ ë³´ìœ ëŸ‰</div>
                <div style="font-size: 3.5rem; font-weight: 900; color: #ffd700; margin-bottom: 16px;">
                    <span id="goldAmountKg">0.000</span> <span style="font-size: 1.8rem;">kg</span>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-top: 24px;">
                    <div style="background: rgba(0,0,0,0.3); padding: 16px; border-radius: 12px;">
                        <div style="color: #999; font-size: 0.85rem; margin-bottom: 4px;">ì˜¨ìŠ¤</div>
                        <div style="font-size: 1.5rem; font-weight: 700; color: #ffd700;"><span id="goldAmountOz">0.00</span> oz</div>
                    </div>
                    <div style="background: rgba(0,0,0,0.3); padding: 16px; border-radius: 12px;">
                        <div style="color: #999; font-size: 0.85rem; margin-bottom: 4px;">ì‹œê°€ ì´ì•¡</div>
                        <div style="font-size: 1.5rem; font-weight: 700; color: #ffd700;">$<span id="goldValueUsd">0</span></div>
                    </div>
                </div>
            </div>

            <!-- TLC ê°€ê²© ì•ˆì •ì„± -->
            <div style="background: rgba(0,0,0,0.3); padding: 24px; border-radius: 16px; margin-bottom: 24px; border: 1px solid rgba(255,255,255,0.1);">
                <h3 style="margin-bottom: 20px; color: #1db954;">ğŸ“Š TLC ê°€ê²© ì•ˆì •ì„±</h3>

                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 20px;">
                    <div style="background: rgba(29,185,84,0.1); padding: 16px; border-radius: 12px; border-left: 4px solid #1db954;">
                        <div style="font-size: 0.85rem; color: #999; margin-bottom: 4px;">ì‹œì¥ ê°€ê²©</div>
                        <div style="font-size: 1.8rem; font-weight: 800; color: #1db954;">$2.50</div>
                    </div>

                    <div style="background: rgba(255,215,0,0.1); padding: 16px; border-radius: 12px; border-left: 4px solid #ffd700;">
                        <div style="font-size: 0.85rem; color: #999; margin-bottom: 4px;">ê¸ˆ ë‹´ë³´ ê°€ê²©</div>
                        <div style="font-size: 1.8rem; font-weight: 800; color: #ffd700;">$<span id="goldBackedPriceGold">1.50</span></div>
                    </div>

                    <div style="background: rgba(138,43,226,0.1); padding: 16px; border-radius: 12px; border-left: 4px solid #8a2be2;">
                        <div style="font-size: 0.85rem; color: #999; margin-bottom: 4px;">TLC ì´ ë°œí–‰ëŸ‰</div>
                        <div style="font-size: 1.8rem; font-weight: 800; color: #b983ff;"><span id="totalTlcSupply">0</span></div>
                    </div>
                </div>

                <div style="background: rgba(138,43,226,0.05); padding: 16px; border-radius: 12px; border-left: 4px solid #8a2be2;">
                    <div style="color: #b983ff; font-weight: 600; margin-bottom: 8px;">ğŸ’¡ ê°€ê²© ì•ˆì • ë©”ì»¤ë‹ˆì¦˜</div>
                    <div style="color: #999; font-size: 0.9rem; line-height: 1.6;">
                        ê¸ˆ ë‹´ë³´ ê°€ê²© = ê¸ˆ ë³´ìœ ëŸ‰ Ã— ê¸ˆ ì‹œì„¸ Ã· TLC ì´ ë°œí–‰ëŸ‰<br>
                        ì‹œì¥ ê°€ê²©ì´ ê¸ˆ ë‹´ë³´ ê°€ê²© ì•„ë˜ë¡œ ë–¨ì–´ì§€ë©´ í”Œë«í¼ì´ ìë™ ë§¤ì…í•˜ì—¬ ê°€ê²© ë°©ì–´
                    </div>
                </div>
            </div>

            <!-- ì›”ë³„ ê¸ˆ ë§¤ì… í†µê³„ -->
            <div style="background: rgba(0,0,0,0.3); padding: 24px; border-radius: 16px; margin-bottom: 24px; border: 1px solid rgba(255,255,255,0.1);">
                <h3 style="margin-bottom: 20px; color: #f59e0b;">ğŸ“ˆ ê¸ˆ ë§¤ì… ë‚´ì—­</h3>

                <div style="display: grid; gap: 12px;">
                    <div class="contribution-item">
                        <div class="contribution-icon">ğŸ“…</div>
                        <div class="contribution-info">
                            <div class="contribution-title">ì´ë²ˆ ë‹¬ ë§¤ì…</div>
                            <div style="color: #999; font-size: 0.9rem;">í”Œë«í¼ ìˆ˜ìµ: $<span id="monthlyRevenue">0</span> â†’ ê¸ˆ ë§¤ì…: $<span id="monthlyGoldPurchase">0</span></div>
                        </div>
                        <div style="font-weight: 700; color: #ffd700; font-size: 1.2rem;"><span id="monthlyGoldAmount">0.00</span> g</div>
                    </div>

                    <div class="contribution-item">
                        <div class="contribution-icon">ğŸ“Š</div>
                        <div class="contribution-info">
                            <div class="contribution-title">ëˆ„ì  ë§¤ì…</div>
                            <div style="color: #999; font-size: 0.9rem;">ì´ í”Œë«í¼ ìˆ˜ìµ: $<span id="totalRevenue">0</span></div>
                        </div>
                        <div style="font-weight: 700; color: #ffd700; font-size: 1.2rem;"><span id="totalGoldPurchased">0.00</span> g</div>
                    </div>
                </div>
            </div>

            <!-- ê¸ˆ ê°€ê²© ì°¨íŠ¸ -->
            <div style="margin-top:24px; display:flex; gap:12px; justify-content:center;">
                <button class="genre-btn" onclick="App.setGoldPeriod('day')" id="goldDay">ì¼ê°„</button>
                <button class="genre-btn active" onclick="App.setGoldPeriod('week')" id="goldWeek">ì£¼ê°„</button>
                <button class="genre-btn" onclick="App.setGoldPeriod('month')" id="goldMonth">ì›”ê°„</button>
                <button class="genre-btn" onclick="App.setGoldPeriod('year')" id="goldYear">ì—°ê°„</button>
            </div>
            <div style="margin-top:20px; background:rgba(0,0,0,0.3); padding:20px; border-radius:16px;">
                <canvas id="goldChart" width="600" height="300" style="max-width:100%;"></canvas>
            </div>

            <!-- 5ë…„ ì‹œë®¬ë ˆì´ì…˜ -->
            <div style="background: rgba(29,185,84,0.05); padding: 20px; border-radius: 12px; margin-top: 24px; border-left: 4px solid #1db954;">
                <h4 style="margin-bottom: 12px; color: #1db954;">ğŸš€ 5ë…„ ì‹œë®¬ë ˆì´ì…˜</h4>
                <div style="color: #999; line-height: 2; font-size: 0.95rem;">
                    <div style="margin-bottom: 8px;">Year 1: ì›” $15k ìˆ˜ìµ â†’ $18k ê¸ˆ ë§¤ì… â†’ <strong style="color: #ffd700;">9g ë³´ìœ </strong></div>
                    <div style="margin-bottom: 8px;">Year 3: ì›” $2M ìˆ˜ìµ â†’ $2.4M ê¸ˆ ë§¤ì… â†’ <strong style="color: #ffd700;">1.2kg ë³´ìœ </strong></div>
                    <div>Year 5: ì›” $40M ìˆ˜ìµ â†’ $48M ê¸ˆ ë§¤ì… â†’ <strong style="color: #ffd700;">2.4í†¤ ë³´ìœ  ($90M)</strong></div>
                </div>
            </div>
        </div>
    </div>

    <!-- TLC Wallet -->
    <div id="tabTon" class="tab-content">
        <div class="card">
            <h2>â›ï¸ Mining & TLC Wallet</h2>
            <div class="panel" style="background:rgba(138,43,226,0.1); border-color:#8a2be2;">
                <strong>ğŸ’ TLC ì§€ê°‘</strong><br>
                <div style="font-size:2.5rem; font-weight:800; color:#8a2be2; margin-top:8px;" id="tlcWalletAmount">0.00 TLC</div>
                <div style="color:#999; font-size:13px; margin-top:8px;">â‰ˆ $<span id="tlcUsdValue">0.00</span> USD</div>
            </div>
            <div style="margin-top:24px;">
                <h3 style="font-size:1.2rem; margin-bottom:16px;">â›ï¸ TLC ì±„êµ´</h3>
                <div class="panel"><strong>ê¸°ì—¬ ì§€ìˆ˜ (CI)</strong><br><span style="font-size:2rem; font-weight:800;" id="ciValueWallet">1.00x</span></div>
                <div class="form-group" style="margin-top:16px;">
                    <label>ì±„êµ´í•  TL (ìµœëŒ€: <span id="miningMaxWallet">5000</span> TL)</label>
                    <input type="number" id="miningAmountWallet" value="100" min="1">
                </div>
                <button class="btn btn-play" onclick="App.mineToWallet()" style="width:100%; padding:18px;">â›ï¸ TLC ì±„êµ´í•˜ê¸°</button>
            </div>
            <div style="margin-top:32px; padding-top:24px; border-top:1px solid rgba(255,255,255,0.1);">
                <h3 style="font-size:1.2rem; margin-bottom:16px;">â¬¡ TON ë¸”ë¡ì²´ì¸ ì „ì†¡</h3>
                <div class="form-group"><label>TON ì§€ê°‘ ì£¼ì†Œ</label><input type="text" id="tonWalletAddress" placeholder="UQxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"></div>
                <div class="form-group"><label>ì „ì†¡í•  TLC</label><input type="number" id="tonTransferAmount" placeholder="0.00" step="0.01" min="0.01"></div>
                <button class="btn" onclick="App.transferToTon()" style="width:100%; background:#0098ea; color:white; padding:18px;">â¬¡ TONìœ¼ë¡œ ì „ì†¡</button>
            </div>
            <div style="margin-top:32px; padding-top:24px; border-top:1px solid rgba(255,255,255,0.1);">
                <h3 style="font-size:1.2rem; margin-bottom:16px;">ğŸ“œ ê±°ë˜ ë‚´ì—­</h3>
                <div id="walletHistory" style="max-height:200px; overflow-y:auto;"><div style="text-align:center; padding:40px; color:#666;">ì•„ì§ ê±°ë˜ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤</div></div>
            </div>
        </div>
    </div>

</div>

</div>

<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
// ==================== GLOBAL BLOCKCHAIN REGISTRY ====================
const BlockchainRegistry = {
    // ë¸”ë¡ì²´ì¸ í•´ì‹œ â†’ ìµœì´ˆ ì—…ë¡œë” ì •ë³´
    registry: {},

    init() {
        const saved = localStorage.getItem('blockchain_registry');
        if (saved) {
            try {
                this.registry = JSON.parse(saved);
            } catch (e) {
                this.registry = {};
            }
        }
    },

    save() {
        localStorage.setItem('blockchain_registry', JSON.stringify(this.registry));
    },

    // ë¸”ë¡ì²´ì¸ í•´ì‹œ ë“±ë¡ (ìµœì´ˆ ì—…ë¡œë”)
    register(blockchainHash, creator) {
        if (this.registry[blockchainHash]) {
            return false; // ì´ë¯¸ ë“±ë¡ë¨
        }
        this.registry[blockchainHash] = {
            creator: creator.email || creator,
            creatorName: creator.name || 'Unknown',
            timestamp: Date.now()
        };
        this.save();
        return true;
    },

    // ë¸”ë¡ì²´ì¸ í•´ì‹œ ì²´í¬
    check(blockchainHash) {
        return this.registry[blockchainHash] || null;
    },

    // í˜„ì¬ ì‚¬ìš©ìê°€ ìµœì´ˆ ì—…ë¡œë”ì¸ì§€ í™•ì¸
    isOriginalCreator(blockchainHash, userEmail) {
        const record = this.registry[blockchainHash];
        if (!record) return false;
        return record.creator === userEmail;
    }
};

// ==================== TL3 CONFIGURATION ====================
const TL3_CONFIG = {
    version: "1.0.0",
    // Supabase (ë¬´ë£Œ í‹°ì–´ - ë‚˜ì¤‘ì— ìì‹ ì˜ í”„ë¡œì íŠ¸ë¡œ êµì²´)
    supabase: {
        url: 'https://your-project.supabase.co', // TODO: êµì²´ í•„ìš”
        key: 'your-anon-key' // TODO: êµì²´ í•„ìš”
    },
    // Web3.Storage for IPFS (ë¬´ë£Œ 100GB)
    ipfs: {
        token: 'your-web3-storage-token' // TODO: https://web3.storage ì—ì„œ ë°œê¸‰
    },
    // TON Blockchain
    ton: {
        network: 'testnet', // í…ŒìŠ¤íŠ¸ë„· ì‚¬ìš© (ë¬´ë£Œ)
        manifestUrl: 'https://yourusername.github.io/timelink/tonconnect-manifest.json'
    }
};

// ==================== TL3 FILE FORMAT ====================
const TL3 = {
    // TL3 ë©”íƒ€ë°ì´í„° ìƒì„±
    createMetadata(file, creator, options = {}) {
        return {
            version: TL3_CONFIG.version,
            format: file.type.startsWith('video') ? 'TL4' : 'TL3',
            creator: creator.wallet || creator.email,
            creatorName: creator.name,
            title: options.title || file.name,
            timestamp: Date.now(),
            duration: options.duration || 0,
            fileSize: file.size,
            mimeType: file.type,
            aiTool: options.aiTool || 'custom',
            genre: options.genre || 'unknown',
            mood: options.mood || 'neutral',
            revenueShare: options.revenueShare || 70,
            certified: options.aiTool === 'suno' || options.aiTool === 'udio',
            description: options.description || '',
        };
    },

    // ë¸”ë¡ì²´ì¸ í•´ì‹œ ìƒì„±
    async createBlockchainHash(metadata) {
        const dataString = JSON.stringify({
            creator: metadata.creator,
            timestamp: metadata.timestamp,
            title: metadata.title,
            duration: metadata.duration
        });
        
        // SHA-256 í•´ì‹œ
        const hash = CryptoJS.SHA256(dataString).toString();
        return `0x${hash}`;
    },

    // IPFS ì—…ë¡œë“œ (Web3.Storage)
    async uploadToIPFS(file, metadata) {
        try {
            // TODO: ì‹¤ì œ IPFS ì—…ë¡œë“œ êµ¬í˜„
            // ì§€ê¸ˆì€ ì‹œë®¬ë ˆì´ì…˜
            console.log('ğŸ“¦ IPFS ì—…ë¡œë“œ ì‹œë®¬ë ˆì´ì…˜:', metadata.title);
            
            // ê°€ìƒ CID ìƒì„±
            const fakeCID = 'Qm' + CryptoJS.SHA256(metadata.title + Date.now()).toString().substring(0, 44);
            
            return {
                cid: fakeCID,
                url: `https://ipfs.io/ipfs/${fakeCID}`,
                gateway: `https://${fakeCID}.ipfs.w3s.link`
            };
        } catch (error) {
            console.error('IPFS ì—…ë¡œë“œ ì˜¤ë¥˜:', error);
            throw error;
        }
    },

    // Supabaseì— ë“±ë¡
    async registerToDatabase(metadata, ipfsData) {
        try {
            // TODO: Supabase í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™” í›„ ì‹¤ì œ êµ¬í˜„
            console.log('ğŸ’¾ ë°ì´í„°ë² ì´ìŠ¤ ë“±ë¡ ì‹œë®¬ë ˆì´ì…˜');
            
            const record = {
                blockchain_hash: metadata.blockchainHash,
                creator_wallet: metadata.creator,
                creator_name: metadata.creatorName,
                title: metadata.title,
                ipfs_cid: ipfsData.cid,
                ipfs_url: ipfsData.url,
                duration: metadata.duration,
                revenue_share: metadata.revenueShare,
                ai_tool: metadata.aiTool,
                certified: metadata.certified,
                created_at: new Date(metadata.timestamp).toISOString()
            };
            
            // localStorageì— ì„ì‹œ ì €ì¥ (MVPìš©)
            const records = JSON.parse(localStorage.getItem('tl3_registry') || '[]');
            records.push(record);
            localStorage.setItem('tl3_registry', JSON.stringify(records));
            
            return record;
        } catch (error) {
            console.error('ë°ì´í„°ë² ì´ìŠ¤ ë“±ë¡ ì˜¤ë¥˜:', error);
            throw error;
        }
    },

    // TL3 íŒŒì¼ ìƒì„± (ë©”íƒ€ë°ì´í„° ì„ë² ë”©)
    async createTL3File(audioBuffer, metadata, ipfsData) {
        // ë©”íƒ€ë°ì´í„°ë¥¼ JSONìœ¼ë¡œ ì§ë ¬í™”
        const metadataJSON = JSON.stringify({
            ...metadata,
            ipfs: ipfsData
        });
        
        // ë©”íƒ€ë°ì´í„°ë¥¼ base64ë¡œ ì¸ì½”ë”©
        const metadataBase64 = btoa(unescape(encodeURIComponent(metadataJSON)));
        
        // TL3 íŒŒì¼ êµ¬ì¡°:
        // [METADATA_MARKER][ë©”íƒ€ë°ì´í„° ê¸¸ì´(4ë°”ì´íŠ¸)][ë©”íƒ€ë°ì´í„°][ì›ë³¸ ì˜¤ë””ì˜¤]
        const marker = new TextEncoder().encode('TL3:');
        const metadataBytes = new TextEncoder().encode(metadataBase64);
        const metadataLength = new Uint32Array([metadataBytes.length]);
        
        // ê²°í•©
        const tl3File = new Blob([
            marker,
            metadataLength,
            metadataBytes,
            audioBuffer
        ], { type: metadata.mimeType });
        
        return tl3File;
    },

    // TL3 íŒŒì¼ì—ì„œ ë©”íƒ€ë°ì´í„° ì¶”ì¶œ
    async extractMetadata(tl3File) {
        try {
            const buffer = await tl3File.arrayBuffer();
            const view = new DataView(buffer);
            
            // ë§ˆì»¤ í™•ì¸
            const markerBytes = new Uint8Array(buffer, 0, 4);
            const marker = new TextDecoder().decode(markerBytes);
            
            if (marker !== 'TL3:') {
                throw new Error('ì˜¬ë°”ë¥¸ TL3 íŒŒì¼ì´ ì•„ë‹™ë‹ˆë‹¤');
            }
            
            // ë©”íƒ€ë°ì´í„° ê¸¸ì´ ì½ê¸°
            const metadataLength = view.getUint32(4, true);
            
            // ë©”íƒ€ë°ì´í„° ì½ê¸°
            const metadataBytes = new Uint8Array(buffer, 8, metadataLength);
            const metadataBase64 = new TextDecoder().decode(metadataBytes);
            const metadataJSON = decodeURIComponent(escape(atob(metadataBase64)));
            const metadata = JSON.parse(metadataJSON);
            
            // ì›ë³¸ ì˜¤ë””ì˜¤ ì¶”ì¶œ
            const audioStart = 8 + metadataLength;
            const audioBuffer = buffer.slice(audioStart);
            
            return {
                metadata,
                audioBuffer,
                audioBlob: new Blob([audioBuffer], { type: metadata.mimeType })
            };
        } catch (error) {
            console.error('ë©”íƒ€ë°ì´í„° ì¶”ì¶œ ì˜¤ë¥˜:', error);
            throw error;
        }
    },

    // ë¸”ë¡ì²´ì¸ ê²€ì¦
    async verifyOnBlockchain(blockchainHash) {
        try {
            // TODO: ì‹¤ì œ TON ë¸”ë¡ì²´ì¸ ê²€ì¦
            console.log('ğŸ” ë¸”ë¡ì²´ì¸ ê²€ì¦:', blockchainHash);
            
            // ì§€ê¸ˆì€ ë¡œì»¬ ë ˆì§€ìŠ¤íŠ¸ë¦¬ì—ì„œ í™•ì¸
            const records = JSON.parse(localStorage.getItem('tl3_registry') || '[]');
            const exists = records.some(r => r.blockchain_hash === blockchainHash);
            
            return exists;
        } catch (error) {
            console.error('ë¸”ë¡ì²´ì¸ ê²€ì¦ ì˜¤ë¥˜:', error);
            return false;
        }
    },

    // TL3 íŒŒì¼ ë‹¤ìš´ë¡œë“œ
    downloadFile(blob, filename) {
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    }
};

// ==================== INDEXEDDB HELPER ====================
const DB = {
    dbName: 'TimeLinkDB',
    storeName: 'files',
    db: null,
    blobUrls: {},

    async reset() {
        if (this.db) { this.db.close(); this.db = null; }
        this.revokeAllBlobUrls();
        return new Promise((resolve, reject) => {
            const request = indexedDB.deleteDatabase(this.dbName);
            request.onsuccess = () => resolve();
            request.onerror = () => reject(request.error);
            request.onblocked = () => console.warn('IndexedDB ì‚­ì œê°€ ì°¨ë‹¨ë¨');
        });
    },

    async open() {
        return new Promise((resolve, reject) => {
            const request = indexedDB.open(this.dbName, 4);
            request.onerror = () => reject(request.error);
            request.onsuccess = () => { this.db = request.result; resolve(); };
            request.onupgradeneeded = (event) => {
                const db = event.target.result;
                if (db.objectStoreNames.contains(this.storeName)) db.deleteObjectStore(this.storeName);
                db.createObjectStore(this.storeName, { keyPath: 'id' });
            };
        });
    },

    async saveFile(fileData) {
        if (!this.db) await this.open();
        return new Promise((resolve, reject) => {
            const tx = this.db.transaction([this.storeName], 'readwrite');
            const request = tx.objectStore(this.storeName).put(fileData);
            request.onsuccess = () => resolve();
            request.onerror = () => reject(request.error);
        });
    },

    async getFile(id) {
        if (!this.db) await this.open();
        return new Promise((resolve, reject) => {
            const tx = this.db.transaction([this.storeName], 'readonly');
            const request = tx.objectStore(this.storeName).get(id);
            request.onsuccess = () => resolve(request.result);
            request.onerror = () => reject(request.error);
        });
    },

    async deleteFile(id) {
        if (!this.db) await this.open();
        if (this.blobUrls[id]) { URL.revokeObjectURL(this.blobUrls[id]); delete this.blobUrls[id]; }
        return new Promise((resolve, reject) => {
            const tx = this.db.transaction([this.storeName], 'readwrite');
            const request = tx.objectStore(this.storeName).delete(id);
            request.onsuccess = () => resolve();
            request.onerror = () => reject(request.error);
        });
    },

    async getBlobUrl(id, mimeType) {
        if (this.blobUrls[id]) return this.blobUrls[id];
        const fileData = await this.getFile(id);
        if (!fileData || !fileData.arrayBuffer) throw new Error('íŒŒì¼ ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.');
        const blob = new Blob([fileData.arrayBuffer], { type: mimeType });
        const blobUrl = URL.createObjectURL(blob);
        this.blobUrls[id] = blobUrl;
        return blobUrl;
    },

    revokeAllBlobUrls() {
        Object.values(this.blobUrls).forEach(url => URL.revokeObjectURL(url));
        this.blobUrls = {};
    }
};

// ==================== AUTH ====================
const Auth = {
    currentUser: null,

    async init() {
        try {
            await DB.open();
        } catch (error) {
            if (error.name === 'VersionError') { await DB.reset(); await DB.open(); }
            else throw error;
        }
        const savedUser = localStorage.getItem('timelink_current_user');
        if (savedUser) {
            this.currentUser = JSON.parse(savedUser);
            await App.loadUserData();
            this.showMainApp();
        } else {
            this.showLoginScreen();
        }
    },

    showLoginScreen() {
        document.getElementById('authScreen').style.display = 'flex';
        document.getElementById('mainApp').style.display = 'none';
    },

    showMainApp() {
        document.getElementById('authScreen').style.display = 'none';
        document.getElementById('mainApp').style.display = 'block';
        document.getElementById('userName').textContent = this.currentUser.name;
        App.loadUserData();  // ì‚¬ìš©ì ë°ì´í„° ë¡œë“œ (wallet í¬í•¨)
        App.updateAll();
    },

    toggleBusinessInfo() {
        const type = document.getElementById('accountType').value;
        document.getElementById('businessInfo').style.display = type === 'business' ? 'block' : 'none';
    },

    async register() {
        try {
            console.log('ğŸ¯ íšŒì›ê°€ì… ì‹œì‘');
            const name = document.getElementById('regName').value.trim();
            const email = document.getElementById('regEmail').value.trim().toLowerCase();
            const password = document.getElementById('regPassword').value;
            const accountType = document.getElementById('accountType').value;

            console.log('ì…ë ¥ê°’:', { name, email, accountType });

            if (!name || !email || !password) return this.showAuthMessage('ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”', 'error');
            if (password.length < 6) return this.showAuthMessage('ë¹„ë°€ë²ˆí˜¸ëŠ” ìµœì†Œ 6ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤', 'error');

            const users = this.getAllUsers();
            if (users[email]) return this.showAuthMessage('ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì´ë©”ì¼ì…ë‹ˆë‹¤', 'error');

            // âœ… ì‹ ê·œ ê°€ì… ì‹œ 10,000 TL ì§€ê¸‰
            const newUser = {
                name, email, password,
                accountType: accountType || 'personal',
                createdAt: Date.now(),
                wallet: { tl: 10000, tlc: 0 },  // ê°€ì… ë³´ë„ˆìŠ¤ 10,000 TL
                files: [],
                gold: 0,
                adWatchedToday: 0,
                adLastDate: new Date().toDateString()
            };

            if (accountType === 'business') {
                newUser.cafeInfo = {
                    name: document.getElementById('cafeName').value.trim() || '',
                    location: document.getElementById('cafeLocation').value.trim() || '',
                    description: document.getElementById('cafeDescription').value.trim() || '',
                    image: document.getElementById('cafeImage').value.trim() || '',
                    hours: document.getElementById('cafeHours').value.trim() || '',
                    comments: []
                };
            }

            console.log('âœ… ì‚¬ìš©ì ìƒì„±:', newUser);

            users[email] = newUser;
            localStorage.setItem('timelink_users', JSON.stringify(users));
            this.currentUser = newUser;
            localStorage.setItem('timelink_current_user', JSON.stringify(newUser));
            
            console.log('âœ… localStorage ì €ì¥ ì™„ë£Œ');

            // Appì´ ì •ì˜ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
            if (typeof App !== 'undefined' && App.loadUserData) {
                console.log('âœ… App.loadUserData() í˜¸ì¶œ');
                await App.loadUserData();
            } else {
                console.warn('âš ï¸ Appì´ ì•„ì§ ì •ì˜ë˜ì§€ ì•ŠìŒ');
            }
            
            this.showMainApp();
            
            // ToastëŠ” Appì´ ì¤€ë¹„ëœ í›„ì— í˜¸ì¶œ
            setTimeout(() => {
                if (typeof App !== 'undefined' && App.toast) {
                    App.toast('ğŸ ê°€ì… ì™„ë£Œ! 10,000 TLì´ ì§€ê¸‰ë˜ì—ˆìŠµë‹ˆë‹¤!');
                } else {
                    alert('ğŸ ê°€ì… ì™„ë£Œ! 10,000 TLì´ ì§€ê¸‰ë˜ì—ˆìŠµë‹ˆë‹¤!');
                }
            }, 500);
            
            console.log('âœ… íšŒì›ê°€ì… ì™„ë£Œ');
        } catch (error) {
            console.error('âŒ íšŒì›ê°€ì… ì—ëŸ¬:', error);
            alert('íšŒì›ê°€ì… ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤:\n\n' + error.message + '\n\nê°œë°œì ë„êµ¬(F12) ì½˜ì†”ì„ í™•ì¸í•˜ì„¸ìš”.');
        }
    },

    async login() {
        try {
            console.log('ğŸ” ë¡œê·¸ì¸ ì‹œì‘');
            const email = document.getElementById('loginEmail').value.trim().toLowerCase();
            const password = document.getElementById('loginPassword').value;
            if (!email || !password) return this.showAuthMessage('ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”', 'error');

            const users = this.getAllUsers();
            const user = users[email];
            if (!user) return this.showAuthMessage('ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì´ë©”ì¼ì…ë‹ˆë‹¤', 'error');
            if (user.password !== password) return this.showAuthMessage('ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤', 'error');

            console.log('âœ… ì‚¬ìš©ì í™•ì¸:', user.email);

            this.currentUser = user;
            localStorage.setItem('timelink_current_user', JSON.stringify(user));
            
            if (typeof App !== 'undefined' && App.loadUserData) {
                console.log('âœ… App.loadUserData() í˜¸ì¶œ');
                await App.loadUserData();
            }
            
            this.showAuthMessage('âœ… ë¡œê·¸ì¸ ì„±ê³µ!', 'success');
            setTimeout(() => this.showMainApp(), 500);
            
            console.log('âœ… ë¡œê·¸ì¸ ì™„ë£Œ');
        } catch (error) {
            console.error('âŒ ë¡œê·¸ì¸ ì—ëŸ¬:', error);
            alert('ë¡œê·¸ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤:\n\n' + error.message);
        }
    },

    async logout() {
        if (confirm('ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
            await this.saveUserData();
            try { await DB.reset(); } catch(e) {}
            await DB.open();
            localStorage.removeItem('timelink_current_user');
            this.currentUser = null;
            App.wallet = { tl: 0, tlc: 0 };
            App.files = [];
            App.gold = 0;
            this.showLoginScreen();
        }
    },

    getAllUsers() {
        const d = localStorage.getItem('timelink_users');
        return d ? JSON.parse(d) : {};
    },

    async saveUserData() {
        if (!this.currentUser) return;
        const users = this.getAllUsers();
        const userCopy = { ...this.currentUser };
        userCopy.files = App.files.map(f => { const { url, ...meta } = f; return meta; });
        userCopy.wallet = App.wallet;
        userCopy.gold = App.gold;
        userCopy.adWatchedToday = App.adWatchedToday;
        userCopy.adLastDate = App.adLastDate;
        users[this.currentUser.email] = userCopy;
        localStorage.setItem('timelink_users', JSON.stringify(users));
        localStorage.setItem('timelink_current_user', JSON.stringify(userCopy));
    },

    switchAuthMode(mode) {
        document.getElementById('loginForm').style.display = mode === 'login' ? 'block' : 'none';
        document.getElementById('registerForm').style.display = mode === 'register' ? 'block' : 'none';
    },

    showAuthMessage(msg, type) {
        const el = document.getElementById('authMessage');
        el.textContent = msg;
        el.style.display = 'block';
        el.style.background = type === 'success' ? 'rgba(29,185,84,0.2)' : 'rgba(255,68,68,0.2)';
        el.style.color = type === 'success' ? '#1db954' : '#ff4444';
        el.style.border = `1px solid ${type === 'success' ? '#1db954' : '#ff4444'}`;
        setTimeout(() => el.style.display = 'none', 3000);
    },

    // í…ŒìŠ¤íŠ¸ í•¨ìˆ˜
    test() {
        alert('âœ… Auth ê°ì²´ê°€ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•©ë‹ˆë‹¤!');
        console.log('Auth ê°ì²´:', this);
        return true;
    }
};

// Make Auth globally available
window.Auth = Auth;
console.log('âœ… Auth ê°ì²´ ì •ì˜ ì™„ë£Œ');
console.log('âœ… window.Auth:', typeof window.Auth);
console.log('âœ… Auth.register:', typeof Auth.register);

// Setup event listeners
document.addEventListener('DOMContentLoaded', function() {
    console.log('ğŸ¯ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡ ì‹œì‘');
    
    // Login button
    const loginBtn = document.getElementById('loginBtn');
    if (loginBtn) {
        loginBtn.addEventListener('click', function() {
            console.log('ğŸ” ë¡œê·¸ì¸ ë²„íŠ¼ í´ë¦­');
            Auth.login();
        });
        console.log('âœ… ë¡œê·¸ì¸ ë²„íŠ¼ ë¦¬ìŠ¤ë„ˆ ë“±ë¡');
    }
    
    // Register button
    const registerBtn = document.getElementById('registerBtn');
    if (registerBtn) {
        registerBtn.addEventListener('click', function() {
            console.log('ğŸ¯ íšŒì›ê°€ì… ë²„íŠ¼ í´ë¦­');
            Auth.register();
        });
        console.log('âœ… íšŒì›ê°€ì… ë²„íŠ¼ ë¦¬ìŠ¤ë„ˆ ë“±ë¡');
    }
    
    // Switch to register
    const switchToRegister = document.getElementById('switchToRegister');
    if (switchToRegister) {
        switchToRegister.addEventListener('click', function() {
            Auth.switchAuthMode('register');
        });
        console.log('âœ… íšŒì›ê°€ì… ì „í™˜ ë¦¬ìŠ¤ë„ˆ ë“±ë¡');
    }
    
    // Switch to login
    const switchToLogin = document.getElementById('switchToLogin');
    if (switchToLogin) {
        switchToLogin.addEventListener('click', function() {
            Auth.switchAuthMode('login');
        });
        console.log('âœ… ë¡œê·¸ì¸ ì „í™˜ ë¦¬ìŠ¤ë„ˆ ë“±ë¡');
    }
    
    // Logout button
    const logoutBtn = document.getElementById('logoutBtn');
    if (logoutBtn) {
        logoutBtn.addEventListener('click', function() {
            Auth.logout();
        });
        console.log('âœ… ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ ë¦¬ìŠ¤ë„ˆ ë“±ë¡');
    }
    
    // Reset button
    const resetBtn = document.getElementById('resetBtn');
    if (resetBtn) {
        resetBtn.addEventListener('click', function() {
            if (typeof App !== 'undefined' && App.resetDatabase) {
                App.resetDatabase();
            }
        });
        console.log('âœ… ë¦¬ì…‹ ë²„íŠ¼ ë¦¬ìŠ¤ë„ˆ ë“±ë¡');
    }
    
    console.log('âœ… ëª¨ë“  ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡ ì™„ë£Œ!');
});

// Enable auth buttons (keep for backward compatibility)
setTimeout(() => {
    const loginBtn = document.getElementById('loginBtn');
    const registerBtn = document.getElementById('registerBtn');
    if (loginBtn) {
        loginBtn.disabled = false;
        loginBtn.style.opacity = '1';
    }
    if (registerBtn) {
        registerBtn.disabled = false;
        registerBtn.style.opacity = '1';
    }
    console.log('âœ… Auth ë²„íŠ¼ í™œì„±í™” ì™„ë£Œ');
}, 100);

// ==================== MAIN APP ====================
const App = {
    wallet: { tl: 10000, tlc: 0 },
    files: [],
    gold: 0,
    goldHistory: [],
    goldPeriod: 'week',
    walletHistory: [],
    tlcPrice: 1.00,
    type: 'audio',
    selectedFile: null,
    selectedFileDuration: 0,
    chargeTarget: null,
    playInterval: null,
    currentFile: null,
    currentGenre: 'all',
    ci: 1.0,
    cafeActive: false,
    cafeMood: 'chill',
    cafeQueue: [],
    cafeIndex: 0,
    carWalkActive: false,
    movementMultiplier: 1.0,
    lectureActive: false,
    lectureProgress: 0,
    
    // ê´‘ê³  ê´€ë ¨
    adWatchedToday: 0,
    adLastDate: new Date().toDateString(),
    adMaxPerDay: 5,
    adWatching: false,
    adTimer: null,

    init() {
        // ë¸”ë¡ì²´ì¸ ë ˆì§€ìŠ¤íŠ¸ë¦¬ ì´ˆê¸°í™”
        BlockchainRegistry.init();
        
        const fileInput = document.getElementById('fileInput');
        fileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (!file) return;
            if (!file.type.startsWith('audio/') && !file.type.startsWith('video/')) {
                App.toast('ì˜¤ë””ì˜¤ ë˜ëŠ” ë¹„ë””ì˜¤ íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤');
                e.target.value = '';
                return;
            }
            App.selectedFile = file;
            document.getElementById('infoFileName').textContent = file.name;
            document.getElementById('infoFileSize').textContent = (file.size / 1024 / 1024).toFixed(2) + ' MB';
            document.getElementById('infoType').textContent = App.type === 'audio' ? 'TL3 (ì˜¤ë””ì˜¤)' : 'TL4 (ë¹„ë””ì˜¤)';
            document.getElementById('infoDuration').textContent = 'ê³„ì‚° ì¤‘...';
            document.getElementById('durationBadge').textContent = 'â±ï¸ ê³„ì‚° ì¤‘';

            if (file.type.startsWith('audio/')) {
                const audio = new Audio();
                audio.src = URL.createObjectURL(file);
                audio.onloadedmetadata = function() {
                    const d = Math.floor(audio.duration);
                    App.selectedFileDuration = d;
                    const m = Math.floor(d/60), s = d%60;
                    document.getElementById('infoDuration').textContent = `${m}:${s.toString().padStart(2,'0')} (${d}ì´ˆ)`;
                    document.getElementById('durationBadge').textContent = `â±ï¸ ${m}:${s.toString().padStart(2,'0')}`;
                    URL.revokeObjectURL(audio.src);
                };
                audio.onerror = () => { App.selectedFileDuration = 180; };
            } else if (file.type.startsWith('video/')) {
                const video = document.createElement('video');
                video.preload = 'metadata';
                video.src = URL.createObjectURL(file);
                video.onloadedmetadata = function() {
                    const d = Math.floor(video.duration);
                    App.selectedFileDuration = d;
                    const m = Math.floor(d/60), s = d%60;
                    document.getElementById('infoDuration').textContent = `${m}:${s.toString().padStart(2,'0')} (${d}ì´ˆ)`;
                    document.getElementById('durationBadge').textContent = `â±ï¸ ${m}:${s.toString().padStart(2,'0')}`;
                    URL.revokeObjectURL(video.src);
                };
                video.onerror = () => { App.selectedFileDuration = 180; };
            }

            document.getElementById('uploadForm').style.display = 'block';
            document.getElementById('fileTitle').value = file.name.replace(/\.[^/.]+$/, '');
            App.toast(`íŒŒì¼ ì„ íƒ ì™„ë£Œ: ${file.name}`);
        });

        setInterval(() => {
            App.ci = 1.0 + Math.random();
            const ciEl = document.getElementById('ciValue');
            if (ciEl) ciEl.textContent = App.ci.toFixed(2) + 'x';
            const ciWEl = document.getElementById('ciValueWallet');
            if (ciWEl) ciWEl.textContent = App.ci.toFixed(2) + 'x';
        }, 3000);

        setTimeout(() => App.drawGoldChart(), 1000);
        App.updateAll();
        
        // ë‚ ì§œ ë³€ê²½ ì‹œ ê´‘ê³  ì¹´ìš´íŠ¸ ë¦¬ì…‹
        App.checkAdDailyReset();


        // ==================== COPYRIGHT REGISTRY ====================
        // First-to-File ì°½ì‘ê¶Œ ì¦ëª… ì‹œìŠ¤í…œ
        this.copyrightRegistry = this.loadCopyrightRegistry();
        this.uploadQueue = [];

        // TL3 Player ì´ˆê¸°í™”
        App.initTL3Player();

        // Contribution System ì´ˆê¸°í™”
        App.initContributionSystem();

        // Mining ì…ë ¥ í•„ë“œ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸
        const miningInput = document.getElementById('miningAmount');
        if (miningInput) {
            miningInput.addEventListener('input', () => App.updateMiningPreview());
        }

        // Discover í˜ì´ì§€ ì´ˆê¸° ë Œë”ë§ (ì§€ì—° ì‹¤í–‰ìœ¼ë¡œ ì•ˆì „í•˜ê²Œ)
        setTimeout(() => {
            try {
                App.renderDiscover();
            } catch (error) {
                console.error('Discover ë Œë”ë§ ì˜¤ë¥˜:', error);
            }
        }, 100);
    },

    // ==================== ê´‘ê³  & êµ¬ë§¤ ì‹œìŠ¤í…œ ====================
    checkAdDailyReset() {
        const today = new Date().toDateString();
        if (this.adLastDate !== today) {
            this.adWatchedToday = 0;
            this.adLastDate = today;
        }
    },

    openRechargeModal(context) {
        this.checkAdDailyReset();
        const remaining = this.adMaxPerDay - this.adWatchedToday;
        
        document.getElementById('modalCurrentTL').textContent = this.wallet.tl.toLocaleString();
        document.getElementById('adRemaining').textContent = remaining + 'íšŒ';
        
        // ê´‘ê³  ë²„íŠ¼ ìƒíƒœ
        const adButtons = document.getElementById('adButtons');
        if (remaining <= 0) {
            adButtons.innerHTML = `<div style="width:100%; text-align:center; padding:14px; background:rgba(255,255,255,0.03); border-radius:12px; color:#666; font-size:14px;">ì˜¤ëŠ˜ ê´‘ê³  ì‹œì²­ íšŸìˆ˜ë¥¼ ëª¨ë‘ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤<br><span style="font-size:12px;">ë‚´ì¼ ë‹¤ì‹œ ì‹œì²­í•˜ì„¸ìš” (ë§¤ì¼ 5íšŒ ì´ˆê¸°í™”)</span></div>`;
        } else {
            adButtons.innerHTML = `
                <button class="btn" onclick="App.watchAd(15, 500)" style="flex:1; background:rgba(59,130,246,0.2); color:#60a5fa; border:1px solid rgba(59,130,246,0.4); padding:12px; font-size:13px;">â–¶ï¸ 15ì´ˆ â†’ +500 TL</button>
                <button class="btn" onclick="App.watchAd(30, 1500)" style="flex:1; background:rgba(59,130,246,0.4); color:#60a5fa; border:1px solid rgba(59,130,246,0.6); padding:12px; font-size:13px;">â–¶ï¸ 30ì´ˆ â†’ +1,500 TL â­</button>
                <button class="btn" onclick="App.watchAd(60, 3000)" style="flex:1; background:rgba(59,130,246,0.2); color:#60a5fa; border:1px solid rgba(59,130,246,0.4); padding:12px; font-size:13px;">â–¶ï¸ 60ì´ˆ â†’ +3,000 TL</button>
            `;
            adButtons.style.display = 'flex';
        }
        
        // ì§„í–‰ ì¤‘ì¸ ê´‘ê³  ì´ˆê¸°í™”
        document.getElementById('adProgressContainer').style.display = 'none';
        adButtons.style.display = remaining > 0 ? 'flex' : 'block';
        
        document.getElementById('tlRechargeModal').style.display = 'flex';
    },

    closeRechargeModal() {
        // ê´‘ê³  ì‹œì²­ ì¤‘ ì·¨ì†Œ
        if (this.adWatching) {
            clearInterval(this.adTimer);
            this.adWatching = false;
            document.getElementById('adProgressContainer').style.display = 'none';
            document.getElementById('adButtons').style.display = 'flex';
        }
        document.getElementById('tlRechargeModal').style.display = 'none';
    },

    watchAd(seconds, reward) {
        if (this.adWatching) return;
        this.checkAdDailyReset();
        
        const remaining = this.adMaxPerDay - this.adWatchedToday;
        if (remaining <= 0) {
            this.toast('ì˜¤ëŠ˜ ê´‘ê³  ì‹œì²­ íšŸìˆ˜ë¥¼ ëª¨ë‘ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤');
            return;
        }

        this.adWatching = true;
        
        // ê´‘ê³  ì½˜í…ì¸  ëœë¤ ì„¤ì •
        const adContents = [
            { brand: 'TimeLink Premium', tagline: 'í”„ë¦¬ë¯¸ì—„ ìŒì•…ì˜ ì„¸ê³„ë¡œ' },
            { brand: 'Suno AI Studio', tagline: 'AIë¡œ ë§Œë“œëŠ” ë‚˜ë§Œì˜ ìŒì•…' },
            { brand: 'TLC Exchange', tagline: 'TLC ì½”ì¸ ì§€ê¸ˆ ë°”ë¡œ íˆ¬ì' },
            { brand: 'K-Music NFT', tagline: 'í•œêµ­ ìŒì•…ì˜ ë¯¸ë˜ë¥¼ ì†Œìœ í•˜ì„¸ìš”' },
            { brand: 'AudioVerse Pro', tagline: 'ë¬´í•œí•œ ì‚¬ìš´ë“œ ìœ ë‹ˆë²„ìŠ¤' }
        ];
        const ad = adContents[Math.floor(Math.random() * adContents.length)];
        document.getElementById('adBrand').textContent = ad.brand;
        document.getElementById('adTagline').textContent = ad.tagline;

        // UI ì „í™˜
        document.getElementById('adButtons').style.display = 'none';
        const progressContainer = document.getElementById('adProgressContainer');
        progressContainer.style.display = 'block';
        
        let elapsed = 0;
        document.getElementById('adProgressFill').style.width = '0%';
        document.getElementById('adCountdown').textContent = seconds + 'ì´ˆ';
        document.getElementById('adProgressText').textContent = 'ê´‘ê³  ì‹œì²­ ì¤‘...';
        
        this.adTimer = setInterval(async () => {
            elapsed++;
            const pct = (elapsed / seconds) * 100;
            document.getElementById('adProgressFill').style.width = pct + '%';
            document.getElementById('adCountdown').textContent = (seconds - elapsed) + 'ì´ˆ';
            
            if (elapsed >= seconds) {
                clearInterval(this.adTimer);
                this.adWatching = false;
                this.adWatchedToday++;
                
                // ë³´ìƒ ì§€ê¸‰
                this.wallet.tl += reward;
                await Auth.saveUserData();
                this.updateAll();
                
                // UI ì—…ë°ì´íŠ¸
                document.getElementById('adProgressText').textContent = 'âœ… ê´‘ê³  ì‹œì²­ ì™„ë£Œ!';
                document.getElementById('adCountdown').textContent = '+' + reward.toLocaleString() + ' TL';
                document.getElementById('adSkipNotice').textContent = 'ğŸ‰ TLì´ ì§€ê¸‰ë˜ì—ˆìŠµë‹ˆë‹¤!';
                document.getElementById('adSkipNotice').style.color = '#22c55e';
                document.getElementById('modalCurrentTL').textContent = this.wallet.tl.toLocaleString();
                
                const newRemaining = this.adMaxPerDay - this.adWatchedToday;
                document.getElementById('adRemaining').textContent = newRemaining + 'íšŒ';
                
                this.toast(`ğŸ‰ ê´‘ê³  ì‹œì²­ ì™„ë£Œ! +${reward.toLocaleString()} TL íšë“!`);
                
                // 2ì´ˆ í›„ ë²„íŠ¼ ë³µì›
                setTimeout(() => {
                    progressContainer.style.display = 'none';
                    document.getElementById('adSkipNotice').style.color = '#666';
                    document.getElementById('adSkipNotice').textContent = 'âš ï¸ ê´‘ê³ ê°€ ëë‚  ë•Œê¹Œì§€ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”';
                    
                    if (newRemaining <= 0) {
                        document.getElementById('adButtons').innerHTML = `<div style="width:100%; text-align:center; padding:14px; background:rgba(255,255,255,0.03); border-radius:12px; color:#666; font-size:14px;">ì˜¤ëŠ˜ ê´‘ê³  ì‹œì²­ íšŸìˆ˜ë¥¼ ëª¨ë‘ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤<br><span style="font-size:12px;">ë‚´ì¼ ë‹¤ì‹œ ì‹œì²­í•˜ì„¸ìš”</span></div>`;
                        document.getElementById('adButtons').style.display = 'block';
                    } else {
                        document.getElementById('adButtons').innerHTML = `
                            <button class="btn" onclick="App.watchAd(15, 500)" style="flex:1; background:rgba(59,130,246,0.2); color:#60a5fa; border:1px solid rgba(59,130,246,0.4); padding:12px; font-size:13px;">â–¶ï¸ 15ì´ˆ â†’ +500 TL</button>
                            <button class="btn" onclick="App.watchAd(30, 1500)" style="flex:1; background:rgba(59,130,246,0.4); color:#60a5fa; border:1px solid rgba(59,130,246,0.6); padding:12px; font-size:13px;">â–¶ï¸ 30ì´ˆ â†’ +1,500 TL â­</button>
                            <button class="btn" onclick="App.watchAd(60, 3000)" style="flex:1; background:rgba(59,130,246,0.2); color:#60a5fa; border:1px solid rgba(59,130,246,0.4); padding:12px; font-size:13px;">â–¶ï¸ 60ì´ˆ â†’ +3,000 TL</button>
                        `;
                        document.getElementById('adButtons').style.display = 'flex';
                    }
                }, 2000);
            }
        }, 1000);
    },

    async purchaseTL(tlAmount, price) {
        // ë°ëª¨: ì‹¤ì œ ê²°ì œ ì—†ì´ ì¦‰ì‹œ TL ì§€ê¸‰
        const confirmMsg = `${tlAmount.toLocaleString()} TLë¥¼ â‚©${price.toLocaleString()}ì— êµ¬ë§¤í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\n(ë°ëª¨ ëª¨ë“œ: ì¦‰ì‹œ ì§€ê¸‰ë©ë‹ˆë‹¤)`;
        if (!confirm(confirmMsg)) return;
        
        this.wallet.tl += tlAmount;
        await Auth.saveUserData();
        this.updateAll();
        
        document.getElementById('modalCurrentTL').textContent = this.wallet.tl.toLocaleString();
        
        this.toast(`âœ… ${tlAmount.toLocaleString()} TL êµ¬ë§¤ ì™„ë£Œ! (â‚©${price.toLocaleString()})`);
        
        // 3ì´ˆ í›„ ëª¨ë‹¬ ë‹«ê¸°
        setTimeout(() => this.closeRechargeModal(), 2500);
    },

    // TL ë¶€ì¡± ì‹œ ìë™ ëª¨ë‹¬ í‘œì‹œ
    checkTlAndPrompt(needed = 1) {
        if (this.wallet.tl < needed) {
            this.openRechargeModal('insufficient');
            return false;
        }
        return true;
    },

    // TL ì”ì•¡ ìƒíƒœ ì—…ë°ì´íŠ¸
    updateTlStatus() {
        const tlBalanceEl = document.getElementById('tlBalance');
        const lowBanner = document.getElementById('lowTlBanner');
        
        if (this.wallet.tl === 0) {
            tlBalanceEl.classList.add('low');
            lowBanner.style.display = 'flex';
        } else if (this.wallet.tl < 500) {
            tlBalanceEl.classList.add('low');
            lowBanner.style.display = 'flex';
        } else {
            tlBalanceEl.classList.remove('low');
            lowBanner.style.display = 'none';
        }
    },

    // ==================== ê¸°ì¡´ ê¸°ëŠ¥ ====================
    async loadUserData() {
        if (!Auth.currentUser) return;
        this.wallet = Auth.currentUser.wallet || { tl: 10000, tlc: 0 };
        this.gold = Auth.currentUser.gold || 0;
        this.adWatchedToday = Auth.currentUser.adWatchedToday || 0;
        this.adLastDate = Auth.currentUser.adLastDate || new Date().toDateString();
        this.checkAdDailyReset();
        this.files = [...(Auth.currentUser.files || [])];
        this.updateAll();
    },

    selectType(type) {
        this.type = type;
        document.getElementById('audioCard').classList.toggle('selected', type === 'audio');
        document.getElementById('videoCard').classList.toggle('selected', type === 'video');
        const icons = { audio: 'ğŸµ', video: 'ğŸ¬' };
        document.getElementById('uploadIcon').textContent = icons[type];
        document.getElementById('uploadTitle').textContent = type === 'audio' ? 'íŒŒì¼ ì„ íƒí•˜ê¸°' : 'ë¹„ë””ì˜¤ ì„ íƒí•˜ê¸°';
        document.getElementById('uploadDesc').textContent = type === 'audio' ? 'MP3, WAV, FLAC' : 'MP4, MOV, AVI';
        document.getElementById('fileInput').accept = type === 'audio' ? 'audio/*' : 'video/*';
    },

    async convert() {
        if (!this.selectedFile) return this.toast('íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”');
        const title = document.getElementById('fileTitle').value.trim();
        const creator = document.getElementById('fileCreator').value.trim();
        const tool = document.getElementById('creatorTool').value;
        const genre = document.getElementById('fileGenre').value;
        const mood = document.getElementById('fileMood').value;
        const desc = document.getElementById('fileDesc').value;
        const revenue = document.getElementById('revenue').value;
        
        if (!title) return this.toast('ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”');
        if (!creator) return this.toast('ì°½ì‘ì ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”');
        
        const isVideo = this.selectedFile.type.startsWith('video');
        const isAudio = this.selectedFile.type.startsWith('audio');
        if (!isVideo && !isAudio) return this.toast('ì˜¤ë””ì˜¤ ë˜ëŠ” ë¹„ë””ì˜¤ íŒŒì¼ë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤');
        
        const fileSizeMB = (this.selectedFile.size / 1024 / 1024).toFixed(1);
        const certified = tool === 'suno' || tool === 'udio';
        
        this.toast('â³ TL3 íŒŒì¼ ìƒì„± ì¤‘... (ë¸”ë¡ì²´ì¸ + IPFS)');
        
        const reader = new FileReader();
        reader.onload = async (e) => {
            try {
                const arrayBuffer = e.target.result;
                
                // 1. TL3 ë©”íƒ€ë°ì´í„° ìƒì„±
                const metadata = TL3.createMetadata(this.selectedFile, {
                    wallet: Auth.currentUser?.email || 'anonymous',
                    name: creator
                }, {
                    title,
                    duration: this.selectedFileDuration || 0,
                    aiTool: tool,
                    genre,
                    mood,
                    revenueShare: parseInt(revenue === '55' ? 50 : 70),
                    description: desc
                });
                
                console.log('ğŸ“ TL3 ë©”íƒ€ë°ì´í„°:', metadata);
                
                // 2. ë¸”ë¡ì²´ì¸ í•´ì‹œ ìƒì„±
                metadata.blockchainHash = await TL3.createBlockchainHash(metadata);
                this.toast('ğŸ”— ë¸”ë¡ì²´ì¸ í•´ì‹œ ìƒì„± ì™„ë£Œ');
                
                // 3. IPFS ì—…ë¡œë“œ (ì‹œë®¬ë ˆì´ì…˜)
                const ipfsData = await TL3.uploadToIPFS(this.selectedFile, metadata);
                this.toast('ğŸ“¦ IPFS ì—…ë¡œë“œ ì™„ë£Œ');
                
                // 4. ë°ì´í„°ë² ì´ìŠ¤ ë“±ë¡
                await TL3.registerToDatabase(metadata, ipfsData);
                this.toast('ğŸ’¾ ë¸”ë¡ì²´ì¸ ë ˆì§€ìŠ¤íŠ¸ë¦¬ ë“±ë¡');
                
                // 5. TL3 íŒŒì¼ ìƒì„±
                const tl3File = await TL3.createTL3File(arrayBuffer, metadata, ipfsData);
                
                // 6. TL3 íŒŒì¼ ë‹¤ìš´ë¡œë“œ
                const tl3FileName = this.selectedFile.name.replace(/\.(mp3|mp4|wav|flac|m4a)$/i, '.tl3');
                TL3.downloadFile(tl3File, tl3FileName);
                
                // 7. ë‚´ë¶€ ì‹œìŠ¤í…œì—ë„ ì €ì¥
                const newFile = {
                    id: Date.now(),
                    title,
                    creator,
                    tool,
                    genre,
                    mood,
                    desc,
                    type: isVideo ? 'TL4' : 'TL3',
                    fileType: isVideo ? 'video' : 'audio',
                    mimeType: this.selectedFile.type,
                    certified,
                    revenue: revenue === '55' ? '55' : '73',
                    balance: 0,
                    duration: this.selectedFileDuration || 0,
                    fileSizeMB,
                    shared: false,
                    createdAt: new Date().toISOString(),
                    // TL3 ì •ë³´
                    blockchainHash: metadata.blockchainHash,
                    ipfsCID: ipfsData.cid,
                    ipfsUrl: ipfsData.url,
                    isTL3: true
                };
                
                await DB.saveFile({ 
                    id: newFile.id, 
                    arrayBuffer,
                    mimeType: this.selectedFile.type,
                    tl3Metadata: metadata
                });
                
                this.files.push(newFile);
                await Auth.saveUserData();
                
                // ì„±ê³µ ì•Œë¦¼
                this.toast('âœ… TL3 íŒŒì¼ ìƒì„± ì™„ë£Œ! ë‹¤ìš´ë¡œë“œ ì‹œì‘...');
                
                // TL3 ì •ë³´ ëª¨ë‹¬ í‘œì‹œ
                setTimeout(() => this.showTL3Info(newFile, metadata, ipfsData), 500);
                
                // í¼ ì´ˆê¸°í™”
                document.getElementById('uploadForm').style.display = 'none';
                document.getElementById('fileInput').value = '';
                this.selectedFile = null;
                this.selectedFileDuration = 0;
                
                this.switchTab('myfiles');
                this.updateAll();
                
            } catch (error) {
                console.error('âŒ TL3 ë³€í™˜ ì˜¤ë¥˜:', error);
                this.toast('TL3 ë³€í™˜ ì¤‘ ì˜¤ë¥˜: ' + error.message);
            }
        };
        
        reader.onerror = () => this.toast('íŒŒì¼ ì½ê¸° ì˜¤ë¥˜');
        reader.readAsArrayBuffer(this.selectedFile);
    },

    showTL3Info(file, metadata, ipfsData) {
        const infoHTML = `
            <div style="background:linear-gradient(135deg,rgba(138,43,226,0.2),rgba(29,185,84,0.1)); padding:24px; border-radius:16px; border:2px solid #8a2be2;">
                <h3 style="margin-bottom:16px; color:#b983ff; font-size:1.4rem;">ğŸ‰ TL3 íŒŒì¼ ìƒì„± ì™„ë£Œ!</h3>
                
                <div style="background:rgba(0,0,0,0.3); padding:16px; border-radius:12px; margin-bottom:16px; font-family:monospace; font-size:11px; line-height:1.6;">
                    <div style="margin-bottom:8px;"><strong>ğŸ“ ì œëª©:</strong> ${file.title}</div>
                    <div style="margin-bottom:8px;"><strong>ğŸ‘¤ ì°½ì‘ì:</strong> ${file.creator}</div>
                    <div style="margin-bottom:12px; padding-bottom:12px; border-bottom:1px solid rgba(255,255,255,0.1);"><strong>â±ï¸ ì¬ìƒ ì‹œê°„:</strong> ${Math.floor(file.duration/60)}:${(file.duration%60).toString().padStart(2,'0')}</div>
                    
                    <div style="margin-bottom:8px;"><strong style="color:#8a2be2;">ğŸ”— ë¸”ë¡ì²´ì¸ í•´ì‹œ:</strong></div>
                    <div style="background:rgba(138,43,226,0.2); padding:8px; border-radius:6px; word-break:break-all; margin-bottom:12px;">${metadata.blockchainHash}</div>
                    
                    <div style="margin-bottom:8px;"><strong style="color:#1db954;">ğŸ“¦ IPFS CID:</strong></div>
                    <div style="background:rgba(29,185,84,0.2); padding:8px; border-radius:6px; word-break:break-all; margin-bottom:12px;">${ipfsData.cid}</div>
                    
                    <div style="margin-bottom:8px;"><strong>ğŸŒ IPFS URL:</strong></div>
                    <div style="background:rgba(59,130,246,0.2); padding:8px; border-radius:6px; word-break:break-all; margin-bottom:12px;">
                        <a href="${ipfsData.url}" target="_blank" style="color:#60a5fa; text-decoration:underline;">${ipfsData.url}</a>
                    </div>
                    
                    <div style="margin-bottom:8px;"><strong>ğŸ’° ìˆ˜ìµ ë°°ë¶„:</strong> ì°½ì‘ì ${metadata.revenueShare}% / í”Œë«í¼ ${100-metadata.revenueShare}%</div>
                    <div><strong>âœ… AI ì¸ì¦:</strong> ${file.certified ? 'âœ“ ' + file.tool.toUpperCase() : 'ìˆ˜ë™ ê²€í† '}</div>
                </div>
                
                <div style="background:linear-gradient(135deg,rgba(29,185,84,0.15),rgba(34,197,94,0.05)); padding:14px; border-radius:8px; border-left:4px solid #1db954; margin-bottom:16px;">
                    <strong style="color:#1db954; font-size:14px;">ğŸ’¡ ì´ì œ ì´ TL3 íŒŒì¼ì„:</strong>
                    <ul style="margin:10px 0 0 20px; line-height:1.8; font-size:13px;">
                        <li>ì–´ë””ì„œë“  ê³µìœ  ê°€ëŠ¥ (Discord, Reddit, Twitter)</li>
                        <li>ëˆ„ê°€ ì¬ìƒí•˜ë“  <strong>ìë™ìœ¼ë¡œ ì •ì‚°</strong></li>
                        <li>ë¸”ë¡ì²´ì¸ìœ¼ë¡œ <strong>ì†Œìœ ê¶Œ ì¦ëª…</strong></li>
                        <li>í”Œë«í¼ ë…ë¦½ì  (Spotify, YouTube í•„ìš” ì—†ìŒ)</li>
                    </ul>
                </div>
                
                <button onclick="App.closeTL3Info()" style="width:100%; padding:14px; background:linear-gradient(135deg,#8a2be2,#b983ff); color:white; border:none; border-radius:12px; font-weight:700; cursor:pointer; font-size:15px;">
                    í™•ì¸
                </button>
            </div>
        `;
        
        const modal = document.createElement('div');
        modal.id = 'tl3InfoModal';
        modal.style.cssText = 'position:fixed; inset:0; background:rgba(0,0,0,0.92); z-index:9999; display:flex; justify-content:center; align-items:center; padding:20px;';
        modal.innerHTML = `<div style="max-width:600px; width:100%; max-height:90vh; overflow-y:auto;">${infoHTML}</div>`;
        document.body.appendChild(modal);
    },

    closeTL3Info() {
        const modal = document.getElementById('tl3InfoModal');
        if (modal) document.body.removeChild(modal);
    },

    getCoverImage(file) {
        const byGenre = {
            pop: 'https://images.unsplash.com/photo-1501386761578-eac5c94b800a?auto=format&fit=crop&w=1200&q=80',
            rock: 'https://images.unsplash.com/photo-1498038432885-c6f3f1b912ee?auto=format&fit=crop&w=1200&q=80',
            hiphop: 'https://images.unsplash.com/photo-1571260899304-425eee4c7efc?auto=format&fit=crop&w=1200&q=80',
            jazz: 'https://images.unsplash.com/photo-1511192336575-5a79af67a629?auto=format&fit=crop&w=1200&q=80',
            classic: 'https://images.unsplash.com/photo-1465847899084-d164df4dedc6?auto=format&fit=crop&w=1200&q=80',
            edm: 'https://images.unsplash.com/photo-1574391884720-bbc7f31f3f8a?auto=format&fit=crop&w=1200&q=80',
            kpop: 'https://images.unsplash.com/photo-1619983081563-430f63602796?auto=format&fit=crop&w=1200&q=80',
            indie: 'https://images.unsplash.com/photo-1516280440614-37939bbacd81?auto=format&fit=crop&w=1200&q=80'
        };
        return byGenre[file.genre] || 'https://images.unsplash.com/photo-1493225457124-a3eb161ffa5f?auto=format&fit=crop&w=1200&q=80';
    },

    renderMyFiles() {
        const el = document.getElementById('myFilesList');
        if (this.files.length === 0) {
            el.innerHTML = '<div style="text-align:center;padding:60px;color:#666">ğŸ“ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤</div>';
            return;
        }
        const genreEmoji = {pop:'ğŸ¤',rock:'ğŸ¸',hiphop:'ğŸ§',jazz:'ğŸº',classic:'ğŸ»',edm:'ğŸ’¿',kpop:'ğŸ‡°ğŸ‡·',indie:'ğŸ¹'};
        const genreColor = {pop:'#ff6b6b',rock:'#4ecdc4',hiphop:'#ffd93d',jazz:'#a8e6cf',classic:'#b39eb5',edm:'#ff8a5c',kpop:'#ff1493',indie:'#9370db'};
        el.innerHTML = this.files.map(f => `
            <div class="file-card">
                <div class="thumb thumb-media ${f.fileType}" style="background-image:linear-gradient(130deg,rgba(0,0,0,0.2),rgba(0,0,0,0.65)),url('${this.getCoverImage(f)}');">
                    <div class="thumb-icon">${f.type==='TL4'?'ğŸ¬':'ğŸµ'}</div>
                    <span class="badge badge-type">${f.type}</span>
                    ${f.certified?'<span class="badge badge-cert">âœ“ ì¸ì¦</span>':''}
                    ${f.isTL3?'<span class="badge" style="right:12px;bottom:12px;background:rgba(138,43,226,0.9);">ğŸ”— ë¸”ë¡ì²´ì¸</span>':''}
                    <span class="badge badge-genre" style="background:${genreColor[f.genre]||'#666'}">${genreEmoji[f.genre]||'ğŸµ'}</span>
                </div>
                <div class="info">
                    <div class="name">${f.title}</div>
                    <div class="creator">${f.creator} Â· ${f.tool}</div>
                    
                    ${f.isTL3 ? `
                        <div style="background:rgba(138,43,226,0.1);padding:8px;border-radius:8px;margin-bottom:12px;border-left:3px solid #8a2be2;">
                            <div style="font-size:10px;color:#999;margin-bottom:4px;">TL3 ë¸”ë¡ì²´ì¸ í•´ì‹œ</div>
                            <div style="font-size:11px;font-family:monospace;word-break:break-all;color:#b983ff;">${f.blockchainHash?.substring(0,16)}...${f.blockchainHash?.substring(f.blockchainHash.length-8)}</div>
                            ${f.ipfsUrl ? `<a href="${f.ipfsUrl}" target="_blank" style="font-size:10px;color:#1db954;text-decoration:underline;margin-top:4px;display:block;">ğŸ“¦ IPFSì—ì„œ ë³´ê¸°</a>` : ''}
                            ${f.isOriginalCreator !== undefined ? 
                                (f.isOriginalCreator ? 
                                    `<div style="margin-top:8px;padding:6px;background:rgba(29,185,84,0.15);border-radius:6px;border:1px solid rgba(29,185,84,0.3);"><span style="color:#1db954;font-size:11px;font-weight:700;">âœ“ ìµœì´ˆ ì—…ë¡œë” (ê³µìœ  ê°€ëŠ¥)</span></div>` :
                                    `<div style="margin-top:8px;padding:6px;background:rgba(239,68,68,0.15);border-radius:6px;border:1px solid rgba(239,68,68,0.3);"><span style="color:#ef4444;font-size:11px;font-weight:700;">ğŸ”’ ë³µì‚¬ë³¸ (ê³µìœ  ë¶ˆê°€)</span></div>`
                                ) : ''
                            }
                        </div>
                    ` : ''}
                    
                    <div class="panel"><strong>â³ TL Balance</strong><br><span style="font-size:1.6rem;font-weight:800;">${f.balance.toLocaleString()}</span> TL</div>
                    <div class="actions">
                        ${f.balance > 0 ?
                            `<button class="btn btn-play" onclick="App.play(${f.id})">â–¶ï¸ ì¬ìƒ</button>` :
                            `<button class="btn btn-charge" onclick="App.openRechargeModal('noBalance')" style="background:#ef4444; color:white;">âš ï¸ TL ì¶©ì „</button>`
                        }
                        <button class="btn btn-charge" onclick="App.openCharge(${f.id})">ğŸ’° ì¶©ì „</button>
                        ${f.isTL3 ? 
                            `<button class="btn" onclick="App.downloadTL3(${f.id})" style="background:#8a2be2;color:white;">ğŸ”— TL3 ë‹¤ìš´ë¡œë“œ</button>
                             ${f.isOriginalCreator !== false ?  // ê¸°ì¡´ íŒŒì¼ì€ undefinedì´ë¯€ë¡œ ê³µìœ  ê°€ëŠ¥
                                (!f.shared ?
                                    `<button class="btn btn-share" onclick="App.share(${f.id})">ğŸ”„ ê³µìœ í•˜ê¸°</button>`:
                                    `<button class="btn" style="background:#555;color:#999;" disabled>âœ“ ê³µìœ ë¨</button>`
                                ) :
                                `<button class="btn" style="background:#333;color:#666;cursor:not-allowed;" disabled title="ì €ì‘ê¶Œ ë³´í˜¸: ìµœì´ˆ ì—…ë¡œë”ë§Œ ê³µìœ  ê°€ëŠ¥">ğŸ”’ ê³µìœ  ë¶ˆê°€</button>`
                             }` :
                            (!f.shared ?
                                `<button class="btn btn-share" onclick="App.share(${f.id})" style="grid-column:span 2;">ğŸ”„ ê³µìœ </button>`:
                                `<button class="btn" style="background:#555;color:#999;grid-column:span 2;" disabled>âœ“ ê³µìœ ë¨</button>`
                            )
                        }
                    </div>
                </div>
            </div>
        `).join('');
    },

    async downloadTL3(fileId) {
        try {
            const file = this.files.find(f => f.id === fileId);
            if (!file) return this.toast('íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
            
            this.toast('â³ TL3 íŒŒì¼ ìƒì„± ì¤‘...');
            
            // IndexedDBì—ì„œ ì›ë³¸ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
            const fileData = await DB.getFile(file.id);
            if (!fileData || !fileData.arrayBuffer) {
                return this.toast('ì›ë³¸ íŒŒì¼ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤');
            }
            
            // TL3 ë©”íƒ€ë°ì´í„° ì¬ìƒì„±
            const metadata = fileData.tl3Metadata || TL3.createMetadata(
                { type: file.mimeType, size: fileData.arrayBuffer.byteLength, name: file.title },
                { wallet: Auth.currentUser?.email, name: file.creator },
                {
                    title: file.title,
                    duration: file.duration,
                    aiTool: file.tool,
                    genre: file.genre,
                    mood: file.mood,
                    revenueShare: parseInt(file.revenue === '55' ? 50 : 70)
                }
            );
            
            metadata.blockchainHash = file.blockchainHash;
            
            const ipfsData = {
                cid: file.ipfsCID,
                url: file.ipfsUrl,
                gateway: file.ipfsUrl
            };
            
            // TL3 íŒŒì¼ ìƒì„±
            const tl3File = await TL3.createTL3File(fileData.arrayBuffer, metadata, ipfsData);
            
            // ë‹¤ìš´ë¡œë“œ
            const tl3FileName = file.title.replace(/\.(mp3|mp4|wav|flac|m4a)$/i, '') + '.tl3';
            TL3.downloadFile(tl3File, tl3FileName);
            
            this.toast('âœ… TL3 íŒŒì¼ ë‹¤ìš´ë¡œë“œ ì‹œì‘!');
        } catch (error) {
            console.error('TL3 ë‹¤ìš´ë¡œë“œ ì˜¤ë¥˜:', error);
            this.toast('TL3 ë‹¤ìš´ë¡œë“œ ì¤‘ ì˜¤ë¥˜: ' + error.message);
        }
    },

    async downloadSharedTL3(fileId) {
        // Share Placeì—ì„œ TL3 ë‹¤ìš´ë¡œë“œ
        // ê¸°ëŠ¥ì€ downloadTL3ì™€ ë™ì¼í•˜ì§€ë§Œ ì‚¬ìš©ìì—ê²Œ ê³µìœ  ê°ì‚¬ ë©”ì‹œì§€ ì¶”ê°€
        try {
            const file = this.files.find(f => f.id === fileId);
            if (!file) return this.toast('íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
            
            this.toast('â³ TL3 íŒŒì¼ ë‹¤ìš´ë¡œë“œ ì¤‘...');
            
            // IndexedDBì—ì„œ ì›ë³¸ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
            const fileData = await DB.getFile(file.id);
            if (!fileData || !fileData.arrayBuffer) {
                return this.toast('ì›ë³¸ íŒŒì¼ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤');
            }
            
            // TL3 ë©”íƒ€ë°ì´í„° ì¬ìƒì„±
            const metadata = fileData.tl3Metadata || TL3.createMetadata(
                { type: file.mimeType, size: fileData.arrayBuffer.byteLength, name: file.title },
                { wallet: file.creator, name: file.creator },
                {
                    title: file.title,
                    duration: file.duration,
                    aiTool: file.tool,
                    genre: file.genre,
                    mood: file.mood,
                    revenueShare: parseInt(file.revenue === '55' ? 50 : 70)
                }
            );
            
            metadata.blockchainHash = file.blockchainHash;
            
            const ipfsData = {
                cid: file.ipfsCID,
                url: file.ipfsUrl,
                gateway: file.ipfsUrl
            };
            
            // TL3 íŒŒì¼ ìƒì„±
            const tl3File = await TL3.createTL3File(fileData.arrayBuffer, metadata, ipfsData);
            
            // ë‹¤ìš´ë¡œë“œ
            const tl3FileName = file.title.replace(/\.(mp3|mp4|wav|flac|m4a)$/i, '') + '.tl3';
            TL3.downloadFile(tl3File, tl3FileName);
            
            this.toast(`âœ… TL3 ë‹¤ìš´ë¡œë“œ ì™„ë£Œ! ì¬ìƒ ì‹œ ${file.creator}ì—ê²Œ ìë™ ì •ì‚°ë©ë‹ˆë‹¤.`);
            
            // ê¸°ì—¬ë„ ì ìˆ˜ ì¶”ê°€ (TL3 ë‹¤ìš´ë¡œë“œ = í™•ì‚° ê¸°ì—¬)
            this.contribution.today += 5;
            this.contribution.total += 5;
            this.contribution.monthly += 5;
            localStorage.setItem('contribution', JSON.stringify(this.contribution));
            this.updateContributionDisplay();
            
        } catch (error) {
            console.error('TL3 ë‹¤ìš´ë¡œë“œ ì˜¤ë¥˜:', error);
            this.toast('TL3 ë‹¤ìš´ë¡œë“œ ì¤‘ ì˜¤ë¥˜: ' + error.message);
        }
    },

    renderSharePlace() {
        const el = document.getElementById('sharePlaceContent');
        const sharedFiles = this.files.filter(f => f.shared);
        if (sharedFiles.length === 0) {
            el.innerHTML = '<div style="text-align:center;padding:60px;color:#666">ğŸ”„ ê³µìœ ëœ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤</div>';
            return;
        }
        let filtered = sharedFiles;
        if (this.currentGenre !== 'all') filtered = filtered.filter(f => f.genre === this.currentGenre);
        const moods = { energetic:'ğŸ”¥ Energetic', chill:'ğŸ˜Œ Chill', focus:'ğŸ¯ Focus', workout:'ğŸ’ª Workout', romantic:'ğŸ’• Romantic', sad:'ğŸ˜¢ Sad', happy:'ğŸ˜Š Happy', sleep:'ğŸ˜´ Sleep' };
        const genreEmoji = {pop:'ğŸ¤',rock:'ğŸ¸',hiphop:'ğŸ§',jazz:'ğŸº',classic:'ğŸ»',edm:'ğŸ’¿',kpop:'ğŸ‡°ğŸ‡·',indie:'ğŸ¹'};
        const genreColor = {pop:'#ff6b6b',rock:'#4ecdc4',hiphop:'#ffd93d',jazz:'#a8e6cf',classic:'#b39eb5',edm:'#ff8a5c',kpop:'#ff1493',indie:'#9370db'};
        let html = '';
        Object.keys(moods).forEach(mood => {
            const moodFiles = filtered.filter(f => f.mood === mood);
            if (moodFiles.length === 0) return;
            html += `<div style="margin-bottom:40px;"><h3 style="margin-bottom:20px;font-size:1.4rem;">${moods[mood]}</h3><div class="grid">${moodFiles.map(f => `
                <div class="file-card" onclick="App.listenShared(${f.id})">
                    <div class="thumb thumb-media ${f.fileType}" style="background-image:linear-gradient(130deg,rgba(0,0,0,0.2),rgba(0,0,0,0.65)),url('${this.getCoverImage(f)}');">
                        <div class="thumb-icon">${f.type==='TL4'?'ğŸ¬':'ğŸµ'}</div>
                        <span class="badge badge-type">${f.type}</span>
                        ${f.isTL3 ? '<span class="badge" style="right:12px;bottom:12px;background:rgba(138,43,226,0.9);">ğŸ”— TL3</span>' : ''}
                        <span class="badge badge-genre" style="background:${genreColor[f.genre]||'#666'}">${genreEmoji[f.genre]||'ğŸµ'}</span>
                    </div>
                    <div class="info">
                        <div class="name">${f.title}</div>
                        <div class="creator">${f.creator}</div>
                        <div class="panel"><strong>ìˆ˜ìµ ê³„ì•½</strong><br>${f.revenue==='55'?'ì°½ì‘ì 50%':'ì°½ì‘ì 70%'}</div>
                        <div style="display:grid; grid-template-columns:1fr 1fr; gap:8px;">
                            <button class="btn btn-play" onclick="event.stopPropagation();App.listenShared(${f.id})">ğŸ§ ì²­ì·¨</button>
                            ${f.isTL3 ? 
                                `<button class="btn" onclick="event.stopPropagation();App.downloadSharedTL3(${f.id})" style="background:#8a2be2;color:white;">ğŸ“¥ TL3</button>` :
                                `<button class="btn" style="background:#555;color:#999;" disabled>-</button>`
                            }
                        </div>
                    </div>
                </div>
            `).join('')}</div></div>`;
        });
        el.innerHTML = html;
    },

    // ==================== DISCOVER PAGE ====================
    discoverGenre: 'all',
    discoverSearchQuery: '',

    renderDiscover() {
        this.updateDiscoverStats();
        this.renderHotTracks();
        this.renderNewReleases();
        this.renderDiscoverGenre();
    },

    updateDiscoverStats() {
        const sharedFiles = this.files.filter(f => f.shared);
        const totalPlays = sharedFiles.reduce((sum, f) => sum + (f.plays || 0), 0);
        const creators = new Set(sharedFiles.map(f => f.creator)).size;

        if (document.getElementById('discoverTotalTracks')) {
            document.getElementById('discoverTotalTracks').textContent = sharedFiles.length;
        }
        if (document.getElementById('discoverTotalPlays')) {
            document.getElementById('discoverTotalPlays').textContent = totalPlays.toLocaleString();
        }
        if (document.getElementById('discoverTotalCreators')) {
            document.getElementById('discoverTotalCreators').textContent = creators;
        }

        // Show/hide empty state
        const emptyEl = document.getElementById('discoverEmpty');
        if (emptyEl) {
            emptyEl.style.display = sharedFiles.length === 0 ? 'block' : 'none';
        }
    },

    renderHotTracks() {
        const el = document.getElementById('hotTracks');
        if (!el) return;

        let sharedFiles = this.files.filter(f => f.shared);
        if (sharedFiles.length === 0) {
            el.innerHTML = '<div style="text-align:center;padding:40px;color:#666;">ğŸ”¥ ì•„ì§ ì¸ê¸° ê³¡ì´ ì—†ìŠµë‹ˆë‹¤</div>';
            return;
        }

        // Sort by plays (simulate plays based on duration and creation time)
        sharedFiles = sharedFiles.map(f => ({
            ...f,
            plays: f.plays || Math.floor(Math.random() * 1000) + 100
        })).sort((a, b) => b.plays - a.plays).slice(0, 10);

        el.innerHTML = this.renderTrackCards(sharedFiles);
    },

    renderNewReleases() {
        const el = document.getElementById('newReleases');
        if (!el) return;

        let sharedFiles = this.files.filter(f => f.shared);
        if (sharedFiles.length === 0) {
            el.innerHTML = '<div style="text-align:center;padding:40px;color:#666;">ğŸ†• ì•„ì§ ì‹ ê³¡ì´ ì—†ìŠµë‹ˆë‹¤</div>';
            return;
        }

        // Sort by ID (latest first) and take 20
        sharedFiles = sharedFiles.sort((a, b) => b.id - a.id).slice(0, 20);

        el.innerHTML = this.renderTrackCards(sharedFiles);
    },

    renderDiscoverGenre() {
        const el = document.getElementById('genreContent');
        if (!el) return;

        let sharedFiles = this.files.filter(f => f.shared);
        
        // Apply genre filter
        if (this.discoverGenre !== 'all') {
            sharedFiles = sharedFiles.filter(f => f.genre === this.discoverGenre);
        }

        // Apply search filter
        if (this.discoverSearchQuery) {
            const query = this.discoverSearchQuery.toLowerCase();
            sharedFiles = sharedFiles.filter(f => 
                f.title.toLowerCase().includes(query) ||
                f.creator.toLowerCase().includes(query) ||
                f.genre.toLowerCase().includes(query) ||
                (f.mood && f.mood.toLowerCase().includes(query))
            );
        }

        if (sharedFiles.length === 0) {
            el.innerHTML = '<div style="text-align:center;padding:60px;color:#666;"><div style="font-size:3rem;margin-bottom:16px;">ğŸ”</div><h3 style="color:#999;">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤</h3></div>';
            return;
        }

        // Group by mood
        const moods = { energetic:'ğŸ”¥ Energetic', chill:'ğŸ˜Œ Chill', focus:'ğŸ¯ Focus', workout:'ğŸ’ª Workout', romantic:'ğŸ’• Romantic', sad:'ğŸ˜¢ Sad', happy:'ğŸ˜Š Happy', sleep:'ğŸ˜´ Sleep' };
        let html = '';
        
        Object.keys(moods).forEach(mood => {
            const moodFiles = sharedFiles.filter(f => f.mood === mood);
            if (moodFiles.length === 0) return;
            html += `<div class="card" style="margin-bottom:24px;"><h3 style="margin-bottom:20px;font-size:1.4rem;">${moods[mood]}</h3><div class="grid">${this.renderTrackCards(moodFiles)}</div></div>`;
        });

        el.innerHTML = html;
    },

    renderTrackCards(tracks) {
        const genreEmoji = {pop:'ğŸ¤',rock:'ğŸ¸',hiphop:'ğŸ§',jazz:'ğŸº',classic:'ğŸ»',edm:'ğŸ’¿',kpop:'ğŸ‡°ğŸ‡·',indie:'ğŸ¹'};
        const genreColor = {pop:'#ff6b6b',rock:'#4ecdc4',hiphop:'#ffd93d',jazz:'#a8e6cf',classic:'#b39eb5',edm:'#ff8a5c',kpop:'#ff1493',indie:'#9370db'};
        
        return tracks.map(f => `
            <div class="file-card" onclick="App.listenShared(${f.id})">
                <div class="thumb thumb-media ${f.fileType}" style="background-image:linear-gradient(130deg,rgba(0,0,0,0.2),rgba(0,0,0,0.65)),url('${this.getCoverImage(f)}');">
                    <div class="thumb-icon">${f.type==='TL4'?'ğŸ¬':'ğŸµ'}</div>
                    <span class="badge badge-type">${f.type}</span>
                    ${f.isTL3 ? '<span class="badge" style="right:12px;bottom:12px;background:rgba(138,43,226,0.9);">ğŸ”— TL3</span>' : ''}
                    <span class="badge badge-genre" style="background:${genreColor[f.genre]||'#666'}">${genreEmoji[f.genre]||'ğŸµ'}</span>
                    ${f.plays ? `<span class="badge" style="left:12px;bottom:12px;background:rgba(239,68,68,0.9);">ğŸ”¥ ${f.plays}</span>` : ''}
                </div>
                <div class="info">
                    <div class="name">${f.title}</div>
                    <div class="creator">${f.creator}</div>
                    <div class="panel"><strong>ìˆ˜ìµ ê³„ì•½</strong><br>${f.revenue==='55'?'ì°½ì‘ì 50%':'ì°½ì‘ì 70%'}</div>
                    <div style="display:grid; grid-template-columns:1fr 1fr; gap:8px;">
                        <button class="btn btn-play" onclick="event.stopPropagation();App.listenShared(${f.id})">ğŸ§ ì²­ì·¨</button>
                        ${f.isTL3 ? 
                            `<button class="btn" onclick="event.stopPropagation();App.downloadSharedTL3(${f.id})" style="background:#8a2be2;color:white;">ğŸ“¥ TL3</button>` :
                            `<button class="btn" style="background:#555;color:#999;" disabled>-</button>`
                        }
                    </div>
                </div>
            </div>
        `).join('');
    },

    searchDiscover() {
        const input = document.getElementById('discoverSearch');
        if (!input) return;
        this.discoverSearchQuery = input.value;
        this.renderDiscoverGenre();
    },

    filterDiscoverGenre(genre) {
        this.discoverGenre = genre;
        
        // Update active button
        document.querySelectorAll('.genre-filter .genre-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        event.target.classList.add('active');
        
        this.renderDiscoverGenre();
    },

    openCharge(id) {
        const file = this.files.find(f => f.id === id);
        if (!file) return this.toast('íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
        if (this.wallet.tl <= 0) {
            this.openRechargeModal('noTL');
            return;
        }
        this.chargeTarget = id;
        const chargeInput = document.getElementById('chargeAmount');
        chargeInput.value = Math.min(1000, this.wallet.tl);
        chargeInput.max = this.wallet.tl;
        document.getElementById('chargeModal').style.display = 'flex';
    },

    async executeCharge() {
        if (!this.chargeTarget) { this.closeModal(); return; }
        const file = this.files.find(f => f.id === this.chargeTarget);
        if (!file) { this.closeModal(); return; }
        let amt = parseInt(document.getElementById('chargeAmount').value);
        if (isNaN(amt) || amt <= 0) return this.toast('ì˜¬ë°”ë¥¸ ê¸ˆì•¡ì„ ì…ë ¥í•˜ì„¸ìš”');
        if (amt > this.wallet.tl) {
            this.toast(`TLì´ ë¶€ì¡±í•©ë‹ˆë‹¤. ì¶©ì „ì´ í•„ìš”í•©ë‹ˆë‹¤!`);
            this.closeModal();
            setTimeout(() => this.openRechargeModal('insufficient'), 300);
            return;
        }
        this.wallet.tl -= amt;
        file.balance += amt;
        await Auth.saveUserData();
        this.updateAll();
        this.closeModal();
        this.toast(`âœ… ${amt.toLocaleString()} TL ì¶©ì „ ì™„ë£Œ!`);
    },

    async play(id) {
        const file = this.files.find(f => f.id === id);
        if (!file) return this.toast('íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
        if (file.balance <= 0) return this.toast('TLì„ ì¶©ì „í•˜ì„¸ìš”');
        try {
            const fileData = await DB.getFile(file.id);
            if (!fileData || !fileData.arrayBuffer) throw new Error('íŒŒì¼ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.');
            const blobUrl = await DB.getBlobUrl(file.id, file.mimeType);
            this.currentFile = file;
            if (file.fileType === 'video') {
                const video = document.createElement('video');
                video.controls = true; video.autoplay = true;
                video.style.cssText = 'position:fixed;top:0;left:0;width:100%;height:100vh;z-index:10000;background:black;';
                video.src = blobUrl;
                const closeBtn = document.createElement('button');
                closeBtn.textContent = 'âœ• ë‹«ê¸°';
                closeBtn.style.cssText = 'position:fixed;top:20px;right:20px;z-index:10001;background:#f44;color:white;border:none;border-radius:8px;padding:12px 24px;font-size:16px;font-weight:700;cursor:pointer;';
                closeBtn.onclick = () => { this.stopPlay(); if(document.body.contains(video))document.body.removeChild(video); if(document.body.contains(closeBtn))document.body.removeChild(closeBtn); };
                document.body.appendChild(video); document.body.appendChild(closeBtn);
                if (this.playInterval) clearInterval(this.playInterval);
                this.playInterval = setInterval(async () => {
                    if (file.balance > 0) { file.balance -= 2; await Auth.saveUserData(); if (file.balance <= 0) { this.stopPlay(); if(document.body.contains(video))document.body.removeChild(video); if(document.body.contains(closeBtn))document.body.removeChild(closeBtn); this.toast('â¹ï¸ TL ì†Œì§„'); } }
                }, 1000);
            } else {
                const audio = document.getElementById('audioPlayer');
                const newAudio = audio.cloneNode(true); audio.parentNode.replaceChild(newAudio, audio);
                const freshAudio = document.getElementById('audioPlayer');
                freshAudio.src = blobUrl;
                document.getElementById('audioModal').style.display = 'flex';
                document.getElementById('playTitle').textContent = file.title;
                document.getElementById('playCreator').textContent = file.creator;
                document.getElementById('playTL').textContent = file.balance;
                let started = false;
                freshAudio.addEventListener('canplaythrough', function() { if(started)return; started=true; freshAudio.play().catch(e=>{ App.toast('ì¬ìƒ ì˜¤ë¥˜: '+e.message); App.stopPlay(); }); }, {once:true});
                freshAudio.addEventListener('error', function() { App.toast('ì˜¤ë””ì˜¤ ì˜¤ë¥˜'); App.stopPlay(); }, {once:true});
                freshAudio.load();
                if (this.playInterval) clearInterval(this.playInterval);
                this.playInterval = setInterval(async () => {
                    if (file.balance > 0 && !freshAudio.paused) {
                        file.balance -= 1;
                        document.getElementById('playTL').textContent = file.balance;
                        await Auth.saveUserData();
                        if (file.balance <= 0) { this.stopPlay(); this.toast('â¹ï¸ TL ì†Œì§„'); }
                    }
                }, 1000);
            }
        } catch (error) { this.toast('ì¬ìƒ ì¤€ë¹„ ì¤‘ ì˜¤ë¥˜: ' + error.message); }
    },

    async listenShared(id) {
        const file = this.files.find(f => f.id === id);
        if (!file) return this.toast('íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
        if (this.wallet.tl <= 0) {
            this.openRechargeModal('noTL');
            return;
        }
        try {
            const fileData = await DB.getFile(file.id);
            if (!fileData || !fileData.arrayBuffer) throw new Error('íŒŒì¼ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
            const blobUrl = await DB.getBlobUrl(file.id, file.mimeType);
            this.currentFile = file;
            const audio = document.getElementById('audioPlayer');
            const newAudio = audio.cloneNode(true); audio.parentNode.replaceChild(newAudio, audio);
            const freshAudio = document.getElementById('audioPlayer');
            freshAudio.src = blobUrl;
            document.getElementById('audioModal').style.display = 'flex';
            document.getElementById('playTitle').textContent = file.title;
            document.getElementById('playCreator').textContent = file.creator + ' (Share Place)';
            document.getElementById('playTL').textContent = this.wallet.tl;
            let started = false;
            freshAudio.addEventListener('canplaythrough', function() { if(started)return; started=true; freshAudio.play().catch(e=>{ App.toast('ì¬ìƒ ì˜¤ë¥˜: '+e.message); App.stopPlay(); }); }, {once:true});
            freshAudio.addEventListener('error', function() { App.toast('ì˜¤ë””ì˜¤ ë¡œë“œ ì˜¤ë¥˜'); App.stopPlay(); }, {once:true});
            freshAudio.load();
            if (this.playInterval) clearInterval(this.playInterval);
            this.playInterval = setInterval(async () => {
                if (this.wallet.tl > 0 && !freshAudio.paused) {
                    const cost = file.type === 'TL4' ? 2 : 1;
                    this.wallet.tl -= cost;
                    const creatorShare = file.revenue === '55' ? 0.5 : 0.7;
                    file.balance += cost * creatorShare;
                    this.gold += (cost * (1 - creatorShare) * 0.1) / 1000;
                    document.getElementById('playTL').textContent = this.wallet.tl;
                    await Auth.saveUserData();
                    this.updateTlStatus();
                    if (this.wallet.tl <= 0) {
                        this.stopPlay();
                        this.toast('â¹ï¸ TL ì†Œì§„!');
                        // ì†Œì§„ ì‹œ ìë™ìœ¼ë¡œ ì¶©ì „ ëª¨ë‹¬ í‘œì‹œ
                        setTimeout(() => this.openRechargeModal('depleted'), 500);
                    }
                }
            }, 1000);
        } catch (error) { this.toast('ì¬ìƒ ì¤€ë¹„ ì¤‘ ì˜¤ë¥˜: ' + error.message); }
    },

    stopPlay() {
        if (this.playInterval) clearInterval(this.playInterval);
        const audio = document.getElementById('audioPlayer');
        audio.pause(); audio.src = '';
        document.getElementById('audioModal').style.display = 'none';
        this.currentFile = null;
        Auth.saveUserData();
        this.updateAll();
    },

    async share(id) {
        const file = this.files.find(f => f.id === id);
        if (!file) return;
        
        // ì°½ì‘ê¶Œ ê²€ì¦ (canShare ì†ì„± í™•ì¸)
        if (file.canShare === false) {
            this.toast('âš ï¸ ì´ íŒŒì¼ì€ ê³µìœ í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤ (ë‹¤ë¥¸ ì‚¬ìš©ìê°€ ë¨¼ì € ë“±ë¡í•¨)');
            
            // ì°½ì‘ê¶Œ ì •ë³´ í‘œì‹œ
            if (file.contentHash) {
                const copyrightInfo = this.verifyCopyright(file.contentHash);
                if (copyrightInfo.exists && !copyrightInfo.isOwner) {
                    this.toast(`ğŸ† ì›ì‘ì: ${copyrightInfo.owner}`);
                }
            }
            return;
        }

        // TL3 íŒŒì¼ì˜ ê²½ìš° ì›ì‘ì ì—¬ë¶€ í™•ì¸
        if (file.isTL3 && !file.isOriginalOwner) {
            this.toast('âš ï¸ ìµœì´ˆ ì—…ë¡œë”ë§Œ ê³µìœ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤ (ì €ì‘ê¶Œ ë³´í˜¸)');
            return;
        }
        
        if (!file.certified && !file.isTL3) {
            return this.toast('ì¸ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤');
        }
        
        file.shared = true;
        await Auth.saveUserData();
        this.toast(`ğŸ”„ ${file.title} Share Placeë¡œ ì´ë™!`);
        this.updateAll();
    },

    filterGenre(genre) {
        this.currentGenre = genre;
        document.querySelectorAll('.genre-btn').forEach(b => b.classList.remove('active'));
        event.target.classList.add('active');
        this.renderSharePlace();
    },

    searchShare() {},

    async mine() {
        const amt = parseInt(document.getElementById('miningAmount').value) || 100;
        const max = Math.floor(this.wallet.tl * 0.5);
        if (amt > max) return this.toast(`í•œë„ ì´ˆê³¼! ìµœëŒ€ ${max} TL`);
        if (this.wallet.tl < amt) { this.openRechargeModal('mine'); return; }
        const tlc = (amt * 0.01) * this.ci;
        this.wallet.tl -= amt;
        this.wallet.tlc += tlc;
        this.gold += (amt * 0.1 * 0.1) / 1000;
        await Auth.saveUserData();
        this.updateAll();
        this.toast(`â›ï¸ ${tlc.toFixed(2)} TLC ì±„êµ´!`);
    },

    async resetDatabase() {
        if (confirm('âš ï¸ ëª¨ë“  íŒŒì¼ ë°ì´í„°ê°€ ì‚­ì œë©ë‹ˆë‹¤. ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
            try {
                await DB.reset(); await DB.open();
                this.files = [];
                await Auth.saveUserData();
                this.updateAll();
                this.toast('âœ… ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™” ì™„ë£Œ!');
            } catch (error) { this.toast('ì˜¤ë¥˜: ' + error.message); }
        }
    },

    async startCafe() {
        const sharedFiles = this.files.filter(f => f.shared);
        if (sharedFiles.length === 0) return this.toast('ê³µìœ ëœ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤');
        if (this.wallet.tl <= 0) { this.openRechargeModal('cafe'); return; }
        this.cafeActive = true;
        this.cafeQueue = sharedFiles.sort(() => Math.random() - 0.5);
        this.cafeIndex = 0;
        this.toast('â˜• ì¹´í˜ ë°©ì†¡ ì‹œì‘!');
        await this.playNextCafe();
    },

    async playNextCafe() {
        if (!this.cafeActive || this.cafeQueue.length === 0) return;
        const file = this.cafeQueue[this.cafeIndex];
        document.getElementById('cafeNowPlaying').textContent = file.title;
        document.getElementById('cafeCreator').textContent = file.creator;
        await this.listenShared(file.id);
        const audio = document.getElementById('audioPlayer');
        audio.onended = () => {
            this.cafeIndex = (this.cafeIndex + 1) % this.cafeQueue.length;
            if (this.cafeActive) setTimeout(() => this.playNextCafe(), 1000);
        };
    },

    stopCafe() {
        this.cafeActive = false; this.stopPlay();
        document.getElementById('cafeNowPlaying').textContent = 'AI DJ ëŒ€ê¸° ì¤‘...';
        document.getElementById('cafeCreator').textContent = '-';
        this.toast('â˜• ì¹´í˜ ë°©ì†¡ ì •ì§€');
    },

    skipCafeSong() {
        if (!this.cafeActive) return;
        this.cafeIndex = (this.cafeIndex + 1) % this.cafeQueue.length;
        this.stopPlay();
        setTimeout(() => this.playNextCafe(), 500);
    },

    async startCarWalk() {
        const sharedFiles = this.files.filter(f => f.shared);
        if (sharedFiles.length === 0) return this.toast('ê³µìœ ëœ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤');
        if (this.wallet.tl <= 0) { this.openRechargeModal('car'); return; }
        this.carWalkActive = true;
        this.simulateMovement();
        this.toast('ğŸš— ì´ë™ ëª¨ë“œ ì‹œì‘!');
        await this.playCarWalkCycle();
    },

    simulateMovement() {
        setInterval(() => {
            if (!this.carWalkActive) return;
            const states = [
                { status: 'ğŸš¶ ê±·ëŠ” ì¤‘', multiplier: 1.5, type: 'ë„ë³´' },
                { status: 'ğŸƒ ë‹¬ë¦¬ëŠ” ì¤‘', multiplier: 1.7, type: 'ì¡°ê¹…' },
                { status: 'ğŸš— ì£¼í–‰ ì¤‘', multiplier: 2.0, type: 'ì°¨ëŸ‰' }
            ];
            const state = states[Math.floor(Math.random() * states.length)];
            this.movementMultiplier = state.multiplier;
            document.getElementById('movementStatus').textContent = state.status;
            document.getElementById('movementType').textContent = state.type;
            document.getElementById('rewardMultiplier').textContent = `Ã—${state.multiplier.toFixed(1)}`;
        }, 5000);
    },

    async playCarWalkCycle() {
        if (!this.carWalkActive) return;
        const sharedFiles = this.files.filter(f => f.shared);
        const file = sharedFiles[Math.floor(Math.random() * sharedFiles.length)];
        document.getElementById('carNowPlaying').textContent = file.title;
        document.getElementById('carCreator').textContent = file.creator;
        await this.listenShared(file.id);
        const audio = document.getElementById('audioPlayer');
        audio.onended = () => { if (this.carWalkActive) setTimeout(() => this.playCarWalkCycle(), 1000); };
    },

    stopCarWalk() {
        this.carWalkActive = false; this.stopPlay();
        document.getElementById('movementStatus').textContent = 'ì •ì§€ ì¤‘';
        document.getElementById('movementType').textContent = '-';
        document.getElementById('rewardMultiplier').textContent = 'Ã—1.0';
        document.getElementById('carNowPlaying').textContent = 'ëŒ€ê¸° ì¤‘...';
        document.getElementById('carCreator').textContent = '-';
        this.toast('ğŸš— ì´ë™ ëª¨ë“œ ì •ì§€');
    },

    async startLecture() {
        const sharedFiles = this.files.filter(f => f.shared);
        if (sharedFiles.length === 0) return this.toast('ê³µìœ ëœ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤');
        if (this.wallet.tl <= 0) { this.openRechargeModal('lecture'); return; }
        this.lectureActive = true;
        this.toast('ğŸ“š ê°•ì˜ ì‹œì‘!');
        await this.playLectureCycle();
    },

    async playLectureCycle() {
        if (!this.lectureActive) return;
        const sharedFiles = this.files.filter(f => f.shared);
        const file = sharedFiles[Math.floor(Math.random() * sharedFiles.length)];
        document.getElementById('lectureNowPlaying').textContent = file.title;
        document.getElementById('lectureCreator').textContent = file.creator;
        await this.listenShared(file.id);
        const audio = document.getElementById('audioPlayer');
        const pi = setInterval(() => {
            if (!audio.paused && audio.duration) {
                const pct = (audio.currentTime / audio.duration) * 100;
                document.getElementById('lectureProgress').style.width = pct + '%';
                document.getElementById('lectureProgressText').textContent = Math.floor(pct) + '%';
            }
        }, 1000);
        audio.onended = async () => {
            clearInterval(pi);
            this.wallet.tl += 100;
            await Auth.saveUserData();
            this.updateAll();
            this.toast('âœ… ê°•ì˜ ì™„ë£Œ! +100 TL ë³´ë„ˆìŠ¤');
            document.getElementById('lectureProgress').style.width = '0%';
            document.getElementById('lectureProgressText').textContent = '0%';
            if (this.lectureActive) setTimeout(() => this.playLectureCycle(), 2000);
        };
    },

    stopLecture() {
        this.lectureActive = false; this.stopPlay();
        document.getElementById('lectureProgress').style.width = '0%';
        document.getElementById('lectureProgressText').textContent = '0%';
        document.getElementById('lectureNowPlaying').textContent = 'ê°•ì˜ ì„ íƒ ëŒ€ê¸° ì¤‘...';
        document.getElementById('lectureCreator').textContent = '-';
        this.toast('ğŸ“š ê°•ì˜ ì •ì§€');
    },

    setGoldPeriod(period) {
        this.goldPeriod = period;
        document.querySelectorAll('#goldDay,#goldWeek,#goldMonth,#goldYear').forEach(b => b.classList.remove('active'));
        document.getElementById('gold' + period.charAt(0).toUpperCase() + period.slice(1)).classList.add('active');
        this.drawGoldChart();
    },

    drawGoldChart() {
        const canvas = document.getElementById('goldChart');
        if (!canvas) return;
        const ctx = canvas.getContext('2d');
        const width = canvas.width, height = canvas.height;
        ctx.clearRect(0, 0, width, height);
        let dataPoints = [], labels = [];
        const periods = { day: 24, week: 7, month: 30, year: 12 };
        const dayLabels = ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '];
        const n = periods[this.goldPeriod] || 7;
        for (let i = 0; i < n; i++) {
            dataPoints.push(this.gold * (0.5 + Math.random() * 0.5) * (i / n));
            if (this.goldPeriod === 'day') labels.push(i + ':00');
            else if (this.goldPeriod === 'week') labels.push(dayLabels[i]);
            else if (this.goldPeriod === 'month') labels.push(i+1 + 'ì¼');
            else labels.push(i+1 + 'ì›”');
        }
        const maxValue = Math.max(...dataPoints, 0.001);
        const padding = 50, chartWidth = width - padding*2, chartHeight = height - padding*2;
        ctx.strokeStyle = 'rgba(255,255,255,0.1)'; ctx.lineWidth = 1;
        for (let i = 0; i <= 5; i++) {
            const y = padding + (chartHeight/5) * i;
            ctx.beginPath(); ctx.moveTo(padding, y); ctx.lineTo(width-padding, y); ctx.stroke();
            ctx.fillStyle = '#999'; ctx.font = '12px sans-serif'; ctx.textAlign = 'right';
            ctx.fillText((maxValue*(1-i/5)).toFixed(4)+' g', padding-10, y+4);
        }
        ctx.strokeStyle = '#ffd700'; ctx.fillStyle = 'rgba(255,215,0,0.2)'; ctx.lineWidth = 3;
        ctx.beginPath();
        dataPoints.forEach((v, i) => {
            const x = padding + (chartWidth/(dataPoints.length-1)) * i;
            const y = height - padding - (v/maxValue) * chartHeight;
            i === 0 ? ctx.moveTo(x, y) : ctx.lineTo(x, y);
        });
        ctx.stroke();
        ctx.lineTo(width-padding, height-padding); ctx.lineTo(padding, height-padding); ctx.closePath(); ctx.fill();
        dataPoints.forEach((v, i) => {
            const x = padding + (chartWidth/(dataPoints.length-1)) * i;
            const y = height - padding - (v/maxValue) * chartHeight;
            ctx.fillStyle = '#ffd700'; ctx.beginPath(); ctx.arc(x, y, 5, 0, Math.PI*2); ctx.fill();
        });
        ctx.fillStyle = '#999'; ctx.font = '11px sans-serif'; ctx.textAlign = 'center';
        labels.forEach((l, i) => {
            if (i % Math.ceil(labels.length/8) === 0) {
                const x = padding + (chartWidth/(labels.length-1)) * i;
                ctx.fillText(l, x, height-padding+20);
            }
        });
    },

    async mineToWallet() {
        const amt = parseInt(document.getElementById('miningAmountWallet').value) || 100;
        const max = Math.floor(this.wallet.tl * 0.5);
        if (amt > max) return this.toast(`í•œë„ ì´ˆê³¼! ìµœëŒ€ ${max} TL`);
        if (this.wallet.tl < amt) { this.openRechargeModal('wallet'); return; }
        const tlc = (amt * 0.01) * this.ci;
        this.wallet.tl -= amt; this.wallet.tlc += tlc;
        this.gold += (amt * 0.1 * 0.1) / 1000;
        this.walletHistory.unshift({ type: 'mine', amount: tlc, timestamp: new Date().toISOString(), description: `TL â†’ TLC ì±„êµ´ (${amt} TL)` });
        await Auth.saveUserData();
        this.updateAll();
        this.updateWalletDisplay();
        this.toast(`â›ï¸ ${tlc.toFixed(2)} TLC ì±„êµ´ ì™„ë£Œ!`);
    },

    async transferToTon() {
        const address = document.getElementById('tonWalletAddress').value.trim();
        const amount = parseFloat(document.getElementById('tonTransferAmount').value) || 0;
        if (!address) return this.toast('TON ì§€ê°‘ ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”');
        if (amount <= 0) return this.toast('ì „ì†¡í•  ê¸ˆì•¡ì„ ì…ë ¥í•˜ì„¸ìš”');
        if (amount > this.wallet.tlc) return this.toast('TLC ì”ì•¡ì´ ë¶€ì¡±í•©ë‹ˆë‹¤');
        this.wallet.tlc -= amount;
        this.walletHistory.unshift({ type: 'transfer', amount: -amount, timestamp: new Date().toISOString(), description: `TON ì „ì†¡ (${address.substring(0,8)}...)` });
        await Auth.saveUserData();
        this.updateAll(); this.updateWalletDisplay();
        this.toast(`âœ… ${amount.toFixed(2)} TLCë¥¼ TONìœ¼ë¡œ ì „ì†¡í–ˆìŠµë‹ˆë‹¤`);
        document.getElementById('tonWalletAddress').value = '';
        document.getElementById('tonTransferAmount').value = '';
    },

    updateWalletDisplay() {
        document.getElementById('tlcWalletAmount').textContent = this.wallet.tlc.toFixed(2) + ' TLC';
        document.getElementById('tlcUsdValue').textContent = (this.wallet.tlc * this.tlcPrice).toFixed(2);
        document.getElementById('ciValueWallet').textContent = this.ci.toFixed(2) + 'x';
        document.getElementById('miningMaxWallet').textContent = Math.floor(this.wallet.tl * 0.5).toLocaleString();
        const historyEl = document.getElementById('walletHistory');
        if (this.walletHistory.length === 0) {
            historyEl.innerHTML = '<div style="text-align:center;padding:40px;color:#666;">ì•„ì§ ê±°ë˜ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤</div>';
        } else {
            historyEl.innerHTML = this.walletHistory.slice(0, 10).map(tx => {
                const date = new Date(tx.timestamp);
                const icon = tx.type === 'mine' ? 'â›ï¸' : 'â¬¡';
                const color = tx.amount > 0 ? '#22c55e' : '#ef4444';
                return `<div style="padding:12px;border-bottom:1px solid rgba(255,255,255,0.05);"><div style="display:flex;justify-content:space-between;align-items:center;"><div><div style="font-weight:600;">${icon} ${tx.description}</div><div style="font-size:11px;color:#999;">${date.toLocaleString()}</div></div><div style="font-weight:700;color:${color};">${tx.amount>0?'+':''}${tx.amount.toFixed(2)} TLC</div></div></div>`;
            }).join('');
        }
    },

    async requestAiDj() {
        const prompt = document.getElementById('aiDjRequest').value.trim();
        if (!prompt) return this.toast('AI DJì—ê²Œ ìš”ì²­í•  ë¶„ìœ„ê¸°ë¥¼ ì…ë ¥í•˜ì„¸ìš”');
        this.cafeActive = true;
        const playlist = this.analyzeAndCurate(prompt);
        if (playlist.length === 0) { this.cafeActive = false; return this.toast('ìš”ì²­í•˜ì‹  ë¶„ìœ„ê¸°ì— ë§ëŠ” ìŒì•…ì´ ì—†ìŠµë‹ˆë‹¤'); }
        this.cafeQueue = playlist; this.cafeIndex = 0;
        document.getElementById('aiDjTheme').textContent = this.extractTheme(prompt);
        this.toast(`ğŸ§ AI DJê°€ ${playlist.length}ê³¡ì„ ì„ ê³¡í–ˆìŠµë‹ˆë‹¤!`);
        await this.playNextCafe();
    },

    analyzeAndCurate(prompt) {
        const sharedFiles = this.files.filter(f => f.shared);
        const lower = prompt.toLowerCase();
        let filtered = [];
        if (lower.includes('ë¹„') || lower.includes('rain')) filtered = sharedFiles.filter(f => f.mood === 'chill' || f.mood === 'sad' || f.genre === 'jazz');
        else if (lower.includes('ì•„ì¹¨') || lower.includes('morning')) filtered = sharedFiles.filter(f => f.mood === 'energetic' || f.mood === 'happy');
        else if (lower.includes('ì €ë…') || lower.includes('ë°¤') || lower.includes('night')) filtered = sharedFiles.filter(f => f.mood === 'chill' || f.mood === 'sleep' || f.mood === 'romantic');
        else if (lower.includes('ìš´ë™') || lower.includes('workout')) filtered = sharedFiles.filter(f => f.mood === 'energetic' || f.mood === 'workout');
        else if (lower.includes('ê³µë¶€') || lower.includes('ì§‘ì¤‘')) filtered = sharedFiles.filter(f => f.mood === 'focus' || f.genre === 'classic');
        else if (lower.includes('ì¬ì¦ˆ') || lower.includes('jazz')) filtered = sharedFiles.filter(f => f.genre === 'jazz');
        else filtered = sharedFiles;
        if (filtered.length === 0) filtered = sharedFiles;
        return filtered.sort(() => Math.random() - 0.5);
    },

    extractTheme(prompt) {
        if (prompt.includes('ë¹„')) return 'ğŸŒ§ï¸ ë¹„ì˜¤ëŠ” ë‚ ';
        if (prompt.includes('ì•„ì¹¨')) return 'ğŸŒ… ìƒì¾Œí•œ ì•„ì¹¨';
        if (prompt.includes('ë°¤')) return 'ğŸŒ™ í¸ì•ˆí•œ ë°¤';
        if (prompt.includes('ìš´ë™')) return 'ğŸ’ª ìš´ë™ ëª¨ë“œ';
        if (prompt.includes('ê³µë¶€')) return 'ğŸ“š ì§‘ì¤‘ í•™ìŠµ';
        if (prompt.includes('ì¬ì¦ˆ')) return 'ğŸº ì¬ì¦ˆ ë¼ìš´ì§€';
        return 'ğŸµ AI íë ˆì´ì…˜';
    },

    renderCafeGallery() {
        const el = document.getElementById('cafeGallery');
        if (!el) return;
        let allUsers = [];
        try {
            const d = localStorage.getItem('timelink_users');
            if (d) { const p = JSON.parse(d); allUsers = typeof p === 'object' && !Array.isArray(p) ? Object.values(p) : (Array.isArray(p) ? p : []); }
        } catch(e) { allUsers = []; }
        const cafes = allUsers.filter(u => u.cafeInfo && u.cafeInfo.name);
        if (cafes.length === 0) {
            el.innerHTML = '<div style="text-align:center;padding:60px;color:#666;grid-column:1/-1;">ë“±ë¡ëœ ì¹´í˜ê°€ ì—†ìŠµë‹ˆë‹¤<br><div style="margin-top:12px;font-size:14px;">ì‚¬ì—…ì íšŒì›ìœ¼ë¡œ ê°€ì…í•˜ì—¬ ì¹´í˜ë¥¼ ë“±ë¡í•´ë³´ì„¸ìš”!</div></div>';
            return;
        }
        el.innerHTML = cafes.map(cafe => {
            const info = cafe.cafeInfo;
            const comments = info.comments || [];
            return `<div style="background:rgba(139,92,46,0.05);border:2px solid #8b5c2e;border-radius:16px;overflow:hidden;">
                <div style="position:relative;height:160px;background:linear-gradient(135deg,#8b5c2e,#654321);">
                    ${info.image ? `<img src="${info.image}" style="width:100%;height:100%;object-fit:cover;" onerror="this.style.display='none'">` : `<div style="display:flex;align-items:center;justify-content:center;height:100%;font-size:3rem;">â˜•</div>`}
                </div>
                <div style="padding:16px;">
                    <div style="font-size:1.2rem;font-weight:800;color:#8b5c2e;">${info.name}</div>
                    <div style="color:#999;font-size:13px;margin-bottom:8px;">ğŸ“ ${info.location || 'ìœ„ì¹˜ ë¯¸ë“±ë¡'}</div>
                    <button class="btn btn-play" onclick="App.listenCafe('${cafe.email}')" style="width:100%;padding:12px;font-size:13px;">ğŸ§ ë°©ì†¡ ë“£ê¸°</button>
                    <div style="margin-top:12px;">
                        <div style="font-weight:700;margin-bottom:8px;font-size:13px;">ğŸ’¬ ëŒ“ê¸€ (${comments.length})</div>
                        <div style="max-height:100px;overflow-y:auto;margin-bottom:8px;">${comments.length === 0 ? '<div style="text-align:center;color:#666;font-size:12px;padding:10px;">ì²« ëŒ“ê¸€ì„ ë‚¨ê²¨ë³´ì„¸ìš”!</div>' : comments.slice(-3).reverse().map(c=>`<div style="padding:6px;background:rgba(0,0,0,0.2);border-radius:6px;margin-bottom:4px;"><div style="font-size:11px;color:#8b5c2e;font-weight:600;">${c.user}</div><div style="font-size:12px;">${c.text}</div></div>`).join('')}</div>
                        <div style="display:flex;gap:6px;"><input type="text" id="comment_${cafe.email}" placeholder="ëŒ“ê¸€..." style="flex:1;background:rgba(0,0,0,0.3);border:1px solid rgba(255,255,255,0.1);border-radius:8px;padding:8px;color:white;font-size:12px;"><button class="btn" onclick="App.addCafeComment('${cafe.email}')" style="padding:8px 12px;font-size:12px;background:#8b5c2e;">ë“±ë¡</button></div>
                    </div>
                </div>
            </div>`;
        }).join('');
    },

    async addCafeComment(cafeEmail) {
        const inputEl = document.getElementById('comment_' + cafeEmail);
        if (!inputEl) return;
        const text = inputEl.value.trim();
        if (!text) return this.toast('ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”');
        let allUsers = {};
        try { const d = localStorage.getItem('timelink_users'); if (d) allUsers = JSON.parse(d); } catch(e) { return; }
        if (!allUsers[cafeEmail]) return;
        if (!allUsers[cafeEmail].cafeInfo) allUsers[cafeEmail].cafeInfo = {};
        if (!allUsers[cafeEmail].cafeInfo.comments) allUsers[cafeEmail].cafeInfo.comments = [];
        allUsers[cafeEmail].cafeInfo.comments.push({ user: Auth.currentUser.name, text, timestamp: new Date().toISOString() });
        localStorage.setItem('timelink_users', JSON.stringify(allUsers));
        inputEl.value = '';
        this.renderCafeGallery();
        this.toast('ğŸ’¬ ëŒ“ê¸€ ë“±ë¡ë¨');
    },

    async listenCafe(cafeEmail) {
        this.toast('â˜• ì¹´í˜ ë°©ì†¡ì„ ì‹œì‘í•©ë‹ˆë‹¤');
        const sharedFiles = this.files.filter(f => f.shared);
        if (sharedFiles.length > 0) await this.listenShared(sharedFiles[Math.floor(Math.random() * sharedFiles.length)].id);
    },

    switchTab(name, evt) {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        if (evt && evt.target) evt.target.classList.add('active');
        document.getElementById('tab' + name.charAt(0).toUpperCase() + name.slice(1)).classList.add('active');
        if (name === 'discover') this.renderDiscover();
        if (name === 'myfiles') this.renderMyFiles();
        if (name === 'share') this.renderSharePlace();
        if (name === 'mining') { const el = document.getElementById('miningMax'); if(el) el.textContent = Math.floor(this.wallet.tl * 0.5).toLocaleString(); }
    },

    closeModal() {
        document.getElementById('chargeModal').style.display = 'none';
        document.getElementById('audioModal').style.display = 'none';
        this.chargeTarget = null;
    },

    updateMvpDashboard() {
        const fileCount = this.files.length;
        const sharedCount = this.files.filter(f=>f.shared).length;
        const totalBalance = this.files.reduce((s,f)=>s+(f.balance||0),0);
        const minedTlc = this.wallet.tlc;

        // Old dashboard stats
        const els = { 
            mvpFileCount: fileCount+'ê°œ', 
            mvpSharedCount: sharedCount+'ê°œ', 
            mvpTotalBalance: totalBalance.toLocaleString()+' TL', 
            mvpMinedTlc: minedTlc.toFixed(2)+' TLC' 
        };
        Object.entries(els).forEach(([id, val]) => { 
            const el = document.getElementById(id); 
            if(el) el.textContent = val; 
        });

        // Hero section stats
        const heroStats = {
            heroFileCount: fileCount,
            heroTlEarned: totalBalance.toLocaleString(),
            heroTlcMined: minedTlc.toFixed(2)
        };
        Object.entries(heroStats).forEach(([id, val]) => {
            const el = document.getElementById(id);
            if(el) el.textContent = val;
        });
    },

    updateAll() {
        document.getElementById('walletTL').textContent = this.wallet.tl.toLocaleString();
        document.getElementById('walletTLC').textContent = this.wallet.tlc.toFixed(2);
        const goldEl = document.getElementById('goldAmount');
        if (goldEl) goldEl.textContent = this.gold.toFixed(4) + ' g';
        this.renderMyFiles();
        this.renderSharePlace();
        this.renderCafeGallery();
        this.updateWalletDisplay();
        this.drawGoldChart();
        this.updateMvpDashboard();
        this.updateTlStatus();
        this.updateMiningDisplay();
        this.updateGoldReserveDisplay();
    },

    // ==================== MINING DISPLAY ====================
    updateMiningDisplay() {
        // ê¸°ì—¬ë„ ì ìˆ˜ í‘œì‹œ
        const scoreEl = document.getElementById('miningScoreValue');
        const statusEl = document.getElementById('miningStatus');
        const buttonEl = document.getElementById('miningButton');
        
        if (scoreEl) scoreEl.textContent = this.contribution.total.toLocaleString();
        if (document.getElementById('miningScoreStatus')) {
            document.getElementById('miningScoreStatus').textContent = this.contribution.total.toLocaleString();
        }

        // ì±„êµ´ ìê²© í™•ì¸
        const canMine = this.contribution.total >= 10000;
        
        if (statusEl) {
            if (canMine) {
                statusEl.style.background = 'rgba(29,185,84,0.1)';
                statusEl.style.color = '#1db954';
                statusEl.style.borderColor = '#1db954';
                statusEl.innerHTML = `âœ… ì±„êµ´ ê°€ëŠ¥! (ê¸°ì—¬ë„: ${this.contribution.total.toLocaleString()}ì )`;
            } else {
                statusEl.style.background = 'rgba(239,68,68,0.1)';
                statusEl.style.color = '#ef4444';
                statusEl.style.borderColor = '#ef4444';
                statusEl.innerHTML = `âŒ ê¸°ì—¬ë„ 10,000ì  ì´ìƒ í•„ìš” (í˜„ì¬: ${this.contribution.total.toLocaleString()}ì )`;
            }
        }

        // ë²„íŠ¼ í™œì„±í™”/ë¹„í™œì„±í™”
        if (buttonEl) {
            buttonEl.disabled = !canMine;
            buttonEl.style.opacity = canMine ? '1' : '0.5';
            buttonEl.style.cursor = canMine ? 'pointer' : 'not-allowed';
        }

        // CI í‘œì‹œ ì—…ë°ì´íŠ¸
        if (document.getElementById('ciValueDisplay')) {
            document.getElementById('ciValueDisplay').textContent = this.ci.toFixed(2);
        }

        // ì±„êµ´ ë¯¸ë¦¬ë³´ê¸° ê³„ì‚°
        this.updateMiningPreview();

        // ì´ ì±„êµ´ëŸ‰ í‘œì‹œ
        if (document.getElementById('totalMinedTLC')) {
            document.getElementById('totalMinedTLC').textContent = this.wallet.tlc.toFixed(2) + ' TLC';
        }
    },

    updateMiningPreview() {
        const amountInput = document.getElementById('miningAmount');
        if (!amountInput) return;

        const tlAmount = parseInt(amountInput.value) || 1000;
        const tlcAmount = (tlAmount / 1000) * this.ci;
        const usdValue = tlcAmount * 2.5; // 1 TLC = $2.50

        if (document.getElementById('miningInputTL')) {
            document.getElementById('miningInputTL').textContent = tlAmount.toLocaleString();
        }
        if (document.getElementById('miningOutputTLC')) {
            document.getElementById('miningOutputTLC').textContent = tlcAmount.toFixed(2);
        }
        if (document.getElementById('miningUsdValue')) {
            document.getElementById('miningUsdValue').textContent = usdValue.toFixed(2);
        }
    },

    // ==================== GOLD RESERVE DISPLAY ====================
    updateGoldReserveDisplay() {
        // ê¸ˆ ë³´ìœ ëŸ‰ ê³„ì‚° (g, oz, USD)
        const goldG = this.gold;
        const goldOz = goldG / 31.1035;
        const goldPrice = 2000; // $2000/oz
        const goldUsd = goldOz * goldPrice;

        if (document.getElementById('goldAmountKg')) {
            document.getElementById('goldAmountKg').textContent = (goldG / 1000).toFixed(3);
        }
        if (document.getElementById('goldAmountOz')) {
            document.getElementById('goldAmountOz').textContent = goldOz.toFixed(2);
        }
        if (document.getElementById('goldValueUsd')) {
            document.getElementById('goldValueUsd').textContent = goldUsd.toLocaleString();
        }

        // TLC ì´ ë°œí–‰ëŸ‰
        const totalTLC = this.wallet.tlc;
        if (document.getElementById('totalTlcSupply')) {
            document.getElementById('totalTlcSupply').textContent = totalTLC.toFixed(0);
        }

        // ê¸ˆ ë‹´ë³´ ê°€ê²©
        const goldBackedPrice = totalTLC > 0 ? goldUsd / totalTLC : 0;
        if (document.getElementById('goldBackedPriceGold')) {
            document.getElementById('goldBackedPriceGold').textContent = goldBackedPrice.toFixed(2);
        }
        if (document.getElementById('goldBackedPrice')) {
            document.getElementById('goldBackedPrice').textContent = '$' + goldBackedPrice.toFixed(2);
        }

        // ì›”ë³„/ëˆ„ì  ë§¤ì… (ì‹œë®¬ë ˆì´ì…˜)
        const monthlyRevenue = 15000;
        const monthlyGoldPurchase = monthlyRevenue * 0.1;
        const monthlyGoldG = (monthlyGoldPurchase / goldPrice) * 31.1035;

        if (document.getElementById('monthlyRevenue')) {
            document.getElementById('monthlyRevenue').textContent = monthlyRevenue.toLocaleString();
        }
        if (document.getElementById('monthlyGoldPurchase')) {
            document.getElementById('monthlyGoldPurchase').textContent = monthlyGoldPurchase.toLocaleString();
        }
        if (document.getElementById('monthlyGoldAmount')) {
            document.getElementById('monthlyGoldAmount').textContent = monthlyGoldG.toFixed(2);
        }

        const totalRevenue = monthlyRevenue * 12;
        const totalGoldPurchased = goldG;
        if (document.getElementById('totalRevenue')) {
            document.getElementById('totalRevenue').textContent = totalRevenue.toLocaleString();
        }
        if (document.getElementById('totalGoldPurchased')) {
            document.getElementById('totalGoldPurchased').textContent = totalGoldPurchased.toFixed(2);
        }
    },

    toast(msg) {
        const t = document.getElementById('toast');
        t.textContent = msg;
        t.style.display = 'block';
        setTimeout(() => t.style.display = 'none', 3000);
    },

    // ==================== TL3 PLAYER ====================
    playerMetadata: null,
    playerAudio: null,
    playerInterval: null,
    playerPlayedSeconds: 0,
    playerFileTL: 0,
    uploadQueue: [], // ì—…ë¡œë“œ ëŒ€ê¸°ì—´

    initTL3Player() {
        const dropZone = document.getElementById('tl3DropZone');
        const fileInput = document.getElementById('tl3FileInput');

        if (!dropZone || !fileInput) return;

        // í´ë¦­ ì‹œ íŒŒì¼ ì„ íƒ
        dropZone.addEventListener('click', () => fileInput.click());

        // íŒŒì¼ ì„ íƒ ì‹œ (ë‹¤ì¤‘ ì„ íƒ ì§€ì›)
        fileInput.addEventListener('change', (e) => {
            const files = Array.from(e.target.files);
            if (files.length > 0) {
                this.handleMultipleFiles(files);
            }
            fileInput.value = ''; // ì´ˆê¸°í™”í•˜ì—¬ ê°™ì€ íŒŒì¼ ì¬ì„ íƒ ê°€ëŠ¥
        });

        // ë“œë˜ê·¸ ì•¤ ë“œë¡­
        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.classList.add('dragging');
        });

        dropZone.addEventListener('dragleave', () => {
            dropZone.classList.remove('dragging');
        });

        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('dragging');
            const files = Array.from(e.dataTransfer.files);
            if (files.length > 0) {
                this.handleMultipleFiles(files);
            }
        });
    },

    async addFilesToQueue(files) {
        this.toast(`â³ ${files.length}ê°œ íŒŒì¼ ë¶„ì„ ì¤‘...`);

        for (const file of files) {
            try {
                // TL3 ë©”íƒ€ë°ì´í„° ì¶”ì¶œ ì‹œë„
                let metadata, audioBlob;
                
                try {
                    const extracted = await TL3.extractMetadata(file);
                    metadata = extracted.metadata;
                    audioBlob = extracted.audioBlob;
                } catch (error) {
                    // TL3 íŒŒì¼ì´ ì•„ë‹Œ ê²½ìš° ì¼ë°˜ íŒŒì¼ë¡œ ì²˜ë¦¬
                    metadata = {
                        title: file.name.replace(/\.[^/.]+$/, ''),
                        creator: Auth.currentUser?.email || 'anonymous',
                        creatorName: Auth.currentUser?.name || 'Unknown',
                        revenueShare: 70,
                        blockchainHash: await TL3.createBlockchainHash({
                            creator: Auth.currentUser?.email || 'anonymous',
                            timestamp: Date.now(),
                            title: file.name,
                            duration: 0
                        }),
                        certified: false,
                        format: 'TL3',
                        fileSize: file.size,
                        mimeType: file.type
                    };
                    audioBlob = file;
                }

                // ë¸”ë¡ì²´ì¸ ë ˆì§€ìŠ¤íŠ¸ë¦¬ ì²´í¬
                const existing = BlockchainRegistry.check(metadata.blockchainHash);
                
                this.uploadQueue.push({
                    id: Date.now() + Math.random(),
                    file: file,
                    metadata: metadata,
                    audioBlob: audioBlob,
                    existing: existing,
                    canShare: !existing || (existing.creator === Auth.currentUser?.email)
                });

            } catch (error) {
                console.error('íŒŒì¼ ë¶„ì„ ì˜¤ë¥˜:', error);
                this.toast(`${file.name} ë¶„ì„ ì‹¤íŒ¨`);
            }
        }

        this.renderUploadQueue();
        this.toast(`âœ… ${files.length}ê°œ íŒŒì¼ ì¶”ê°€ë¨`);
    },

    renderUploadQueue() {
        const queueEl = document.getElementById('uploadQueue');
        const listEl = document.getElementById('uploadQueueList');

        if (this.uploadQueue.length === 0) {
            queueEl.style.display = 'none';
            return;
        }

        queueEl.style.display = 'block';

        listEl.innerHTML = this.uploadQueue.map((item, index) => `
            <div style="background: rgba(138,43,226,0.1); border: 1px solid rgba(138,43,226,0.3); border-radius: 12px; padding: 16px; position: relative;">
                <button onclick="App.removeFromQueue(${index})" style="position: absolute; top: 8px; right: 8px; background: rgba(255,68,68,0.2); color: #ff4444; border: none; border-radius: 50%; width: 28px; height: 28px; cursor: pointer; font-size: 14px;">âœ•</button>
                
                <div style="display: flex; gap: 16px; align-items: start;">
                    <div style="font-size: 2.5rem; flex-shrink: 0;">${item.metadata.format === 'TL4' ? 'ğŸ¬' : 'ğŸµ'}</div>
                    <div style="flex: 1; min-width: 0;">
                        <div style="font-weight: 700; font-size: 1.1rem; margin-bottom: 4px; color: white;">${item.metadata.title}</div>
                        <div style="color: #999; font-size: 0.9rem; margin-bottom: 8px;">ğŸ‘¤ ${item.metadata.creatorName}</div>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 8px; margin-bottom: 12px;">
                            <div style="background: rgba(0,0,0,0.3); padding: 8px; border-radius: 8px; font-size: 11px;">
                                <div style="color: #999;">íŒŒì¼ í¬ê¸°</div>
                                <div style="color: white; font-weight: 600;">${(item.file.size / 1024 / 1024).toFixed(2)} MB</div>
                            </div>
                            <div style="background: rgba(0,0,0,0.3); padding: 8px; border-radius: 8px; font-size: 11px;">
                                <div style="color: #999;">ìˆ˜ìµ ë°°ë¶„</div>
                                <div style="color: white; font-weight: 600;">ì°½ì‘ì ${item.metadata.revenueShare}%</div>
                            </div>
                            <div style="background: rgba(0,0,0,0.3); padding: 8px; border-radius: 8px; font-size: 11px;">
                                <div style="color: #999;">ì¸ì¦ ì—¬ë¶€</div>
                                <div style="color: ${item.metadata.certified ? '#1db954' : '#999'}; font-weight: 600;">${item.metadata.certified ? 'âœ“ ì¸ì¦ë¨' : 'ë¯¸ì¸ì¦'}</div>
                            </div>
                        </div>

                        ${item.existing ? `
                            <div style="background: rgba(239,68,68,0.15); border: 1px solid rgba(239,68,68,0.4); border-radius: 8px; padding: 12px; margin-bottom: 8px;">
                                <div style="color: #ef4444; font-weight: 700; margin-bottom: 4px;">âš ï¸ ì´ë¯¸ ë“±ë¡ëœ íŒŒì¼</div>
                                <div style="color: #999; font-size: 12px;">ìµœì´ˆ ì—…ë¡œë”: ${item.existing.creatorName}</div>
                                <div style="color: #999; font-size: 12px;">ë“±ë¡ ì‹œê°: ${new Date(item.existing.timestamp).toLocaleString()}</div>
                                ${item.canShare ? 
                                    `<div style="color: #1db954; font-size: 12px; margin-top: 4px;">âœ“ ë³¸ì¸ì´ ìµœì´ˆ ì—…ë¡œë”ì´ë¯€ë¡œ ê³µìœ  ê°€ëŠ¥</div>` :
                                    `<div style="color: #ef4444; font-size: 12px; margin-top: 4px;">âœ• ê³µìœ  ë¶ˆê°€ (ì €ì‘ê¶Œ ë³´í˜¸)</div>`
                                }
                            </div>
                        ` : `
                            <div style="background: rgba(29,185,84,0.15); border: 1px solid rgba(29,185,84,0.4); border-radius: 8px; padding: 12px;">
                                <div style="color: #1db954; font-weight: 700; margin-bottom: 4px;">âœ“ ìƒˆë¡œìš´ íŒŒì¼ (ìµœì´ˆ ì—…ë¡œë”)</div>
                                <div style="color: #999; font-size: 12px;">ë¸”ë¡ì²´ì¸ ë ˆì§€ìŠ¤íŠ¸ë¦¬ì— ë“±ë¡ë˜ë©° ê³µìœ  ê¶Œí•œì„ ë°›ìŠµë‹ˆë‹¤</div>
                            </div>
                        `}

                        <div style="background: rgba(0,0,0,0.3); padding: 8px; border-radius: 6px; margin-top: 8px; font-family: monospace; font-size: 10px; word-break: break-all;">
                            <div style="color: #8a2be2; margin-bottom: 2px;">ğŸ”— ë¸”ë¡ì²´ì¸ í•´ì‹œ</div>
                            <div style="color: #b983ff;">${item.metadata.blockchainHash?.substring(0, 32)}...${item.metadata.blockchainHash?.substring(item.metadata.blockchainHash.length - 8)}</div>
                        </div>
                    </div>
                </div>
            </div>
        `).join('');
    },

    removeFromQueue(index) {
        this.uploadQueue.splice(index, 1);
        this.renderUploadQueue();
        this.toast('íŒŒì¼ ì œê±°ë¨');
    },

    clearUploadQueue() {
        if (this.uploadQueue.length === 0) return;
        if (!confirm(`ëŒ€ê¸°ì—´ì˜ ${this.uploadQueue.length}ê°œ íŒŒì¼ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
        
        this.uploadQueue = [];
        this.renderUploadQueue();
        this.toast('ëŒ€ê¸°ì—´ ì´ˆê¸°í™”ë¨');
    },

    async processUploadQueue() {
        if (this.uploadQueue.length === 0) {
            this.toast('ì—…ë¡œë“œí•  íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤');
            return;
        }

        this.toast(`â³ ${this.uploadQueue.length}ê°œ íŒŒì¼ ì²˜ë¦¬ ì¤‘...`);

        let successCount = 0;
        let skippedCount = 0;

        for (const item of this.uploadQueue) {
            try {
                // ë¸”ë¡ì²´ì¸ ë ˆì§€ìŠ¤íŠ¸ë¦¬ì— ë“±ë¡ ì‹œë„
                let isOriginalCreator = false;
                if (!item.existing) {
                    // ìƒˆ íŒŒì¼ - ë ˆì§€ìŠ¤íŠ¸ë¦¬ì— ë“±ë¡
                    const registered = BlockchainRegistry.register(
                        item.metadata.blockchainHash,
                        {
                            email: Auth.currentUser?.email || 'anonymous',
                            name: Auth.currentUser?.name || 'Unknown'
                        }
                    );
                    isOriginalCreator = registered;
                } else {
                    // ê¸°ì¡´ íŒŒì¼ - ë³¸ì¸ ì—¬ë¶€ í™•ì¸
                    isOriginalCreator = item.canShare;
                }

                // My Filesì— ì¶”ê°€
                const newFile = {
                    id: Date.now() + Math.random(),
                    title: item.metadata.title,
                    creator: item.metadata.creatorName,
                    tool: item.metadata.aiTool || 'custom',
                    genre: item.metadata.genre || 'unknown',
                    mood: item.metadata.mood || 'neutral',
                    desc: item.metadata.description || '',
                    type: item.metadata.format || 'TL3',
                    fileType: item.metadata.format === 'TL4' ? 'video' : 'audio',
                    mimeType: item.metadata.mimeType || item.file.type,
                    certified: item.metadata.certified || false,
                    revenue: item.metadata.revenueShare === 50 ? '55' : '73',
                    balance: 0,
                    duration: item.metadata.duration || 0,
                    fileSizeMB: (item.file.size / 1024 / 1024).toFixed(1),
                    shared: false,
                    createdAt: new Date().toISOString(),
                    blockchainHash: item.metadata.blockchainHash,
                    ipfsCID: item.metadata.ipfs?.cid || 'N/A',
                    ipfsUrl: item.metadata.ipfs?.url || 'N/A',
                    isTL3: true,
                    isOriginalCreator: isOriginalCreator, // ğŸ”‘ í•µì‹¬: ìµœì´ˆ ì—…ë¡œë” ì—¬ë¶€
                    uploadedBy: Auth.currentUser?.email || 'anonymous'
                };

                // IndexedDBì— ì €ì¥
                const arrayBuffer = await item.audioBlob.arrayBuffer();
                await DB.saveFile({
                    id: newFile.id,
                    arrayBuffer: arrayBuffer,
                    mimeType: newFile.mimeType,
                    tl3Metadata: item.metadata
                });

                this.files.push(newFile);
                successCount++;

            } catch (error) {
                console.error('íŒŒì¼ ì²˜ë¦¬ ì˜¤ë¥˜:', error);
                skippedCount++;
            }
        }

        // ì €ì¥
        await Auth.saveUserData();

        // ëŒ€ê¸°ì—´ ì´ˆê¸°í™”
        this.uploadQueue = [];
        this.renderUploadQueue();

        // UI ì—…ë°ì´íŠ¸
        this.updateAll();
        this.switchTab('myfiles');

        // ê²°ê³¼ ì•Œë¦¼
        this.toast(`âœ… ${successCount}ê°œ ì¶”ê°€ë¨ ${skippedCount > 0 ? `(${skippedCount}ê°œ ì‹¤íŒ¨)` : ''}`);
    },

    async loadTL3File(file) {
        try {
            this.toast('â³ TL3 íŒŒì¼ ë¡œë”© ì¤‘...');

            // TL3 ë©”íƒ€ë°ì´í„° ì¶”ì¶œ ì‹œë„
            let metadata, audioBlob;
            
            try {
                const extracted = await TL3.extractMetadata(file);
                metadata = extracted.metadata;
                audioBlob = extracted.audioBlob;
                this.toast('âœ… TL3 íŒŒì¼ ê²€ì¦ ì™„ë£Œ!');
            } catch (error) {
                // TL3 íŒŒì¼ì´ ì•„ë‹Œ ê²½ìš° ì¼ë°˜ MP3ë¡œ ì²˜ë¦¬
                this.toast('âš ï¸ ì¼ë°˜ MP3 íŒŒì¼ (TL3 ë³€í™˜ ê¶Œì¥)');
                metadata = {
                    title: file.name.replace(/\.[^/.]+$/, ''),
                    creator: 'Unknown',
                    creatorName: 'Unknown Artist',
                    revenueShare: 70,
                    blockchainHash: 'N/A (ì¼ë°˜ MP3)',
                    certified: false
                };
                audioBlob = file;
            }

            this.playerMetadata = metadata;

            // í”Œë ˆì´ì–´ UI í‘œì‹œ
            document.getElementById('playerUI').style.display = 'block';
            document.getElementById('tl3DropZone').style.display = 'none';

            // ë©”íƒ€ë°ì´í„° í‘œì‹œ
            document.getElementById('playerTrackTitle').textContent = metadata.title || file.name;
            document.getElementById('playerCreator').textContent = `ğŸ‘¤ ${metadata.creatorName || metadata.creator || 'Unknown'}`;
            
            if (metadata.certified) {
                document.getElementById('playerCertified').style.display = 'block';
            }

            // ë¸”ë¡ì²´ì¸ í•´ì‹œ í‘œì‹œ
            document.getElementById('blockchainHash').textContent = metadata.blockchainHash || 'N/A';

            // ìˆ˜ìµ ë°°ë¶„ ë¹„ìœ¨ í‘œì‹œ
            const creatorShare = metadata.revenueShare || 70;
            const platformShare = 100 - creatorShare;
            document.getElementById('playerCreatorSharePercent').textContent = creatorShare;
            document.getElementById('playerPlatformSharePercent').textContent = platformShare;

            // ì˜¤ë””ì˜¤ ë¡œë“œ
            const audioElement = document.getElementById('tl3Audio');
            audioElement.src = URL.createObjectURL(audioBlob);

            // ì¬ìƒ ì‹œì‘ ì‹œ ì •ì‚° ì‹œì‘
            audioElement.onplay = () => this.startPlayerPayment();
            audioElement.onpause = () => this.stopPlayerPayment();
            audioElement.onended = () => this.stopPlayerPayment();

            // ì‹œê°„ ì—…ë°ì´íŠ¸
            audioElement.ontimeupdate = () => {
                const current = Math.floor(audioElement.currentTime);
                const duration = Math.floor(audioElement.duration) || 0;
                document.getElementById('playerCurrentTime').textContent = this.formatTime(current);
                document.getElementById('playerDuration').textContent = this.formatTime(duration);
            };

        } catch (error) {
            console.error('TL3 ë¡œë“œ ì˜¤ë¥˜:', error);
            this.toast('TL3 ë¡œë“œ ì‹¤íŒ¨: ' + error.message);
        }
    },

    formatTime(seconds) {
        const m = Math.floor(seconds / 60);
        const s = seconds % 60;
        return `${m}:${s.toString().padStart(2, '0')}`;
    },

    startPlayerPayment() {
        this.playerPlayedSeconds = 0;
        
        this.playerInterval = setInterval(() => {
            this.playerPlayedSeconds++;
            
            // ì‚¬ìš©ì TL ì°¨ê°
            if (this.wallet.tl > 0) {
                this.wallet.tl--;
            }

            // ì •ì‚° ê³„ì‚°
            const consumed = this.playerPlayedSeconds;
            const creatorShare = Math.floor(consumed * (this.playerMetadata.revenueShare / 100));
            const platformShare = consumed - creatorShare;

            // UI ì—…ë°ì´íŠ¸
            document.getElementById('playerPlayedSeconds').textContent = consumed;
            document.getElementById('playerConsumedTL').textContent = consumed;
            document.getElementById('playerCreatorEarned').textContent = creatorShare;
            document.getElementById('playerPlatformEarned').textContent = platformShare;

            // ì •ì‚° ì• ë‹ˆë©”ì´ì…˜
            this.showPaymentAnimation(creatorShare);

            // TL ì—…ë°ì´íŠ¸
            this.updateAll();

        }, 1000);
    },

    stopPlayerPayment() {
        if (this.playerInterval) {
            clearInterval(this.playerInterval);
            this.playerInterval = null;
        }
    },

    showPaymentAnimation(amount) {
        const container = document.getElementById('paymentAnimation');
        container.innerHTML = `
            <div style="display: flex; align-items: center; justify-content: center; gap: 16px;">
                <span style="font-size: 1.5rem;">ğŸ’¸</span>
                <span style="color: #fff; font-size: 1.1rem; font-weight: 600;">
                    ì •ì‚° ì¤‘... ${amount} TL â†’ ì°½ì‘ì
                </span>
                <span style="font-size: 1.5rem;">â†’</span>
                <span style="color: #1db954; font-size: 1.5rem;">ğŸ‘¤</span>
            </div>
        `;
    },

    // ==================== CONTRIBUTION SYSTEM ====================
    contribution: {
        today: 0,
        total: 0,
        monthly: 0,
        rewards: 0
    },

    contributionScores: {
        'complete_listen': 10,
        'repeat_3x': 20,
        'add_playlist': 30,
        'share_sns': 100,
        'early_discover': 200
    },

    initContributionSystem() {
        // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ê¸°ì—¬ë„ ë¡œë“œ
        const saved = localStorage.getItem('contribution');
        if (saved) {
            this.contribution = JSON.parse(saved);
        }

        this.updateContributionDisplay();
    },

    simulateContribution(action) {
        const score = this.contributionScores[action] || 0;
        const reward = score * 5; // 1ì  = 5 TL

        // ê¸°ì—¬ë„ ì¦ê°€
        this.contribution.today += score;
        this.contribution.total += score;
        this.contribution.monthly += score;

        // ì €ì¥
        localStorage.setItem('contribution', JSON.stringify(this.contribution));

        // UI ì—…ë°ì´íŠ¸
        this.updateContributionDisplay();

        // ì•Œë¦¼
        this.toast(`ğŸ‰ +${score}ì  ê¸°ì—¬! ${reward} TL íšë“ ê°€ëŠ¥`);

        // íŒŒí‹°í´ íš¨ê³¼
        this.showContributionParticle(action, score);
    },

    updateContributionDisplay() {
        document.getElementById('todayContribution').innerHTML = 
            `${this.contribution.today}<span style="font-size: 2rem;">ì </span>`;
        
        const todayReward = this.contribution.today * 5;
        document.getElementById('todayReward').textContent = todayReward.toLocaleString();

        document.getElementById('totalContribution').textContent = 
            this.contribution.total.toLocaleString() + 'ì ';
        
        document.getElementById('totalRewards').textContent = 
            this.contribution.rewards.toLocaleString() + ' TL';
        
        document.getElementById('monthlyContribution').textContent = 
            this.contribution.monthly.toLocaleString() + 'ì ';

        // ë“±ê¸‰ ê³„ì‚°
        let rank = 'ìƒˆì‹¹ ğŸŒ±';
        if (this.contribution.total > 50000) rank = 'ë ˆì „ë“œ ğŸ‘‘';
        else if (this.contribution.total > 20000) rank = 'ë§ˆìŠ¤í„° ğŸ’';
        else if (this.contribution.total > 10000) rank = 'ì „ë¬¸ê°€ â­';
        else if (this.contribution.total > 5000) rank = 'ë² í…Œë‘ ğŸ¯';
        else if (this.contribution.total > 1000) rank = 'ì¤‘ê¸‰ ğŸŒ¿';
        
        document.getElementById('userRank').textContent = rank;

        // ë³´ìƒ ë°›ê¸° ë²„íŠ¼ í™œì„±í™”
        const claimBtn = document.getElementById('claimRewardBtn');
        if (this.contribution.today > 0) {
            claimBtn.disabled = false;
            claimBtn.style.opacity = '1';
            claimBtn.style.cursor = 'pointer';
        } else {
            claimBtn.disabled = true;
            claimBtn.style.opacity = '0.5';
            claimBtn.style.cursor = 'not-allowed';
        }
    },

    claimContributionReward() {
        if (this.contribution.today === 0) {
            this.toast('ì˜¤ëŠ˜ íšë“í•œ ê¸°ì—¬ë„ê°€ ì—†ìŠµë‹ˆë‹¤');
            return;
        }

        const reward = this.contribution.today * 5;
        
        // TL ì§€ê¸‰
        this.wallet.tl += reward;
        
        // ê¸°ì—¬ë„ ë¦¬ì…‹
        this.contribution.rewards += reward;
        this.contribution.today = 0;
        
        localStorage.setItem('contribution', JSON.stringify(this.contribution));
        
        // UI ì—…ë°ì´íŠ¸
        this.updateContributionDisplay();
        this.updateAll();

        this.toast(`ğŸ ${reward} TL ë³´ìƒ ë°›ê¸° ì™„ë£Œ!`);
    },

    showContributionParticle(action, score) {
        const actionNames = {
            'complete_listen': 'ì™„ê³¡ ì²­ì·¨',
            'repeat_3x': 'ë°˜ë³µ ì¬ìƒ',
            'add_playlist': 'í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ì¶”ê°€',
            'share_sns': 'SNS ê³µìœ ',
            'early_discover': 'ì‹ ê³¡ ë°œê²¬'
        };

        // ê°„ë‹¨í•œ í† ìŠ¤íŠ¸ë¡œ í‘œì‹œ
        setTimeout(() => {
            this.toast(`âœ¨ ${actionNames[action]}: +${score}ì `);
        }, 100);
    },

    // ==================== COPYRIGHT REGISTRY SYSTEM ====================
    
    loadCopyrightRegistry() {
        const registry = localStorage.getItem('copyright_registry');
        return registry ? JSON.parse(registry) : {};
    },

    saveCopyrightRegistry() {
        localStorage.setItem('copyright_registry', JSON.stringify(this.copyrightRegistry));
    },

    // íŒŒì¼ì˜ ì»¨í…ì¸  í•´ì‹œ ìƒì„± (MD5 ê¸°ë°˜)
    async generateContentHash(arrayBuffer) {
        const wordArray = CryptoJS.lib.WordArray.create(arrayBuffer);
        const hash = CryptoJS.MD5(wordArray).toString();
        return hash;
    },

    // ì°½ì‘ê¶Œ ë“±ë¡ (First-to-File)
    async registerCopyright(contentHash, metadata) {
        if (this.copyrightRegistry[contentHash]) {
            // ì´ë¯¸ ë“±ë¡ëœ ì»¨í…ì¸ 
            return {
                success: false,
                isOriginal: false,
                originalOwner: this.copyrightRegistry[contentHash].owner,
                originalDate: this.copyrightRegistry[contentHash].timestamp,
                message: 'ì´ ê³¡ì€ ì´ë¯¸ ë‹¤ë¥¸ ì‚¬ìš©ìê°€ ë¨¼ì € ë“±ë¡í–ˆìŠµë‹ˆë‹¤'
            };
        }

        // ìµœì´ˆ ë“±ë¡
        this.copyrightRegistry[contentHash] = {
            owner: Auth.currentUser.email,
            ownerName: Auth.currentUser.name,
            timestamp: Date.now(),
            blockchainHash: metadata.blockchainHash,
            title: metadata.title,
            certified: true
        };

        this.saveCopyrightRegistry();

        return {
            success: true,
            isOriginal: true,
            message: 'ğŸ† ì°½ì‘ê¶Œì´ ë¸”ë¡ì²´ì¸ì— ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!'
        };
    },

    // ì°½ì‘ê¶Œ ê²€ì¦
    verifyCopyright(contentHash) {
        if (!this.copyrightRegistry[contentHash]) {
            return { exists: false };
        }

        const record = this.copyrightRegistry[contentHash];
        const isOwner = record.owner === Auth.currentUser.email;

        return {
            exists: true,
            isOwner,
            owner: record.ownerName,
            ownerEmail: record.owner,
            timestamp: record.timestamp,
            title: record.title
        };
    },

    // ==================== MULTI-FILE UPLOAD ====================
    
    async handleMultipleFiles(files) {
        this.uploadQueue = [];
        
        for (let file of files) {
            try {
                this.toast(`ğŸ“ ì²˜ë¦¬ ì¤‘: ${file.name}...`);
                
                // íŒŒì¼ ì½ê¸°
                const arrayBuffer = await this.readFileAsArrayBuffer(file);
                
                // TL3 ë©”íƒ€ë°ì´í„° ì¶”ì¶œ ì‹œë„
                let metadata, audioBlob, contentHash;
                
                try {
                    const extracted = await TL3.extractMetadata(file);
                    metadata = extracted.metadata;
                    audioBlob = extracted.audioBlob;
                    
                    // ì˜¤ë””ì˜¤ ë°ì´í„°ë¡œ ì»¨í…ì¸  í•´ì‹œ ìƒì„±
                    const audioBuffer = await audioBlob.arrayBuffer();
                    contentHash = await this.generateContentHash(audioBuffer);
                } catch (error) {
                    // ì¼ë°˜ MP3 íŒŒì¼
                    metadata = {
                        title: file.name.replace(/\.[^/.]+$/, ''),
                        creator: Auth.currentUser.name,
                        creatorName: Auth.currentUser.name,
                        revenueShare: 70,
                        certified: false,
                        isTL3: false
                    };
                    audioBlob = file;
                    contentHash = await this.generateContentHash(arrayBuffer);
                }

                // ì°½ì‘ê¶Œ ë“±ë¡ ì‹œë„
                metadata.blockchainHash = metadata.blockchainHash || await TL3.createBlockchainHash(metadata);
                const copyrightResult = await this.registerCopyright(contentHash, metadata);

                // íì— ì¶”ê°€
                this.uploadQueue.push({
                    file,
                    metadata,
                    audioBlob,
                    arrayBuffer,
                    contentHash,
                    copyrightResult
                });

            } catch (error) {
                console.error('íŒŒì¼ ì²˜ë¦¬ ì˜¤ë¥˜:', file.name, error);
                this.toast(`âŒ ${file.name} ì²˜ë¦¬ ì‹¤íŒ¨: ${error.message}`);
            }
        }

        // í UI í‘œì‹œ
        this.displayUploadQueue();
    },

    readFileAsArrayBuffer(file) {
        return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onload = (e) => resolve(e.target.result);
            reader.onerror = () => reject(new Error('íŒŒì¼ ì½ê¸° ì‹¤íŒ¨'));
            reader.readAsArrayBuffer(file);
        });
    },

    displayUploadQueue() {
        const queueEl = document.getElementById('uploadQueue');
        const listEl = document.getElementById('uploadQueueList');
        
        if (this.uploadQueue.length === 0) {
            queueEl.style.display = 'none';
            return;
        }

        queueEl.style.display = 'block';
        document.getElementById('queueCount').textContent = this.uploadQueue.length;

        listEl.innerHTML = this.uploadQueue.map((item, index) => {
            const result = item.copyrightResult;
            const statusColor = result.isOriginal ? '#1db954' : '#ef4444';
            const statusIcon = result.isOriginal ? 'ğŸ†' : 'âš ï¸';
            const statusText = result.isOriginal ? 'ì›ì‘ì ì¸ì¦' : 'ì¤‘ë³µ íŒŒì¼';

            return `
                <div style="background: rgba(255,255,255,0.05); padding: 16px; border-radius: 12px; border-left: 4px solid ${statusColor};">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 8px;">
                        <div style="flex: 1;">
                            <div style="font-weight: 700; font-size: 1.1rem; margin-bottom: 4px;">${item.metadata.title}</div>
                            <div style="color: #999; font-size: 0.9rem;">ğŸ“ ${item.file.name}</div>
                        </div>
                        <div style="background: rgba(${result.isOriginal ? '29,185,84' : '239,68,68'}, 0.2); padding: 6px 12px; border-radius: 8px; border: 1px solid ${statusColor};">
                            <span style="color: ${statusColor}; font-size: 0.85rem; font-weight: 700;">${statusIcon} ${statusText}</span>
                        </div>
                    </div>
                    
                    ${!result.isOriginal ? `
                        <div style="background: rgba(239,68,68,0.1); padding: 12px; border-radius: 8px; margin-top: 8px;">
                            <div style="color: #ef4444; font-size: 0.9rem; line-height: 1.6;">
                                <strong>âš ï¸ ê³µìœ  ë¶ˆê°€</strong><br>
                                ${result.originalOwner}ë‹˜ì´ ë¨¼ì € ë“±ë¡í•œ ê³¡ì…ë‹ˆë‹¤<br>
                                <span style="font-size: 0.8rem; color: #999;">ë“±ë¡ì¼: ${new Date(result.originalDate).toLocaleString()}</span>
                            </div>
                        </div>
                    ` : `
                        <div style="background: rgba(29,185,84,0.1); padding: 12px; border-radius: 8px; margin-top: 8px;">
                            <div style="color: #1db954; font-size: 0.9rem; line-height: 1.6;">
                                <strong>âœ… Share Place ê³µìœ  ê°€ëŠ¥</strong><br>
                                ë‹¹ì‹ ì´ ì´ ê³¡ì˜ ìµœì´ˆ ì—…ë¡œë”ì…ë‹ˆë‹¤!
                            </div>
                        </div>
                    `}
                    
                    <div style="margin-top: 12px; font-size: 0.8rem; color: #666; font-family: monospace; word-break: break-all;">
                        Hash: ${item.contentHash.substring(0, 16)}...
                    </div>
                </div>
            `;
        }).join('');

        // ë²„íŠ¼ ì´ë²¤íŠ¸ ì—°ê²°
        const processBtn = document.getElementById('processUploadsBtn');
        const clearBtn = document.getElementById('clearQueueBtn');
        
        if (processBtn) {
            processBtn.onclick = () => this.processUploadQueue();
        }
        if (clearBtn) {
            clearBtn.onclick = () => this.clearUploadQueue();
        }
    },

    async processUploadQueue() {
        if (this.uploadQueue.length === 0) return;

        this.toast('â³ My Filesì— ì¶”ê°€ ì¤‘...');

        let successCount = 0;
        let duplicateCount = 0;

        for (const item of this.uploadQueue) {
            try {
                // IndexedDBì— ì €ì¥
                await DB.saveFile({
                    id: Date.now() + Math.random(),
                    arrayBuffer: item.arrayBuffer,
                    mimeType: item.file.type,
                    tl3Metadata: item.metadata
                });

                // files ë°°ì—´ì— ì¶”ê°€
                const newFile = {
                    id: Date.now() + Math.random(),
                    title: item.metadata.title,
                    creator: item.metadata.creatorName || Auth.currentUser.name,
                    tool: item.metadata.aiTool || 'custom',
                    genre: item.metadata.genre || 'pop',
                    mood: item.metadata.mood || 'chill',
                    desc: item.metadata.description || '',
                    type: item.file.type.startsWith('video') ? 'TL4' : 'TL3',
                    fileType: item.file.type.startsWith('video') ? 'video' : 'audio',
                    mimeType: item.file.type,
                    certified: item.metadata.certified || false,
                    revenue: item.metadata.revenueShare >= 70 ? '73' : '55',
                    balance: 0,
                    duration: item.metadata.duration || 180,
                    fileSizeMB: (item.file.size / 1024 / 1024).toFixed(1),
                    shared: false,
                    canShare: item.copyrightResult.isOriginal, // ì›ì‘ìë§Œ ê³µìœ  ê°€ëŠ¥
                    createdAt: new Date().toISOString(),
                    blockchainHash: item.metadata.blockchainHash,
                    contentHash: item.contentHash,
                    ipfsCID: item.metadata.ipfs?.cid,
                    ipfsUrl: item.metadata.ipfs?.url,
                    isTL3: true,
                    isOriginalOwner: item.copyrightResult.isOriginal
                };

                this.files.push(newFile);

                if (item.copyrightResult.isOriginal) {
                    successCount++;
                } else {
                    duplicateCount++;
                }

            } catch (error) {
                console.error('íŒŒì¼ ì €ì¥ ì˜¤ë¥˜:', error);
            }
        }

        await Auth.saveUserData();
        this.updateAll();

        // í ì´ˆê¸°í™”
        this.uploadQueue = [];
        this.displayUploadQueue();

        // ê²°ê³¼ ì•Œë¦¼
        if (successCount > 0 && duplicateCount > 0) {
            this.toast(`âœ… ${successCount}ê°œ ì¶”ê°€ (ì›ì‘), âš ï¸ ${duplicateCount}ê°œ ì¶”ê°€ (ì¤‘ë³µ, ê³µìœ  ë¶ˆê°€)`);
        } else if (successCount > 0) {
            this.toast(`ğŸ‰ ${successCount}ê°œ íŒŒì¼ì´ My Filesì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!`);
        } else if (duplicateCount > 0) {
            this.toast(`âš ï¸ ${duplicateCount}ê°œ íŒŒì¼ ì¶”ê°€ (ì¤‘ë³µ íŒŒì¼ë¡œ ê³µìœ  ë¶ˆê°€)`);
        }

        // My Files íƒ­ìœ¼ë¡œ ì „í™˜
        this.switchTab('myfiles');
    },

    clearUploadQueue() {
        this.uploadQueue = [];
        this.displayUploadQueue();
        this.toast('ğŸ—‘ï¸ ëŒ€ê¸°ì—´ì„ ë¹„ì› ìŠµë‹ˆë‹¤');
    }
};

// Make App globally available
window.App = App;
console.log('âœ… App ê°ì²´ ì •ì˜ ì™„ë£Œ');

// ì´ˆê¸°í™”
(async () => {
    console.log('ğŸš€ TimeLink ì´ˆê¸°í™” ì‹œì‘');
    
    try {
        // Auth ê°ì²´ í™•ì¸
        console.log('1ï¸âƒ£ Auth ê°ì²´ í™•ì¸:', typeof Auth);
        if (typeof Auth === 'undefined') {
            throw new Error('Auth ê°ì²´ê°€ ì •ì˜ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤!');
        }
        console.log('   âœ… Auth ê°ì²´ ì¡´ì¬');

        // Auth ì´ˆê¸°í™”
        console.log('2ï¸âƒ£ Auth.init() í˜¸ì¶œ ì¤‘...');
        await Auth.init();
        console.log('   âœ… Auth ì´ˆê¸°í™” ì™„ë£Œ');
        console.log('   - currentUser:', Auth.currentUser ? Auth.currentUser.email : 'null');
        
        // App ê°ì²´ í™•ì¸
        console.log('3ï¸âƒ£ App ê°ì²´ í™•ì¸:', typeof App);
        if (typeof App === 'undefined') {
            throw new Error('App ê°ì²´ê°€ ì •ì˜ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤!');
        }
        console.log('   âœ… App ê°ì²´ ì¡´ì¬');

        // App ì´ˆê¸°í™”
        console.log('4ï¸âƒ£ App.init() í˜¸ì¶œ ì¤‘...');
        App.init();
        console.log('   âœ… App ì´ˆê¸°í™” ì™„ë£Œ');
        
        console.log('âœ… TimeLink ì´ˆê¸°í™” ì„±ê³µ!');
    } catch (error) {
        console.error('âŒ ì´ˆê¸°í™” ì˜¤ë¥˜:', error);
        console.error('   Stack:', error.stack);
        alert('ì´ˆê¸°í™” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\n\n' + error.message + '\n\nê°œë°œì ë„êµ¬(F12)ì—ì„œ ìì„¸í•œ ë‚´ìš©ì„ í™•ì¸í•˜ì„¸ìš”.');
    }
})();

window.addEventListener('click', (e) => {
    if (e.target.id === 'tlRechargeModal') {
        App.closeRechargeModal();
    }
    if (e.target.classList.contains('modal') && e.target.id !== 'tlRechargeModal') {
        App.closeModal();
    }
});

window.addEventListener('beforeunload', () => Auth.saveUserData());
</script>
</body>
</html>
