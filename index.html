<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TimeLink â€” Time-Based Media Economy</title>
    <style>
        /* (CSS ìƒëµ - ë™ì¼í•˜ê²Œ ìœ ì§€) */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #0a0a0a; 
            color: #fff; 
            line-height: 1.6;
        }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        
        .header {
            background: linear-gradient(145deg, #1a0b2e, #1a1a1a);
            padding: 24px 32px;
            border-radius: 20px;
            margin-bottom: 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid rgba(138,43,226,0.3);
        }
        .header h1 {
            font-size: 2rem;
            background: linear-gradient(135deg, #b983ff, #8a2be2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .balances { display: flex; gap: 16px; }
        .balance {
            background: rgba(255,255,255,0.05);
            padding: 12px 20px;
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .balance .lbl { font-size: 10px; color: #999; text-transform: uppercase; }
        .balance .amt { font-size: 22px; font-weight: 800; }
        
        .tabs {
            background: rgba(17,17,17,0.8);
            border-radius: 999px;
            padding: 8px;
            display: flex;
            gap: 6px;
            margin-bottom: 28px;
            overflow-x: auto;
        }
        .tab {
            padding: 12px 24px;
            border-radius: 999px;
            border: none;
            background: transparent;
            color: #999;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.2s;
        }
        .tab:hover { background: rgba(255,255,255,0.05); color: white; }
        .tab.active { background: #8a2be2; color: white; }
        
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        
        .card {
            background: linear-gradient(145deg, #1a1a1a, #151515);
            border-radius: 20px;
            padding: 32px;
            margin-bottom: 28px;
            border: 1px solid rgba(255,255,255,0.08);
        }
        .card h2 { 
            font-size: 1.8rem; 
            margin-bottom: 24px;
            background: linear-gradient(135deg, #fff, #e0e0e0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(360px, 1fr)); gap: 24px; }
        
        .file-card {
            background: #1e1e1e;
            border-radius: 16px;
            overflow: hidden;
            border: 1px solid rgba(255,255,255,0.08);
            transition: all 0.3s;
        }
        .file-card:hover { transform: translateY(-6px); border-color: #8a2be2; }
        
        .thumb {
            height: 160px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3.5rem;
            background: linear-gradient(145deg, #2a1a3a, #1e1e1e);
            position: relative;
        }
        .thumb.video { background: linear-gradient(145deg, #ff7b00, #ff5500); }
        
        .badge {
            position: absolute;
            padding: 6px 14px;
            border-radius: 999px;
            font-size: 11px;
            font-weight: 700;
            color: white;
        }
        .badge-type { left: 12px; top: 12px; background: rgba(0,0,0,0.7); }
        .badge-cert { right: 12px; top: 12px; background: rgba(255,215,0,0.9); color: black; }
        .badge-genre { left: 12px; bottom: 12px; }
        
        .info { padding: 20px; }
        .name { font-size: 1.2rem; font-weight: 700; margin-bottom: 6px; }
        .creator { color: #999; font-size: 0.9rem; margin-bottom: 16px; }
        
        .panel {
            background: rgba(255,255,255,0.03);
            padding: 14px;
            border-radius: 12px;
            margin-bottom: 16px;
            font-size: 13px;
            border-left: 4px solid #8a2be2;
        }
        
        .actions { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .btn {
            padding: 12px;
            border: none;
            border-radius: 12px;
            font-weight: 700;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .btn:hover { transform: translateY(-2px); }
        .btn-play { background: #1db954; color: white; }
        .btn-charge { background: #f59e0b; color: black; }
        .btn-share { background: #8a2be2; color: white; grid-column: span 2; }
        .btn-disabled { background: #333; color: #666; cursor: not-allowed; }
        
        .form-group { margin-bottom: 20px; }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #999;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 14px 16px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            color: white;
            font-size: 14px;
            font-family: inherit;
        }
        
        .type-selector { display: flex; gap: 20px; margin-bottom: 28px; }
        .type-card {
            flex: 1;
            background: rgba(255,255,255,0.05);
            padding: 28px;
            border-radius: 20px;
            text-align: center;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s;
        }
        .type-card:hover { transform: translateY(-4px); }
        .type-card.selected { border-color: #1db954; background: rgba(29,185,84,0.1); }
        .type-card.video.selected { border-color: #ff5500; background: rgba(255,85,0,0.1); }
        
        .upload {
            border: 2px dashed #8a2be2;
            background: rgba(138,43,226,0.05);
            border-radius: 20px;
            padding: 50px;
            text-align: center;
            cursor: pointer;
            margin-bottom: 28px;
            transition: all 0.2s;
        }
        .upload:hover { background: rgba(138,43,226,0.1); transform: scale(1.01); }
        
        .modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.92);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        .modal-content {
            background: #1e1e1e;
            border-radius: 20px;
            padding: 36px;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .toast {
            position: fixed;
            top: 28px;
            right: 28px;
            background: #1e1e1e;
            padding: 16px 24px;
            border-radius: 999px;
            display: none;
            z-index: 3000;
            min-width: 320px;
            border-left: 6px solid #1db954;
            box-shadow: 0 4px 20px rgba(0,0,0,0.4);
        }
        
        .hero {
            background: linear-gradient(145deg, #2a1a3a, #1a1a1a);
            padding: 48px;
            border-radius: 24px;
            text-align: center;
            margin-bottom: 32px;
            border: 1px solid rgba(138,43,226,0.3);
        }
        .hero h1 {
            font-size: 3rem;
            margin-bottom: 16px;
            background: linear-gradient(135deg, #b983ff, #8a2be2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
            margin-top: 32px;
        }
        .feature-card {
            background: rgba(255,255,255,0.03);
            padding: 24px;
            border-radius: 16px;
            border: 1px solid rgba(255,255,255,0.08);
        }
        .feature-card h3 { margin: 12px 0; font-size: 1.2rem; }
        .feature-card p { color: #999; font-size: 0.9rem; line-height: 1.6; }
        
        .search-box {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 999px;
            padding: 14px 24px;
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 24px;
        }
        .search-box input {
            flex: 1;
            background: transparent;
            border: none;
            color: white;
            font-size: 15px;
            outline: none;
        }
        
        .genre-filter {
            display: flex;
            gap: 10px;
            margin-bottom: 24px;
            flex-wrap: wrap;
        }
        .genre-btn {
            padding: 8px 18px;
            border-radius: 999px;
            border: 1px solid rgba(255,255,255,0.1);
            background: transparent;
            color: #999;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        .genre-btn:hover { border-color: #8a2be2; }
        .genre-btn.active { background: #8a2be2; color: white; border-color: #8a2be2; }
        
        /* Auth Screen */
        #authScreen {
            position: fixed;
            inset: 0;
            background: linear-gradient(145deg, #1a0b2e, #0a0a0a);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }
        .auth-container {
            background: linear-gradient(145deg, #1e1e1e, #151515);
            border-radius: 24px;
            padding: 48px;
            max-width: 480px;
            width: 90%;
            border: 1px solid rgba(138,43,226,0.3);
        }
        .auth-logo {
            text-align: center;
            margin-bottom: 40px;
        }
        .auth-logo h1 {
            font-size: 2.5rem;
            background: linear-gradient(135deg, #b983ff, #8a2be2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 8px;
        }
        .auth-form { margin-top: 32px; }
        .auth-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #8a2be2, #b983ff);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 12px;
        }
        .auth-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(138,43,226,0.4);
        }
        .auth-switch {
            text-align: center;
            margin-top: 24px;
            color: #999;
            font-size: 14px;
        }
        .auth-switch a {
            color: #8a2be2;
            text-decoration: none;
            font-weight: 600;
            cursor: pointer;
        }
        .auth-switch a:hover { text-decoration: underline; }
        .auth-message {
            display: none;
            padding: 14px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            font-size: 14px;
            font-weight: 600;
        }
        #mainApp { display: none; }
        .user-info {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        .user-name {
            background: rgba(255,255,255,0.05);
            padding: 10px 18px;
            border-radius: 999px;
            font-weight: 600;
        }
        .logout-btn {
            background: rgba(255,68,68,0.2);
            color: #ff4444;
            border: 1px solid rgba(255,68,68,0.3);
            padding: 10px 20px;
            border-radius: 999px;
            font-weight: 600;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s;
        }
        .logout-btn:hover { background: rgba(255,68,68,0.3); }
    </style>
</head>
<body>

<!-- Auth Screen -->
<div id="authScreen">
    <div class="auth-container">
        <div class="auth-logo">
            <h1>â° TimeLink</h1>
            <p style="color:#999;">Time-Based Media Economy</p>
        </div>
        
        <div class="auth-message" id="authMessage"></div>
        
        <!-- Login Form -->
        <div id="loginForm" class="auth-form">
            <div class="form-group">
                <label>ì´ë©”ì¼</label>
                <input type="email" id="loginEmail" placeholder="your@email.com">
            </div>
            <div class="form-group">
                <label>ë¹„ë°€ë²ˆí˜¸</label>
                <input type="password" id="loginPassword" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
            </div>
            <button class="auth-btn" onclick="Auth.login()">ë¡œê·¸ì¸</button>
            <div class="auth-switch">
                ê³„ì •ì´ ì—†ìœ¼ì‹ ê°€ìš”? <a onclick="Auth.switchAuthMode('register')">íšŒì›ê°€ì…</a>
            </div>
        </div>
        
        <!-- Register Form -->
        <div id="registerForm" class="auth-form" style="display:none;">
            <div class="form-group">
                <label>ì´ë¦„</label>
                <input type="text" id="regName" placeholder="í™ê¸¸ë™">
            </div>
            <div class="form-group">
                <label>ì´ë©”ì¼</label>
                <input type="email" id="regEmail" placeholder="your@email.com">
            </div>
            <div class="form-group">
                <label>ë¹„ë°€ë²ˆí˜¸</label>
                <input type="password" id="regPassword" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
            </div>
            <button class="auth-btn" onclick="Auth.register()">íšŒì›ê°€ì…</button>
            <div class="auth-switch">
                ì´ë¯¸ ê³„ì •ì´ ìˆìœ¼ì‹ ê°€ìš”? <a onclick="Auth.switchAuthMode('login')">ë¡œê·¸ì¸</a>
            </div>
        </div>
    </div>
</div>

<!-- Main App -->
<div id="mainApp">

<div id="toast" class="toast"></div>
<input type="file" id="fileInput" style="display:none;" accept="audio/*,video/*">

<!-- Audio Player Modal -->
<div class="modal" id="audioModal">
    <div class="modal-content">
        <h2 id="playTitle">ì¬ìƒ ì¤‘</h2>
        <p style="color:#999; margin-bottom:20px;" id="playCreator">Creator</p>
        <div class="panel">
            <strong>â³ TL Balance</strong><br>
            <span style="font-size:2rem; font-weight:800;" id="playTL">0</span> TL
        </div>
        <audio id="audioPlayer" controls style="width:100%; margin:20px 0;"></audio>
        <button class="btn" onclick="App.stopPlay()" style="width:100%; background:#f44; color:white; padding:16px;">â¹ï¸ ì •ì§€</button>
    </div>
</div>

<!-- Charge Modal -->
<div class="modal" id="chargeModal">
    <div class="modal-content">
        <h2>ğŸ’° TL ì¶©ì „</h2>
        <div class="form-group" style="margin-top:24px;">
            <label>ì¶©ì „í•  TL</label>
            <input type="number" id="chargeAmount" value="1000" min="100" step="100">
        </div>
        <div style="display:flex; gap:12px;">
            <button class="btn btn-play" onclick="App.executeCharge()" style="flex:1; padding:16px;">ì¶©ì „</button>
            <button class="btn" onclick="App.closeModal()" style="flex:1; background:#333; color:white; padding:16px;">ì·¨ì†Œ</button>
        </div>
    </div>
</div>

<div class="container">
    <div class="header">
        <h1>â° TimeLink</h1>
        <div class="user-info">
            <div class="balances">
                <div class="balance">
                    <div class="lbl">ğŸ’° TL</div>
                    <div class="amt" id="walletTL">10,000</div>
                </div>
                <div class="balance">
                    <div class="lbl">ğŸª™ TLC</div>
                    <div class="amt" id="walletTLC">0.00</div>
                </div>
            </div>
            <div class="user-name">ğŸ‘¤ <span id="userName">User</span></div>
            <button class="logout-btn" onclick="Auth.logout()">ë¡œê·¸ì•„ì›ƒ</button>
        </div>
    </div>

    <div class="tabs">
        <button class="tab active" onclick="App.switchTab('dashboard')">ğŸ“Š Dashboard</button>
        <button class="tab" onclick="App.switchTab('create')">ğŸ“¤ Create</button>
        <button class="tab" onclick="App.switchTab('myfiles')">ğŸµ My Files</button>
        <button class="tab" onclick="App.switchTab('share')">ğŸ”„ Share Place</button>
        <button class="tab" onclick="App.switchTab('radio')">ğŸ“» Radio</button>
        <button class="tab" onclick="App.switchTab('commercial')">ğŸ“º Commercial</button>
        <button class="tab" onclick="App.switchTab('car')">ğŸš—ğŸš¶ Car & Walk</button>
        <button class="tab" onclick="App.switchTab('mining')">â›ï¸ Mining</button>
        <button class="tab" onclick="App.switchTab('lecture')">ğŸ“š Lecture</button>
        <button class="tab" onclick="App.switchTab('gold')">ğŸ† Gold</button>
        <button class="tab" onclick="App.switchTab('ton')">â¬¡ TON</button>
    </div>

    <!-- Dashboard -->
    <div id="tabDashboard" class="tab-content active">
        <div class="hero">
            <h1>â° TimeLink</h1>
            <p style="font-size:1.2rem; color:#999;">Time-Based Media Economy</p>
        </div>

        <div class="card">
            <h2>ğŸ¯ TimeLinkë€?</h2>
            <p style="color:#999; line-height:1.8; margin-bottom:24px;">
                TimeLinkëŠ” ì‹œê°„ ê¸°ë°˜ ë¯¸ë””ì–´ ê²½ì œ í”Œë«í¼ì…ë‹ˆë‹¤. ëª¨ë“  ì½˜í…ì¸ ëŠ” ì‹œê°„ê³¼ í•¨ê»˜ íë¥´ë©°, 
                ì°½ì‘ìì™€ ì²­ì·¨ì ëª¨ë‘ê°€ ê³µì •í•˜ê²Œ ê°€ì¹˜ë¥¼ ë‚˜ëˆ•ë‹ˆë‹¤.
            </p>
            
            <div class="feature-grid">
                <div class="feature-card">
                    <div style="font-size:2.5rem;">ğŸ“¤</div>
                    <h3>Create</h3>
                    <p>MP3/MP4ë¥¼ TL3/TL4ë¡œ ë³€í™˜. Suno/Udio AI ìë™ ì¸ì¦.</p>
                </div>
                <div class="feature-card">
                    <div style="font-size:2.5rem;">ğŸµ</div>
                    <h3>My Files</h3>
                    <p>TL ì¶©ì „ í›„ ì¬ìƒ. ë³¸ì¸ íŒŒì¼ë„ ì²­ì·¨ ê°€ëŠ¥.</p>
                </div>
                <div class="feature-card">
                    <div style="font-size:2.5rem;">ğŸ”„</div>
                    <h3>Share Place</h3>
                    <p>AI DJ íë ˆì´ì…˜. ì²­ì·¨ì TL ì†Œë¹„ â†’ ì°½ì‘ì TL íšë“.</p>
                </div>
                <div class="feature-card">
                    <div style="font-size:2.5rem;">ğŸš—ğŸš¶</div>
                    <h3>Car & Walk</h3>
                    <p>ì´ë™ ì¤‘ ìŒì•… ì¬ìƒ = ìµœëŒ€ 2ë°° ë³´ìƒ (Movement AI).</p>
                </div>
                <div class="feature-card">
                    <div style="font-size:2.5rem;">â›ï¸</div>
                    <h3>Mining</h3>
                    <p>TLì˜ ìµœëŒ€ 50%ë¥¼ TLCë¡œ ì±„êµ´. ê¸°ì—¬ì§€ìˆ˜ ë³€ë™.</p>
                </div>
                <div class="feature-card">
                    <div style="font-size:2.5rem;">ğŸ†</div>
                    <h3>Gold Reserve</h3>
                    <p>í”Œë«í¼ ìˆ˜ìµ 10% â†’ ê¸ˆ êµ¬ë§¤ â†’ TLC ê°€ì¹˜ ìœ ì§€.</p>
                </div>
            </div>
        </div>

        <div class="card">
            <h2>â¬¡ TON Blockchain</h2>
            <p style="color:#999; line-height:1.8;">
                TimeLinkëŠ” TON ë¸”ë¡ì²´ì¸ê³¼ ì—°ë™ë©ë‹ˆë‹¤. TLC ì½”ì¸ì€ TON ë„¤íŠ¸ì›Œí¬ì—ì„œ ê±°ë˜ë˜ë©°,
                ì‹¤ì œ ì•”í˜¸í™”íë¡œì„œì˜ ê°€ì¹˜ë¥¼ ê°–ìŠµë‹ˆë‹¤. ì§€ê°‘ ì—°ë™ í›„ ììœ ë¡­ê²Œ ì…ì¶œê¸ˆì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.
            </p>
        </div>
    </div>

    <!-- Create -->
  <!-- Create íƒ­ë§Œ ì™„ì „íˆ ì¬ì‘ì„± (ë‹¤ë¥¸ íƒ­ì€ ì™„ì „íˆ ë™ì¼) -->
<div id="tabCreate" class="tab-content">
    <div class="card">
        <h2>ğŸ“¤ Create TL3/TL4</h2>
        
        <div class="type-selector">
            <div class="type-card audio selected" id="audioCard" onclick="App.selectType('audio')">
                <div style="font-size:3rem;">ğŸµ</div>
                <h3>TL3 Audio</h3>
                <div style="color:#1db954; font-weight:700; margin-top:10px;">1ì´ˆ = 1 TL</div>
                <p style="color:#999; font-size:13px; margin-top:8px;">MP3, WAV, FLAC</p>
            </div>
            <div class="type-card video" id="videoCard" onclick="App.selectType('video')">
                <div style="font-size:3rem;">ğŸ¬</div>
                <h3>TL4 Video</h3>
                <div style="color:#ff5500; font-weight:700; margin-top:10px;">1ì´ˆ = 2 TL</div>
                <p style="color:#999; font-size:13px; margin-top:8px;">MP4, MOV, AVI</p>
            </div>
        </div>

        <!-- íŒŒì¼ ì„ íƒ ì˜ì—­ -->
        <div class="upload" id="uploadArea">
            <div style="font-size:3.5rem; margin-bottom:16px;" id="uploadIcon">ğŸµ</div>
            <h3 id="uploadTitle">íŒŒì¼ ì„ íƒí•˜ê¸°</h3>
            <p style="color:#999; margin-top:8px;" id="uploadDesc">MP3, WAV, FLAC</p>
        </div>

        <!-- íŒŒì¼ ì •ë³´ ë° ì—…ë¡œë“œ í¼ (ì²˜ìŒì—ëŠ” ìˆ¨ê¹€) -->
        <div id="uploadForm" style="display:none;">
            <!-- íŒŒì¼ ì •ë³´ íŒ¨ë„ -->
            <div class="file-info-panel" style="background:rgba(138,43,226,0.1); border:1px solid #8a2be2; border-radius:12px; padding:16px; margin-bottom:20px;">
                <div style="display:flex; justify-content:space-between; margin-bottom:8px; color:#999;">
                    <span>íŒŒì¼ëª…</span>
                    <span class="file-info-value" style="color:#fff; font-weight:600;" id="infoFileName">-</span>
                </div>
                <div style="display:flex; justify-content:space-between; margin-bottom:8px; color:#999;">
                    <span>íŒŒì¼ í¬ê¸°</span>
                    <span class="file-info-value" style="color:#fff; font-weight:600;" id="infoFileSize">-</span>
                </div>
                <div style="display:flex; justify-content:space-between; margin-bottom:8px; color:#999;">
                    <span>ì¬ìƒ ì‹œê°„</span>
                    <span class="file-info-value" style="color:#fff; font-weight:600;" id="infoDuration">ê³„ì‚° ì¤‘...</span>
                </div>
                <div style="display:flex; justify-content:space-between; margin-bottom:8px; color:#999;">
                    <span>ë³€í™˜ ìœ í˜•</span>
                    <span class="file-info-value" style="color:#fff; font-weight:600;" id="infoType">TL3 (ì˜¤ë””ì˜¤)</span>
                </div>
                <div style="margin-top:12px; text-align:center;">
                    <span style="background:#8a2be2; color:white; padding:4px 12px; border-radius:999px; font-size:12px; font-weight:600;" id="durationBadge">-</span>
                </div>
            </div>

            <!-- ì…ë ¥ í¼ -->
            <div class="form-group">
                <label>ğŸ¤ ì°½ì‘ì ì´ë¦„</label>
                <input type="text" id="fileCreator" value="Global Investor" placeholder="ì°½ì‘ì ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”">
            </div>
            
            <div class="form-group">
                <label>ğŸ¤– AI ì°½ì‘ íˆ´ (ì¸ì¦)</label>
                <select id="creatorTool">
                    <option value="suno">ğŸµ Suno AI (ìë™ ì¸ì¦)</option>
                    <option value="udio">ğŸµ Udio AI (ìë™ ì¸ì¦)</option>
                    <option value="custom">ğŸ¹ ì§ì ‘ ì‘ê³¡ (ìˆ˜ë™ ê²€í† )</option>
                </select>
            </div>

            <div class="form-group">
                <label>ğŸ¼ ì¥ë¥´</label>
                <select id="fileGenre">
                    <option value="pop">ğŸ¤ Pop</option>
                    <option value="rock">ğŸ¸ Rock</option>
                    <option value="hiphop">ğŸ§ Hip Hop</option>
                    <option value="jazz">ğŸº Jazz</option>
                    <option value="classic">ğŸ» Classic</option>
                    <option value="edm">ğŸ’¿ EDM</option>
                    <option value="kpop">ğŸ‡°ğŸ‡· K-Pop</option>
                    <option value="indie">ğŸ¹ Indie</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>ğŸ˜Œ ëŠë‚Œ (AI DJ íë ˆì´ì…˜)</label>
                <select id="fileMood">
                    <option value="energetic">ğŸ”¥ Energetic - ì—ë„ˆì§€ ë„˜ì¹˜ëŠ”</option>
                    <option value="chill">ğŸ˜Œ Chill - í¸ì•ˆí•œ</option>
                    <option value="focus">ğŸ¯ Focus - ì§‘ì¤‘ë ¥</option>
                    <option value="workout">ğŸ’ª Workout - ìš´ë™</option>
                    <option value="romantic">ğŸ’• Romantic - ë¡œë§¨í‹±</option>
                    <option value="sad">ğŸ˜¢ Sad - ìŠ¬í”ˆ</option>
                    <option value="happy">ğŸ˜Š Happy - í–‰ë³µí•œ</option>
                    <option value="sleep">ğŸ˜´ Sleep - ìˆ˜ë©´</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>ğŸ“ ì„¤ëª…</label>
                <textarea id="fileDesc" rows="3" placeholder="íŒŒì¼ì— ëŒ€í•œ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
            </div>
            
            <div class="form-group">
                <label>ğŸ’° ìˆ˜ìµ ê³„ì•½</label>
                <select id="revenue">
                    <option value="55">5:5 (ì°½ì‘ì 50% / í”Œë«í¼ 50%)</option>
                    <option value="73">7:3 (ì°½ì‘ì 70% / í”Œë«í¼ 30%)</option>
                </select>
            </div>
            
            <!-- ë³€í™˜ ë²„íŠ¼ (ì§ì ‘ onclick ì—°ê²°) -->
            <button class="btn btn-play" onclick="App.convertFile()" style="width:100%; padding:18px; font-size:1.1rem; cursor:pointer;">
                âœ¨ TL íŒŒì¼ë¡œ ë³€í™˜í•˜ê¸°
            </button>
        </div>
    </div>
</div>

<script>
// ==================== App ê°ì²´ ì¬ì •ì˜ (Create íƒ­ ê´€ë ¨ í•¨ìˆ˜ë§Œ ìˆ˜ì •) ====================
// ê¸°ì¡´ App ê°ì²´ë¥¼ ìœ ì§€í•˜ë˜, convert í•¨ìˆ˜ë§Œ í™•ì‹¤í•˜ê²Œ ì¬ì •ì˜

// ê¸°ì¡´ App ê°ì²´ê°€ ì´ë¯¸ ìˆìœ¼ë¯€ë¡œ, í•„ìš”í•œ í•¨ìˆ˜ë§Œ ë‹¤ì‹œ ì •ì˜í•©ë‹ˆë‹¤.
// ì•„ë˜ ì½”ë“œë¥¼ ê¸°ì¡´ script ì„¹ì…˜ ëë¶€ë¶„ì— ì¶”ê°€í•˜ì„¸ìš”.

// íŒŒì¼ ë³€í™˜ í•¨ìˆ˜ ì¬ì •ì˜ (ì´ë¦„ì„ convertFileë¡œ ë³€ê²½í•˜ì—¬ ì¶©ëŒ ë°©ì§€)
App.convertFile = function() {
    console.log('convertFile í•¨ìˆ˜ ì‹¤í–‰ë¨');
    
    // íŒŒì¼ ì„ íƒ í™•ì¸
    if (!App.selectedFile) {
        App.toast('íŒŒì¼ì„ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”');
        return;
    }
    
    // ì…ë ¥ê°’ ê°€ì ¸ì˜¤ê¸°
    const title = document.getElementById('fileTitle')?.value;
    const creator = document.getElementById('fileCreator')?.value;
    const tool = document.getElementById('creatorTool')?.value;
    const genre = document.getElementById('fileGenre')?.value;
    const mood = document.getElementById('fileMood')?.value;
    const desc = document.getElementById('fileDesc')?.value;
    const revenue = document.getElementById('revenue')?.value;
    
    // í•„ìˆ˜ ì…ë ¥ê°’ ê²€ì¦
    if (!title || title.trim() === '') {
        App.toast('ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”');
        return;
    }
    if (!creator || creator.trim() === '') {
        App.toast('ì°½ì‘ì ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”');
        return;
    }
    
    // íŒŒì¼ íƒ€ì… í™•ì¸
    const isVideo = App.selectedFile.type.startsWith('video');
    const isAudio = App.selectedFile.type.startsWith('audio');
    
    if (!isVideo && !isAudio) {
        App.toast('ì˜¤ë””ì˜¤ ë˜ëŠ” ë¹„ë””ì˜¤ íŒŒì¼ë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤');
        return;
    }
    
    // íŒŒì¼ í¬ê¸° í™•ì¸
    const maxSize = 500 * 1024 * 1024; // 500MB
    const fileSizeMB = (App.selectedFile.size / 1024 / 1024).toFixed(1);
    
    if (App.selectedFile.size > maxSize) {
        App.toast(`íŒŒì¼ í¬ê¸°ê°€ ë„ˆë¬´ í½ë‹ˆë‹¤ (ìµœëŒ€ 500MB). í˜„ì¬: ${fileSizeMB}MB`);
        return;
    }
    
    // AI ì¸ì¦ ì—¬ë¶€
    const certified = tool === 'suno' || tool === 'udio';
    
    App.toast('â³ íŒŒì¼ ë³€í™˜ ì¤‘... ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”');
    
    // FileReaderë¡œ íŒŒì¼ ì½ê¸°
    const reader = new FileReader();
    
    reader.onload = async function(e) {
        try {
            const dataUrl = e.target.result;
            
            // ìƒˆ íŒŒì¼ ê°ì²´ ìƒì„±
            const newFile = {
                id: Date.now(),
                title: title,
                creator: creator,
                tool: tool,
                genre: genre,
                mood: mood,
                desc: desc,
                type: isVideo ? 'TL4' : 'TL3',
                fileType: isVideo ? 'video' : 'audio',
                mimeType: App.selectedFile.type,
                certified: certified,
                revenue: revenue,
                balance: 0,
                duration: App.selectedFileDuration || 0,
                url: dataUrl,
                fileSizeMB: fileSizeMB,
                shared: false,
                createdAt: new Date().toISOString()
            };
            
            // IndexedDBì— ì €ì¥
            await DB.saveFile({ id: newFile.id, url: dataUrl });
            
            // files ë°°ì—´ì— ì¶”ê°€
            App.files.push(newFile);
            
            // ì‚¬ìš©ì ë°ì´í„° ì €ì¥
            await Auth.saveUserData();
            
            App.toast(`âœ… ${newFile.type} ë³€í™˜ ì™„ë£Œ!` + (certified ? ' (ìë™ ì¸ì¦)' : ''));
            
            // í¼ ì´ˆê¸°í™”
            document.getElementById('uploadForm').style.display = 'none';
            document.getElementById('fileInput').value = '';
            App.selectedFile = null;
            
            // My Files íƒ­ìœ¼ë¡œ ì´ë™
            App.switchTab('myfiles');
            App.updateAll();
            
        } catch (error) {
            console.error('ë³€í™˜ ì¤‘ ì˜¤ë¥˜:', error);
            App.toast('íŒŒì¼ ë³€í™˜ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤');
        }
    };
    
    reader.onerror = function(e) {
        console.error('íŒŒì¼ ì½ê¸° ì˜¤ë¥˜:', e);
        App.toast('íŒŒì¼ ì½ê¸° ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤');
    };
    
    reader.readAsDataURL(App.selectedFile);
};

// íŒŒì¼ ì„ íƒ ì²˜ë¦¬ í•¨ìˆ˜ ì¬ì •ì˜
App.handleFileChange = function(e) {
    const file = e.target.files[0];
    console.log('íŒŒì¼ ì„ íƒë¨:', file);
    
    if (!file) {
        App.toast('íŒŒì¼ ì„ íƒì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.');
        return;
    }
    
    if (!file.type.startsWith('audio/') && !file.type.startsWith('video/')) {
        App.toast('ì˜¤ë””ì˜¤ ë˜ëŠ” ë¹„ë””ì˜¤ íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤');
        e.target.value = '';
        return;
    }
    
    App.selectedFile = file;
    
    // íŒŒì¼ ì •ë³´ í‘œì‹œ
    document.getElementById('infoFileName').textContent = file.name;
    document.getElementById('infoFileSize').textContent = (file.size / 1024 / 1024).toFixed(2) + ' MB';
    document.getElementById('infoType').textContent = App.type === 'audio' ? 'TL3 (ì˜¤ë””ì˜¤)' : 'TL4 (ë¹„ë””ì˜¤)';
    document.getElementById('infoDuration').textContent = 'ê³„ì‚° ì¤‘...';
    document.getElementById('durationBadge').textContent = 'â±ï¸ ê³„ì‚° ì¤‘';
    
    // ì˜¤ë””ì˜¤ ê¸¸ì´ ê°€ì ¸ì˜¤ê¸°
    if (file.type.startsWith('audio/')) {
        const audio = new Audio();
        audio.src = URL.createObjectURL(file);
        audio.onloadedmetadata = function() {
            const duration = Math.floor(audio.duration);
            App.selectedFileDuration = duration;
            const minutes = Math.floor(duration / 60);
            const seconds = duration % 60;
            document.getElementById('infoDuration').textContent = `${minutes}:${seconds.toString().padStart(2, '0')} (${duration}ì´ˆ)`;
            document.getElementById('durationBadge').textContent = `â±ï¸ ${minutes}:${seconds.toString().padStart(2, '0')}`;
            URL.revokeObjectURL(audio.src);
        };
        audio.onerror = function() {
            document.getElementById('infoDuration').textContent = 'ê¸¸ì´ë¥¼ í™•ì¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤';
            document.getElementById('durationBadge').textContent = 'â±ï¸ --:--';
            App.selectedFileDuration = 180; // ê¸°ë³¸ê°’ 3ë¶„
        };
    } else if (file.type.startsWith('video/')) {
        const video = document.createElement('video');
        video.preload = 'metadata';
        video.src = URL.createObjectURL(file);
        video.onloadedmetadata = function() {
            const duration = Math.floor(video.duration);
            App.selectedFileDuration = duration;
            const minutes = Math.floor(duration / 60);
            const seconds = duration % 60;
            document.getElementById('infoDuration').textContent = `${minutes}:${seconds.toString().padStart(2, '0')} (${duration}ì´ˆ)`;
            document.getElementById('durationBadge').textContent = `â±ï¸ ${minutes}:${seconds.toString().padStart(2, '0')}`;
            URL.revokeObjectURL(video.src);
        };
        video.onerror = function() {
            document.getElementById('infoDuration').textContent = 'ê¸¸ì´ë¥¼ í™•ì¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤';
            document.getElementById('durationBadge').textContent = 'â±ï¸ --:--';
            App.selectedFileDuration = 180; // ê¸°ë³¸ê°’ 3ë¶„
        };
    }
    
    // ì—…ë¡œë“œ í¼ í‘œì‹œ
    document.getElementById('uploadForm').style.display = 'block';
    document.getElementById('fileTitle').value = file.name.replace(/\.[^/.]+$/, '');
    
    App.toast(`íŒŒì¼ ì„ íƒ ì™„ë£Œ: ${file.name}`);
};

// íŒŒì¼ ì…ë ¥ ìš”ì†Œì— ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë‹¤ì‹œ ì—°ê²°
document.addEventListener('DOMContentLoaded', function() {
    const fileInput = document.getElementById('fileInput');
    if (fileInput) {
        // ê¸°ì¡´ ë¦¬ìŠ¤ë„ˆ ì œê±° í›„ ìƒˆë¡œ ë“±ë¡
        fileInput.removeEventListener('change', App.handleFileChange);
        fileInput.addEventListener('change', App.handleFileChange.bind(App));
    }
    
    // ì—…ë¡œë“œ ì˜ì—­ í´ë¦­ ì´ë²¤íŠ¸
    const uploadArea = document.getElementById('uploadArea');
    if (uploadArea) {
        uploadArea.onclick = function() {
            document.getElementById('fileInput').click();
        };
    }
});

<script>
// ==================== INDEXEDDB HELPER ====================
const DB = {
    dbName: 'TimeLinkDB',
    storeName: 'files',
    db: null,

    async open() {
        return new Promise((resolve, reject) => {
            const request = indexedDB.open(this.dbName, 1);
            request.onerror = () => reject(request.error);
            request.onsuccess = () => {
                this.db = request.result;
                resolve();
            };
            request.onupgradeneeded = (event) => {
                const db = event.target.result;
                if (!db.objectStoreNames.contains(this.storeName)) {
                    db.createObjectStore(this.storeName, { keyPath: 'id' });
                }
            };
        });
    },

    async saveFile(fileData) {
        if (!this.db) await this.open();
        return new Promise((resolve, reject) => {
            const transaction = this.db.transaction([this.storeName], 'readwrite');
            const store = transaction.objectStore(this.storeName);
            const request = store.put(fileData);
            request.onsuccess = () => resolve();
            request.onerror = () => reject(request.error);
        });
    },

    async getFile(id) {
        if (!this.db) await this.open();
        return new Promise((resolve, reject) => {
            const transaction = this.db.transaction([this.storeName], 'readonly');
            const store = transaction.objectStore(this.storeName);
            const request = store.get(id);
            request.onsuccess = () => resolve(request.result);
            request.onerror = () => reject(request.error);
        });
    },

    async deleteFile(id) {
        if (!this.db) await this.open();
        return new Promise((resolve, reject) => {
            const transaction = this.db.transaction([this.storeName], 'readwrite');
            const store = transaction.objectStore(this.storeName);
            const request = store.delete(id);
            request.onsuccess = () => resolve();
            request.onerror = () => reject(request.error);
        });
    },

    async getAllFileIds() {
        if (!this.db) await this.open();
        return new Promise((resolve, reject) => {
            const transaction = this.db.transaction([this.storeName], 'readonly');
            const store = transaction.objectStore(this.storeName);
            const request = store.getAllKeys();
            request.onsuccess = () => resolve(request.result);
            request.onerror = () => reject(request.error);
        });
    }
};

// ==================== USER AUTHENTICATION SYSTEM ====================
const Auth = {
    currentUser: null,

    async init() {
        await DB.open(); // IndexedDB ì¤€ë¹„
        const savedUser = localStorage.getItem('timelink_current_user');
        if (savedUser) {
            this.currentUser = JSON.parse(savedUser);
            await App.loadUserData(); // íŒŒì¼ ë°ì´í„°ë¥¼ IndexedDBì—ì„œ ë¡œë“œ
            this.showMainApp();
        } else {
            this.showLoginScreen();
        }
    },

    showLoginScreen() {
        document.getElementById('authScreen').style.display = 'flex';
        document.getElementById('mainApp').style.display = 'none';
    },

    showMainApp() {
        document.getElementById('authScreen').style.display = 'none';
        document.getElementById('mainApp').style.display = 'block';
        
        document.getElementById('userName').textContent = this.currentUser.name;
        App.updateAll();
    },

    async register() {
        const name = document.getElementById('regName').value.trim();
        const email = document.getElementById('regEmail').value.trim().toLowerCase();
        const password = document.getElementById('regPassword').value;

        if (!name || !email || !password) {
            this.showAuthMessage('ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”', 'error');
            return;
        }

        if (password.length < 6) {
            this.showAuthMessage('ë¹„ë°€ë²ˆí˜¸ëŠ” ìµœì†Œ 6ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤', 'error');
            return;
        }

        const users = this.getAllUsers();
        if (users[email]) {
            this.showAuthMessage('ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì´ë©”ì¼ì…ë‹ˆë‹¤', 'error');
            return;
        }

        const newUser = {
            name,
            email,
            password,
            createdAt: Date.now(),
            wallet: { tl: 10000, tlc: 0 },
            files: [], // ë©”íƒ€ë°ì´í„°ë§Œ ì €ì¥ (url ì—†ìŒ)
            gold: 0
        };

        users[email] = newUser;
        localStorage.setItem('timelink_users', JSON.stringify(users));

        this.currentUser = newUser;
        localStorage.setItem('timelink_current_user', JSON.stringify(newUser));
        this.showMainApp();
        App.toast('âœ… íšŒì›ê°€ì… ì™„ë£Œ! ìë™ ë¡œê·¸ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.');
    },

    async login() {
        const email = document.getElementById('loginEmail').value.trim().toLowerCase();
        const password = document.getElementById('loginPassword').value;

        if (!email || !password) {
            this.showAuthMessage('ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”', 'error');
            return;
        }

        const users = this.getAllUsers();
        const user = users[email];

        if (!user) {
            this.showAuthMessage('ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì´ë©”ì¼ì…ë‹ˆë‹¤', 'error');
            return;
        }

        if (user.password !== password) {
            this.showAuthMessage('ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤', 'error');
            return;
        }

        this.currentUser = user;
        localStorage.setItem('timelink_current_user', JSON.stringify(user));

        await App.loadUserData(); // IndexedDBì—ì„œ íŒŒì¼ ë¡œë“œ
        this.showAuthMessage('âœ… ë¡œê·¸ì¸ ì„±ê³µ!', 'success');
        
        setTimeout(() => {
            this.showMainApp();
        }, 500);
    },

    async logout() {
        if (confirm('ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
            await this.saveUserData(); // í˜„ì¬ ë°ì´í„° ì €ì¥
            
            localStorage.removeItem('timelink_current_user');
            this.currentUser = null;
            
            App.wallet = { tl: 0, tlc: 0 };
            App.files = [];
            App.gold = 0;
            
            this.showLoginScreen();
            App.toast('ë¡œê·¸ì•„ì›ƒ ë˜ì—ˆìŠµë‹ˆë‹¤');
        }
    },

    getAllUsers() {
        const usersData = localStorage.getItem('timelink_users');
        return usersData ? JSON.parse(usersData) : {};
    },

    async saveUserData() {
        if (!this.currentUser) return;

        // ë©”íƒ€ë°ì´í„° ì €ì¥ (íŒŒì¼ ë‚´ìš© ì œì™¸)
        const users = this.getAllUsers();
        const userCopy = { ...this.currentUser };
        // íŒŒì¼ ë©”íƒ€ë°ì´í„°ì—ëŠ” urlì´ ì—†ì–´ì•¼ í•¨ (IndexedDBì— ë³„ë„ ì €ì¥)
        userCopy.files = App.files.map(f => {
            const { url, ...meta } = f; // url ì œì™¸
            return meta;
        });
        userCopy.wallet = App.wallet;
        userCopy.gold = App.gold;
        users[this.currentUser.email] = userCopy;
        localStorage.setItem('timelink_users', JSON.stringify(users));
        localStorage.setItem('timelink_current_user', JSON.stringify(userCopy));
    },

    switchAuthMode(mode) {
        document.getElementById('loginForm').style.display = mode === 'login' ? 'block' : 'none';
        document.getElementById('registerForm').style.display = mode === 'register' ? 'block' : 'none';
    },

    showAuthMessage(msg, type) {
        const messageEl = document.getElementById('authMessage');
        messageEl.textContent = msg;
        messageEl.style.display = 'block';
        messageEl.style.background = type === 'success' ? 'rgba(29,185,84,0.2)' : 'rgba(255,68,68,0.2)';
        messageEl.style.color = type === 'success' ? '#1db954' : '#ff4444';
        messageEl.style.border = `1px solid ${type === 'success' ? '#1db954' : '#ff4444'}`;
        
        setTimeout(() => {
            messageEl.style.display = 'none';
        }, 3000);
    }
};

// ==================== MAIN APP ====================
const App = {
    wallet: { tl: 10000, tlc: 0 },
    files: [], // ë©”íƒ€ë°ì´í„° + url (urlì€ IndexedDBì—ì„œ ë¡œë“œí•˜ì—¬ ì¶”ê°€)
    gold: 0,
    type: 'audio',
    selectedFile: null,
    chargeTarget: null,
    playInterval: null,
    currentFile: null,
    currentGenre: 'all',
    ci: 1.0,

    init() {
        document.getElementById('fileInput').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (!file) return;
            
            if (!file.type.startsWith('audio/') && !file.type.startsWith('video/')) {
                App.toast('ì˜¤ë””ì˜¤ ë˜ëŠ” ë¹„ë””ì˜¤ íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤');
                return;
            }
            
            App.selectedFile = file;
            document.getElementById('uploadForm').style.display = 'block';
            document.getElementById('fileTitle').value = file.name.replace(/\.[^/.]+$/, '');
            
            console.log('íŒŒì¼ ì„ íƒ:', file.name, file.type, file.size);
        });

        setInterval(() => {
            App.ci = 1.0 + Math.random();
            const ciEl = document.getElementById('ciValue');
            if (ciEl) ciEl.textContent = App.ci.toFixed(2) + 'x';
        }, 3000);

        App.updateAll();
    },

    async loadUserData() {
        if (!Auth.currentUser) return;
        
        this.wallet = Auth.currentUser.wallet || { tl: 10000, tlc: 0 };
        this.gold = Auth.currentUser.gold || 0;
        
        // ë©”íƒ€ë°ì´í„° ë¡œë“œ
        const metaFiles = Auth.currentUser.files || [];
        // IndexedDBì—ì„œ ê° íŒŒì¼ì˜ url ë¡œë“œ
        this.files = [];
        for (const meta of metaFiles) {
            const fileData = await DB.getFile(meta.id);
            if (fileData) {
                this.files.push({ ...meta, url: fileData.url });
            } else {
                // íŒŒì¼ ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ë©”íƒ€ë°ì´í„°ë§Œ ìœ ì§€ (url ì—†ìŒ)
                this.files.push(meta);
            }
        }
        this.updateAll();
    },

    selectType(type) {
        this.type = type;
        document.getElementById('audioCard').classList.toggle('selected', type === 'audio');
        document.getElementById('videoCard').classList.toggle('selected', type === 'video');
        
        const icons = { audio: 'ğŸµ', video: 'ğŸ¬' };
        const titles = { audio: 'íŒŒì¼ ì„ íƒí•˜ê¸°', video: 'ë¹„ë””ì˜¤ ì„ íƒí•˜ê¸°' };
        const descs = { audio: 'MP3, WAV, FLAC', video: 'MP4, MOV, AVI' };
        
        document.getElementById('uploadIcon').textContent = icons[type];
        document.getElementById('uploadTitle').textContent = titles[type];
        document.getElementById('uploadDesc').textContent = descs[type];
        document.getElementById('fileInput').accept = type === 'audio' ? 'audio/*' : 'video/*';
    },

    async convert() {
        if (!this.selectedFile) return this.toast('íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”');
        
        const title = document.getElementById('fileTitle').value;
        const creator = document.getElementById('fileCreator').value;
        const tool = document.getElementById('creatorTool').value;
        const genre = document.getElementById('fileGenre').value;
        const mood = document.getElementById('fileMood').value;
        const desc = document.getElementById('fileDesc').value;
        const revenue = document.getElementById('revenue').value;
        
        if (!title) return this.toast('ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”');
        
        const isVideo = this.selectedFile.type.startsWith('video');
        const isAudio = this.selectedFile.type.startsWith('audio');
        
        if (!isVideo && !isAudio) {
            return this.toast('ì˜¤ë””ì˜¤ ë˜ëŠ” ë¹„ë””ì˜¤ íŒŒì¼ë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤');
        }
        
        const maxSize = 500 * 1024 * 1024; // 500MB
        const fileSizeMB = (this.selectedFile.size / 1024 / 1024).toFixed(1);
        
        if (this.selectedFile.size > maxSize) {
            return this.toast(`íŒŒì¼ í¬ê¸°ê°€ ë„ˆë¬´ í½ë‹ˆë‹¤ (ìµœëŒ€ 500MB). í˜„ì¬: ${fileSizeMB}MB`);
        }
        
        const certified = tool === 'suno' || tool === 'udio';
        
        this.toast('â³ íŒŒì¼ ë³€í™˜ ì¤‘... ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”');
        
        const reader = new FileReader();
        
        reader.onload = async (e) => {
            const dataUrl = e.target.result;
            
            const newFile = {
                id: Date.now(),
                title,
                creator,
                tool,
                genre,
                mood,
                desc,
                type: isVideo ? 'TL4' : 'TL3',
                fileType: isVideo ? 'video' : 'audio',
                mimeType: this.selectedFile.type,
                certified,
                revenue,
                balance: 0,
                fileSizeMB: fileSizeMB,
                shared: false
            };
            
            // íŒŒì¼ ë°ì´í„°ë¥¼ IndexedDBì— ì €ì¥
            await DB.saveFile({ id: newFile.id, url: dataUrl });
            
            // ë©”íƒ€ë°ì´í„°ë§Œ files ë°°ì—´ì— ì¶”ê°€ (urlì€ ë‚˜ì¤‘ì— ë¡œë“œ)
            this.files.push({ ...newFile, url: dataUrl }); // ë©”ëª¨ë¦¬ìƒì—ëŠ” url í¬í•¨
            await Auth.saveUserData(); // localStorageì— ë©”íƒ€ë°ì´í„° ì €ì¥
            
            this.toast(`âœ… ${newFile.type} ë³€í™˜ ì™„ë£Œ!` + (certified ? ' (ìë™ ì¸ì¦)' : '') + ` (${fileSizeMB}MB)`);
            
            document.getElementById('uploadForm').style.display = 'none';
            document.getElementById('fileInput').value = '';
            this.selectedFile = null;
            
            this.switchTab('myfiles');
            this.updateAll();
        };
        
        reader.onerror = (e) => {
            console.error('âŒ íŒŒì¼ ì½ê¸° ì˜¤ë¥˜:', e);
            this.toast('íŒŒì¼ ì½ê¸° ì˜¤ë¥˜: ' + e.target.error);
        };
        
        reader.readAsDataURL(this.selectedFile);
    },

    renderMyFiles() {
        const el = document.getElementById('myFilesList');
        if (this.files.length === 0) {
            el.innerHTML = '<div style="text-align:center;padding:60px;color:#666">ğŸ“ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤</div>';
            return;
        }
        
        const genreEmoji = {pop:'ğŸ¤',rock:'ğŸ¸',hiphop:'ğŸ§',jazz:'ğŸº',classic:'ğŸ»',edm:'ğŸ’¿',kpop:'ğŸ‡°ğŸ‡·',indie:'ğŸ¹'};
        const genreColor = {pop:'#ff6b6b',rock:'#4ecdc4',hiphop:'#ffd93d',jazz:'#a8e6cf',classic:'#b39eb5',edm:'#ff8a5c',kpop:'#ff1493',indie:'#9370db'};
        
        el.innerHTML = this.files.map(f => `
            <div class="file-card">
                <div class="thumb ${f.fileType}">
                    <div style="font-size:4rem">${f.type==='TL4'?'ğŸ¬':'ğŸµ'}</div>
                    <span class="badge badge-type">${f.type}</span>
                    ${f.certified?'<span class="badge badge-cert">âœ“ ì¸ì¦</span>':''}
                    <span class="badge badge-genre" style="background:${genreColor[f.genre]||'#666'}">${genreEmoji[f.genre]||'ğŸµ'}</span>
                </div>
                <div class="info">
                    <div class="name">${f.title}</div>
                    <div class="creator">${f.creator} Â· ${f.tool}</div>
                    <div class="panel">
                        <strong>â³ TL Balance</strong><br>
                        <span style="font-size:1.6rem;font-weight:800;">${f.balance.toLocaleString()}</span> TL
                    </div>
                    <div class="actions">
                        ${f.url && f.balance > 0 ?
                            `<button class="btn btn-play" onclick="App.play(${f.id})">â–¶ï¸ ì¬ìƒ</button>` :
                            f.url ?
                                `<button class="btn btn-disabled" disabled>âš ï¸ TL ì¶©ì „ í•„ìš”</button>` :
                                `<button class="btn btn-disabled" disabled>ğŸš« ì—…ë¡œë“œ í•„ìš”</button>`
                        }
                        <button class="btn btn-charge" onclick="App.openCharge(${f.id})">ğŸ’° ì¶©ì „</button>
                        ${!f.shared?
                            `<button class="btn btn-share" onclick="App.share(${f.id})">ğŸ”„ ê³µìœ </button>`:
                            `<button class="btn" style="background:#555;color:#999;" disabled>âœ“ ê³µìœ ë¨</button>`
                        }
                    </div>
                </div>
            </div>
        `).join('');
    },

    renderSharePlace() {
        const el = document.getElementById('sharePlaceContent');
        const sharedFiles = this.files.filter(f => f.shared);
        
        if (sharedFiles.length === 0) {
            el.innerHTML = '<div style="text-align:center;padding:60px;color:#666">ğŸ”„ ê³µìœ ëœ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤</div>';
            return;
        }
        
        let filtered = sharedFiles;
        if (this.currentGenre !== 'all') {
            filtered = filtered.filter(f => f.genre === this.currentGenre);
        }
        
        const moods = {
            energetic: 'ğŸ”¥ Energetic',
            chill: 'ğŸ˜Œ Chill',
            focus: 'ğŸ¯ Focus',
            workout: 'ğŸ’ª Workout',
            romantic: 'ğŸ’• Romantic',
            sad: 'ğŸ˜¢ Sad',
            happy: 'ğŸ˜Š Happy',
            sleep: 'ğŸ˜´ Sleep'
        };
        
        const genreEmoji = {pop:'ğŸ¤',rock:'ğŸ¸',hiphop:'ğŸ§',jazz:'ğŸº',classic:'ğŸ»',edm:'ğŸ’¿',kpop:'ğŸ‡°ğŸ‡·',indie:'ğŸ¹'};
        const genreColor = {pop:'#ff6b6b',rock:'#4ecdc4',hiphop:'#ffd93d',jazz:'#a8e6cf',classic:'#b39eb5',edm:'#ff8a5c',kpop:'#ff1493',indie:'#9370db'};
        
        let html = '';
        Object.keys(moods).forEach(mood => {
            const moodFiles = filtered.filter(f => f.mood === mood);
            if (moodFiles.length === 0) return;
            
            html += `
                <div style="margin-bottom:40px;">
                    <h3 style="margin-bottom:20px; font-size:1.4rem;">${moods[mood]}</h3>
                    <div class="grid">
                        ${moodFiles.map(f => `
                            <div class="file-card" onclick="App.listenShared(${f.id})">
                                <div class="thumb ${f.fileType}">
                                    <div style="font-size:4rem">${f.type==='TL4'?'ğŸ¬':'ğŸµ'}</div>
                                    <span class="badge badge-type">${f.type}</span>
                                    <span class="badge badge-genre" style="background:${genreColor[f.genre]||'#666'}">${genreEmoji[f.genre]||'ğŸµ'}</span>
                                </div>
                                <div class="info">
                                    <div class="name">${f.title}</div>
                                    <div class="creator">${f.creator}</div>
                                    <div class="panel">
                                        <strong>ìˆ˜ìµ ê³„ì•½</strong><br>
                                        ${f.revenue==='55'?'ì°½ì‘ì 50% / í”Œë«í¼ 50%':'ì°½ì‘ì 70% / í”Œë«í¼ 30%'}
                                    </div>
                                    <button class="btn btn-play" onclick="event.stopPropagation(); App.listenShared(${f.id})" style="width:100%;">
                                        ğŸ§ ì²­ì·¨ (1 TL/sec)
                                    </button>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        });
        
        el.innerHTML = html;
    },

    openCharge(id) {
        const file = this.files.find(f => f.id === id);
        if (!file) {
            this.toast('íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
            return;
        }
        if (this.wallet.tl <= 0) {
            this.toast('ë³´ìœ  TLì´ ì—†ìŠµë‹ˆë‹¤');
            return;
        }
        this.chargeTarget = id;
        const chargeInput = document.getElementById('chargeAmount');
        chargeInput.value = Math.min(1000, this.wallet.tl);
        chargeInput.max = this.wallet.tl;
        document.getElementById('chargeModal').style.display = 'flex';
    },

    async executeCharge() {
        if (!this.chargeTarget) {
            this.toast('ì¶©ì „ ëŒ€ìƒì´ ì—†ìŠµë‹ˆë‹¤');
            this.closeModal();
            return;
        }

        const file = this.files.find(f => f.id === this.chargeTarget);
        if (!file) {
            this.toast('íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
            this.closeModal();
            return;
        }

        const amtInput = document.getElementById('chargeAmount');
        let amt = parseInt(amtInput.value);
        if (isNaN(amt) || amt <= 0) {
            this.toast('ì˜¬ë°”ë¥¸ ê¸ˆì•¡ì„ ì…ë ¥í•˜ì„¸ìš”');
            return;
        }

        if (amt > this.wallet.tl) {
            this.toast(`TLì´ ë¶€ì¡±í•©ë‹ˆë‹¤ (ë³´ìœ : ${this.wallet.tl.toLocaleString()} TL)`);
            return;
        }

        this.wallet.tl -= amt;
        file.balance += amt;

        await Auth.saveUserData();
        this.updateAll();
        this.closeModal();
        this.toast(`âœ… ${amt.toLocaleString()} TL ì¶©ì „ ì™„ë£Œ!`);
    },

    async play(id) {
        const file = this.files.find(f => f.id === id);
        if (!file) {
            this.toast('íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
            return;
        }
        
        if (file.balance <= 0) {
            this.toast('TLì„ ì¶©ì „í•˜ì„¸ìš”');
            return;
        }
        
        if (!file.url) {
            this.toast('ì¬ìƒ ê°€ëŠ¥í•œ íŒŒì¼ì´ ì•„ë‹™ë‹ˆë‹¤');
            return;
        }
        
        this.currentFile = file;
        
        if (file.fileType === 'video') {
            const video = document.createElement('video');
            video.controls = true;
            video.autoplay = true;
            video.style.cssText = 'position:fixed; top:0; left:0; width:100%; height:100vh; z-index:10000; background:black;';
            video.src = file.url;
            
            const closeBtn = document.createElement('button');
            closeBtn.textContent = 'âœ• ë‹«ê¸°';
            closeBtn.style.cssText = 'position:fixed; top:20px; right:20px; z-index:10001; background:#f44; color:white; border:none; border-radius:8px; padding:12px 24px; font-size:16px; font-weight:700; cursor:pointer;';
            closeBtn.onclick = () => {
                this.stopPlay();
                document.body.removeChild(video);
                document.body.removeChild(closeBtn);
            };
            
            document.body.appendChild(video);
            document.body.appendChild(closeBtn);
            
            console.log('ğŸ¬ ë¹„ë””ì˜¤ ì¬ìƒ:', file.title);
            
            if (this.playInterval) clearInterval(this.playInterval);
            this.playInterval = setInterval(async () => {
                if (file.balance > 0) {
                    file.balance -= 2;
                    await Auth.saveUserData();
                    if (file.balance <= 0) {
                        this.stopPlay();
                        document.body.removeChild(video);
                        document.body.removeChild(closeBtn);
                        this.toast('â¹ï¸ TL ì†Œì§„');
                    }
                }
            }, 1000);
            
        } else {
            const audio = document.getElementById('audioPlayer');
            audio.src = file.url;
            
            console.log('ğŸµ ì˜¤ë””ì˜¤ ì¬ìƒ:', {
                title: file.title,
                mimeType: file.mimeType,
                size: file.fileSizeMB + 'MB'
            });
            
            document.getElementById('audioModal').style.display = 'flex';
            document.getElementById('playTitle').textContent = file.title;
            document.getElementById('playCreator').textContent = file.creator;
            document.getElementById('playTL').textContent = file.balance;
            
            audio.play()
                .then(() => {
                    console.log('âœ… ì¬ìƒ ì‹œì‘!');
                    this.toast(`ğŸµ ${file.title} ì¬ìƒ ì¤‘`);
                })
                .catch(err => {
                    console.error('âŒ ì¬ìƒ ì˜¤ë¥˜:', err);
                    this.toast('ì¬ìƒ ì˜¤ë¥˜: ' + err.message);
                    this.stopPlay();
                });
            
            if (this.playInterval) clearInterval(this.playInterval);
            this.playInterval = setInterval(async () => {
                if (file.balance > 0) {
                    file.balance -= 1;
                    document.getElementById('playTL').textContent = file.balance;
                    await Auth.saveUserData();
                    
                    if (file.balance <= 0) {
                        this.stopPlay();
                        this.toast('â¹ï¸ TL ì†Œì§„');
                    }
                }
            }, 1000);
        }
    },

    async listenShared(id) {
        const file = this.files.find(f => f.id === id);
        
        if (!file) {
            this.toast('íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
            return;
        }
        
        if (this.wallet.tl <= 0) {
            this.toast('TLì´ ë¶€ì¡±í•©ë‹ˆë‹¤');
            return;
        }
        
        if (!file.url) {
            this.toast('ì¬ìƒ ê°€ëŠ¥í•œ íŒŒì¼ì´ ì•„ë‹™ë‹ˆë‹¤ (ì—…ë¡œë“œëœ íŒŒì¼ë§Œ ì¬ìƒ ê°€ëŠ¥)');
            return;
        }
        
        this.currentFile = file;
        
        const audio = document.getElementById('audioPlayer');
        audio.src = file.url;
        
        document.getElementById('audioModal').style.display = 'flex';
        document.getElementById('playTitle').textContent = file.title;
        document.getElementById('playCreator').textContent = file.creator + ' (Share Place)';
        document.getElementById('playTL').textContent = this.wallet.tl;
        
        audio.play()
            .then(() => {
                console.log('âœ… Share Place ì¬ìƒ ì‹œì‘!');
            })
            .catch(err => {
                console.error('âŒ ì¬ìƒ ì˜¤ë¥˜:', err);
                this.toast('ì¬ìƒ ì˜¤ë¥˜: ' + err.message);
                this.stopPlay();
            });
        
        if (this.playInterval) clearInterval(this.playInterval);
        this.playInterval = setInterval(async () => {
            if (this.wallet.tl > 0) {
                const cost = file.type === 'TL4' ? 2 : 1;
                this.wallet.tl -= cost;
                
                const creatorShare = file.revenue === '55' ? 0.5 : 0.7;
                const creatorEarn = cost * creatorShare;
                file.balance += creatorEarn;
                
                const platformShare = cost * (1 - creatorShare);
                const goldPurchase = platformShare * 0.1;
                this.gold += goldPurchase / 1000; // g ë‹¨ìœ„
                
                document.getElementById('playTL').textContent = this.wallet.tl;
                await Auth.saveUserData();
                this.updateAll();
                
                if (this.wallet.tl <= 0) {
                    this.stopPlay();
                    this.toast('â¹ï¸ TL ì†Œì§„');
                }
            }
        }, 1000);
    },

    stopPlay() {
        if (this.playInterval) clearInterval(this.playInterval);
        
        const audio = document.getElementById('audioPlayer');
        audio.pause();
        audio.src = '';
        
        document.getElementById('audioModal').style.display = 'none';
        this.currentFile = null;
        Auth.saveUserData();
        this.updateAll();
    },

    async share(id) {
        const file = this.files.find(f => f.id === id);
        if (!file) return;
        if (!file.certified) return this.toast('ì¸ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤');
        
        file.shared = true;
        await Auth.saveUserData();
        this.toast(`ğŸ”„ ${file.title} Share Placeë¡œ ì´ë™!`);
        this.updateAll();
    },

    filterGenre(genre) {
        this.currentGenre = genre;
        document.querySelectorAll('.genre-btn').forEach(b => b.classList.remove('active'));
        event.target.classList.add('active');
        this.renderSharePlace();
    },

    searchShare() {
        // ê²€ìƒ‰ ê¸°ëŠ¥ (í–¥í›„ êµ¬í˜„)
    },

    async mine() {
        const amt = parseInt(document.getElementById('miningAmount').value) || 100;
        const max = Math.floor(this.wallet.tl * 0.5);
        
        if (amt > max) return this.toast(`í•œë„ ì´ˆê³¼! ìµœëŒ€ ${max} TL`);
        if (this.wallet.tl < amt) return this.toast('TL ë¶€ì¡±');
        
        const tlc = (amt * 0.01) * this.ci;
        this.wallet.tl -= amt;
        this.wallet.tlc += tlc;
        
        const platformFee = amt * 0.1;
        this.gold += (platformFee * 0.1) / 1000;
        
        await Auth.saveUserData();
        this.updateAll();
        this.toast(`â›ï¸ ${tlc.toFixed(2)} TLC ì±„êµ´!`);
    },

    switchTab(name) {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        
        event.target.classList.add('active');
        document.getElementById('tab' + name.charAt(0).toUpperCase() + name.slice(1)).classList.add('active');
        
        if (name === 'myfiles') this.renderMyFiles();
        if (name === 'share') this.renderSharePlace();
        if (name === 'mining') document.getElementById('miningMax').textContent = Math.floor(this.wallet.tl * 0.5).toLocaleString();
    },

    closeModal() {
        document.getElementById('chargeModal').style.display = 'none';
        document.getElementById('audioModal').style.display = 'none';
        this.chargeTarget = null;
    },

    updateAll() {
        document.getElementById('walletTL').textContent = this.wallet.tl.toLocaleString();
        document.getElementById('walletTLC').textContent = this.wallet.tlc.toFixed(2);
        document.getElementById('goldAmount').textContent = this.gold.toFixed(4) + ' g';
        
        this.renderMyFiles();
        this.renderSharePlace();
    },

    toast(msg) {
        const t = document.getElementById('toast');
        t.textContent = msg;
        t.style.display = 'block';
        setTimeout(() => t.style.display = 'none', 3000);
    }
};

// ì´ˆê¸°í™”
(async () => {
    await Auth.init();
    App.init();
})();

window.addEventListener('click', (e) => {
    if (e.target.classList.contains('modal')) App.closeModal();
});

window.addEventListener('beforeunload', () => Auth.saveUserData());
</script>

</body>
</html>
